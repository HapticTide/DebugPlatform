import{a as Al,d as Fl,r as d,u as Ur,e as ra,L as ct,b as ur,f as zl,g as xr,R as Jt,B as $l,h as Bl,i as Xs}from"./vendor-OZmp0u2f.js";import{g as so,r as ro}from"./protobuf-Dqj1RN3m.js";import{c as Ve}from"./zustand-DD08SlDH.js";import{c as g,R as Es,A as Bn,C as Is,X as Ms,Y as Ds,T as Rs,a as _n,b as vr,L as za,d as gn,e as _l,B as Wl,f as Hl,g as Ul}from"./recharts-C9adVEF_.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var bn={exports:{}},Qs={};var $a;function Vl(){if($a)return Qs;$a=1;var t=Al(),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,u){var x,m={},h=null,y=null;u!==void 0&&(h=""+u),c.key!==void 0&&(h=""+c.key),c.ref!==void 0&&(y=c.ref);for(x in c)n.call(c,x)&&!i.hasOwnProperty(x)&&(m[x]=c[x]);if(l&&l.defaultProps)for(x in c=l.defaultProps,c)m[x]===void 0&&(m[x]=c[x]);return{$$typeof:r,type:l,key:h,ref:y,props:m,_owner:a.current}}return Qs.Fragment=s,Qs.jsx=o,Qs.jsxs=o,Qs}var Ba;function ql(){return Ba||(Ba=1,bn.exports=Vl()),bn.exports}var e=ql(),wr={},_a;function Gl(){if(_a)return wr;_a=1;var t=Fl();return wr.createRoot=t.createRoot,wr.hydrateRoot=t.hydrateRoot,wr}var Yl=Gl();const Kl=so(Yl),Jl=t=>(r,s,n)=>{const a=n.subscribe;return n.subscribe=((o,l,c)=>{let u=o;if(l){const x=c?.equalityFn||Object.is;let m=o(n.getState());u=h=>{const y=o(h);if(!x(m,y)){const p=m;l(m=y,p)}},c?.fireImmediately&&l(m,m)}return a(u)}),t(r,s,n)},Xl=Jl;function no(t,r){let s;try{s=t()}catch{return}return{getItem:a=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),l=(i=s.getItem(a))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(a,i)=>s.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>s.removeItem(a)}}const Wn=t=>r=>{try{const s=t(r);return s instanceof Promise?s:{then(n){return Wn(n)(s)},catch(n){return this}}}catch(s){return{then(n){return this},catch(n){return Wn(n)(s)}}}},Ql=(t,r)=>(s,n,a)=>{let i={storage:no(()=>localStorage),partialize:f=>f,version:0,merge:(f,w)=>({...w,...f}),...r},o=!1;const l=new Set,c=new Set;let u=i.storage;if(!u)return t((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...f)},n,a);const x=()=>{const f=i.partialize({...n()});return u.setItem(i.name,{state:f,version:i.version})},m=a.setState;a.setState=(f,w)=>(m(f,w),x());const h=t((...f)=>(s(...f),x()),n,a);a.getInitialState=()=>h;let y;const p=()=>{var f,w;if(!u)return;o=!1,l.forEach(E=>{var S;return E((S=n())!=null?S:h)});const N=((w=i.onRehydrateStorage)==null?void 0:w.call(i,(f=n())!=null?f:h))||void 0;return Wn(u.getItem.bind(u))(i.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate){const S=i.migrate(E.state,E.version);return S instanceof Promise?S.then(j=>[!0,j]):[!0,S]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var S;const[j,k]=E;if(y=i.merge(k,(S=n())!=null?S:h),s(y,!0),j)return x()}).then(()=>{N?.(y,void 0),y=n(),o=!0,c.forEach(E=>E(y))}).catch(E=>{N?.(void 0,E)})};return a.persist={setOptions:f=>{i={...i,...f},f.storage&&(u=f.storage)},clearStorage:()=>{u?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>p(),hasHydrated:()=>o,onHydrate:f=>(l.add(f),()=>{l.delete(f)}),onFinishHydration:f=>(c.add(f),()=>{c.delete(f)})},i.skipHydration||p(),y||h},na=Ql,ce="/api";async function fe(t,r){const s=await fetch(t,{headers:{"Content-Type":"application/json",Accept:"application/json",...r?.headers},...r});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const n=await s.text();if(n)return JSON.parse(n)}const Le={get:t=>fe(t),post:(t,r)=>fe(t,{method:"POST",body:r!==void 0?JSON.stringify(r):void 0}),put:(t,r)=>fe(t,{method:"PUT",body:r!==void 0?JSON.stringify(r):void 0}),delete:t=>fe(t,{method:"DELETE"})};async function Zl(){return fe(`${ce}/devices`)}async function Wa(t){return fe(`${ce}/devices/${t}`)}async function ec(t){await fetch(`${ce}/devices/${t}/data`,{method:"DELETE"})}async function Ha(t){const r=await fetch(`${ce}/devices/${t}`,{method:"DELETE"});if(!r.ok){const s=await r.text();throw new Error(s||"Failed to remove device")}}async function tc(){if(!(await fetch(`${ce}/devices/offline`,{method:"DELETE"})).ok)throw new Error("Failed to remove offline devices")}async function ao(t,r=50){return fe(`${ce}/devices/${t}/sessions?limit=${r}`)}async function Ua(t,r={}){const s=new URLSearchParams;r.page&&s.set("page",String(r.page)),r.pageSize&&s.set("pageSize",String(r.pageSize)),r.method&&s.set("method",r.method),r.statusCode&&s.set("statusCode",String(r.statusCode)),r.urlContains&&s.set("urlContains",r.urlContains),r.isMocked!==void 0&&s.set("isMocked",String(r.isMocked)),r.timeFrom&&s.set("timeFrom",r.timeFrom),r.timeTo&&s.set("timeTo",r.timeTo);const n=s.toString();return fe(`${ce}/devices/${t}/http${n?`?${n}`:""}`)}async function io(t,r){return fe(`${ce}/devices/${t}/http/${r}`)}async function sc(t,r){return fe(`${ce}/devices/${t}/http/${r}/curl`)}async function rc(t,r){return fe(`${ce}/devices/${t}/http/${r}/replay`,{method:"POST"})}async function nc(t,r){return fe(`${ce}/devices/${t}/http/batch/delete`,{method:"POST",body:JSON.stringify({ids:r})})}async function ac(t){return fe(`${ce}/devices/${t}/http`,{method:"DELETE"})}async function ic(){await fetch(`${ce}/cleanup/truncate`,{method:"POST"})}async function oc(t){return fe(`${ce}/auth/verify`,{method:"POST",body:JSON.stringify({token:t})})}async function Va(t,r={}){const s=new URLSearchParams;r.page&&s.set("page",String(r.page)),r.pageSize&&s.set("pageSize",String(r.pageSize)),r.level&&s.set("level",r.level),r.levels?.length&&s.set("levels",r.levels.join(",")),r.subsystem&&s.set("subsystem",r.subsystem),r.category&&s.set("category",r.category),r.loggerName&&s.set("loggerName",r.loggerName),r.text&&s.set("text",r.text),r.traceId&&s.set("traceId",r.traceId),r.timeFrom&&s.set("timeFrom",r.timeFrom),r.timeTo&&s.set("timeTo",r.timeTo);const n=s.toString();return fe(`${ce}/devices/${t}/logs${n?`?${n}`:""}`)}async function lc(t){return fe(`${ce}/devices/${t}/logs/subsystems`)}async function cc(t){return fe(`${ce}/devices/${t}/logs/categories`)}async function dc(t,r){await fetch(`${ce}/devices/${t}/logs/batch-delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:r})})}async function uc(t){return fe(`${ce}/devices/${t}/logs`,{method:"DELETE"})}async function xc(t,r={}){const s=new URLSearchParams;r.page&&s.set("page",String(r.page)),r.pageSize&&s.set("pageSize",String(r.pageSize)),r.urlContains&&s.set("urlContains",r.urlContains),r.host&&s.set("host",r.host),r.isOpen!==void 0&&s.set("isOpen",String(r.isOpen)),r.timeFrom&&s.set("timeFrom",r.timeFrom),r.timeTo&&s.set("timeTo",r.timeTo);const n=s.toString();return fe(`${ce}/devices/${t}/ws-sessions${n?`?${n}`:""}`)}async function oo(t,r){return fe(`${ce}/devices/${t}/ws-sessions/${r}`)}async function qa(t,r,s={}){const n=new URLSearchParams;s.page&&n.set("page",String(s.page)),s.pageSize&&n.set("pageSize",String(s.pageSize)),s.direction&&n.set("direction",s.direction);const a=n.toString();return fe(`${ce}/devices/${t}/ws-sessions/${r}/frames${a?`?${a}`:""}`)}async function mc(t,r,s){return fe(`${ce}/devices/${t}/ws-sessions/${r}/frames/${s}`)}async function hc(t,r){return fe(`${ce}/devices/${t}/ws-sessions/batch/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:r})})}async function pc(t){return fe(`${ce}/devices/${t}/ws-sessions`,{method:"DELETE"})}async function lo(t){return fe(`${ce}/devices/${t}/mock-rules`)}async function fc(t,r){return fe(`${ce}/devices/${t}/mock-rules`,{method:"POST",body:JSON.stringify(r)})}async function Ga(t,r,s){return fe(`${ce}/devices/${t}/mock-rules/${r}`,{method:"PUT",body:JSON.stringify(s)})}async function co(t,r){await fetch(`${ce}/devices/${t}/mock-rules/${r}`,{method:"DELETE"})}async function gc(t){const r=await lo(t);await Promise.all(r.map(s=>co(t,s.id)))}async function bc(t){const r=`${ce}/devices/${t}/export/logs-zip`,s=await fetch(r);if(!s.ok){let c="Export failed";try{const u=await s.json();c=u.reason||u.message||c}catch{}throw new Error(c)}const n=await s.blob(),a=s.headers.get("Content-Disposition");let i=`logs-${new Date().toISOString().slice(0,10)}.zip`;if(a){const c=a.match(/filename="?([^"]+)"?/);c&&(i=c[1])}const o=window.URL.createObjectURL(n),l=document.createElement("a");l.href=o,l.download=i,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o)}function yc(t,r="json"){return`${ce}/devices/${t}/export/http?format=${r}`}function jc(t,r){const s=new URLSearchParams;r&&r.length>0&&s.set("ids",r.join(","));const n=s.toString();return`${ce}/devices/${t}/export/har${n?`?${n}`:""}`}async function aa(t){return fe(`${ce}/devices/${t}/breakpoints`)}async function vc(t,r){return fe(`${ce}/devices/${t}/breakpoints`,{method:"POST",body:JSON.stringify(r)})}async function Ya(t,r,s){return fe(`${ce}/devices/${t}/breakpoints/${r}`,{method:"PUT",body:JSON.stringify(s)})}async function uo(t,r){await fetch(`${ce}/devices/${t}/breakpoints/${r}`,{method:"DELETE"})}async function xo(t){const r=await aa(t);await Promise.all(r.map(s=>uo(t,s.id)))}async function wc(t){return fe(`${ce}/devices/${t}/breakpoints/pending`)}async function Nc(t,r,s){await fetch(`${ce}/devices/${t}/breakpoints/resume/${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}async function ia(t){return fe(`${ce}/devices/${t}/chaos`)}async function mo(t,r){return fe(`${ce}/devices/${t}/chaos`,{method:"POST",body:JSON.stringify(r)})}async function Hn(t,r,s){return fe(`${ce}/devices/${t}/chaos/${r}`,{method:"PUT",body:JSON.stringify(s)})}async function oa(t,r){await fetch(`${ce}/devices/${t}/chaos/${r}`,{method:"DELETE"})}async function la(t){const r=await ia(t);await Promise.all(r.map(s=>oa(t,s.id)))}async function kc(t){return fe(`${ce}/devices/${t}/databases`)}async function Cc(t,r){return fe(`${ce}/devices/${t}/databases/${r}/tables`)}async function Sc(t,r,s){return fe(`${ce}/devices/${t}/databases/${r}/tables/${s}/schema`)}async function yn(t,r,s,n){const a=new URLSearchParams;n?.page&&a.set("page",n.page.toString()),n?.pageSize&&a.set("pageSize",n.pageSize.toString()),n?.orderBy&&a.set("orderBy",n.orderBy),n?.ascending!==void 0&&a.set("ascending",n.ascending.toString()),n?.targetRowId&&a.set("targetRowId",n.targetRowId);const i=a.toString(),o=`${ce}/devices/${t}/databases/${r}/tables/${s}/rows${i?"?"+i:""}`;return fe(o)}async function Tc(t,r,s){return fe(`${ce}/devices/${t}/databases/${r}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s})})}async function Ec(t,r,s){return fe(`${ce}/devices/${t}/databases/${r}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}async function Ic(t,r,s){return fe(`${ce}/devices/${t}/databases/${r}/search/rows`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}async function Mc(){return fe(`${ce}/stats`)}const At=Ve((t,r)=>({rules:[],deviceRules:[],isLoading:!1,fetchRules:async()=>{t({isLoading:!0});try{const s=await Le.get("/api/traffic-rules");t({rules:s})}catch(s){console.error("Failed to fetch traffic rules",s)}finally{t({isLoading:!1})}},fetchDeviceRules:async s=>{t({isLoading:!0});try{const n=await Le.get(`/api/devices/${s}/traffic-rules`);t({deviceRules:n})}catch(n){console.error("Failed to fetch device traffic rules",n)}finally{t({isLoading:!1})}},createOrUpdateRule:async s=>{try{const n=await Le.post("/api/traffic-rules",s);t(a=>{let i=a.rules;a.rules.some(l=>l.id===n.id)?i=a.rules.map(l=>l.id===n.id?n:l):i=[n,...a.rules];let o=a.deviceRules;return a.deviceRules.some(l=>l.id===n.id)?o=a.deviceRules.map(l=>l.id===n.id?n:l):(n.deviceId===null||s.deviceId&&a.deviceRules.some(l=>l.deviceId===s.deviceId))&&(o=[n,...a.deviceRules]),{rules:i,deviceRules:o}})}catch(n){throw console.error("Failed to save traffic rule",n),n}},deleteRule:async s=>{try{await Le.delete(`/api/traffic-rules/${s}`),t(n=>({rules:n.rules.filter(a=>a.id!==s),deviceRules:n.deviceRules.filter(a=>a.id!==s)}))}catch(n){throw console.error("Failed to delete traffic rule",n),n}},deleteAllRules:async()=>{try{await Le.delete("/api/traffic-rules"),t({rules:[],deviceRules:[]})}catch(s){throw console.error("Failed to delete all traffic rules",s),s}},getDomainRule:(s,n)=>{const{deviceRules:a,rules:i}=r();return(n?a:i).find(l=>l.isEnabled&&l.matchType==="domain"&&l.matchValue===s&&(n?l.deviceId===n||l.deviceId===null:!0))},matchRule:(s,n)=>{const{deviceRules:a,rules:i}=r();return(n?a:i).find(l=>{if(!l.isEnabled)return!1;if(l.matchType==="domain")try{return new URL(s.url).hostname===l.matchValue}catch{return!1}if(l.matchType==="urlRegex")try{return new RegExp(l.matchValue).test(s.url)}catch{return!1}return l.matchType==="header",!1})}})),Dc={getItem:t=>localStorage.getItem(t),setItem:(t,r)=>{localStorage.setItem(t,r)},removeItem:t=>{localStorage.removeItem(t)}},Vr=Ve()(na((t,r)=>({favoriteUrlsMap:{},isFavorite:(s,n)=>{const a=r().favoriteUrlsMap[s];if(!a||!Array.isArray(a))return!1;const i=Nr(n);return a.includes(i)},toggleFavorite:(s,n)=>{const a=Nr(n),i=r().favoriteUrlsMap[s]||[];let o,l;const c=i.indexOf(a);return c>=0?(o=[...i.slice(0,c),...i.slice(c+1)],l=!1):(o=[...i,a],l=!0),t(u=>({favoriteUrlsMap:{...u.favoriteUrlsMap,[s]:o}})),l},addFavorite:(s,n)=>{const a=Nr(n);t(i=>{const o=i.favoriteUrlsMap[s]||[];return o.includes(a)?i:{favoriteUrlsMap:{...i.favoriteUrlsMap,[s]:[...o,a]}}})},removeFavorite:(s,n)=>{const a=Nr(n);t(i=>{const o=i.favoriteUrlsMap[s]||[],l=o.indexOf(a);return l<0?i:{favoriteUrlsMap:{...i.favoriteUrlsMap,[s]:[...o.slice(0,l),...o.slice(l+1)]}}})},clearFavorites:s=>{t(n=>({favoriteUrlsMap:{...n.favoriteUrlsMap,[s]:[]}}))},getFavoriteUrls:s=>{const n=r().favoriteUrlsMap[s];return Array.isArray(n)?[...n]:[]}}),{name:"debug-hub-favorite-urls",storage:no(()=>Dc)}));function Nr(t){try{const r=new URL(t);return`${r.protocol}//${r.host}${r.pathname}`}catch{return t}}function Rc(t,r){return t?!0:!!r}function mr(t,r,s){return t!=null&&t>0?t>=400:r?.category==="cancelled"?!1:Rc(r,s)}function Lc(t){switch(t){case"network":return"网络异常";case"timeout":return"超时";case"cancelled":return"已取消";case"dns":return"DNS";case"tls":return"TLS";case"http":return"HTTP";case"unknown":return"未知";default:return"-"}}function Kt(t){return t.type==="session-divider"}function st(t,r,s,n){const a=Vr.getState().isFavorite;return t.filter(i=>{if(Kt(i))return!1;const o=i;if(n?.clearedBeforeTimestamp&&o.startTime&&o.startTime<n.clearedBeforeTimestamp||n?.showCurrentSessionOnly&&n?.sessionStartTimestamp&&o.startTime&&o.startTime<n.sessionStartTimestamp||r.method&&o.method!==r.method)return!1;if(r.statusRange){const[l,c]=r.statusRange.split("-").map(Number),u=o.statusCode&&o.statusCode>0?o.statusCode:null;if(u!==null){if(u<l||u>c)return!1}else if(!(l>=400&&mr(o.statusCode,o.error,o.errorDescription)))return!1}if(r.urlContains&&!o.url.toLowerCase().includes(r.urlContains.toLowerCase())||r.mockedOnly&&!o.isMocked||r.favoritesOnly&&!(s?a(s,o.url):o.isFavorite))return!1;if(r.domains&&r.domains.length>0)try{const l=new URL(o.url);if(!r.domains.includes(l.hostname))return!1}catch{return!1}if(!r.showBlacklisted){const l=At.getState().matchRule(o,s);if(l&&l.action==="hide")return!1}return!0})}const Pc=t=>{const{clearedBeforeTimestamp:r,showCurrentSessionOnly:s,sessionStartTimestamp:n}=t();return{clearedBeforeTimestamp:r,showCurrentSessionOnly:s,sessionStartTimestamp:n}},Oc=t=>st(t.listItems,t.filters,t.currentDeviceId??void 0,{clearedBeforeTimestamp:t.clearedBeforeTimestamp,showCurrentSessionOnly:t.showCurrentSessionOnly,sessionStartTimestamp:t.sessionStartTimestamp}),Ze=Ve((t,r)=>({events:[],listItems:[],filteredItems:[],selectedEventId:null,selectedEvent:null,total:0,page:1,pageSize:100,isLoading:!1,autoScroll:!0,selectedIds:new Set,isSelectMode:!1,currentAppSessionId:null,currentDeviceId:null,groupMode:"none",showCurrentSessionOnly:!0,clearedBeforeTimestamp:null,sessionStartTimestamp:null,filters:{method:"",statusRange:"",urlContains:"",mockedOnly:!1,favoritesOnly:!1,domains:[],showBlacklisted:!1},fetchEvents:async s=>{const{pageSize:n,filters:a,selectedEventId:i}=r();t({isLoading:!0,currentDeviceId:s});try{const o=await Ua(s,{pageSize:n,method:a.method||void 0,urlContains:a.urlContains||void 0,isMocked:a.mockedOnly?!0:void 0}),l=o.items,{showCurrentSessionOnly:c,clearedBeforeTimestamp:u,sessionStartTimestamp:x}=r(),m=st(l,a,s,{clearedBeforeTimestamp:u,showCurrentSessionOnly:c,sessionStartTimestamp:x}),h=i?l.some(y=>y.id===i):!0;t({events:l,listItems:l,filteredItems:m,total:o.total,page:o.page,isLoading:!1,...h?{}:{selectedEventId:null,selectedEvent:null}}),r().fetchSessionHistory(s)}catch(o){console.error("Failed to fetch HTTP events:",o),t({isLoading:!1})}},fetchSessionHistory:async s=>{},loadMore:async s=>{const{pageSize:n,page:a,total:i,events:o,filters:l,isLoading:c}=r();if(c||o.length>=i)return;const u=a+1;t({isLoading:!0});try{const m=(await Ua(s,{page:u,pageSize:n,method:l.method||void 0,urlContains:l.urlContains||void 0,isMocked:l.mockedOnly?!0:void 0})).items,h=[...o,...m],y=st(h,l,s,Pc(r));t({events:h,listItems:h,filteredItems:y,page:u,isLoading:!1})}catch(x){console.error("Failed to load more HTTP events:",x),t({isLoading:!1})}},hasMore:()=>{const{events:s,total:n}=r();return s.length<n},selectEvent:async(s,n)=>{if(!n){t({selectedEventId:null,selectedEvent:null});return}t({selectedEventId:n});try{const a=await io(s,n);t(i=>{const o=x=>Kt(x)||x.id!==a.id?x:{...x,redirectFromId:a.redirectFromId??x.redirectFromId,redirectToUrl:a.redirectToUrl??x.redirectToUrl},l=i.events.map(x=>x.id===a.id?{...x,redirectFromId:a.redirectFromId??x.redirectFromId,redirectToUrl:a.redirectToUrl??x.redirectToUrl}:x),c=i.listItems.map(o),u=st(c,i.filters,i.currentDeviceId??void 0,{clearedBeforeTimestamp:i.clearedBeforeTimestamp,showCurrentSessionOnly:i.showCurrentSessionOnly,sessionStartTimestamp:i.sessionStartTimestamp});return{selectedEvent:a,events:l,listItems:c,filteredItems:u}})}catch(a){console.error("Failed to fetch HTTP event detail:",a),t({selectedEventId:null,selectedEvent:null})}},clearSelection:()=>{t({selectedEventId:null,selectedEvent:null})},addRealtimeEvent:s=>{t(n=>{const a=[s,...n.events].slice(0,1e3),i=[s,...n.listItems].slice(0,1e3),o=st(i,n.filters,n.currentDeviceId??void 0,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:n.sessionStartTimestamp});return{events:a,listItems:i,filteredItems:o,total:n.total+1}})},clearEvents:()=>{t({events:[],listItems:[],filteredItems:[],total:0,selectedEventId:null,selectedEvent:null,selectedIds:new Set,currentAppSessionId:null})},addSessionDivider:(s,n)=>{},setFilter:(s,n)=>{t(a=>{const i={...a.filters,[s]:n},o=st(a.listItems,i,a.currentDeviceId??void 0,{clearedBeforeTimestamp:a.clearedBeforeTimestamp,showCurrentSessionOnly:a.showCurrentSessionOnly,sessionStartTimestamp:a.sessionStartTimestamp});return{filters:i,filteredItems:o}})},toggleDomain:s=>{t(n=>{const a=n.filters.domains,i=a.includes(s)?a.filter(c=>c!==s):[...a,s],o={...n.filters,domains:i},l=st(n.listItems,o,n.currentDeviceId??void 0,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:n.sessionStartTimestamp});return{filters:o,filteredItems:l}})},clearDomains:()=>{t(s=>{const n={...s.filters,domains:[]},a=st(s.listItems,n,s.currentDeviceId??void 0,{clearedBeforeTimestamp:s.clearedBeforeTimestamp,showCurrentSessionOnly:s.showCurrentSessionOnly,sessionStartTimestamp:s.sessionStartTimestamp});return{filters:n,filteredItems:a}})},applyFilters:()=>{t(s=>({filteredItems:Oc(s)}))},setAutoScroll:s=>{t({autoScroll:s})},setGroupMode:s=>{t({groupMode:s})},updateEventFavorite:(s,n)=>{t(a=>{const i=a.events.map(c=>c.id===s?{...c,isFavorite:n}:c),o=a.listItems.map(c=>!Kt(c)&&c.id===s?{...c,isFavorite:n}:c),l=st(o,a.filters,a.currentDeviceId??void 0,{clearedBeforeTimestamp:a.clearedBeforeTimestamp,showCurrentSessionOnly:a.showCurrentSessionOnly,sessionStartTimestamp:a.sessionStartTimestamp});return{events:i,listItems:o,filteredItems:l,selectedEvent:a.selectedEvent?.id===s?{...a.selectedEvent,isFavorite:n}:a.selectedEvent}})},toggleSelectMode:()=>{t(s=>({isSelectMode:!s.isSelectMode,selectedIds:s.isSelectMode?new Set:s.selectedIds}))},toggleSelectId:s=>{t(n=>{const a=new Set(n.selectedIds);return a.has(s)?a.delete(s):a.add(s),{selectedIds:a}})},selectAll:()=>{t(s=>{const n=s.filteredItems.filter(o=>!Kt(o)),a=new Set(n.map(o=>o.id));return{selectedIds:s.selectedIds.size===a.size&&[...s.selectedIds].every(o=>a.has(o))?new Set:a}})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchDelete:async s=>{const{selectedIds:n,events:a,listItems:i,filters:o,currentDeviceId:l,clearedBeforeTimestamp:c,showCurrentSessionOnly:u,sessionStartTimestamp:x}=r();if(n.size!==0)try{await nc(s,Array.from(n));const m=a.filter(p=>!n.has(p.id)),h=i.filter(p=>Kt(p)?!0:!n.has(p.id)),y=st(h,o,l??void 0,{clearedBeforeTimestamp:c,showCurrentSessionOnly:u,sessionStartTimestamp:x});t({events:m,listItems:h,filteredItems:y,selectedIds:new Set,total:r().total-n.size})}catch(m){console.error("Failed to batch delete:",m)}},batchFavorite:async(s,n)=>{const{selectedIds:a,events:i,listItems:o,filters:l,currentDeviceId:c,clearedBeforeTimestamp:u,showCurrentSessionOnly:x,sessionStartTimestamp:m}=r();if(a.size!==0)try{const{addFavorite:h,removeFavorite:y}=Vr.getState(),p=i.filter(w=>a.has(w.id));for(const w of p)n?h(s,w.url):y(s,w.url);const f=st(o,l,c??void 0,{clearedBeforeTimestamp:u,showCurrentSessionOnly:x,sessionStartTimestamp:m});return t({filteredItems:f}),a.size}catch(h){throw console.error("Failed to batch favorite:",h),h}},clearScreen:()=>{const s=new Date().toISOString();t({clearedBeforeTimestamp:s,filteredItems:[],selectedEventId:null,selectedEvent:null,selectedIds:new Set})},setShowCurrentSessionOnly:s=>{t(n=>{const a=st(n.listItems,n.filters,n.currentDeviceId??void 0,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:s,sessionStartTimestamp:n.sessionStartTimestamp});return{showCurrentSessionOnly:s,filteredItems:a}})},setSessionStartTimestamp:s=>{t(n=>{const a=st(n.listItems,n.filters,n.currentDeviceId??void 0,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:s});return{sessionStartTimestamp:s,filteredItems:a}})},setCurrentAppSessionId:s=>{t({currentAppSessionId:s})}})),Un={verbose:0,debug:1,info:2,warning:3,error:4};function Ac(t){const r={};if(!t.trim())return r;const s=[{field:"level",pattern:/level:(>=)?(\w+)/gi},{field:"subsystem",pattern:/subsystem:("([^"]+)"|(\S+))/gi},{field:"category",pattern:/category:("([^"]+)"|(\S+))/gi},{field:"message",pattern:/message:("([^"]+)"|(\S+))/gi},{field:"traceId",pattern:/traceId:(\S+)/gi},{field:"file",pattern:/file:("([^"]+)"|(\S+))/gi},{field:"function",pattern:/function:("([^"]+)"|(\S+))/gi},{field:"timestampFrom",pattern:/timestamp:>(\S+)/gi},{field:"timestampTo",pattern:/timestamp:<(\S+)/gi}];let n=t;for(const{field:i,pattern:o}of s){let l;for(;(l=o.exec(t))!==null;)switch(n=n.replace(l[0],""),i){case"level":{const c=l[1]===">=",u=l[2].toLowerCase();Un[u]!==void 0&&(c?r.minLevel=u:r.level=u);break}case"subsystem":r.subsystem=l[2]||l[3];break;case"category":r.category=l[2]||l[3];break;case"message":{const c=l[2]||l[3];r.message=c;try{r.messageRegex=new RegExp(c,"i")}catch{}break}case"traceId":r.traceId=l[1];break;case"file":r.file=l[2]||l[3];break;case"function":r.function=l[2]||l[3];break;case"timestampFrom":{const c=new Date(l[1]);isNaN(c.getTime())||(r.timestampFrom=c);break}case"timestampTo":{const c=new Date(l[1]);isNaN(c.getTime())||(r.timestampTo=c);break}}}const a=n.trim();return a&&(r.freeText=a),r}function Fc(t,r,s="verbose"){const n=r.minLevel||r.level||s,a=Un[n];return t.filter(i=>{const o=Un[i.level]??0;if(r.level&&i.level!==r.level||o<a||r.subsystem&&i.subsystem!==r.subsystem||r.category&&i.category!==r.category)return!1;if(r.message){if(r.messageRegex){if(!r.messageRegex.test(i.message))return!1}else if(!i.message.toLowerCase().includes(r.message.toLowerCase()))return!1}if(r.traceId&&i.traceId!==r.traceId||r.file&&i.file&&!i.file.toLowerCase().includes(r.file.toLowerCase())||r.function&&i.function&&!i.function.toLowerCase().includes(r.function.toLowerCase()))return!1;if(r.timestampFrom||r.timestampTo){const l=new Date(i.timestamp);if(r.timestampFrom&&l<r.timestampFrom||r.timestampTo&&l>r.timestampTo)return!1}if(r.freeText){const l=r.freeText.toLowerCase(),c=i.message.toLowerCase().includes(l),u=i.subsystem?.toLowerCase().includes(l),x=i.category?.toLowerCase().includes(l),m=i.file?.toLowerCase().includes(l),h=i.function?.toLowerCase().includes(l);if(!c&&!u&&!x&&!m&&!h)return!1}return!0})}const zc=`
支持的搜索语法:
• level:error - 精确匹配级别
• level:>=warning - 显示 warning 及以上级别
• subsystem:Network - 匹配 subsystem
• category:API - 匹配 category
• message:"error message" - 搜索消息内容
• traceId:xxx - 匹配 traceId
• file:ViewController - 匹配文件名
• function:viewDidLoad - 匹配函数名
• timestamp:>2025-12-05T10:00:00 - 时间范围
• 直接输入文本搜索消息内容
`.trim(),Ka={verbose:0,debug:1,info:2,warning:3,error:4};function $c(t,r,s){const n=Ka[r.minLevel];return t.filter(a=>!(s?.clearedBeforeTimestamp&&a.timestamp&&a.timestamp<s.clearedBeforeTimestamp||s?.showCurrentSessionOnly&&s?.sessionStartTimestamp&&a.timestamp&&a.timestamp<s.sessionStartTimestamp||(Ka[a.level]??0)<n||r.subsystem&&a.subsystem!==r.subsystem||r.category&&a.category!==r.category||r.text&&!r.searchQuery&&!a.message.toLowerCase().includes(r.text.toLowerCase())||r.traceId&&a.traceId!==r.traceId))}function Ct(t,r,s){let n=$c(t,r,s);if(r.searchQuery){const a=Ac(r.searchQuery);n=Fc(n,a,r.minLevel)}return n}const Ft=Ve((t,r)=>({events:[],filteredEvents:[],total:0,page:1,pageSize:500,isLoading:!1,autoScroll:!0,selectedId:null,selectedIds:new Set,isSelectMode:!1,showCurrentSessionOnly:!0,clearedBeforeTimestamp:null,sessionStartTimestamp:null,currentAppSessionId:null,subsystems:[],categories:[],filters:{minLevel:"verbose",subsystem:"",category:"",text:"",traceId:"",searchQuery:""},fetchEvents:async s=>{const{pageSize:n,showCurrentSessionOnly:a,clearedBeforeTimestamp:i,sessionStartTimestamp:o}=r();t({isLoading:!0});try{const l=await Va(s,{pageSize:n}),{filters:c}=r(),u=Ct(l.items,c,{clearedBeforeTimestamp:i,showCurrentSessionOnly:a,sessionStartTimestamp:o});t({events:l.items,filteredEvents:u,total:l.total,page:l.page,isLoading:!1})}catch(l){console.error("Failed to fetch log events:",l),t({isLoading:!1})}},fetchFilterOptions:async s=>{try{const[n,a]=await Promise.all([lc(s),cc(s)]);t({subsystems:n,categories:a})}catch(n){console.error("Failed to fetch filter options:",n)}},addRealtimeEvent:s=>{t(n=>{const a=[s,...n.events].slice(0,5e3),i=Ct(a,n.filters,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:n.sessionStartTimestamp});return{events:a,filteredEvents:i,total:n.total+1}})},clearEvents:()=>{t({events:[],filteredEvents:[],total:0,currentAppSessionId:null})},setFilter:(s,n)=>{t(a=>{const i={...a.filters,[s]:n},o=Ct(a.events,i,{clearedBeforeTimestamp:a.clearedBeforeTimestamp,showCurrentSessionOnly:a.showCurrentSessionOnly,sessionStartTimestamp:a.sessionStartTimestamp});return{filters:i,filteredEvents:o}})},setMinLevel:s=>{t(n=>{const a={...n.filters,minLevel:s},i=Ct(n.events,a,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:n.sessionStartTimestamp});return{filters:a,filteredEvents:i}})},setSearchQuery:s=>{t(n=>{const a={...n.filters,searchQuery:s},i=Ct(n.events,a,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:n.sessionStartTimestamp});return{filters:a,filteredEvents:i}})},applyFilters:()=>{t(s=>({filteredEvents:Ct(s.events,s.filters,{clearedBeforeTimestamp:s.clearedBeforeTimestamp,showCurrentSessionOnly:s.showCurrentSessionOnly,sessionStartTimestamp:s.sessionStartTimestamp})}))},setAutoScroll:s=>{t({autoScroll:s})},selectEvent:s=>{t(n=>({selectedId:n.selectedId===s?null:s}))},toggleSelectMode:()=>{t(s=>({isSelectMode:!s.isSelectMode,selectedIds:s.isSelectMode?new Set:s.selectedIds,selectedId:null}))},toggleSelectId:s=>{t(n=>{const a=new Set(n.selectedIds);return a.has(s)?a.delete(s):a.add(s),{selectedIds:a}})},selectAll:()=>{t(s=>{const n=new Set(s.filteredEvents.map(i=>i.id));return{selectedIds:s.selectedIds.size===n.size&&[...s.selectedIds].every(i=>n.has(i))?new Set:n}})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchDelete:async s=>{const{selectedIds:n,events:a,filters:i,clearedBeforeTimestamp:o,showCurrentSessionOnly:l,sessionStartTimestamp:c}=r();if(n.size!==0)try{await dc(s,Array.from(n));const u=a.filter(x=>!n.has(x.id));t({events:u,filteredEvents:Ct(u,i,{clearedBeforeTimestamp:o,showCurrentSessionOnly:l,sessionStartTimestamp:c}),selectedIds:new Set,total:r().total-n.size})}catch(u){throw console.error("Failed to batch delete logs:",u),u}},clearScreen:()=>{const s=new Date().toISOString();t({clearedBeforeTimestamp:s,filteredEvents:[],selectedId:null,selectedIds:new Set})},setShowCurrentSessionOnly:s=>{t(n=>{const a=Ct(n.events,n.filters,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:s,sessionStartTimestamp:n.sessionStartTimestamp});return{showCurrentSessionOnly:s,filteredEvents:a}})},setSessionStartTimestamp:s=>{t(n=>{const a=Ct(n.events,n.filters,{clearedBeforeTimestamp:n.clearedBeforeTimestamp,showCurrentSessionOnly:n.showCurrentSessionOnly,sessionStartTimestamp:s});return{sessionStartTimestamp:s,filteredEvents:a}})},setCurrentAppSessionId:s=>{t({currentAppSessionId:s})},loadMore:async s=>{const{pageSize:n,page:a,total:i,events:o,filters:l,isLoading:c,clearedBeforeTimestamp:u,showCurrentSessionOnly:x,sessionStartTimestamp:m}=r();if(c||o.length>=i)return;const h=a+1;t({isLoading:!0});try{const p=(await Va(s,{page:h,pageSize:n})).items,f=[...o,...p],w=Ct(f,l,{clearedBeforeTimestamp:u,showCurrentSessionOnly:x,sessionStartTimestamp:m});t({events:f,filteredEvents:w,page:h,isLoading:!1})}catch(y){console.error("Failed to load more log events:",y),t({isLoading:!1})}},hasMore:()=>{const{events:s,total:n}=r();return s.length<n}}));let kr=null;function Bc(t,r){kr&&clearTimeout(kr),kr=setTimeout(()=>{r(t),kr=null},500)}const Be="/api";async function _c(t,r=60){return Le.get(`${Be}/devices/${t}/performance/realtime?seconds=${r}`)}async function Wc(t,r,s,n=60){const a=new URLSearchParams;return r&&a.set("startTime",r.toISOString()),s&&a.set("endTime",s.toISOString()),a.set("interval",n.toString()),Le.get(`${Be}/devices/${t}/performance/history?${a}`)}async function Hc(t,r=60){return Le.get(`${Be}/devices/${t}/performance/trends?minutes=${r}`)}async function Uc(t,r=1,s=50,n){const a=new URLSearchParams;return a.set("page",r.toString()),a.set("pageSize",s.toString()),n&&a.set("minDuration",n.toString()),Le.get(`${Be}/devices/${t}/performance/janks?${a}`)}async function Vc(t){return Le.get(`${Be}/devices/${t}/performance/status`)}async function qc(t,r){return Le.post(`${Be}/devices/${t}/performance/config`,r)}async function Gc(t){return Le.delete(`${Be}/devices/${t}/performance`)}async function Yc(t,r=!1){return Le.get(`${Be}/devices/${t}/performance/alerts?includeResolved=${r}`)}async function Kc(t){return Le.get(`${Be}/devices/${t}/performance/alerts/config`)}async function Jc(t,r){return Le.post(`${Be}/devices/${t}/performance/alerts/config`,r)}async function Xc(t,r){return Le.post(`${Be}/devices/${t}/performance/alerts/rules`,r)}async function Qc(t,r,s){return Le.put(`${Be}/devices/${t}/performance/alerts/rules/${r}`,s)}async function Zc(t,r){return Le.delete(`${Be}/devices/${t}/performance/alerts/rules/${r}`)}async function ed(t,r){return Le.post(`${Be}/devices/${t}/performance/alerts/${r}/resolve`,{})}async function td(t){return Le.get(`${Be}/devices/${t}/performance/launch`)}async function sd(t,r={}){const s=new URLSearchParams;r.page&&s.set("page",r.page.toString()),r.pageSize&&s.set("pageSize",r.pageSize.toString()),r.pageId&&s.set("pageId",r.pageId),r.pageName&&s.set("pageName",r.pageName),r.route&&s.set("route",r.route),r.from&&s.set("from",r.from.toISOString()),r.to&&s.set("to",r.to.toISOString()),r.minDuration&&s.set("minDuration",r.minDuration.toString());const n=s.toString(),a=`${Be}/devices/${t}/performance/page-timings${n?"?"+n:""}`;return Le.get(a)}async function rd(t,r,s,n){const a=new URLSearchParams;r&&a.set("from",r.toISOString()),s&&a.set("to",s.toISOString()),n&&a.set("pageName",n);const i=a.toString(),o=`${Be}/devices/${t}/performance/page-timings/summary${i?"?"+i:""}`;return Le.get(o)}async function nd(t,r){return Le.get(`${Be}/devices/${t}/performance/page-timings/${r}`)}async function ad(t){await Le.delete(`${Be}/devices/${t}/performance/page-timings`)}const Ws=Ve((t,r)=>({realtimeMetrics:[],isLoading:!1,error:null,jankEvents:[],jankTotal:0,jankPage:1,jankPageSize:50,isLoadingJanks:!1,isMonitoring:!1,lastMetrics:null,recentJankCount:0,appLaunchMetrics:null,appLaunchHistory:[],appLaunchStats:null,isLoadingAppLaunch:!1,trends:null,isLoadingTrends:!1,config:{sampleInterval:1,monitorFPS:!0,monitorCPU:!0,monitorMemory:!0,monitorNetwork:!0,monitorDiskIO:!0,smartSamplingEnabled:!0},alerts:[],alertRules:[],alertConfig:{cooldownSeconds:60,isEnabled:!0},isLoadingAlerts:!1,activeAlertCount:0,timeRange:60,pageTimingEvents:[],pageTimingTotal:0,pageTimingPage:1,pageTimingPageSize:50,pageTimingSummary:[],isLoadingPageTiming:!1,isLoadingPageTimingSummary:!1,selectedPageTimingEvent:null,fetchRealtimeMetrics:async s=>{t({isLoading:!0,error:null});try{const n=await _c(s,r().timeRange);t({realtimeMetrics:n.metrics,isLoading:!1})}catch(n){t({error:String(n),isLoading:!1})}},fetchHistoryMetrics:async(s,n,a,i)=>{t({isLoading:!0,error:null});try{const o=await Wc(s,n,a,i);t({realtimeMetrics:o.metrics,isLoading:!1})}catch(o){t({error:String(o),isLoading:!1})}},fetchTrends:async(s,n=60)=>{t({isLoadingTrends:!0});try{const a=await Hc(s,n);t({trends:a,isLoadingTrends:!1})}catch(a){console.error("Failed to fetch trends:",a),t({isLoadingTrends:!1})}},fetchJankEvents:async(s,n=1,a)=>{t({isLoadingJanks:!0});try{const i=await Uc(s,n,r().jankPageSize,a);t({jankEvents:i.items,jankTotal:i.total,jankPage:i.page,isLoadingJanks:!1})}catch{t({isLoadingJanks:!1})}},fetchStatus:async s=>{try{const n=await Vc(s);t({isMonitoring:n.isMonitoring,lastMetrics:n.lastMetrics??null,recentJankCount:n.recentJankCount})}catch(n){console.error("Failed to fetch performance status:",n)}},updateConfig:async(s,n)=>{try{await qc(s,n),t(a=>({config:{...a.config,...n}}))}catch(a){console.error("Failed to update config:",a)}},clearMetrics:async s=>{try{await Gc(s),t({realtimeMetrics:[],jankEvents:[],jankTotal:0,appLaunchMetrics:null,appLaunchHistory:[],appLaunchStats:null,alerts:[],activeAlertCount:0})}catch(n){console.error("Failed to clear metrics:",n)}},fetchAppLaunchData:async s=>{t({isLoadingAppLaunch:!0});try{const n=await td(s);t({appLaunchMetrics:n.launchMetrics?{totalTime:n.launchMetrics.totalTime,preMainTime:n.launchMetrics.preMainTime,mainToLaunchTime:n.launchMetrics.mainToLaunchTime,launchToFirstFrameTime:n.launchMetrics.launchToFirstFrameTime,timestamp:n.launchMetrics.timestamp,preMainDetails:n.launchMetrics.preMainDetails}:null,appLaunchHistory:n.history,appLaunchStats:n.stats,isLoadingAppLaunch:!1})}catch(n){console.error("Failed to fetch app launch data:",n),t({isLoadingAppLaunch:!1})}},addRealtimeMetrics:s=>{t(n=>{const a=[...n.realtimeMetrics,...s],i=new Date(Date.now()-n.timeRange*1e3);return{realtimeMetrics:a.filter(l=>new Date(l.timestamp)>=i),lastMetrics:s[s.length-1]??n.lastMetrics}})},addJankEvent:s=>{t(n=>n.jankEvents.some(i=>i.id===s.id)?n:{jankEvents:[s,...n.jankEvents].slice(0,100),jankTotal:n.jankTotal+1,recentJankCount:n.recentJankCount+1})},fetchAlerts:async(s,n=!1)=>{t({isLoadingAlerts:!0});try{const a=await Yc(s,n);t({alerts:a.items,activeAlertCount:a.activeCount,isLoadingAlerts:!1})}catch(a){console.error("Failed to fetch alerts:",a),t({isLoadingAlerts:!1})}},fetchAlertConfig:async s=>{try{const n=await Kc(s);t({alertRules:n.rules,alertConfig:{cooldownSeconds:n.cooldownSeconds,isEnabled:n.isEnabled}})}catch(n){console.error("Failed to fetch alert config:",n)}},updateAlertConfig:async(s,n)=>{try{await Jc(s,n),t(a=>({alertConfig:{...a.alertConfig,...n},alertRules:n.rules??a.alertRules}))}catch(a){console.error("Failed to update alert config:",a)}},addAlertRule:async(s,n)=>{try{await Xc(s,n),r().fetchAlertConfig(s)}catch(a){console.error("Failed to add alert rule:",a)}},updateAlertRule:async(s,n,a)=>{try{await Qc(s,n,a),t(i=>({alertRules:i.alertRules.map(o=>o.id===n?{...o,...a}:o)}))}catch(i){console.error("Failed to update alert rule:",i)}},deleteAlertRule:async(s,n)=>{try{await Zc(s,n),t(a=>({alertRules:a.alertRules.filter(i=>i.id!==n)}))}catch(a){console.error("Failed to delete alert rule:",a)}},resolveAlert:async(s,n)=>{try{await ed(s,n),t(a=>({alerts:a.alerts.map(i=>i.id===n?{...i,isResolved:!0,resolvedAt:new Date().toISOString()}:i),activeAlertCount:Math.max(0,a.activeAlertCount-1)}))}catch(a){console.error("Failed to resolve alert:",a)}},addAlert:s=>{t(n=>({alerts:[s,...n.alerts].slice(0,100),activeAlertCount:s.isResolved?n.activeAlertCount:n.activeAlertCount+1}))},updateAlert:s=>{t(n=>{const a=n.alerts.find(c=>c.id===s.id),i=a&&!a.isResolved,o=!s.isResolved;let l=n.activeAlertCount;return i&&!o?l=Math.max(0,l-1):!i&&o&&(l+=1),{alerts:n.alerts.map(c=>c.id===s.id?s:c),activeAlertCount:l}})},handleRealtimeEvent:(s,n)=>{switch(s.eventType){case"metrics":if(s.metrics&&s.metrics.length>0){const a=s.metrics.map(i=>({timestamp:i.timestamp,cpu:i.cpu?{usage:i.cpu.usage,userTime:i.cpu.userTime,systemTime:i.cpu.systemTime,threadCount:i.cpu.threadCount}:void 0,memory:i.memory?{usedMemory:i.memory.usedMemory,peakMemory:i.memory.peakMemory,freeMemory:i.memory.freeMemory,memoryPressure:i.memory.memoryPressure,footprintRatio:i.memory.footprintRatio}:void 0,fps:i.fps?{fps:i.fps.fps,droppedFrames:i.fps.droppedFrames,jankCount:i.fps.jankCount,averageRenderTime:i.fps.averageRenderTime}:void 0,network:i.network?{bytesReceived:i.network.bytesReceived,bytesSent:i.network.bytesSent,downloadRate:i.network.downloadRate,uploadRate:i.network.uploadRate}:void 0,diskIO:i.diskIO?{readBytes:i.diskIO.readBytes,writeBytes:i.diskIO.writeBytes,readRate:i.diskIO.readRate,writeRate:i.diskIO.writeRate}:void 0}));r().addRealtimeMetrics(a),t({isMonitoring:!0})}break;case"jank":s.jank&&r().addJankEvent({id:s.jank.id,timestamp:s.jank.timestamp,duration:s.jank.duration,droppedFrames:s.jank.droppedFrames,stackTrace:s.jank.stackTrace});break;case"alert":s.alert&&r().addAlert({id:s.alert.id,ruleId:s.alert.ruleId,metricType:s.alert.metricType,severity:s.alert.severity,message:s.alert.message,currentValue:s.alert.currentValue,threshold:s.alert.threshold,timestamp:s.alert.timestamp,isResolved:s.alert.isResolved,resolvedAt:s.alert.resolvedAt});break;case"alertResolved":s.alert&&r().updateAlert({id:s.alert.id,ruleId:s.alert.ruleId,metricType:s.alert.metricType,severity:s.alert.severity,message:s.alert.message,currentValue:s.alert.currentValue,threshold:s.alert.threshold,timestamp:s.alert.timestamp,isResolved:!0,resolvedAt:s.alert.resolvedAt});break;case"appLaunch":s.appLaunch&&t({appLaunchMetrics:{totalTime:s.appLaunch.totalTime,preMainTime:s.appLaunch.preMainTime,mainToLaunchTime:s.appLaunch.mainToLaunchTime,launchToFirstFrameTime:s.appLaunch.launchToFirstFrameTime,timestamp:s.appLaunch.timestamp,preMainDetails:s.appLaunch.preMainDetails}});break;case"pageTiming":s.pageTiming&&(r().addPageTimingEvent({id:s.pageTiming.eventId,deviceId:n??"",visitId:s.pageTiming.visitId,pageId:s.pageTiming.pageId,pageName:s.pageTiming.pageName,route:s.pageTiming.route,startAt:s.pageTiming.startAt,firstLayoutAt:s.pageTiming.firstLayoutAt,appearAt:s.pageTiming.appearAt,endAt:s.pageTiming.endAt,loadDuration:s.pageTiming.loadDuration,appearDuration:s.pageTiming.appearDuration,totalDuration:s.pageTiming.totalDuration,markers:s.pageTiming.markers?.map(a=>({name:a.name,timestamp:a.timestamp,elapsed:a.duration??0}))??[],appVersion:s.pageTiming.appVersion,appBuild:s.pageTiming.appBuild,osVersion:s.pageTiming.osVersion,deviceModel:s.pageTiming.deviceModel,isColdStart:s.pageTiming.isColdStart,isPush:s.pageTiming.isPush,parentPageId:s.pageTiming.parentPageId,seqNum:0}),n&&Bc(n,r().fetchPageTimingSummary));break}},setTimeRange:s=>{t({timeRange:s})},clearData:()=>{t({realtimeMetrics:[],jankEvents:[],jankTotal:0,jankPage:1,lastMetrics:null,recentJankCount:0,trends:null,alerts:[],activeAlertCount:0,pageTimingEvents:[],pageTimingTotal:0,pageTimingPage:1,pageTimingSummary:[],selectedPageTimingEvent:null,appLaunchMetrics:null,appLaunchHistory:[],appLaunchStats:null})},fetchPageTimingEvents:async(s,n={})=>{t({isLoadingPageTiming:!0});try{const a=await sd(s,n);t({pageTimingEvents:a.items,pageTimingTotal:a.total,pageTimingPage:a.page,pageTimingPageSize:a.pageSize,isLoadingPageTiming:!1})}catch(a){console.error("Failed to fetch page timing events:",a),t({isLoadingPageTiming:!1})}},fetchPageTimingSummary:async(s,n,a,i)=>{t({isLoadingPageTimingSummary:!0});try{const o=await rd(s,n,a,i);t({pageTimingSummary:o.items,isLoadingPageTimingSummary:!1})}catch(o){console.error("Failed to fetch page timing summary:",o),t({isLoadingPageTimingSummary:!1})}},fetchPageTimingEvent:async(s,n)=>{try{const a=await nd(s,n);t({selectedPageTimingEvent:a})}catch(a){console.error("Failed to fetch page timing event:",a)}},clearPageTimingEvents:async s=>{try{await ad(s),t({pageTimingEvents:[],pageTimingTotal:0,pageTimingPage:1,pageTimingSummary:[],selectedPageTimingEvent:null})}catch(n){console.error("Failed to clear page timing events:",n)}},setSelectedPageTimingEvent:s=>{t({selectedPageTimingEvent:s})},addPageTimingEvent:s=>{t(n=>n.pageTimingEvents.some(i=>i.id===s.id)?n:{pageTimingEvents:[s,...n.pageTimingEvents].slice(0,100),pageTimingTotal:n.pageTimingTotal+1})}}));function Ge(t){if(t==null||isNaN(t)||t===0||t<0)return"0 B";const r=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(r)),a=Math.min(n,s.length-1);return parseFloat((t/Math.pow(r,a)).toFixed(1))+" "+s[a]}function ho(t){return t==null||isNaN(t)?"--":t<1e3?`${t.toFixed(0)}ms`:`${(t/1e3).toFixed(2)}s`}function Ja(t){switch(t){case"low":return"text-green-400";case"medium":return"text-yellow-400";case"high":return"text-orange-400";case"critical":return"text-red-400";default:return"text-zinc-400"}}function jn(t){return t<30?"text-green-400":t<60?"text-yellow-400":t<80?"text-orange-400":"text-red-400"}function vn(t){return t>=55?"text-green-400":t>=40?"text-yellow-400":t>=25?"text-orange-400":"text-red-400"}function Xa(t){switch(t){case"info":return"text-blue-400";case"warning":return"text-yellow-400";case"critical":return"text-red-400";default:return"text-zinc-400"}}function id(t){switch(t){case"info":return"bg-blue-500/20 border-blue-500/50";case"warning":return"bg-yellow-500/20 border-yellow-500/50";case"critical":return"bg-red-500/20 border-red-500/50";default:return"bg-zinc-500/20 border-zinc-500/50"}}function Qa(t){switch(t){case"cpu":return"CPU";case"memory":return"内存";case"fps":return"帧率";case"jank":return"卡顿";default:return t}}function od(t){switch(t){case"gt":return"大于";case"lt":return"小于";case"gte":return"大于等于";case"lte":return"小于等于";default:return t}}function Je(t){return t==null||isNaN(t)?"text-zinc-400":t<300?"text-green-400":t<500?"text-yellow-400":t<1e3?"text-orange-400":"text-red-400"}function ld(t){return t==null||isNaN(t)?"bg-zinc-500/10":t<300?"bg-green-500/10":t<500?"bg-yellow-500/10":t<1e3?"bg-orange-500/10":"bg-red-500/10"}function Me(t){return t==null||isNaN(t)?"--":t<1e3?`${Math.round(t)}ms`:`${(t/1e3).toFixed(2)}s`}const po="debug-hub-favorite-devices",cd=()=>{try{const t=localStorage.getItem(po);if(t)return new Set(JSON.parse(t))}catch(t){console.error("Failed to load favorite devices:",t)}return new Set},dd=t=>{try{localStorage.setItem(po,JSON.stringify([...t]))}catch(r){console.error("Failed to save favorite devices:",r)}},Pe=Ve((t,r)=>({devices:[],currentDeviceId:null,currentDevice:null,isLoading:!1,error:null,favoriteDeviceIds:cd(),isSelectMode:!1,selectedIds:new Set,pluginStates:{},fetchDevices:async()=>{t({isLoading:!0,error:null});try{const s=await Zl();t({devices:s,isLoading:!1})}catch(s){t({error:s.message,isLoading:!1})}},selectDevice:async s=>{t({currentDeviceId:s,isLoading:!0,error:null});try{const n=await Wa(s);t({currentDevice:n,isLoading:!1,pluginStates:n.pluginStates||{}})}catch(n){t({error:n.message,isLoading:!1})}},refreshDevice:async()=>{const{currentDeviceId:s,currentDevice:n}=r();if(!s)return{success:!1,error:"未选择设备"};try{const a=await Wa(s);return t({currentDevice:a,pluginStates:a.pluginStates||{}}),{success:!0}}catch(a){return console.error("Failed to refresh device:",a),n&&t({currentDevice:{...n,isOnline:!1,lastSeenAt:new Date().toISOString()}}),{success:!1,error:a.message||"刷新失败"}}},clearSelection:()=>{t({currentDeviceId:null,currentDevice:null})},clearDeviceData:async()=>{const{currentDeviceId:s}=r();if(s)try{await ec(s),await Promise.all([gc(s),xo(s),la(s)]),Ze.getState().clearEvents(),Ft.getState().clearEvents(),Ws.getState().clearData()}catch(n){t({error:n.message})}},removeDevice:async s=>{try{await Ha(s),t(n=>({devices:n.devices.filter(a=>a.deviceId!==s)}))}catch(n){throw t({error:n.message}),n}},removeAllOfflineDevices:async()=>{try{await tc(),t(s=>({devices:s.devices.filter(n=>n.isOnline)}))}catch(s){throw t({error:s.message}),s}},toggleFavorite:s=>{const{favoriteDeviceIds:n}=r(),a=new Set(n);a.has(s)?a.delete(s):a.add(s),dd(a),t({favoriteDeviceIds:a})},isFavorite:s=>r().favoriteDeviceIds.has(s),toggleSelectMode:()=>{const{isSelectMode:s}=r();t({isSelectMode:!s,selectedIds:new Set})},toggleSelectId:s=>{const{selectedIds:n,devices:a}=r();if(a.find(l=>l.deviceId===s)?.isOnline)return;const o=new Set(n);o.has(s)?o.delete(s):o.add(s),t({selectedIds:o})},selectAllOffline:()=>{const{devices:s,selectedIds:n}=r(),a=s.filter(o=>!o.isOnline).map(o=>o.deviceId),i=a.every(o=>n.has(o));t(i?{selectedIds:new Set}:{selectedIds:new Set(a)})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchRemoveSelected:async()=>{const{selectedIds:s}=r();if(s.size!==0)try{const n=Array.from(s);await Promise.all(n.map(a=>Ha(a))),t(a=>({devices:a.devices.filter(i=>!n.includes(i.deviceId)),selectedIds:new Set,isSelectMode:!1}))}catch(n){throw t({error:n.message}),n}},setAllDevicesOffline:()=>{t(s=>({devices:s.devices.map(n=>({...n,isOnline:!1})),currentDevice:s.currentDevice?{...s.currentDevice,isOnline:!1}:null}))},updatePluginStates:s=>{t({pluginStates:s})},isPluginEnabled:s=>{const{pluginStates:n}=r();return n[s]??!0}})),Cr={handleDeviceConnected:t=>{const{devices:r,fetchDevices:s,updatePluginStates:n}=Pe.getState();r.find(i=>i.deviceId===t.deviceId)?Pe.setState({devices:r.map(i=>i.deviceId===t.deviceId?{...i,isOnline:!0,deviceName:t.deviceName||i.deviceName,lastSeenAt:t.timestamp}:i)}):s(),t.pluginStates&&n(t.pluginStates),console.log("[DeviceStore] Device connected:",t.deviceName)},handleDeviceDisconnected:t=>{const{devices:r,currentDevice:s,currentDeviceId:n}=Pe.getState();Pe.setState({devices:r.map(a=>a.deviceId===t.deviceId?{...a,isOnline:!1,lastSeenAt:t.timestamp}:a),currentDevice:n===t.deviceId&&s?{...s,isOnline:!1,lastSeenAt:t.timestamp}:s}),console.log("[DeviceStore] Device disconnected:",t.deviceId)},handleDeviceReconnected:t=>{const{devices:r,currentDevice:s,currentDeviceId:n}=Pe.getState();Pe.setState({devices:r.map(a=>a.deviceId===t.deviceId?{...a,isOnline:!0,deviceName:t.deviceName||a.deviceName,lastSeenAt:t.timestamp}:a),currentDevice:n===t.deviceId&&s?{...s,isOnline:!0,lastSeenAt:t.timestamp,deviceInfo:{...s.deviceInfo,deviceName:t.deviceName||s.deviceInfo.deviceName}}:s}),console.log("[DeviceStore] Device reconnected:",t.deviceName)},handleDeviceInfoUpdated:t=>{const{devices:r,currentDevice:s,currentDeviceId:n}=Pe.getState();Pe.setState({devices:r.map(a=>a.deviceId===t.deviceId?{...a,deviceName:t.deviceName,deviceAlias:t.deviceAlias}:a),currentDevice:n===t.deviceId&&s?{...s,deviceInfo:{...s.deviceInfo,deviceName:t.deviceName,deviceAlias:t.deviceAlias}}:s}),console.log("[DeviceStore] Device info updated:",t.deviceAlias||t.deviceName)}},bt=Ve()(Xl(t=>({isServerOnline:!0,isRealtimeConnected:!1,isInDeviceDetail:!1,serverStats:null,isConnected:!1,setServerOnline:r=>t({isServerOnline:r}),setRealtimeConnected:r=>t({isRealtimeConnected:r,isConnected:r}),setInDeviceDetail:r=>t({isInDeviceDetail:r}),setServerStats:r=>t({serverStats:r}),setConnected:r=>t({isRealtimeConnected:r,isConnected:r})})));let Lt=null,Fr=null,Sr=0;const Za=10,ei=3e3;let Vn=null;function ud(t){Vn=t}function xd(t){try{const r=JSON.parse(t.data);if(!r.payload||!["stats","deviceConnected","deviceDisconnected","deviceReconnected","deviceInfoUpdated"].includes(r.type))return;const s=JSON.parse(r.payload);switch(r.type){case"stats":bt.getState().setServerStats(s);break;case"deviceConnected":Cr.handleDeviceConnected({deviceId:s.deviceId,deviceName:s.deviceName,sessionId:s.sessionId,timestamp:s.timestamp,pluginStates:s.pluginStates});break;case"deviceDisconnected":Cr.handleDeviceDisconnected({deviceId:s.deviceId,timestamp:s.timestamp});break;case"deviceReconnected":Cr.handleDeviceReconnected({deviceId:s.deviceId,deviceName:s.deviceName,sessionId:s.sessionId,timestamp:s.timestamp});break;case"deviceInfoUpdated":Cr.handleDeviceInfoUpdated({deviceId:s.deviceId,deviceName:s.deviceName,timestamp:s.timestamp});break}}catch(r){console.error("[GlobalWS] Failed to parse message:",r)}}function fo(){if(Lt?.readyState===WebSocket.OPEN)return;const r=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/live?type=all`;Lt=new WebSocket(r),Lt.onopen=()=>{console.log("[GlobalWS] Connected"),bt.getState().setServerOnline(!0),Sr=0},Lt.onmessage=xd,Lt.onclose=()=>{console.log("[GlobalWS] Disconnected");const s=bt.getState().isServerOnline;bt.getState().setServerOnline(!1),s&&Vn&&Vn(),Sr<Za&&(Sr++,console.log(`[GlobalWS] Reconnecting in ${ei}ms (attempt ${Sr}/${Za})`),Fr=setTimeout(fo,ei))},Lt.onerror=s=>{console.error("[GlobalWS] Error:",s)}}function md(){fo()}function hd(){Fr&&(clearTimeout(Fr),Fr=null),Lt&&(Lt.close(),Lt=null)}const go="ws-auto-scroll";function pd(){try{const t=localStorage.getItem(go);if(t!==null)return t==="true"}catch{}return!0}function fd(t){try{localStorage.setItem(go,String(t))}catch{}}const fs=Ve((t,r)=>({sessions:[],totalSessions:0,sessionsLoading:!1,sessionsError:null,selectedSessionId:null,selectedSession:null,sessionLoading:!1,frames:[],totalFrames:0,framesLoading:!1,framesError:null,filters:{page:1,pageSize:50},framePage:1,framePageSize:100,frameDirection:"",autoScroll:pd(),isSelectMode:!1,selectedIds:new Set,fetchSessions:async s=>{t({sessionsLoading:!0,sessionsError:null});try{const n=await xc(s,r().filters),{selectedSessionId:a}=r(),i=a&&n.items.some(o=>o.id===a);t({sessions:n.items,totalSessions:n.total,sessionsLoading:!1,...a&&!i?{selectedSessionId:null,selectedSession:null,frames:[],totalFrames:0}:{}})}catch(n){console.error("[wsStore] fetchSessions error:",n),t({sessionsLoading:!1,sessionsError:n instanceof Error?n.message:"加载失败"})}},selectSession:async(s,n)=>{t({selectedSessionId:n,sessionLoading:!0,frames:[],totalFrames:0});try{const[a]=await Promise.all([oo(s,n),r().fetchFrames(s,n)]);t({selectedSession:a,sessionLoading:!1})}catch(a){console.error("[wsStore] selectSession error:",a),t({selectedSessionId:null,selectedSession:null,sessionLoading:!1,frames:[],totalFrames:0})}},fetchFrames:async(s,n,a)=>{a!==void 0&&t({frameDirection:a}),t({framesLoading:!0,framesError:null,framePage:1});try{const i=a!==void 0?a:r().frameDirection,o=await qa(s,n,{page:1,pageSize:r().framePageSize,direction:i||void 0});t({frames:o.items,totalFrames:o.total,framesLoading:!1})}catch(i){t({framesLoading:!1,framesError:i instanceof Error?i.message:"加载失败"})}},loadMoreFrames:async(s,n)=>{const{framePage:a,framePageSize:i,frames:o,totalFrames:l}=r();if(!(o.length>=l)){t({framesLoading:!0});try{const c=await qa(s,n,{page:a+1,pageSize:i,direction:r().frameDirection||void 0});t({frames:[...o,...c.items],framePage:a+1,framesLoading:!1})}catch{t({framesLoading:!1})}}},setFilter:(s,n)=>{t(a=>({filters:{...a.filters,[s]:n}}))},setFrameDirection:s=>{t({frameDirection:s})},clearSelection:()=>{t({selectedSessionId:null,selectedSession:null,frames:[],totalFrames:0})},clearSessions:()=>{t({sessions:[],totalSessions:0,selectedSessionId:null,selectedSession:null,frames:[],totalFrames:0})},setAutoScroll:s=>{fd(s),t({autoScroll:s})},addRealtimeSession:s=>{t(n=>{const a=n.sessions.findIndex(i=>i.id===s.id);if(a>=0){const i=n.sessions[a];if(i.url==="(loading...)"&&s.url!=="(loading...)"){const o=[...n.sessions];return o[a]={...i,url:s.url},{sessions:o}}return n}return{sessions:[s,...n.sessions],totalSessions:n.totalSessions+1}})},updateSessionStatus:(s,n,a,i)=>{t(o=>({sessions:o.sessions.map(l=>l.id===s?{...l,isOpen:n,closeCode:a??l.closeCode,closeReason:i??l.closeReason}:l),selectedSession:o.selectedSession?.id===s?{...o.selectedSession,closeCode:a??null,closeReason:i??null}:o.selectedSession}))},updateSessionUrl:(s,n)=>{t(a=>({sessions:a.sessions.map(i=>i.id===s?{...i,url:n}:i)}))},removeSession:s=>{t(n=>({sessions:n.sessions.filter(a=>a.id!==s),totalSessions:Math.max(0,n.totalSessions-1),...n.selectedSessionId===s?{selectedSessionId:null,selectedSession:null,frames:[],totalFrames:0}:{}}))},addRealtimeFrame:s=>{const{selectedSessionId:n,frames:a}=r();s.sessionId===n&&(a.some(o=>o.id===s.id)||t(o=>({frames:[s,...o.frames],totalFrames:o.totalFrames+1})))},toggleSelectMode:()=>{t(s=>({isSelectMode:!s.isSelectMode,selectedIds:s.isSelectMode?new Set:s.selectedIds}))},toggleSelectId:s=>{t(n=>{const a=new Set(n.selectedIds);return a.has(s)?a.delete(s):a.add(s),{selectedIds:a}})},selectAll:()=>{t(s=>{const n=new Set(s.sessions.map(i=>i.id));return{selectedIds:s.selectedIds.size===s.sessions.length?new Set:n}})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchDelete:async s=>{const{selectedIds:n,sessions:a}=r();if(n.size!==0)try{await hc(s,Array.from(n)),t({sessions:a.filter(i=>!n.has(i.id)),selectedIds:new Set,totalSessions:r().totalSessions-n.size,selectedSessionId:n.has(r().selectedSessionId??"")?null:r().selectedSessionId,selectedSession:n.has(r().selectedSessionId??"")?null:r().selectedSession})}catch(i){console.error("Failed to batch delete WS sessions:",i)}}})),$={size:20,strokeWidth:1.5},Bs=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),_s=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M9 12l-4-4.5M15 12l4-4.5M9 12v8M15 12v8M9 12h6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M5 7.5L3 9M19 7.5L21 9",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),es=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),qr=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M10 15V9M14 15V9",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),gd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M8 6h12M8 12h12M8 18h12",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"4",cy:"6",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"4",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"4",cy:"18",r:"1.5",fill:"currentColor"})]}),vt=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10 10 10 0 0 1-10-10 10 10 0 0 1 10-10z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),hr=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 9v4M12 17h.01",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),us=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 3v18h18",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 14l3-3 4 4 6-8",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),bd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("rect",{x:"9",y:"9",width:"6",height:"6",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M9 1v3M15 1v3M9 20v3M15 20v3M20 9h3M20 15h3M1 9h3M1 15h3",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),ti=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M6 6V4M10 6V4M14 6V4M18 6V4M6 18v2M10 18v2M14 18v2M18 18v2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("path",{d:"M6 10v4M10 10v4M14 10v4M18 10v4",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),yd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M8 21h8M12 17v4",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("path",{d:"M7 7l3 3-3 3M12 13h5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),bo=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 9v4M12 17h.01",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),xs=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),wt=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"2.5",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M10 4h4",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("path",{d:"M9.5 19h5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("path",{d:"M18 8v3",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),jd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>{const n=s??1.5;return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",stroke:"currentColor",strokeWidth:n}),e.jsx("circle",{cx:"12",cy:"4.5",r:"1",stroke:"currentColor",strokeWidth:n}),e.jsx("path",{d:"M8 19h8",stroke:"currentColor",strokeWidth:n*.8,strokeLinecap:"round",opacity:"0.5"}),e.jsx("circle",{cx:"9",cy:"19",r:"0.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"0.5",fill:"currentColor"}),e.jsx("circle",{cx:"15",cy:"19",r:"0.5",fill:"currentColor"})]})},vd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"18",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M12 17h.01",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),wd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M8 21h8M12 17v4",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),Nd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"6",y:"5",width:"12",height:"14",rx:"4",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M9 2v3M15 2v3M9 19v3M15 19v3",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),kd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"12",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M12 7V3M8 3h8",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),si=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>{const n=s??1.5;return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"2",width:"20",height:"14",rx:"1.5",stroke:"currentColor",strokeWidth:n}),e.jsx("path",{d:"M2 13h20",stroke:"currentColor",strokeWidth:n*.6,opacity:"0.3"}),e.jsx("path",{d:"M8 20h8",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round"}),e.jsx("path",{d:"M12 16v4",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round"}),e.jsx("rect",{x:"9",y:"4",width:"6",height:"9",rx:"1",stroke:"currentColor",strokeWidth:n*.8}),e.jsx("path",{d:"M10.5 5.5h3",stroke:"currentColor",strokeWidth:n*.6,strokeLinecap:"round"}),e.jsx("path",{d:"M10.5 11h3",stroke:"currentColor",strokeWidth:n*.6,strokeLinecap:"round"})]})},ri=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>{const n=s??1.5;return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"2",width:"20",height:"14",rx:"1.5",stroke:"currentColor",strokeWidth:n}),e.jsx("path",{d:"M2 13h20",stroke:"currentColor",strokeWidth:n*.6,opacity:"0.3"}),e.jsx("path",{d:"M8 20h8",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round"}),e.jsx("path",{d:"M12 16v4",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round"}),e.jsx("rect",{x:"9",y:"4",width:"6",height:"9",rx:"0.5",stroke:"currentColor",strokeWidth:n*.8}),e.jsx("circle",{cx:"12",cy:"5.2",r:"0.6",fill:"currentColor"}),e.jsx("circle",{cx:"10.5",cy:"11.5",r:"0.4",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"11.5",r:"0.4",fill:"currentColor"}),e.jsx("circle",{cx:"13.5",cy:"11.5",r:"0.4",fill:"currentColor"})]})},Gr=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 3v5h5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 21v-5h-5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),pr=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 11v6M14 11v6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Cd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 10l5 5 5-5M12 15V3",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),St=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),yo=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M22 3H2l8 9.46V19l4 2v-8.54L22 3z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),Hs=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth,filled:n=!1})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:n?"currentColor":"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),ca=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth,filled:n=!1})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:n?"currentColor":"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M9 11L15 5L19 9L13 15L9 11Z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round",fill:n?"currentColor":"none"}),e.jsx("path",{d:"M15 5L18 2L22 6L19 9",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 11L5 21L13 15",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("line",{x1:"2",y1:"22",x2:"8",y2:"22",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),jo=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Sd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M6 8h2M10 8h2M14 8h2M18 8h.01M6 12h2M10 12h2M14 12h2M18 12h.01M7 16h10",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),Td=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1",stroke:"currentColor",strokeWidth:s}),e.jsx("circle",{cx:"12",cy:"5",r:"1",stroke:"currentColor",strokeWidth:s}),e.jsx("circle",{cx:"12",cy:"19",r:"1",stroke:"currentColor",strokeWidth:s})]}),vo=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),Ed=({size:t=10,className:r})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 10 10",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"5",cy:"5",r:"4",fill:"#10B981"})}),yt=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 9l6 6 6-6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),Bt=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 3l8 4.5v9L12 21l-8-4.5v-9L12 3z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 12l8-4.5M12 12v9M12 12L4 7.5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Qt=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),da=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Yr=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),ir=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Ae=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Re=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),Id=({size:t=$.size,className:r})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"healthyGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#4ade80"}),e.jsx("stop",{offset:"100%",stopColor:"#22c55e"})]})}),e.jsx("path",{d:"M20 6L9 17L4 12",stroke:"url(#healthyGrad)",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),wo=({size:t=$.size,className:r})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"unhealthyGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#f87171"}),e.jsx("stop",{offset:"100%",stopColor:"#ef4444"})]})}),e.jsx("path",{d:"M18 6L6 18",stroke:"url(#unhealthyGrad)",strokeWidth:"3.5",strokeLinecap:"round"}),e.jsx("path",{d:"M6 6L18 18",stroke:"url(#unhealthyGrad)",strokeWidth:"3.5",strokeLinecap:"round"})]}),qn=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),or=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Md=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.48-.56.93-1.23 1.35-2h-4.35z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 9l-3.8 3.8a2.5 2.5 0 0 0 0 3.5l1.5 1.5a2.5 2.5 0 0 0 3.5 0L14 14",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),jt=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),Gn=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Dd=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})]}),Rd=({size:t=24,className:r=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:e.jsx("path",{d:"m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"})}),ms=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),e.jsx("polyline",{points:"5 12 12 5 19 12"})]}),hs=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("polyline",{points:"19 12 12 19 5 12"})]}),ua=({size:t=24,className:r=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:e.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),ni=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("polyline",{points:"7 10 10 13 7 16"}),e.jsx("line",{x1:"13",y1:"16",x2:"17",y2:"16"})]}),Ld=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),Yn=({size:t=24,className:r=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),No=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),Pd=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("rect",{x:"8",y:"6",width:"8",height:"12",rx:"4"}),e.jsx("path",{d:"M12 12h.01"}),e.jsx("path",{d:"M16 10l2-2"}),e.jsx("path",{d:"M16 14l2 2"}),e.jsx("path",{d:"M8 10l-2-2"}),e.jsx("path",{d:"M8 14l-2 2"})]}),ko=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),ai=({size:t=24,className:r=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:e.jsx("path",{d:"M12 3l1.912 5.813a2 2 0 0 0 1.272 1.272L21 12l-5.813 1.912a2 2 0 0 0-1.272 1.272L12 21l-1.912-5.813a2 2 0 0 0-1.272-1.272L3 12l5.813-1.912a2 2 0 0 0 1.272-1.272L12 3z"})}),Kr=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),e.jsx("polyline",{points:"12 5 19 12 12 19"})]}),Co=({size:t=24,className:r=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:e.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})}),Kn=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),zr=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Od=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"5"}),e.jsx("circle",{cx:"12",cy:"7",r:"1",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]}),Ad=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"3",width:"8",height:"8",rx:"1.5",stroke:"currentColor",strokeWidth:s}),e.jsx("rect",{x:"13",y:"3",width:"8",height:"8",rx:"1.5",stroke:"currentColor",strokeWidth:s}),e.jsx("rect",{x:"3",y:"13",width:"8",height:"8",rx:"1.5",stroke:"currentColor",strokeWidth:s}),e.jsx("rect",{x:"13",y:"13",width:"8",height:"8",rx:"1.5",stroke:"currentColor",strokeWidth:s})]}),Fd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("line",{x1:"9",y1:"6",x2:"20",y2:"6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("line",{x1:"9",y1:"12",x2:"20",y2:"12",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("line",{x1:"9",y1:"18",x2:"20",y2:"18",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("circle",{cx:"5",cy:"6",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"5",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"5",cy:"18",r:"1.5",fill:"currentColor"})]}),zd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"14",width:"4",height:"7",rx:"1",stroke:"currentColor",strokeWidth:s}),e.jsx("rect",{x:"10",y:"6",width:"4",height:"15",rx:"1",stroke:"currentColor",strokeWidth:s}),e.jsx("rect",{x:"17",y:"10",width:"4",height:"11",rx:"1",stroke:"currentColor",strokeWidth:s}),e.jsx("line",{x1:"2",y1:"21",x2:"22",y2:"21",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),$d=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),dt=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]}),Bd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M5 3l14 9-14 9V3z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),xa=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 4h4v16H6zM14 4h4v16h-4z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),_d=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M4.93 4.93l14.14 14.14",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Wd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),at=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),Jn=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),Hd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",strokeWidth:s}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"15.5",cy:"15.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"15.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"8.5",cy:"15.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"})]}),Ud=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"13",r:"8",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M12 9v4l2 2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M5 3L2 6",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 6L19 3",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 2v4",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),So=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 22v-5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 8V2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15 8V2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8h12z",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),Vd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"11",cy:"13",r:"9",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M11 4a9 9 0 0 0-9 9",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18.5 5.5L22 2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 6l-1.5-1.5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19 2l-1.5 1.5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),qd=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M2 13a6 6 0 1 0 12 0 4 4 0 1 0-8 0 2 2 0 0 0 4 0",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"10",cy:"13",r:"8",stroke:"currentColor",strokeWidth:s}),e.jsx("path",{d:"M2 21h16c2.5 0 4-1.5 4-3v-2h-2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18 14l2-2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 14l-2-2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]}),To=Gr,$r=({size:t=24,className:r=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Gd=({size:t=$.size,className:r})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 64 64",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{width:"64",height:"64",rx:"16",fill:"url(#debugPlatformGrad)"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32 14C26.4772 14 22 18.4772 22 24V26H18C16.8954 26 16 26.8954 16 28C16 29.1046 16.8954 30 18 30H22V34H16C14.8954 34 14 34.8954 14 36C14 37.1046 14.8954 38 16 38H22V42C22 47.5228 26.4772 52 32 52C37.5228 52 42 47.5228 42 42V38H48C49.1046 38 50 37.1046 50 36C50 34.8954 49.1046 34 48 34H42V30H46C47.1046 30 48 29.1046 48 28C48 26.8954 47.1046 26 46 26H42V24C42 18.4772 37.5228 14 32 14ZM26 24C26 20.6863 28.6863 18 32 18C35.3137 18 38 20.6863 38 24V26H26V24ZM26 30H38V34H26V30ZM26 38H38V42C38 45.3137 35.3137 48 32 48C28.6863 48 26 45.3137 26 42V38Z",fill:"white"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"debugPlatformGrad",x1:"0",y1:"0",x2:"64",y2:"64",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#00d4aa"}),e.jsx("stop",{offset:"1",stopColor:"#00b894"})]})})]}),cs=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})}),wn=({size:t=$.size,className:r})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"3",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),e.jsx("circle",{cx:"12",cy:"6.5",r:"2",fill:"#ef4444"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"#eab308"}),e.jsx("circle",{cx:"12",cy:"17.5",r:"2",fill:"#22c55e"})]}),As=({size:t=$.size,className:r,strokeWidth:s=$.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:r,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"}),e.jsx("path",{d:"M5.5 18.5L18.5 5.5",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round"})]}),ma=(t,r=24,s,n)=>{const a={className:s,size:r},i=t.toLowerCase();if(n)return i.includes("android")?e.jsx(ri,{...a}):e.jsx(si,{...a});if(i.includes("simulator"))return i.includes("android")?e.jsx(ri,{...a}):e.jsx(si,{...a});if(i.includes("android"))return e.jsx(jd,{...a});switch(t){case"iOS":return e.jsx(wt,{...a});case"iPadOS":return e.jsx(vd,{...a});case"macOS":return e.jsx(wd,{...a});case"watchOS":return e.jsx(Nd,{...a});case"tvOS":return e.jsx(kd,{...a});default:return e.jsx(wt,{...a})}};let Yd=0;const Tt=Ve((t,r)=>({toasts:[],show:(s,n,a=3e3)=>{const i=`toast-${++Yd}`;t(o=>({toasts:[...o.toasts,{id:i,type:s,message:n}]})),setTimeout(()=>{r().remove(i)},a)},remove:s=>{t(n=>({toasts:n.toasts.filter(a=>a.id!==s)}))}}));function Kd({isOpen:t,onClose:r,onConfirm:s,title:n,message:a,confirmText:i="确认执行",cancelText:o="取消",loading:l=!1}){const[c,u]=d.useState(""),[x,m]=d.useState(!1),[h,y]=d.useState(null),[p,f]=d.useState(!1);if(d.useEffect(()=>{t||(u(""),y(null),f(!1))},[t]),!t)return null;const w=async()=>{if(!c.trim()){y({valid:!1,message:"请输入 Token"});return}m(!0),y(null);try{const S=await oc(c.trim());y(S),f(S.valid)}catch(S){y({valid:!1,message:"验证失败: "+(S instanceof Error?S.message:"未知错误")}),f(!1)}finally{m(!1)}},N=()=>{p&&!l&&s()},E=S=>{S.key==="Enter"&&(p?N():w()),S.key==="Escape"&&r()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-lg shadow-lg w-[480px] overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-border bg-red-500/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-red-500/15",children:e.jsx(jt,{size:24,className:"text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-400",children:n}),e.jsx("p",{className:"text-xs text-text-muted",children:"此操作需要 Token 验证"})]})]})}),e.jsxs("div",{className:"px-6 py-5",children:[e.jsx("p",{className:"text-text-secondary whitespace-pre-line mb-4",children:a}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4 border border-border",children:[e.jsxs("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[e.jsx(Rd,{size:14}),"请输入服务器 Token 以验证身份："]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:c,onChange:S=>{u(S.target.value),y(null),f(!1)},onKeyDown:E,placeholder:"输入 Token...",autoFocus:!0,disabled:p,className:g("flex-1 px-3 py-2 bg-bg-dark border rounded text-text-primary font-mono focus:outline-none transition-colors",p?"border-green-500 bg-green-500/5":h&&!h.valid?"border-red-500/50 focus:border-red-400":"border-border focus:border-primary")}),e.jsx("button",{onClick:w,disabled:x||p||!c.trim(),className:g("px-4 py-2 rounded text-sm font-medium transition-all",p?"bg-green-500 text-white":"bg-primary text-bg-darkest hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed"),children:x?e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin inline-block"}):p?"已验证 ✓":"验证"})]}),h&&e.jsx("p",{className:g("text-xs mt-2",h.valid?"text-green-400":"text-red-400"),children:h.message})]}),p&&e.jsx("div",{className:"mt-4 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-400",children:"✓ Token 验证通过，您现在可以执行此操作。"})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border bg-bg-medium/30 flex justify-end gap-3",children:[e.jsx("button",{onClick:r,disabled:l,className:"px-4 py-2 rounded-lg text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-bg-light transition-all disabled:opacity-50",children:o}),e.jsx("button",{onClick:N,disabled:!p||l,className:g("px-4 py-2 rounded-lg text-sm font-medium text-white transition-all",p?"bg-red-500 hover:bg-red-600":"bg-red-500/30 cursor-not-allowed",l&&"opacity-50"),children:l?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"处理中..."]}):i})]})]})})}function Jd(t){if(t==null)return"-";if(t===0)return"0 B";if(isNaN(t))return"-";const r=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(r)),a=Math.min(n,s.length-1);return parseFloat((t/Math.pow(r,a)).toFixed(1))+" "+s[a]}function Mt(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}function Xd(){const t=bt(k=>k.serverStats),[r,s]=d.useState(null),[n,a]=d.useState(!1),[i,o]=d.useState(!1),[l,c]=d.useState(!1),[u,x]=d.useState(!1),m=Tt(),h=t||r,{fetchRules:y}=At(),p=Ze(),f=Ft(),w=fs(),N=Ws(),E=async()=>{o(!0);try{const k=await Mc();s(k)}catch(k){console.error("Failed to fetch server stats:",k)}finally{o(!1)}},S=async()=>{x(!0);try{await ic(),p.clearEvents(),f.clearEvents(),w.clearSessions(),N.clearData(),m.show("success","已清空所有数据"),c(!1),await Promise.all([E(),y()])}catch(k){m.show("error","清空数据失败: "+(k instanceof Error?k.message:"未知错误"))}finally{x(!1)}};if(d.useEffect(()=>{t||E()},[t]),!h)return null;const j=({icon:k,label:R,value:D})=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("span",{className:"text-text-muted flex items-center gap-1.5",children:[k,R]}),e.jsx("span",{className:"font-mono text-text-primary",children:D})]});return e.jsxs("div",{className:"border-t border-border",children:[e.jsxs("button",{onClick:()=>a(!n),className:"w-full px-4 py-2 flex items-center justify-between hover:bg-bg-light transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($d,{size:14}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:"数据统计"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n&&h&&e.jsxs("span",{className:"text-xs text-text-muted",children:[Mt(h.httpEventCount)," HTTP · ",Mt(h.logEventCount)," Log"]}),e.jsx("span",{className:`text-xs text-text-muted transition-transform ${n?"":"rotate-180"}`,children:e.jsx(yt,{size:12})})]})]}),n&&e.jsxs("div",{className:"px-4 pb-3 text-xs space-y-0.5",children:[e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-1 mb-1",children:"数据记录"}),e.jsx(j,{icon:e.jsx(Bs,{size:12}),label:"HTTP 事件",value:Mt(h.httpEventCount)}),e.jsx(j,{icon:e.jsx(es,{size:12}),label:"日志条目",value:Mt(h.logEventCount)}),e.jsx(j,{icon:e.jsx(_s,{size:12}),label:"WS 会话",value:Mt(h.wsSessionCount)}),e.jsx(j,{icon:e.jsx(ko,{size:12}),label:"WS 帧",value:Mt(h.wsFrameCount)}),e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"性能监控"}),e.jsx(j,{icon:e.jsx(us,{size:12}),label:"性能数据",value:Mt(h.perfMetricsCount)}),e.jsx(j,{icon:e.jsx(us,{size:12}),label:"卡顿事件",value:Mt(h.jankEventCount)}),e.jsx(j,{icon:e.jsx(bo,{size:12}),label:"告警记录",value:Mt(h.alertCount)}),e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"规则配置"}),e.jsx(j,{icon:e.jsx(vt,{size:12}),label:"Mock 规则",value:h.mockRuleCount}),e.jsx(j,{icon:e.jsx(qr,{size:12}),label:"断点规则",value:h.breakpointRuleCount}),e.jsx(j,{icon:e.jsx(hr,{size:12}),label:"故障注入规则",value:h.chaosRuleCount}),e.jsx(j,{icon:e.jsx(Od,{size:12}),label:"流量规则",value:h.trafficRuleCount}),e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"设备连接"}),e.jsx(j,{icon:e.jsx(wt,{size:12}),label:"在线设备",value:h.onlineDeviceCount}),e.jsx(j,{icon:e.jsx(Qt,{size:12}),label:"历史会话",value:h.deviceSessionCount}),h.databaseSizeBytes!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"存储"}),e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("span",{className:"text-text-muted flex items-center gap-1.5",children:[e.jsx(xs,{size:12}),"数据库大小"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-text-primary",children:Jd(h.databaseSizeBytes)}),e.jsx("button",{onClick:()=>c(!0),className:"p-1 text-text-muted hover:text-red-400 hover:bg-red-500/10 rounded transition-colors",title:"清空所有数据",children:e.jsx(pr,{size:12})})]})]})]}),e.jsx("button",{onClick:E,disabled:i,className:"mt-2 w-full py-1.5 text-center text-xs text-text-muted hover:text-text-primary hover:bg-bg-light rounded transition-colors disabled:opacity-50 flex items-center justify-center gap-1",children:i?"刷新中...":e.jsxs(e.Fragment,{children:[e.jsx(To,{size:12})," 刷新统计"]})})]}),e.jsx(Kd,{isOpen:l,onClose:()=>c(!1),onConfirm:S,title:"清空所有数据",message:`此操作将永久删除数据库中的所有数据，包括：
• HTTP 请求记录
• 日志条目
• WebSocket 会话和帧
• Mock/断点/故障注入规则
• 流量规则

此操作不可逆，请确认您已备份重要数据。`,confirmText:"确认清空",loading:u})]})}function Qd(){return typeof window>"u"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Nn(t){return t==="system"?Qd():t}function kn(t){const r=document.documentElement;t==="light"?(r.classList.add("light"),r.classList.remove("dark")):(r.classList.add("dark"),r.classList.remove("light"))}const Jr=Ve()(na((t,r)=>({theme:"dark",resolvedTheme:"dark",setTheme:s=>{const n=Nn(s);kn(n),t({theme:s,resolvedTheme:n})},toggleTheme:()=>{const{theme:s}=r(),n=s==="dark"?"light":s==="light"?"system":"dark",a=Nn(n);kn(a),t({theme:n,resolvedTheme:a})}}),{name:"debug-platform-theme",onRehydrateStorage:()=>t=>{if(t){const r=Nn(t.theme);kn(r),t.resolvedTheme=r}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const{theme:t,setTheme:r}=Jr.getState();t==="system"&&r("system")});function Zd(){const{theme:t,setTheme:r}=Jr(),s=()=>{r(t==="dark"?"light":t==="light"?"system":"dark")};return e.jsxs("button",{onClick:s,className:"p-2 rounded-lg hover:bg-bg-light transition-colors text-text-muted hover:text-text-primary",title:`当前主题: ${t==="dark"?"深色":t==="light"?"浅色":"跟随系统"}`,children:[t==="dark"&&e.jsx(eu,{className:"w-5 h-5"}),t==="light"&&e.jsx(tu,{className:"w-5 h-5"}),t==="system"&&e.jsx(su,{className:"w-5 h-5"})]})}function eu({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}function tu({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})}function su({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}function ru(){const t=Ur(),r=ra(),{isServerOnline:s}=bt(),[n,a]=d.useState(()=>localStorage.getItem("sidebar-collapsed")==="true"),[i,o]=d.useState(()=>{const L=localStorage.getItem("sidebar-width");return L?parseInt(L,10):288}),[l,c]=d.useState(!1),u=d.useRef(null),x=48,m=240,h=480,y=d.useCallback(()=>{a(L=>{const Q=!L;return localStorage.setItem("sidebar-collapsed",String(Q)),Q})},[]),p=d.useCallback(L=>{n||(L.preventDefault(),c(!0))},[n]);d.useEffect(()=>{const L=Z=>{if(!l)return;const J=Math.min(h,Math.max(m,Z.clientX));o(J)},Q=()=>{l&&(c(!1),localStorage.setItem("sidebar-width",i.toString()))};return l&&(document.addEventListener("mousemove",L),document.addEventListener("mouseup",Q),document.body.style.userSelect="none",document.body.style.cursor="col-resize"),()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",Q),document.body.style.userSelect="",document.body.style.cursor=""}},[l,i]);const{devices:f,fetchDevices:w,currentDeviceId:N,selectDevice:E}=Pe(),{events:S,toggleDomain:j,clearDomains:k,filters:R}=Ze(),{sessions:D,setFilter:F,filters:P}=fs(),{rules:U,getDomainRule:K,createOrUpdateRule:G,deleteRule:q,fetchRules:C}=At(),b=d.useMemo(()=>new URLSearchParams(r.search).get("plugin")||"http",[r.search]),[M,T]=d.useState(""),[B,A]=d.useState(new Set),I=d.useRef({});d.useEffect(()=>{w(),C()},[]);const O=b==="http"||b==="websocket",z=b==="websocket",[H,le]=d.useState(new Set),Y=(L,Q)=>{Q.stopPropagation(),le(Z=>{const J=new Set(Z);return J.has(L)?J.delete(L):J.add(L),J})},V=L=>H.has(L),ie=L=>{const Q=[],Z=Object.entries(L);for(const[Ie,ye]of Z){const je=Ie.split("/").filter(Boolean);let $e=Q,_e="";for(let We=0;We<je.length;We++){const mt=je[We];_e=_e+"/"+mt;let He=$e.find(Xe=>Xe.segment===mt);He||(He={segment:mt,fullPath:_e,count:0,children:[]},$e.push(He)),We===je.length-1&&(He.count+=ye),$e=He.children}}const J=Ie=>{for(const ye of Ie){J(ye.children);const je=ye.children.reduce(($e,_e)=>$e+_e.count,0);je>0&&ye.count===0&&(ye.count=je)}};J(Q);const be=Ie=>{Ie.sort((ye,je)=>je.count-ye.count);for(const ye of Ie)be(ye.children)};return be(Q),Q},Ne=d.useMemo(()=>{if(!O)return[];if(b==="websocket"){const L={};return D.forEach(Q=>{try{const Z=new URL(Q.url),J=Z.hostname,be=Z.pathname||"/";L[J]||(L[J]={count:0,pathCounts:{}}),L[J].count++,L[J].pathCounts[be]=(L[J].pathCounts[be]||0)+1}catch{}}),Object.entries(L).map(([Q,Z])=>({domain:Q,count:Z.count,pathTree:ie(Z.pathCounts)})).sort((Q,Z)=>Z.count-Q.count)}else{const L={};return S.forEach(Q=>{try{const Z=new URL(Q.url),J=Z.hostname,be=Z.pathname||"/";L[J]||(L[J]={count:0,pathCounts:{}}),L[J].count++,L[J].pathCounts[be]=(L[J].pathCounts[be]||0)+1}catch{}}),Object.entries(L).map(([Q,Z])=>({domain:Q,count:Z.count,pathTree:ie(Z.pathCounts)})).sort((Q,Z)=>Z.count-Q.count)}},[S,D,b,O]),se=d.useMemo(()=>Ne.map(({domain:L,count:Q})=>({domain:L,count:Q})),[Ne]),de=d.useRef(b);d.useEffect(()=>{if(!O)return;if(de.current!==b){de.current=b;const Z={};se.forEach(({domain:J,count:be})=>{Z[J]=be}),I.current=Z;return}const L={};se.forEach(({domain:Z,count:J})=>{L[Z]=J});const Q=new Set;for(const[Z,J]of Object.entries(L)){const be=I.current[Z]||0;J>be&&Q.add(Z)}Q.size>0&&(A(Z=>new Set([...Z,...Q])),setTimeout(()=>{A(Z=>{const J=new Set(Z);return Q.forEach(be=>J.delete(be)),J})},1500)),I.current=L},[se,b,O]);const _=d.useMemo(()=>{if(!M.trim())return Ne;const L=M.toLowerCase(),Q=Z=>{for(const J of Z)if(J.segment.toLowerCase().includes(L)||Q(J.children))return!0;return!1};return Ne.filter(({domain:Z,pathTree:J})=>Z.toLowerCase().includes(L)||Q(J))},[Ne,M]),ue=d.useMemo(()=>_.map(({domain:L,count:Q})=>({domain:L,count:Q})),[_]),ae=d.useMemo(()=>N?f.filter(L=>L.deviceId===N):[],[f,N]),ee=L=>{E(L);const Z=new URLSearchParams(r.search).get("plugin");t(Z?`/device/${L}?plugin=${Z}`:`/device/${L}`)},me=L=>{b==="websocket"?P.host===L?F("host",""):F("host",L):j(L)},Ce=(L,Q,Z)=>{if(Z.stopPropagation(),b==="websocket"){const J=P.urlContains||"",be=`${L}${Q}`;J===be?F("urlContains",""):F("urlContains",be)}else{const J=R.urlContains||"",be=`${L}${Q}`;J===be?Ze.getState().setFilter("urlContains",""):(R.domains.includes(L)||j(L),Ze.getState().setFilter("urlContains",be))}},Fe=(L,Q)=>{const Z=`${L}${Q}`;return b==="websocket"?P.urlContains===Z:R.urlContains===Z},et=()=>{b==="websocket"?(F("host",""),F("urlContains","")):(k(),Ze.getState().setFilter("urlContains",""))},ze=L=>b==="websocket"?P.host===L:R.domains.includes(L),re=()=>b==="websocket"?!P.host:R.domains.length===0,Se=async(L,Q)=>{L.stopPropagation();const Z=K(Q);Z?Z.action==="highlight"?await G({...Z,action:"mark"}):Z.action==="mark"?await G({...Z,action:"hide"}):Z.id&&await q(Z.id):await G({name:Q,matchType:"domain",matchValue:Q,action:"highlight",isEnabled:!0,priority:0})};return e.jsxs("aside",{ref:u,className:g("bg-bg-dark border-r border-border flex flex-col h-full relative flex-shrink-0 transition-all duration-300",n&&"overflow-hidden"),style:{width:n?x:i},children:[e.jsx("button",{onClick:y,className:g("absolute top-1/2 -translate-y-1/2 z-20 w-8 h-8 rounded-full","bg-bg-medium/90 border border-border shadow-md backdrop-blur","flex items-center justify-center","text-text-muted hover:text-primary hover:bg-bg-light transition-all",n?"right-1":"-right-4",n?"hover:translate-x-0.5":"hover:-translate-x-0.5"),title:n?"展开侧边栏":"收起侧边栏","aria-label":n?"展开侧边栏":"收起侧边栏",children:n?e.jsx(at,{size:14}):e.jsx(Jn,{size:14})}),!n&&e.jsx("div",{className:g("absolute top-0 right-0 w-1.5 h-full cursor-col-resize z-10 transition-colors group/handle","hover:bg-primary/50",l&&"bg-primary"),onMouseDown:p,title:"拖拽调整侧边栏宽度",children:e.jsxs("div",{className:g("absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2","flex flex-col gap-0.5 opacity-0 group-hover/handle:opacity-100 transition-opacity",l&&"opacity-100"),children:[e.jsx("div",{className:"w-0.5 h-3 bg-primary/80 rounded-full"}),e.jsx("div",{className:"w-0.5 h-3 bg-primary/80 rounded-full"}),e.jsx("div",{className:"w-0.5 h-3 bg-primary/80 rounded-full"})]})}),e.jsxs(ct,{to:"/",className:g("border-b border-border flex items-center gap-3 hover:bg-bg-light/50 transition-colors",n?"p-2 justify-center":"p-5"),children:[e.jsx(Gd,{size:n?32:40}),!n&&e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-text-primary text-lg",children:"Debug Platform"}),e.jsx("p",{className:"text-2xs text-text-muted",children:"调试平台"})]})]}),n?e.jsxs("div",{className:"flex-1 flex flex-col items-center py-4 gap-2 overflow-hidden",children:[e.jsx(ct,{to:"/api-docs",className:"w-8 h-8 flex items-center justify-center text-text-muted hover:text-primary hover:bg-bg-light rounded transition-colors",title:"API 文档",children:e.jsx(qn,{size:16})}),e.jsx(ct,{to:"/health",className:"w-8 h-8 flex items-center justify-center text-text-muted hover:text-green-400 hover:bg-bg-light rounded transition-colors",title:"健康检查",children:e.jsx(Re,{size:16})}),e.jsx(ct,{to:"/rules",className:g("w-8 h-8 flex items-center justify-center rounded transition-colors",r.pathname==="/rules"?"text-primary bg-primary/10":"text-text-muted hover:text-primary hover:bg-bg-light"),title:"流量规则",children:e.jsx(wn,{size:16})})]}):e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ct,{to:"/api-docs",className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-primary hover:bg-bg-light rounded transition-colors",title:"API 文档",children:[e.jsx(qn,{size:12}),e.jsx("span",{children:"API"})]}),e.jsxs(ct,{to:"/health",className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-green-400 hover:bg-bg-light rounded transition-colors",title:"健康检查",children:[e.jsx(Re,{size:12}),e.jsx("span",{children:"健康"})]})]}),e.jsxs(ct,{to:"/rules",className:g("flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors",r.pathname==="/rules"?"text-primary bg-primary/10":"text-text-muted hover:text-amber-400 hover:bg-bg-light"),title:"全局流量规则",children:[e.jsx(wn,{size:12}),e.jsx("span",{children:"流量规则"}),U.length>0&&e.jsx("span",{className:"ml-1 text-2xs px-1 py-0.5 rounded bg-bg-medium text-text-muted",children:U.length})]})]}),N&&e.jsxs("div",{className:"px-3 pt-4 pb-3",children:[e.jsxs("div",{className:"px-2 mb-3 text-xs font-semibold text-text-secondary uppercase tracking-wider flex justify-between items-center",children:[e.jsxs("button",{onClick:()=>t("/"),className:"flex items-center gap-2 hover:text-primary transition-colors",title:"查看设备列表",children:[e.jsx(wt,{size:14}),"当前设备"]}),e.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded-full text-2xs font-bold",children:f.length})]}),e.jsx("div",{className:"space-y-1",children:ae.map(L=>{const Q=N===L.deviceId,Z=!L.isOnline,J=L.deviceAlias||L.deviceName;return e.jsxs("div",{onClick:()=>ee(L.deviceId),className:g("group relative flex items-start gap-2.5 px-2.5 py-2 rounded-lg cursor-pointer transition-colors",Q?"bg-primary/15":Z?"text-text-muted hover:bg-bg-light/50":"text-text-secondary hover:bg-bg-light hover:text-text-primary"),children:[Q&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[3px] bg-primary"}),e.jsxs("div",{className:"flex flex-col items-center flex-shrink-0 gap-0.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:g("w-8 h-8 rounded-lg flex items-center justify-center border",Z?"bg-bg-medium/50 border-border":"bg-white/20 dark:bg-black/20 border-white/30 dark:border-white/10"),children:ma(L.platform,18,void 0,L.isSimulator)}),L.isOnline?e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-green-500 border border-green-400/50 rounded-full status-dot-online"}):e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-gray-500 border border-bg-dark rounded-full"})]}),L.isSimulator&&e.jsx("span",{className:"text-2xs px-1 py-0.5 rounded bg-yellow-500/20 text-yellow-400 whitespace-nowrap",children:"模拟器"})]}),e.jsxs("div",{className:g("min-w-0 flex-1",Z&&"opacity-60"),children:[e.jsx("div",{className:g("font-medium truncate text-xs",Q?"text-primary":"text-text-primary"),children:J}),e.jsxs("div",{className:g("text-2xs truncate",Q?"text-accent-blue/70":"text-text-muted"),title:L.deviceModel,children:[L.deviceModel," · ",L.platform," ",e.jsx("span",{className:"opacity-60",children:L.systemVersion})]}),e.jsxs("div",{className:g("text-2xs truncate mt-1 pt-1 border-t border-border flex items-center gap-1",Q?"text-accent-blue/70":"text-text-muted"),children:[e.jsx("div",{className:"w-3.5 h-3.5 rounded overflow-hidden bg-bg-light flex items-center justify-center flex-shrink-0",children:L.appIcon?e.jsx("img",{src:`data:image/png;base64,${L.appIcon}`,alt:L.appName,className:"w-full h-full object-cover"}):e.jsx(Bt,{size:8,className:"text-text-muted"})}),e.jsx("span",{className:"truncate",children:L.appName}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:L.appVersion})]})]})]},L.deviceId)})})]}),N&&O&&e.jsx("div",{className:"h-px bg-border"}),N&&O&&e.jsxs("div",{className:"px-3 py-3",children:[e.jsxs("div",{className:"px-2 mb-3 text-xs font-semibold text-text-secondary uppercase tracking-wider flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[b==="websocket"?e.jsx(_s,{size:14}):e.jsx(Bs,{size:14}),b==="websocket"?"WS Hosts":"Domains"]}),e.jsx("span",{className:"bg-accent-blue/10 text-accent-blue px-2 py-0.5 rounded-full text-2xs font-bold",children:se.length})]}),e.jsx("div",{className:"px-1 mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(St,{size:12,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",value:M,onChange:L=>T(L.target.value),placeholder:b==="websocket"?"搜索主机...":"搜索域名...",className:"w-full pl-8 pr-3 py-2 text-xs bg-bg-medium border border-border rounded text-text-primary placeholder:text-text-muted focus:outline-none focus:border-primary transition-colors"})]})}),e.jsxs("div",{className:"space-y-0.5 max-h-[400px] overflow-y-auto pr-1",children:[e.jsxs("div",{onClick:et,className:g("flex items-center justify-between px-3 py-2 rounded cursor-pointer text-xs transition-colors group",re()?"bg-accent-blue text-white font-medium":"text-text-secondary hover:bg-bg-light"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(es,{size:14}),e.jsx("span",{className:"font-medium",children:b==="websocket"?"全部主机":"全部域名"})]}),e.jsx("span",{className:g("font-mono text-2xs px-1.5 py-0.5 rounded",re()?"text-white font-bold bg-white/20":"opacity-60 bg-bg-medium"),children:se.reduce((L,{count:Q})=>L+Q,0)})]}),se.length>0&&e.jsx("div",{className:"border-t border-border-subtle my-1"}),_.map(({domain:L,count:Q,pathTree:Z})=>{const J=K(L),be=J?.action==="highlight",Ie=J?.action==="mark",ye=J?.action==="hide",je=ze(L),$e=B.has(L),_e=L,We=V(_e),mt=16,He=(Xe,Nt=0)=>Xe.map(tt=>{const Et=`${L}:${tt.fullPath}`,kt=V(Et),ht=tt.children.length>0,oe=Fe(L,tt.fullPath);return e.jsxs("div",{children:[e.jsxs("div",{onClick:pt=>Ce(L,tt.fullPath,pt),className:g("flex items-center justify-between py-1.5 cursor-pointer text-xs transition-colors group",oe?"bg-accent-blue/20 text-accent-blue font-medium":"text-text-muted hover:bg-bg-light hover:text-text-secondary"),style:{paddingLeft:`${mt+4}px`,paddingRight:"12px"},children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[ht?e.jsx("button",{onClick:pt=>Y(Et,pt),className:g("w-4 h-4 flex items-center justify-center flex-shrink-0 transition-transform hover:bg-bg-medium rounded",kt&&"rotate-90"),children:e.jsx(at,{size:12,className:kt?"text-primary":"text-text-muted"})}):e.jsx("span",{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("span",{className:"truncate font-mono text-2xs",children:["/",tt.segment]})]}),e.jsx("span",{className:g("font-mono text-2xs px-1 py-0.5 rounded ml-2 flex-shrink-0",oe?"bg-accent-blue/30":"opacity-60 bg-bg-medium"),children:tt.count})]}),kt&&ht&&e.jsx("div",{className:"border-l border-border-subtle",style:{marginLeft:`${mt}px`},children:He(tt.children,Nt+1)})]},tt.fullPath)});return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>me(L),className:g("flex items-center justify-between px-3 py-2 rounded cursor-pointer text-xs transition-colors group",je?"bg-accent-blue text-white font-medium":"text-text-secondary hover:bg-bg-light",$e&&"animate-domain-highlight"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("button",{onClick:Xe=>Y(_e,Xe),className:g("w-5 h-5 flex items-center justify-center flex-shrink-0 transition-transform hover:bg-bg-medium rounded",We&&"rotate-90"),title:We?"收起路径列表":"展开路径列表",children:e.jsx(at,{size:14,className:g(je?"text-white":We?"text-primary":"text-text-primary")})}),e.jsx("span",{className:g("truncate font-mono",ye&&"opacity-50 line-through"),children:L}),(be||Ie||ye)&&e.jsxs("span",{className:"flex-shrink-0",children:[be&&e.jsx(ca,{size:12,filled:!0,className:"text-yellow-500"}),Ie&&e.jsx(Yr,{size:12,className:"text-blue-400"}),ye&&e.jsx(pr,{size:12,className:"text-red-400"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g("font-mono text-2xs px-1.5 py-0.5 rounded",$e?"text-primary font-bold bg-primary/10":je?"text-white bg-white/20":"opacity-60 bg-bg-medium"),children:Q}),e.jsx("button",{onClick:Xe=>Se(Xe,L),className:g("opacity-0 group-hover:opacity-100 p-1.5 hover:bg-bg-medium rounded transition-colors",je&&"hover:bg-white/20"),title:"设置流量规则 (无 → 高亮 → 标记 → 隐藏)",children:e.jsx(wn,{size:14})})]})]}),We&&Z.length>0&&e.jsx("div",{className:"ml-7 border-l border-border-subtle",children:He(Z)})]},L)}),ue.length===0&&M&&e.jsxs("div",{className:"px-4 py-4 text-center text-xs text-text-muted bg-bg-light/20 rounded border border-dashed border-border",children:[e.jsx(St,{size:24,className:"block mb-1 opacity-50 mx-auto"}),z?"未找到匹配的主机":"未找到匹配的域名"]}),se.length===0&&!M&&e.jsxs("div",{className:"px-4 py-4 text-center text-xs text-text-muted bg-bg-light/20 rounded border border-dashed border-border",children:[z?e.jsx(_s,{size:24,className:"block mb-1 opacity-50 mx-auto"}):e.jsx(Bs,{size:24,className:"block mb-1 opacity-50 mx-auto"}),z?"暂无 WebSocket 主机":"暂无域名记录"]})]})]})]}),!n&&e.jsx(Xd,{}),e.jsxs("div",{className:g("bg-bg-darker border-t border-border text-xs text-text-muted flex items-center",n?"flex-col gap-2 py-3 px-2":"justify-between px-4 py-2"),children:[e.jsxs("div",{className:g("flex items-center",n?"flex-col gap-2":"gap-3"),children:[e.jsx(Zd,{}),!n&&e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:g("w-2 h-2 rounded-full border",s?"bg-green-500 border-green-400/50 status-dot-online":"bg-red-500 border-red-400/50")}),!n&&e.jsx("span",{className:"font-medium",children:s?"在线":"离线"})]})]}),!n&&e.jsx("span",{className:"text-text-muted/50",children:"1.2.4"})]})]})}let nu={data:""},au=t=>{if(typeof window=="object"){let r=(t?t.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return r.nonce=window.__nonce__,r.parentNode||(t||document.head).appendChild(r),r.firstChild}return t||nu},iu=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,ou=/\/\*[^]*?\*\/|  +/g,ii=/\n+/g,Yt=(t,r)=>{let s="",n="",a="";for(let i in t){let o=t[i];i[0]=="@"?i[1]=="i"?s=i+" "+o+";":n+=i[1]=="f"?Yt(o,i):i+"{"+Yt(o,i[1]=="k"?"":r)+"}":typeof o=="object"?n+=Yt(o,r?r.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,l):l?l+" "+c:c)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=Yt.p?Yt.p(i,o):i+":"+o+";")}return s+(r&&a?r+"{"+a+"}":a)+n},Dt={},Eo=t=>{if(typeof t=="object"){let r="";for(let s in t)r+=s+Eo(t[s]);return r}return t},lu=(t,r,s,n,a)=>{let i=Eo(t),o=Dt[i]||(Dt[i]=(c=>{let u=0,x=11;for(;u<c.length;)x=101*x+c.charCodeAt(u++)>>>0;return"go"+x})(i));if(!Dt[o]){let c=i!==t?t:(u=>{let x,m,h=[{}];for(;x=iu.exec(u.replace(ou,""));)x[4]?h.shift():x[3]?(m=x[3].replace(ii," ").trim(),h.unshift(h[0][m]=h[0][m]||{})):h[0][x[1]]=x[2].replace(ii," ").trim();return h[0]})(t);Dt[o]=Yt(a?{["@keyframes "+o]:c}:c,s?"":"."+o)}let l=s&&Dt.g?Dt.g:null;return s&&(Dt.g=Dt[o]),((c,u,x,m)=>{m?u.data=u.data.replace(m,c):u.data.indexOf(c)===-1&&(u.data=x?c+u.data:u.data+c)})(Dt[o],r,n,l),o},cu=(t,r,s)=>t.reduce((n,a,i)=>{let o=r[i];if(o&&o.call){let l=o(s),c=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=c?"."+c:l&&typeof l=="object"?l.props?"":Yt(l,""):l===!1?"":l}return n+a+(o??"")},"");function Xr(t){let r=this||{},s=t.call?t(r.p):t;return lu(s.unshift?s.raw?cu(s,[].slice.call(arguments,1),r.p):s.reduce((n,a)=>Object.assign(n,a&&a.call?a(r.p):a),{}):s,au(r.target),r.g,r.o,r.k)}let Io,Xn,Qn;Xr.bind({g:1});let _t=Xr.bind({k:1});function du(t,r,s,n){Yt.p=r,Io=t,Xn=s,Qn=n}function ts(t,r){let s=this||{};return function(){let n=arguments;function a(i,o){let l=Object.assign({},i),c=l.className||a.className;s.p=Object.assign({theme:Xn&&Xn()},l),s.o=/ *go\d+/.test(c),l.className=Xr.apply(s,n)+(c?" "+c:"");let u=t;return t[0]&&(u=l.as||t,delete l.as),Qn&&u[0]&&Qn(l),Io(u,l)}return a}}var uu=t=>typeof t=="function",Zn=(t,r)=>uu(t)?t(r):t,xu=(()=>{let t=0;return()=>(++t).toString()})(),mu=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let r=matchMedia("(prefers-reduced-motion: reduce)");t=!r||r.matches}return t}})(),hu=20,Mo="default",Do=(t,r)=>{let{toastLimit:s}=t.settings;switch(r.type){case 0:return{...t,toasts:[r.toast,...t.toasts].slice(0,s)};case 1:return{...t,toasts:t.toasts.map(o=>o.id===r.toast.id?{...o,...r.toast}:o)};case 2:let{toast:n}=r;return Do(t,{type:t.toasts.find(o=>o.id===n.id)?1:0,toast:n});case 3:let{toastId:a}=r;return{...t,toasts:t.toasts.map(o=>o.id===a||a===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return r.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(o=>o.id!==r.toastId)};case 5:return{...t,pausedAt:r.time};case 6:let i=r.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},pu=[],fu={toasts:[],pausedAt:void 0,settings:{toastLimit:hu}},Fs={},Ro=(t,r=Mo)=>{Fs[r]=Do(Fs[r]||fu,t),pu.forEach(([s,n])=>{s===r&&n(Fs[r])})},Lo=t=>Object.keys(Fs).forEach(r=>Ro(t,r)),gu=t=>Object.keys(Fs).find(r=>Fs[r].toasts.some(s=>s.id===t)),ha=(t=Mo)=>r=>{Ro(r,t)},bu=(t,r="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:r,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...s,id:s?.id||xu()}),fr=t=>(r,s)=>{let n=bu(r,t,s);return ha(n.toasterId||gu(n.id))({type:2,toast:n}),n.id},De=(t,r)=>fr("blank")(t,r);De.error=fr("error");De.success=fr("success");De.loading=fr("loading");De.custom=fr("custom");De.dismiss=(t,r)=>{let s={type:3,toastId:t};r?ha(r)(s):Lo(s)};De.dismissAll=t=>De.dismiss(void 0,t);De.remove=(t,r)=>{let s={type:4,toastId:t};r?ha(r)(s):Lo(s)};De.removeAll=t=>De.remove(void 0,t);De.promise=(t,r,s)=>{let n=De.loading(r.loading,{...s,...s?.loading});return typeof t=="function"&&(t=t()),t.then(a=>{let i=r.success?Zn(r.success,a):void 0;return i?De.success(i,{id:n,...s,...s?.success}):De.dismiss(n),a}).catch(a=>{let i=r.error?Zn(r.error,a):void 0;i?De.error(i,{id:n,...s,...s?.error}):De.dismiss(n)}),t};var yu=_t`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,ju=_t`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,vu=_t`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,wu=ts("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${yu} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${ju} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${vu} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Nu=_t`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ku=ts("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${Nu} 1s linear infinite;
`,Cu=_t`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Su=_t`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Tu=ts("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Cu} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Su} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Eu=ts("div")`
  position: absolute;
`,Iu=ts("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Mu=_t`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Du=ts("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Mu} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Ru=({toast:t})=>{let{icon:r,type:s,iconTheme:n}=t;return r!==void 0?typeof r=="string"?d.createElement(Du,null,r):r:s==="blank"?null:d.createElement(Iu,null,d.createElement(ku,{...n}),s!=="loading"&&d.createElement(Eu,null,s==="error"?d.createElement(wu,{...n}):d.createElement(Tu,{...n})))},Lu=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Pu=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,Ou="0%{opacity:0;} 100%{opacity:1;}",Au="0%{opacity:1;} 100%{opacity:0;}",Fu=ts("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,zu=ts("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,$u=(t,r)=>{let s=t.includes("top")?1:-1,[n,a]=mu()?[Ou,Au]:[Lu(s),Pu(s)];return{animation:r?`${_t(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${_t(a)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};d.memo(({toast:t,position:r,style:s,children:n})=>{let a=t.height?$u(t.position||r||"top-center",t.visible):{opacity:0},i=d.createElement(Ru,{toast:t}),o=d.createElement(zu,{...t.ariaProps},Zn(t.message,t));return d.createElement(Fu,{className:t.className,style:{...a,...s,...t.style}},typeof n=="function"?n({icon:i,message:o}):d.createElement(d.Fragment,null,i,o))});du(d.createElement);Xr`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;const Po=Ve((t,r)=>({activities:[],maxActivities:100,isLoading:!1,addActivity:s=>t(n=>({activities:[s,...n.activities].slice(0,n.maxActivities)})),clearActivities:()=>t({activities:[]}),getActivitiesForDevice:s=>r().activities.filter(n=>n.deviceId===s),loadDeviceActivities:async s=>{t({isLoading:!0});try{const n=await ao(s,20),a=[];for(const i of n)a.push({id:`${i.sessionId}-connected`,deviceId:i.deviceId,sessionId:i.sessionId,timestamp:i.connectedAt,type:"connected",deviceName:i.deviceName}),i.disconnectedAt&&a.push({id:`${i.sessionId}-disconnected`,deviceId:i.deviceId,sessionId:i.sessionId,timestamp:i.disconnectedAt,type:"disconnected",deviceName:i.deviceName});a.sort((i,o)=>new Date(o.timestamp).getTime()-new Date(i.timestamp).getTime()),t(i=>{const o=new Set(i.activities.map(u=>u.id)),l=a.filter(u=>!o.has(u.id));return{activities:[...i.activities,...l].sort((u,x)=>new Date(x.timestamp).getTime()-new Date(u.timestamp).getTime()).slice(0,i.maxActivities),isLoading:!1}})}catch(n){console.error("[sessionActivityStore] Failed to load activities:",n),t({isLoading:!1})}}}));function oi(){return{name:"新规则",targetType:"httpResponse",condition:{urlPattern:"",method:null,statusCode:null,headerContains:null,bodyContains:null,wsPayloadContains:null,enabled:!0},action:{modifyRequestHeaders:null,modifyRequestBody:null,mockResponseStatusCode:200,mockResponseHeaders:{"Content-Type":"application/json"},mockResponseBody:btoa(JSON.stringify({mock:!0})),mockWebSocketPayload:null,delayMilliseconds:null},priority:0,enabled:!0}}const Us=Ve((t,r)=>({rules:[],loading:!1,error:null,editingRule:null,isEditorOpen:!1,fetchRules:async s=>{t({loading:!0,error:null});try{const a=[...await lo(s)].sort((i,o)=>!i.createdAt&&!o.createdAt?0:i.createdAt?o.createdAt?new Date(o.createdAt).getTime()-new Date(i.createdAt).getTime():-1:1);t({rules:a,loading:!1})}catch(n){t({loading:!1,error:n instanceof Error?n.message:"加载失败"})}},createRule:async(s,n)=>{t({loading:!0,error:null});try{const a=await fc(s,n);t(i=>({rules:[a,...i.rules],loading:!1,isEditorOpen:!1,editingRule:null}))}catch(a){throw t({loading:!1,error:a instanceof Error?a.message:"创建失败"}),a}},updateRule:async(s,n,a)=>{t({loading:!0,error:null});try{const i=await Ga(s,n,a);t(o=>({rules:o.rules.map(l=>l.id===n?i:l),loading:!1,isEditorOpen:!1,editingRule:null}))}catch(i){throw t({loading:!1,error:i instanceof Error?i.message:"更新失败"}),i}},deleteRule:async(s,n)=>{t({loading:!0,error:null});try{await co(s,n),t(a=>({rules:a.rules.filter(i=>i.id!==n),loading:!1}))}catch(a){t({loading:!1,error:a instanceof Error?a.message:"删除失败"})}},toggleRuleEnabled:async(s,n)=>{const a=r().rules.find(i=>i.id===n);if(a)try{await Ga(s,n,{name:a.name,targetType:a.targetType,condition:a.condition,action:a.action,priority:a.priority,enabled:!a.enabled}),t(i=>({rules:i.rules.map(o=>o.id===n?{...o,enabled:!o.enabled}:o)}))}catch(i){console.error("Failed to toggle rule:",i)}},openEditor:s=>{t({isEditorOpen:!0,editingRule:s||null})},openEditorWithTemplate:s=>{let n=s.url;try{n=`*${new URL(s.url).pathname}*`}catch{}const a={id:"",deviceId:null,name:`Mock ${s.method||"GET"} ${n}`,targetType:"httpResponse",condition:{urlPattern:n,method:s.method||null,statusCode:null,headerContains:null,bodyContains:null,wsPayloadContains:null,enabled:!0},action:{modifyRequestHeaders:null,modifyRequestBody:null,mockResponseStatusCode:200,mockResponseHeaders:s.responseHeaders||{"Content-Type":"application/json"},mockResponseBody:s.responseBody||null,mockWebSocketPayload:null,delayMilliseconds:null},priority:0,enabled:!0,createdAt:null,updatedAt:null};t({isEditorOpen:!0,editingRule:a})},closeEditor:()=>{t({isEditorOpen:!1,editingRule:null})},clearRules:()=>{t({rules:[],editingRule:null,isEditorOpen:!1})}})),Zt=Ve((t,r)=>({rules:[],rulesLoading:!1,editingRule:null,isEditorOpen:!1,pendingHits:[],loading:!1,fetchRules:async s=>{t({rulesLoading:!0});try{const a=[...await aa(s)].sort((i,o)=>!i.createdAt&&!o.createdAt?0:i.createdAt?o.createdAt?new Date(o.createdAt).getTime()-new Date(i.createdAt).getTime():-1:1);t({rules:a,rulesLoading:!1})}catch(n){console.error("Failed to fetch breakpoint rules:",n),t({rulesLoading:!1})}},clearRules:()=>{t({rules:[]})},openEditor:s=>{t({editingRule:s||null,isEditorOpen:!0})},closeEditor:()=>{t({editingRule:null,isEditorOpen:!1})},activeRulesCount:()=>r().rules.filter(s=>s.enabled).length,hasActiveRules:()=>r().rules.some(s=>s.enabled),fetchPendingHits:async s=>{t({loading:!0});try{const n=await wc(s);t({pendingHits:n})}catch(n){console.error("Failed to fetch pending breakpoints:",n)}finally{t({loading:!1})}},addHit:s=>{t(n=>n.pendingHits.some(a=>a.requestId===s.requestId)?n:{pendingHits:[...n.pendingHits,s]})},removeHit:s=>{t(n=>({pendingHits:n.pendingHits.filter(a=>a.requestId!==s)}))},resumeBreakpoint:async(s,n,a)=>{try{await Nc(s,n,a),r().removeHit(n)}catch(i){throw console.error("Failed to resume breakpoint:",i),i}},clear:()=>{t({pendingHits:[],rules:[]})}})),Qr=Ve((t,r)=>({rules:[],loading:!1,error:null,editingRule:null,isEditorOpen:!1,fetchRules:async s=>{t({loading:!0,error:null});try{const a=[...await ia(s)].sort((i,o)=>!i.createdAt&&!o.createdAt?0:i.createdAt?o.createdAt?new Date(o.createdAt).getTime()-new Date(i.createdAt).getTime():-1:1);t({rules:a,loading:!1})}catch(n){t({error:n.message,loading:!1})}},createRule:async(s,n)=>{try{await mo(s,n),await r().fetchRules(s)}catch(a){t({error:a.message})}},updateRule:async(s,n,a)=>{try{await Hn(s,n,a),await r().fetchRules(s)}catch(i){t({error:i.message})}},deleteRule:async(s,n)=>{try{await oa(s,n),await r().fetchRules(s)}catch(a){t({error:a.message})}},toggleRuleEnabled:async(s,n)=>{const a=r().rules.find(i=>i.id===n);a&&await r().updateRule(s,n,{enabled:!a.enabled})},clearAllRules:async s=>{try{await la(s),t({rules:[]})}catch(n){t({error:n.message})}},clearRules:()=>{t({rules:[],error:null})},openEditor:s=>{t({editingRule:s||null,isEditorOpen:!0})},closeEditor:()=>{t({editingRule:null,isEditorOpen:!1})},hasActiveRules:()=>r().rules.some(s=>s.enabled),activeRulesCount:()=>r().rules.filter(s=>s.enabled).length})),as={http:{label:"HTTP 请求",icon:"🌐"},websocket:{label:"WebSocket 会话",icon:"🔌"},log:{label:"日志",icon:"📝"},mock:{label:"Mock 规则",icon:"🎭"},breakpoint:{label:"断点规则",icon:"🔴"},chaos:{label:"故障注入规则",icon:"💥"},trafficRule:{label:"流量规则",icon:"🚦"}};function Bu(t,r=10){const s=Ze.getState().events,n=t.toLowerCase();return s.filter(a=>a.url.toLowerCase().includes(n)||a.method.toLowerCase().includes(n)||(a.statusCode?.toString()||"").includes(t)||(a.traceId?.toLowerCase()||"").includes(n)).slice(0,r).map(a=>({id:a.id,type:"http",title:`${a.method} ${Ao(a.url)}`,subtitle:Oo(a.url),highlight:gs(a.url,t),timestamp:a.startTime,extra:{statusCode:a.statusCode,isMocked:a.isMocked,error:a.error,errorDescription:a.errorDescription},raw:a}))}function _u(t,r=10){const s=fs.getState().sessions,n=t.toLowerCase();return s.filter(a=>a.url.toLowerCase().includes(n)||a.id.toLowerCase().includes(n)).slice(0,r).map(a=>({id:a.id,type:"websocket",title:Ao(a.url)||a.url,subtitle:`${a.isOpen?"🟢 连接中":"🔴 已断开"} · ${Oo(a.url)}`,highlight:gs(a.url,t),timestamp:a.connectTime,extra:{isOpen:a.isOpen,closeCode:a.closeCode},raw:a}))}function Wu(t,r=15){const s=Ft.getState().events,n=t.toLowerCase();return s.filter(a=>a.message.toLowerCase().includes(n)||(a.subsystem?.toLowerCase()||"").includes(n)||(a.category?.toLowerCase()||"").includes(n)||(a.traceId?.toLowerCase()||"").includes(n)||a.tags?.some(i=>i.toLowerCase().includes(n))).slice(0,r).map(a=>({id:a.id,type:"log",title:Gu(a.message,80),subtitle:`${Yu(a.level)} ${a.level.toUpperCase()}${a.subsystem?` · ${a.subsystem}`:""}${a.category?` / ${a.category}`:""}`,highlight:gs(a.message,t),timestamp:a.timestamp,extra:{level:a.level,subsystem:a.subsystem,category:a.category},raw:a}))}function Hu(t,r=10){const s=Us.getState().rules,n=t.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(n)||(a.condition.urlPattern?.toLowerCase()||"").includes(n)||(a.condition.method?.toLowerCase()||"").includes(n)||a.targetType.toLowerCase().includes(n)).slice(0,r).map(a=>({id:a.id,type:"mock",title:a.name,subtitle:`${a.enabled?"✅":"❌"} ${a.targetType} · ${a.condition.urlPattern||"任意 URL"}`,highlight:gs(a.name+" "+(a.condition.urlPattern||""),t),timestamp:a.createdAt||void 0,extra:{enabled:a.enabled,targetType:a.targetType},raw:a}))}function Uu(t,r=10){const s=Zt.getState().rules,n=t.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(n)||(a.urlPattern?.toLowerCase()||"").includes(n)||(a.method?.toLowerCase()||"").includes(n)||a.phase.toLowerCase().includes(n)).slice(0,r).map(a=>({id:a.id,type:"breakpoint",title:a.name,subtitle:`${a.enabled?"✅":"❌"} ${a.phase} · ${a.urlPattern||"任意 URL"}`,highlight:gs(a.name+" "+(a.urlPattern||""),t),timestamp:a.createdAt||void 0,extra:{enabled:a.enabled,phase:a.phase},raw:a}))}function Vu(t,r=10){const s=Qr.getState().rules,n=t.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(n)||(a.urlPattern?.toLowerCase()||"").includes(n)||(a.method?.toLowerCase()||"").includes(n)||a.chaos.type.toLowerCase().includes(n)).slice(0,r).map(a=>({id:a.id,type:"chaos",title:a.name,subtitle:`${a.enabled?"✅":"❌"} ${Ku(a.chaos.type)} · ${Math.round(a.probability*100)}%`,highlight:gs(a.name+" "+(a.urlPattern||""),t),timestamp:a.createdAt||void 0,extra:{enabled:a.enabled,chaosType:a.chaos.type,probability:a.probability},raw:a}))}function qu(t,r=10){const s=At.getState().deviceRules.length>0?At.getState().deviceRules:At.getState().rules,n=t.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(n)||a.matchValue.toLowerCase().includes(n)||a.matchType.toLowerCase().includes(n)||a.action.toLowerCase().includes(n)).slice(0,r).map(a=>({id:a.id,type:"trafficRule",title:a.name,subtitle:`${a.isEnabled?"✅":"❌"} ${a.matchType}: ${a.matchValue} → ${a.action}`,highlight:gs(a.name+" "+a.matchValue,t),timestamp:a.createdAt||void 0,extra:{isEnabled:a.isEnabled,matchType:a.matchType,action:a.action},raw:a}))}function Oo(t){try{return new URL(t).hostname}catch{return t}}function Ao(t){try{const r=new URL(t);return r.pathname+r.search}catch{return t}}function Gu(t,r){return t.length<=r?t:t.slice(0,r)+"..."}function gs(t,r){if(!r)return;const s=t.toLowerCase(),n=r.toLowerCase(),a=s.indexOf(n);if(a===-1)return;const i=Math.max(0,a-20),o=Math.min(t.length,a+r.length+20),l=i>0?"...":"",c=o<t.length?"...":"";return l+t.slice(i,o)+c}function Yu(t){switch(t){case"error":return"🔴";case"warning":return"🟡";case"info":return"🔵";case"debug":return"⚪";case"verbose":return"⬜";default:return"⚪"}}function Ku(t){return{latency:"延迟",timeout:"超时",connectionReset:"连接重置",randomError:"随机错误",corruptResponse:"响应损坏",slowNetwork:"慢速网络",dropRequest:"丢弃请求"}[t]||t}function Ju(){try{const t=localStorage.getItem("globalSearch.recentSearches");return t?JSON.parse(t):[]}catch{return[]}}function li(t){try{localStorage.setItem("globalSearch.recentSearches",JSON.stringify(t))}catch{}}const Fo=Ve((t,r)=>({isOpen:!1,query:"",isSearching:!1,results:[],selectedIndex:0,recentSearches:Ju(),open:()=>t({isOpen:!0,query:"",results:[],selectedIndex:0}),close:()=>t({isOpen:!1,query:"",results:[],selectedIndex:0}),setQuery:s=>{t({query:s}),s.trim().length>=1?r().search(s):t({results:[],selectedIndex:0})},search:s=>{if(!s.trim()){t({results:[],selectedIndex:0});return}t({isSearching:!0});const n=Bu(s),a=_u(s),i=Wu(s),o=Hu(s),l=Uu(s),c=Vu(s),u=qu(s),x=[];n.length>0&&x.push({type:"http",...as.http,items:n,total:n.length}),a.length>0&&x.push({type:"websocket",...as.websocket,items:a,total:a.length}),i.length>0&&x.push({type:"log",...as.log,items:i,total:i.length}),o.length>0&&x.push({type:"mock",...as.mock,items:o,total:o.length}),l.length>0&&x.push({type:"breakpoint",...as.breakpoint,items:l,total:l.length}),c.length>0&&x.push({type:"chaos",...as.chaos,items:c,total:c.length}),u.length>0&&x.push({type:"trafficRule",...as.trafficRule,items:u,total:u.length}),t({results:x,isSearching:!1,selectedIndex:0})},selectNext:()=>{const{results:s,selectedIndex:n}=r(),a=s.reduce((i,o)=>i+o.items.length,0);a!==0&&t({selectedIndex:(n+1)%a})},selectPrev:()=>{const{results:s,selectedIndex:n}=r(),a=s.reduce((i,o)=>i+o.items.length,0);a!==0&&t({selectedIndex:(n-1+a)%a})},getSelectedResult:()=>{const{results:s,selectedIndex:n}=r();let a=0;for(const i of s)for(const o of i.items){if(a===n)return o;a++}return null},addRecentSearch:s=>{const n=s.trim();if(!n)return;const{recentSearches:a}=r(),i=a.filter(l=>l!==n),o=[n,...i].slice(0,10);t({recentSearches:o}),li(o)},clearRecentSearches:()=>{t({recentSearches:[]}),li([])}})),we={HTTP:"http",LOG:"log",DATABASE:"database",WEBSOCKET:"websocket",MOCK:"mock",BREAKPOINT:"breakpoint",CHAOS:"chaos",PERFORMANCE:"performance"},ci="debugplatform_plugin_enabled_state",Xu=[we.WEBSOCKET,we.PERFORMANCE,we.MOCK,we.BREAKPOINT,we.CHAOS];function di(t){return!Xu.includes(t)}class Qu{plugins=new Map;context=null;eventHandlers=new Map;enabledState=new Map;changeListeners=new Set;constructor(){this.loadEnabledState()}subscribe(r){return this.changeListeners.add(r),()=>this.changeListeners.delete(r)}notifyChange(){this.changeListeners.forEach(r=>r())}loadEnabledState(){try{const r=localStorage.getItem(ci);if(r){const s=JSON.parse(r);for(const[n,a]of Object.entries(s))this.enabledState.set(n,a)}}catch(r){console.error("[PluginRegistry] Failed to load plugin enabled state:",r)}}saveEnabledState(){try{const r={};for(const[s,n]of this.enabledState)r[s]=n;localStorage.setItem(ci,JSON.stringify(r))}catch(r){console.error("[PluginRegistry] Failed to save plugin enabled state:",r)}}setPluginEnabled(r,s){const n=this.getPlugin(r);if(n){if(s){const a=this.enableRequiredDependencies(r);a.length>0&&console.log(`[PluginRegistry] Auto-enabled dependencies for ${r}: ${a.join(", ")}`);const i=this.enableChildPlugins(r);i.length>0&&console.log(`[PluginRegistry] Auto-enabled child plugins of ${r}: ${i.join(", ")}`)}else{const a=this.disableDependentPlugins(r);a.length>0&&console.log(`[PluginRegistry] Auto-disabled dependent plugins of ${r}: ${a.join(", ")}`)}n.isEnabled=s,this.enabledState.set(r,s),this.saveEnabledState(),this.notifyChange(),console.log(`[PluginRegistry] Plugin ${r} ${s?"enabled":"disabled"}`),this.syncPluginStatesToHub()}}enableChildPlugins(r){const s=[];for(const[n,a]of this.plugins){const i=a.plugin.metadata;i.isSubPlugin&&i.parentPluginId===r&&(this.isPluginEnabled(n)||(a.plugin.isEnabled=!0,this.enabledState.set(n,!0),s.push(n)))}return s}getRequiredDependencies(r){const s=this.getPlugin(r);return s?(s.metadata.dependencies||[]).filter(a=>!this.isPluginEnabled(a)):[]}getDependentPlugins(r){const s=[];for(const[n,a]of this.plugins)a.plugin.metadata.dependencies?.includes(r)&&this.isPluginEnabled(n)&&s.push(n);return s}syncPluginStatesToHub(){const r=this.getAllPlugins().map(s=>({pluginId:s.metadata.pluginId,displayName:s.metadata.displayName,isEnabled:s.isEnabled}));fetch("/api/webui-plugins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plugins:r})}).catch(s=>{console.warn("[PluginRegistry] Failed to sync plugin states to DebugHub:",s)})}syncInitialStatesToHub(){this.syncPluginStatesToHub()}enableRequiredDependencies(r){const s=this.getPlugin(r);if(!s)return[];const n=s.metadata.dependencies||[],a=[];for(const i of n)if(!this.isPluginEnabled(i)){const o=this.getPlugin(i);o&&(o.isEnabled=!0,this.enabledState.set(i,!0),a.push(i))}return a}disableDependentPlugins(r){const s=[];for(const[n,a]of this.plugins)a.plugin.metadata.dependencies?.includes(r)&&this.isPluginEnabled(n)&&(a.plugin.isEnabled=!1,this.enabledState.set(n,!1),s.push(n));return s}isPluginEnabled(r){return this.enabledState.has(r)?this.enabledState.get(r):di(r)}register(r,s){if(this.plugins.has(r.metadata.pluginId)){console.warn(`Plugin already registered: ${r.metadata.pluginId}`);return}this.enabledState.has(r.metadata.pluginId)?r.isEnabled=this.enabledState.get(r.metadata.pluginId):r.isEnabled=di(r.metadata.pluginId);const n={plugin:r,routePath:s.routePath,tabOrder:s.tabOrder??this.plugins.size};this.plugins.set(r.metadata.pluginId,n),console.log(`[PluginRegistry] Registered plugin: ${r.metadata.pluginId}`)}unregister(r){const s=this.plugins.get(r);s&&(s.plugin.destroy?.(),this.plugins.delete(r),console.log(`[PluginRegistry] Unregistered plugin: ${r}`))}getPlugin(r){return this.plugins.get(r)?.plugin}getAllPlugins(){return Array.from(this.plugins.values()).sort((r,s)=>r.tabOrder-s.tabOrder).map(r=>r.plugin)}getTabConfigs(){return Array.from(this.plugins.values()).sort((r,s)=>r.tabOrder-s.tabOrder).filter(r=>r.plugin.isEnabled&&!r.plugin.metadata.isSubPlugin).map(r=>({pluginId:r.plugin.metadata.pluginId,label:r.plugin.metadata.displayName,icon:r.plugin.metadata.icon,description:r.plugin.metadata.description,routePath:r.routePath}))}setContext(r){this.context=r}getContext(){return this.context}async initializeAll(r){this.context=r;const s=this.topologicalSort();for(const n of s){const a=this.plugins.get(n);if(!a)continue;const i=a.plugin;if(i.isEnabled)try{console.log(`[PluginRegistry] Initializing plugin: ${n}`),await i.initialize(r),console.log(`[PluginRegistry] Plugin initialized: ${n}`)}catch(o){console.error(`[PluginRegistry] Failed to initialize plugin ${n}:`,o)}}}dispatchEvent(r){const s=this.getPlugin(r.pluginId);s?.onEvent&&s.onEvent(r);const n=this.eventHandlers.get(r.eventType);n&&n.forEach(a=>a(r))}subscribeToEvents(r,s){for(const n of r)this.eventHandlers.has(n)||this.eventHandlers.set(n,new Set),this.eventHandlers.get(n).add(s);return()=>{for(const n of r)this.eventHandlers.get(n)?.delete(s)}}destroyAll(){for(const r of this.plugins.values())r.plugin.destroy?.();this.plugins.clear(),this.eventHandlers.clear(),this.context=null}topologicalSort(){const r=new Set,s=new Set,n=[],a=i=>{if(r.has(i))return;if(s.has(i)){console.warn(`Circular dependency detected: ${i}`);return}s.add(i);const o=this.plugins.get(i);if(o){const l=o.plugin.metadata.dependencies||[];for(const c of l)this.plugins.has(c)&&a(c)}s.delete(i),r.add(i),n.push(i)};for(const i of this.plugins.keys())a(i);return n}get(r){return this.getPlugin(r)}getAll(){return this.getAllPlugins()}getPluginConfig(r){const s=this.plugins.get(r);if(s)return{routePath:s.routePath,tabOrder:s.tabOrder}}}const he=new Qu;class Zu{ws=null;messageHandlers=new Set;connectionHandlers=new Set;reconnectTimer=null;currentDeviceId=null;shouldReconnect=!1;connect(r,s="all"){this.disconnect(),this.currentDeviceId=r,this.shouldReconnect=!0;const a=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/live?deviceId=${r}&type=${s}`;this.ws=new WebSocket(a),this.ws.onopen=()=>{console.log("[Realtime] Connected"),this.notifyConnectionHandlers(!0)},this.ws.onclose=()=>{console.log("[Realtime] Disconnected"),this.notifyConnectionHandlers(!1),this.scheduleReconnect()},this.ws.onerror=i=>{console.error("[Realtime] Error:",i)},this.ws.onmessage=i=>{try{const o=JSON.parse(i.data);this.notifyMessageHandlers(o)}catch(o){console.error("[Realtime] Failed to parse message:",o)}}}disconnect(){this.shouldReconnect=!1,this.currentDeviceId=null,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null)}pauseReconnect(){this.shouldReconnect=!1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null)}resumeReconnect(){this.currentDeviceId&&(this.shouldReconnect=!0,this.connect(this.currentDeviceId))}scheduleReconnect(){!this.shouldReconnect||!this.currentDeviceId||(this.reconnectTimer=window.setTimeout(()=>{this.currentDeviceId&&(console.log("[Realtime] Reconnecting..."),this.connect(this.currentDeviceId))},3e3))}onMessage(r){return this.messageHandlers.add(r),()=>this.messageHandlers.delete(r)}onConnection(r){return this.connectionHandlers.add(r),()=>this.connectionHandlers.delete(r)}notifyMessageHandlers(r){this.messageHandlers.forEach(s=>s(r))}notifyConnectionHandlers(r){this.connectionHandlers.forEach(s=>s(r))}get isConnected(){return this.ws?.readyState===WebSocket.OPEN}}const os=new Zu;function ex(t){const r=JSON.parse(t);return{id:r.request.id,method:r.request.method,url:r.request.url,statusCode:r.response?.statusCode??null,startTime:r.request.startTime,duration:r.response?.duration??null,isMocked:r.isMocked,mockRuleId:r.mockRuleId??null,errorDescription:r.response?.errorDescription??null,error:r.response?.error??null,traceId:r.request.traceId??null,isFavorite:r.isFavorite??!1,isReplay:r.isReplay??!1,redirectFromId:r.redirectFromId??null,redirectToUrl:r.redirectToUrl??null,seqNum:r.seqNum??0}}function tx(t){const r=JSON.parse(t);return{...r,seqNum:r.seqNum??0}}function sx(t){const r=JSON.parse(t),s=n=>n&&typeof n=="object"&&"_0"in n?n._0:n;return r.kind.sessionCreated?{type:"sessionCreated",data:s(r.kind.sessionCreated)}:r.kind.sessionClosed?{type:"sessionClosed",data:s(r.kind.sessionClosed)}:r.kind.frame?{type:"frame",data:s(r.kind.frame)}:{type:"unknown",data:r}}const ui="/api",Cn=new Map;function Br(){return he.getAll().filter(t=>t.metadata.isSubPlugin?!1:he.isPluginEnabled(t.metadata.pluginId)).map(t=>({pluginId:t.metadata.pluginId,displayName:t.metadata.displayName,icon:t.metadata.icon,tabOrder:he.getPluginConfig(t.metadata.pluginId)?.tabOrder??999})).sort((t,r)=>t.tabOrder-r.tabOrder)}function rx({deviceId:t,activePluginId:r,className:s}){const n=Tt(),a=Pe(p=>p.isPluginEnabled),[i,o]=d.useState({});d.useEffect(()=>he.subscribe(()=>o({})),[]);const l=d.useMemo(()=>({deviceId:t,apiBaseUrl:ui,fetch:window.fetch.bind(window),getConfig:p=>Cn.get(r)?.[p],setConfig:(p,f)=>{let w=Cn.get(r);w||(w={},Cn.set(r,w)),w[p]=f},showToast:(p,f)=>{n.show(f,p)},subscribeToEvents:(p,f)=>{const w=os.onMessage(N=>{if(N.deviceId!==t)return;const S={httpEvent:"http_event",logEvent:"log_event",wsEvent:"ws_connection",breakpointHit:"breakpoint_hit",performanceEvent:"performance_metrics"}[N.type];if(S&&p.includes(S)){const j={pluginId:r,eventType:S,eventId:Math.random().toString(36).substring(7),payload:JSON.parse(N.payload),timestamp:new Date().toISOString()};f(j)}if(N.type==="performanceEvent")try{const j=JSON.parse(N.payload);let k=null;if(j.eventType==="metrics"&&p.includes("performance_metrics")?k="performance_metrics":j.eventType==="jank"&&p.includes("jank_event")?k="jank_event":j.eventType==="alert"&&p.includes("performance_alert")?k="performance_alert":j.eventType==="alertResolved"&&p.includes("alert_resolved")&&(k="alert_resolved"),k){const R={pluginId:r,eventType:k,eventId:Math.random().toString(36).substring(7),payload:j,timestamp:new Date().toISOString()};f(R)}}catch(j){console.error("[PluginRenderer] Failed to parse performance event:",j)}});return()=>{w()}},sendCommand:async p=>{if(!(await fetch(`${ui}/devices/${t}/plugins/${p.pluginId}/command`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok)throw new Error("Failed to send command");return{pluginId:p.pluginId,commandId:p.commandId||"",success:!0}}}),[t,r,n]),c=d.useMemo(()=>{if(!(!r||!he.isPluginEnabled(r)))return he.get(r)},[r,i]);d.useEffect(()=>{c&&c.initialize(l)},[c,l]);const u=d.useMemo(()=>({context:l,isActive:!0}),[l]),x=Br(),m=r?he.get(r):void 0,h=m&&!he.isPluginEnabled(r),y=r?!a(r):!1;return x.length===0?e.jsxs("div",{className:`flex flex-col items-center justify-center h-full text-text-tertiary ${s}`,children:[e.jsx("div",{className:"text-lg mb-2",children:"没有启用任何插件"}),e.jsx("div",{className:"text-sm text-text-muted",children:'请点击右上角的"插件"按钮启用插件'})]}):y&&c?e.jsxs("div",{className:`flex flex-col items-center justify-center h-full text-text-tertiary ${s}`,children:[e.jsx(As,{size:48,className:"mb-4 text-text-muted"}),e.jsx("div",{className:"text-lg mb-2",children:"插件在设备端已禁用"}),e.jsxs("div",{className:"text-sm text-text-muted max-w-md text-center",children:['插件 "',c.metadata.displayName,'" 在 DebugProbe SDK 中已被禁用， 无法在 WebUI 中使用。请在 App 中启用该插件后重新连接。']})]}):c?e.jsx("div",{className:`h-full ${s}`,children:c.render(u)}):h?e.jsxs("div",{className:`flex flex-col items-center justify-center h-full text-text-tertiary ${s}`,children:[e.jsx("div",{className:"text-lg mb-2",children:"插件未启用"}),e.jsxs("div",{className:"text-sm text-text-muted mb-4",children:['插件 "',m?.metadata.displayName||r,'" 当前已禁用']}),e.jsx("button",{onClick:()=>he.setPluginEnabled(r,!0),className:"btn btn-primary text-sm",children:"启用插件"})]}):e.jsxs("div",{className:`flex items-center justify-center h-full text-text-tertiary ${s}`,children:["插件未找到: ",r]})}function nx({activePluginId:t,onTabChange:r,className:s}){const[,n]=d.useState({}),a=Pe(o=>o.isPluginEnabled);d.useEffect(()=>he.subscribe(()=>n({})),[]);const i=Br();return e.jsx("div",{className:`flex items-center gap-0.5 p-0.5 bg-bg-medium rounded-lg border border-border w-fit ${s}`,children:i.map((o,l)=>{const c=!a(o.pluginId);return e.jsxs("button",{onClick:()=>r(o.pluginId),title:c?`${o.displayName}（设备端已禁用）`:`⌘${l+1}`,className:`flex items-center gap-1.5 px-3 py-1.5 rounded text-sm font-medium transition-colors relative whitespace-nowrap ${t===o.pluginId?"bg-primary text-bg-darkest":c?"text-text-muted opacity-50 cursor-not-allowed":"text-text-secondary hover:text-text-primary hover:bg-bg-light"}`,children:[e.jsx("span",{className:"text-sm",children:o.icon}),e.jsx("span",{children:o.displayName}),c&&e.jsx(As,{size:12,className:"ml-1 text-text-muted"})]},o.pluginId)})})}const ax=[{category:"导航",items:[{keys:["↑","↓"],description:"上/下选择请求"},{keys:["Enter"],description:"查看详情"},{keys:["Esc"],description:"取消选择/关闭面板"}]},{category:"操作",items:[{keys:["⌘/Ctrl","K / F"],description:"全局搜索"},{keys:["⌘/Ctrl","R"],description:"刷新列表"},{keys:["⌘/Ctrl","L"],description:"清屏"},{keys:["⌘/Ctrl","E"],description:"导出数据"},{keys:["⌘/Ctrl","A"],description:"全选"}]},{category:"收藏与删除",items:[{keys:["F"],description:"收藏/取消收藏选中项"},{keys:["Delete","/","Backspace"],description:"删除选中项"}]},{category:"界面",items:[{keys:["⌘/Ctrl","T"],description:"切换主题"},{keys:["⌘/Ctrl","/"],description:"显示快捷键帮助"}]}];function ix({isOpen:t,onClose:r}){return d.useEffect(()=>{const s=n=>{n.key==="Escape"&&r()};if(t)return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[t,r]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative bg-bg-dark border border-border rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"键盘快捷键"}),e.jsx("button",{onClick:r,className:"p-1 rounded hover:bg-bg-light transition-colors text-text-muted hover:text-text-primary",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[60vh]",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:ax.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted mb-3",children:s.category}),e.jsx("div",{className:"space-y-2",children:s.items.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:n.description}),e.jsx("div",{className:"flex items-center gap-1",children:n.keys.map((i,o)=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("kbd",{className:"kbd",children:i}),o<n.keys.length-1&&e.jsx("span",{className:"mx-1 text-text-muted text-xs",children:"+"})]},o))})]},a))})]},s.category))})}),e.jsx("div",{className:"px-6 py-3 border-t border-border bg-bg-medium/50 text-center",children:e.jsxs("span",{className:"text-xs text-text-muted",children:["按 ",e.jsx("kbd",{className:"kbd",children:"Esc"})," 关闭"]})})]})]}):null}const zo=6048e5,ox=864e5,pa=6e4,fa=36e5,xi=Symbol.for("constructDateFrom");function it(t,r){return typeof t=="function"?t(r):t&&typeof t=="object"&&xi in t?t[xi](r):t instanceof Date?new t.constructor(r):new Date(r)}function Ye(t,r){return it(r||t,t)}function lx(t,r,s){const n=Ye(t,s?.in);return isNaN(r)?it(t,NaN):(n.setDate(n.getDate()+r),n)}let cx={};function Zr(){return cx}function lr(t,r){const s=Zr(),n=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,a=Ye(t,r?.in),i=a.getDay(),o=(i<n?7:0)+i-n;return a.setDate(a.getDate()-o),a.setHours(0,0,0,0),a}function _r(t,r){return lr(t,{...r,weekStartsOn:1})}function $o(t,r){const s=Ye(t,r?.in),n=s.getFullYear(),a=it(s,0);a.setFullYear(n+1,0,4),a.setHours(0,0,0,0);const i=_r(a),o=it(s,0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);const l=_r(o);return s.getTime()>=i.getTime()?n+1:s.getTime()>=l.getTime()?n:n-1}function mi(t){const r=Ye(t),s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),+t-+s}function ga(t,...r){const s=it.bind(null,r.find(n=>typeof n=="object"));return r.map(s)}function Wr(t,r){const s=Ye(t,r?.in);return s.setHours(0,0,0,0),s}function dx(t,r,s){const[n,a]=ga(s?.in,t,r),i=Wr(n),o=Wr(a),l=+i-mi(i),c=+o-mi(o);return Math.round((l-c)/ox)}function ux(t,r){const s=$o(t,r),n=it(t,0);return n.setFullYear(s,0,4),n.setHours(0,0,0,0),_r(n)}function Bo(t){return it(t,Date.now())}function _o(t,r,s){const[n,a]=ga(s?.in,t,r);return+Wr(n)==+Wr(a)}function xx(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function mx(t){return!(!xx(t)&&typeof t!="number"||isNaN(+Ye(t)))}function ba(t){return r=>{const s=Math.trunc,n=s(r);return n===0?0:n}}function hx(t,r,s){const[n,a]=ga(s?.in,t,r),i=(+n-+a)/fa;return ba()(i)}function Wo(t,r){return+Ye(t)-+Ye(r)}function Ho(t,r,s){const n=Wo(t,r)/pa;return ba()(n)}function px(t,r,s){const n=Wo(t,r)/1e3;return ba()(n)}function fx(t,r){const s=Ye(t,r?.in);return s.setFullYear(s.getFullYear(),0,1),s.setHours(0,0,0,0),s}const gx={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},bx=(t,r,s)=>{let n;const a=gx[t];return typeof a=="string"?n=a:r===1?n=a.one:n=a.other.replace("{{count}}",r.toString()),s?.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function Sn(t){return(r={})=>{const s=r.width?String(r.width):t.defaultWidth;return t.formats[s]||t.formats[t.defaultWidth]}}const yx={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},jx={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},vx={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},wx={date:Sn({formats:yx,defaultWidth:"full"}),time:Sn({formats:jx,defaultWidth:"full"}),dateTime:Sn({formats:vx,defaultWidth:"full"})},Nx={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},kx=(t,r,s,n)=>Nx[t];function Zs(t){return(r,s)=>{const n=s?.context?String(s.context):"standalone";let a;if(n==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,l=s?.width?String(s.width):o;a=t.formattingValues[l]||t.formattingValues[o]}else{const o=t.defaultWidth,l=s?.width?String(s.width):t.defaultWidth;a=t.values[l]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(r):r;return a[i]}}const Cx={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Sx={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Tx={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ex={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ix={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Mx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Dx=(t,r)=>{const s=Number(t),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},Rx={ordinalNumber:Dx,era:Zs({values:Cx,defaultWidth:"wide"}),quarter:Zs({values:Sx,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Zs({values:Tx,defaultWidth:"wide"}),day:Zs({values:Ex,defaultWidth:"wide"}),dayPeriod:Zs({values:Ix,defaultWidth:"wide",formattingValues:Mx,defaultFormattingWidth:"wide"})};function er(t){return(r,s={})=>{const n=s.width,a=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],i=r.match(a);if(!i)return null;const o=i[0],l=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?Px(l,m=>m.test(o)):Lx(l,m=>m.test(o));let u;u=t.valueCallback?t.valueCallback(c):c,u=s.valueCallback?s.valueCallback(u):u;const x=r.slice(o.length);return{value:u,rest:x}}}function Lx(t,r){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&r(t[s]))return s}function Px(t,r){for(let s=0;s<t.length;s++)if(r(t[s]))return s}function Ox(t){return(r,s={})=>{const n=r.match(t.matchPattern);if(!n)return null;const a=n[0],i=r.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=s.valueCallback?s.valueCallback(o):o;const l=r.slice(a.length);return{value:o,rest:l}}}const Ax=/^(\d+)(th|st|nd|rd)?/i,Fx=/\d+/i,zx={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},$x={any:[/^b/i,/^(a|c)/i]},Bx={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},_x={any:[/1/i,/2/i,/3/i,/4/i]},Wx={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Hx={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ux={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Vx={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},qx={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Gx={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Yx={ordinalNumber:Ox({matchPattern:Ax,parsePattern:Fx,valueCallback:t=>parseInt(t,10)}),era:er({matchPatterns:zx,defaultMatchWidth:"wide",parsePatterns:$x,defaultParseWidth:"any"}),quarter:er({matchPatterns:Bx,defaultMatchWidth:"wide",parsePatterns:_x,defaultParseWidth:"any",valueCallback:t=>t+1}),month:er({matchPatterns:Wx,defaultMatchWidth:"wide",parsePatterns:Hx,defaultParseWidth:"any"}),day:er({matchPatterns:Ux,defaultMatchWidth:"wide",parsePatterns:Vx,defaultParseWidth:"any"}),dayPeriod:er({matchPatterns:qx,defaultMatchWidth:"any",parsePatterns:Gx,defaultParseWidth:"any"})},Kx={code:"en-US",formatDistance:bx,formatLong:wx,formatRelative:kx,localize:Rx,match:Yx,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Jx(t,r){const s=Ye(t,r?.in);return dx(s,fx(s))+1}function Xx(t,r){const s=Ye(t,r?.in),n=+_r(s)-+ux(s);return Math.round(n/zo)+1}function Uo(t,r){const s=Ye(t,r?.in),n=s.getFullYear(),a=Zr(),i=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,o=it(r?.in||t,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const l=lr(o,r),c=it(r?.in||t,0);c.setFullYear(n,0,i),c.setHours(0,0,0,0);const u=lr(c,r);return+s>=+l?n+1:+s>=+u?n:n-1}function Qx(t,r){const s=Zr(),n=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,a=Uo(t,r),i=it(r?.in||t,0);return i.setFullYear(a,0,n),i.setHours(0,0,0,0),lr(i,r)}function Zx(t,r){const s=Ye(t,r?.in),n=+lr(s,r)-+Qx(s,r);return Math.round(n/zo)+1}function ve(t,r){const s=t<0?"-":"",n=Math.abs(t).toString().padStart(r,"0");return s+n}const Gt={y(t,r){const s=t.getFullYear(),n=s>0?s:1-s;return ve(r==="yy"?n%100:n,r.length)},M(t,r){const s=t.getMonth();return r==="M"?String(s+1):ve(s+1,2)},d(t,r){return ve(t.getDate(),r.length)},a(t,r){const s=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];default:return s==="am"?"a.m.":"p.m."}},h(t,r){return ve(t.getHours()%12||12,r.length)},H(t,r){return ve(t.getHours(),r.length)},m(t,r){return ve(t.getMinutes(),r.length)},s(t,r){return ve(t.getSeconds(),r.length)},S(t,r){const s=r.length,n=t.getMilliseconds(),a=Math.trunc(n*Math.pow(10,s-3));return ve(a,r.length)}},Cs={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},hi={G:function(t,r,s){const n=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});default:return s.era(n,{width:"wide"})}},y:function(t,r,s){if(r==="yo"){const n=t.getFullYear(),a=n>0?n:1-n;return s.ordinalNumber(a,{unit:"year"})}return Gt.y(t,r)},Y:function(t,r,s,n){const a=Uo(t,n),i=a>0?a:1-a;if(r==="YY"){const o=i%100;return ve(o,2)}return r==="Yo"?s.ordinalNumber(i,{unit:"year"}):ve(i,r.length)},R:function(t,r){const s=$o(t);return ve(s,r.length)},u:function(t,r){const s=t.getFullYear();return ve(s,r.length)},Q:function(t,r,s){const n=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(n);case"QQ":return ve(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,r,s){const n=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(n);case"qq":return ve(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,r,s){const n=t.getMonth();switch(r){case"M":case"MM":return Gt.M(t,r);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(t,r,s){const n=t.getMonth();switch(r){case"L":return String(n+1);case"LL":return ve(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(t,r,s,n){const a=Zx(t,n);return r==="wo"?s.ordinalNumber(a,{unit:"week"}):ve(a,r.length)},I:function(t,r,s){const n=Xx(t);return r==="Io"?s.ordinalNumber(n,{unit:"week"}):ve(n,r.length)},d:function(t,r,s){return r==="do"?s.ordinalNumber(t.getDate(),{unit:"date"}):Gt.d(t,r)},D:function(t,r,s){const n=Jx(t);return r==="Do"?s.ordinalNumber(n,{unit:"dayOfYear"}):ve(n,r.length)},E:function(t,r,s){const n=t.getDay();switch(r){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(t,r,s,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return ve(i,2);case"eo":return s.ordinalNumber(i,{unit:"day"});case"eee":return s.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"});default:return s.day(a,{width:"wide",context:"formatting"})}},c:function(t,r,s,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return ve(i,r.length);case"co":return s.ordinalNumber(i,{unit:"day"});case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"});default:return s.day(a,{width:"wide",context:"standalone"})}},i:function(t,r,s){const n=t.getDay(),a=n===0?7:n;switch(r){case"i":return String(a);case"ii":return ve(a,r.length);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(t,r,s){const a=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,r,s){const n=t.getHours();let a;switch(n===12?a=Cs.noon:n===0?a=Cs.midnight:a=n/12>=1?"pm":"am",r){case"b":case"bb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,r,s){const n=t.getHours();let a;switch(n>=17?a=Cs.evening:n>=12?a=Cs.afternoon:n>=4?a=Cs.morning:a=Cs.night,r){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,r,s){if(r==="ho"){let n=t.getHours()%12;return n===0&&(n=12),s.ordinalNumber(n,{unit:"hour"})}return Gt.h(t,r)},H:function(t,r,s){return r==="Ho"?s.ordinalNumber(t.getHours(),{unit:"hour"}):Gt.H(t,r)},K:function(t,r,s){const n=t.getHours()%12;return r==="Ko"?s.ordinalNumber(n,{unit:"hour"}):ve(n,r.length)},k:function(t,r,s){let n=t.getHours();return n===0&&(n=24),r==="ko"?s.ordinalNumber(n,{unit:"hour"}):ve(n,r.length)},m:function(t,r,s){return r==="mo"?s.ordinalNumber(t.getMinutes(),{unit:"minute"}):Gt.m(t,r)},s:function(t,r,s){return r==="so"?s.ordinalNumber(t.getSeconds(),{unit:"second"}):Gt.s(t,r)},S:function(t,r){return Gt.S(t,r)},X:function(t,r,s){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(r){case"X":return fi(n);case"XXXX":case"XX":return ls(n);default:return ls(n,":")}},x:function(t,r,s){const n=t.getTimezoneOffset();switch(r){case"x":return fi(n);case"xxxx":case"xx":return ls(n);default:return ls(n,":")}},O:function(t,r,s){const n=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+pi(n,":");default:return"GMT"+ls(n,":")}},z:function(t,r,s){const n=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+pi(n,":");default:return"GMT"+ls(n,":")}},t:function(t,r,s){const n=Math.trunc(+t/1e3);return ve(n,r.length)},T:function(t,r,s){return ve(+t,r.length)}};function pi(t,r=""){const s=t>0?"-":"+",n=Math.abs(t),a=Math.trunc(n/60),i=n%60;return i===0?s+String(a):s+String(a)+r+ve(i,2)}function fi(t,r){return t%60===0?(t>0?"-":"+")+ve(Math.abs(t)/60,2):ls(t,r)}function ls(t,r=""){const s=t>0?"-":"+",n=Math.abs(t),a=ve(Math.trunc(n/60),2),i=ve(n%60,2);return s+a+r+i}const gi=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});default:return r.date({width:"full"})}},Vo=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});default:return r.time({width:"full"})}},em=(t,r)=>{const s=t.match(/(P+)(p+)?/)||[],n=s[1],a=s[2];if(!a)return gi(t,r);let i;switch(n){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",gi(n,r)).replace("{{time}}",Vo(a,r))},tm={p:Vo,P:em},sm=/^D+$/,rm=/^Y+$/,nm=["D","DD","YY","YYYY"];function am(t){return sm.test(t)}function im(t){return rm.test(t)}function om(t,r,s){const n=lm(t,r,s);if(console.warn(n),nm.includes(t))throw new RangeError(n)}function lm(t,r,s){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${n} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const cm=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dm=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,um=/^'([^]*?)'?$/,xm=/''/g,mm=/[a-zA-Z]/;function zs(t,r,s){const n=Zr(),a=n.locale??Kx,i=n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=n.weekStartsOn??n.locale?.options?.weekStartsOn??0,l=Ye(t,s?.in);if(!mx(l))throw new RangeError("Invalid time value");let c=r.match(dm).map(x=>{const m=x[0];if(m==="p"||m==="P"){const h=tm[m];return h(x,a.formatLong)}return x}).join("").match(cm).map(x=>{if(x==="''")return{isToken:!1,value:"'"};const m=x[0];if(m==="'")return{isToken:!1,value:hm(x)};if(hi[m])return{isToken:!0,value:x};if(m.match(mm))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");return{isToken:!1,value:x}});a.localize.preprocessor&&(c=a.localize.preprocessor(l,c));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:a};return c.map(x=>{if(!x.isToken)return x.value;const m=x.value;(im(m)||am(m))&&om(m,r,String(t));const h=hi[m[0]];return h(l,m,a.localize,u)}).join("")}function hm(t){const r=t.match(um);return r?r[1].replace(xm,"'"):t}function qo(t,r){return _o(it(t,t),Bo(t))}function pm(t,r,s){return lx(t,-1,s)}function Go(t,r){return _o(it(t,t),pm(Bo(t)))}function Yo(t,r){const s=()=>it(r?.in,NaN),a=ym(t);let i;if(a.date){const u=jm(a.date,2);i=vm(u.restDateString,u.year)}if(!i||isNaN(+i))return s();const o=+i;let l=0,c;if(a.time&&(l=wm(a.time),isNaN(l)))return s();if(a.timezone){if(c=Nm(a.timezone),isNaN(c))return s()}else{const u=new Date(o+l),x=Ye(0,r?.in);return x.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),x.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),x}return Ye(o+l+c,r?.in)}const Tr={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},fm=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,gm=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,bm=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ym(t){const r={},s=t.split(Tr.dateTimeDelimiter);let n;if(s.length>2)return r;if(/:/.test(s[0])?n=s[0]:(r.date=s[0],n=s[1],Tr.timeZoneDelimiter.test(r.date)&&(r.date=t.split(Tr.timeZoneDelimiter)[0],n=t.substr(r.date.length,t.length))),n){const a=Tr.timezone.exec(n);a?(r.time=n.replace(a[1],""),r.timezone=a[1]):r.time=n}return r}function jm(t,r){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),n=t.match(s);if(!n)return{year:NaN,restDateString:""};const a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:t.slice((n[1]||n[2]).length)}}function vm(t,r){if(r===null)return new Date(NaN);const s=t.match(fm);if(!s)return new Date(NaN);const n=!!s[4],a=tr(s[1]),i=tr(s[2])-1,o=tr(s[3]),l=tr(s[4]),c=tr(s[5])-1;if(n)return Em(r,l,c)?km(r,l,c):new Date(NaN);{const u=new Date(0);return!Sm(r,i,o)||!Tm(r,a)?new Date(NaN):(u.setUTCFullYear(r,i,Math.max(a,o)),u)}}function tr(t){return t?parseInt(t):1}function wm(t){const r=t.match(gm);if(!r)return NaN;const s=Tn(r[1]),n=Tn(r[2]),a=Tn(r[3]);return Im(s,n,a)?s*fa+n*pa+a*1e3:NaN}function Tn(t){return t&&parseFloat(t.replace(",","."))||0}function Nm(t){if(t==="Z")return 0;const r=t.match(bm);if(!r)return 0;const s=r[1]==="+"?-1:1,n=parseInt(r[2]),a=r[3]&&parseInt(r[3])||0;return Mm(n,a)?s*(n*fa+a*pa):NaN}function km(t,r,s){const n=new Date(0);n.setUTCFullYear(t,0,4);const a=n.getUTCDay()||7,i=(r-1)*7+s+1-a;return n.setUTCDate(n.getUTCDate()+i),n}const Cm=[31,null,31,30,31,30,31,31,30,31,30,31];function Ko(t){return t%400===0||t%4===0&&t%100!==0}function Sm(t,r,s){return r>=0&&r<=11&&s>=1&&s<=(Cm[r]||(Ko(t)?29:28))}function Tm(t,r){return r>=1&&r<=(Ko(t)?366:365)}function Em(t,r,s){return r>=1&&r<=53&&s>=0&&s<=6}function Im(t,r,s){return t===24?r===0&&s===0:s>=0&&s<60&&r>=0&&r<60&&t>=0&&t<25}function Mm(t,r){return r>=0&&r<=59}function Jo(t){try{const r=typeof t=="string"?Yo(t):new Date(t),s=new Date,n=px(s,r),a=Ho(s,r),i=hx(s,r);return n<5?"刚刚":n<60?`${n} 秒前`:a<60?`${a} 分钟前`:i<24?`${i} 小时前`:qo(r)?`今天 ${zs(r,"HH:mm")}`:Go(r)?`昨天 ${zs(r,"HH:mm")}`:zs(r,"MM-dd HH:mm")}catch{return t}}function ut(t){try{const r=typeof t=="string"?Yo(t):new Date(t);return Ho(new Date,r)<5?Jo(t):qo(r)?zs(r,"HH:mm:ss"):Go(r)?`昨天 ${zs(r,"HH:mm")}`:zs(r,"MM/dd HH:mm")}catch{return t}}function ya(t){if(t==null)return"text-text-muted";const r=t*1e3;return r<100?"text-emerald-400":r<500?"text-yellow-400":"text-red-400"}function ja(t){if(t==null)return"bg-transparent";const r=t*1e3;return r<100?"bg-emerald-400/70":r<500?"bg-yellow-400/70":"bg-red-400/80"}function zt(t,r){let s;if(t instanceof Date&&r instanceof Date)s=r.getTime()-t.getTime();else if(typeof t=="number"){if(t===null)return"-";s=t*1e3}else return"-";if(s<0)return"-";if(s<1)return`${Math.round(s*1e3)}µs`;if(s<1e3)return`${Math.round(s)}ms`;if(s<6e4)return`${(s/1e3).toFixed(1)}s`;if(s<36e5){const i=Math.floor(s/6e4),o=Math.floor(s%6e4/1e3);return`${i}m ${o}s`}const n=Math.floor(s/36e5),a=Math.floor(s%36e5/6e4);return`${n}h ${a}m`}function ea(t){if(!t)return"-";const r=t.trim().toLowerCase();if(!r)return"-";const s={h2:"http/2.0",h3:"http/3.0","http/2":"http/2.0","http/2.0":"http/2.0","http/3":"http/3.0","http/3.0":"http/3.0","http/1.1":"http/1.1","http/1.0":"http/1.0","http/1":"http/1.0"};if(s[r])return s[r];const n=r.match(/^http\/(\d)(?:\.(\d))?$/);if(n){const a=n[1],i=n[2]??"0";return`http/${a}.${i}`}return t}function ps(t){if(t==null||isNaN(t))return"-";if(t===0)return"0 B";if(t<0)return"-";const r=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,n)).toFixed(2))+" "+s[n]}function Dm(t,r=60){try{const s=new URL(t),n=s.pathname+s.search;return n.length>r?n.substring(0,r)+"...":n}catch{return t.length>r?t.substring(0,r)+"...":t}}function en(t){try{return new URL(t).hostname}catch{return t}}function nr(t){return t?t>=100&&t<200?"bg-blue-500/10 text-blue-400 border border-blue-500/20":t>=200&&t<300?"bg-green-500/15 text-green-400 border border-green-500/30":t>=300&&t<400?"bg-blue-500/15 text-blue-400 border border-blue-500/30":t>=400&&t<500?"bg-yellow-500/15 text-yellow-400 border border-yellow-500/30":"bg-red-500/15 text-red-400 border border-red-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}function va(t){return{GET:"bg-method-get/20 text-method-get border border-method-get/30",POST:"bg-method-post/20 text-method-post border border-method-post/30",PUT:"bg-method-put/20 text-method-put border border-method-put/30",DELETE:"bg-method-delete/20 text-method-delete border border-method-delete/30",PATCH:"bg-method-patch/20 text-method-patch border border-method-patch/30"}[t.toUpperCase()]||"bg-gray-500/20 text-gray-400 border border-gray-500/30"}function Ls(t){try{const r=atob(t),s=new Uint8Array(r.length);for(let n=0;n<r.length;n++)s[n]=r.charCodeAt(n);return new TextDecoder("utf-8").decode(s)}catch{return t}}function Rm(t){const r={verbose:{color:"text-level-verbose",bg:"bg-level-verbose/10",border:"border-l-level-verbose"},debug:{color:"text-level-debug",bg:"bg-level-debug/10",border:"border-l-level-debug"},info:{color:"text-level-info",bg:"bg-level-info/10",border:"border-l-level-info"},warning:{color:"text-level-warning",bg:"bg-level-warning/10",border:"border-l-level-warning"},error:{color:"text-level-error",bg:"bg-level-error/10",border:"border-l-level-error"}};return r[t.toLowerCase()]||r.debug}function Lm({deviceId:t,alwaysShow:r=!1,isExpanded:s=!1,onToggleExpand:n}){const{activities:a}=Po(),[i,o]=d.useState(!1),l=d.useMemo(()=>a.filter(x=>x.deviceId===t),[a,t]),u=l[0]?.type==="connected";return r?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>o(!i),className:g("flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",l.length===0?"bg-gray-500/10 text-gray-400 border border-gray-500/20 hover:bg-gray-500/15":u?"bg-status-success-bg text-status-success border border-green-500/20 hover:bg-green-500/15":"bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/15"),children:[e.jsx("span",{className:g("w-2 h-2 rounded-full",l.length===0?"bg-gray-500":u?"bg-green-500":"bg-orange-500")}),e.jsx("span",{children:"连接活动"}),l.length>0&&e.jsxs("span",{className:"text-2xs opacity-60",children:["(",l.length,")"]}),e.jsx("span",{className:"ml-1",children:i?e.jsx(ms,{size:10}):e.jsx(hs,{size:10})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-bg-dark border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"连接活动"}),l.length>0&&e.jsxs("span",{className:"text-2xs text-text-muted",children:[l.length," 条记录"]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.length===0?e.jsx("div",{className:"px-3 py-6 text-center text-xs text-text-muted",children:"暂无连接活动记录"}):l.slice(0,20).map((x,m)=>e.jsx(bi,{activity:x,isFirst:m===0},x.id))})]})]})]}):l.length===0?null:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:n,className:g("flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",u?"bg-status-success-bg text-status-success border border-green-500/20 hover:bg-green-500/15":"bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/15"),children:[e.jsx("span",{className:g("w-2 h-2 rounded-full",u?"bg-green-500":"bg-orange-500")}),e.jsx("span",{children:u?"已连接":"重连中..."}),l.length>1&&e.jsxs("span",{className:"text-2xs opacity-60",children:["(",l.length,")"]}),e.jsx("span",{className:"ml-1",children:s?e.jsx(ms,{size:10}):e.jsx(hs,{size:10})})]}),s&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-bg-dark border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"连接活动"}),e.jsxs("span",{className:"text-2xs text-text-muted",children:[l.length," 条记录"]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.slice(0,20).map((x,m)=>e.jsx(bi,{activity:x,isFirst:m===0},x.id))})]})]})}function bi({activity:t,isFirst:r,compact:s=!1}){const n=t.type==="connected";return s?e.jsxs("div",{className:g("flex items-center gap-2 px-3 py-1.5 border-b border-border-light transition-colors",r&&"bg-bg-light/30"),children:[e.jsx("span",{className:g("w-1.5 h-1.5 rounded-full flex-shrink-0",n?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:g("text-2xs",n?"text-green-400":"text-red-400"),children:n?"已连接":"已断开"}),e.jsx("span",{className:"text-2xs text-text-muted flex-1 text-right",children:ut(t.timestamp)})]}):e.jsxs("div",{className:g("flex items-center gap-3 px-4 py-2.5 border-b border-border-light transition-colors",r&&"bg-bg-light/30"),children:[e.jsx("div",{className:g("w-8 h-8 rounded flex items-center justify-center flex-shrink-0",n?"bg-green-500/15":"bg-red-500/15"),children:n?e.jsx(wt,{size:14}):e.jsx(Ld,{size:14})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:g("text-xs font-medium",n?"text-green-400":"text-red-400"),children:n?"设备已连接":"设备已断开"}),e.jsxs("div",{className:"text-2xs text-text-muted font-mono truncate",children:[ut(t.timestamp),t.sessionId&&e.jsxs("span",{className:"ml-2 opacity-60",children:["#",t.sessionId.slice(0,6)]})]})]})]})}function xt({isOpen:t,onClose:r,onConfirm:s,title:n,message:a,confirmText:i="确认",cancelText:o="取消",type:l="danger",loading:c=!1}){const u=d.useCallback(h=>{h.key==="Escape"&&!c&&r()},[r,c]);if(d.useEffect(()=>{if(t)return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[t,u]),!t)return null;const m={danger:{icon:e.jsx(jt,{size:20}),iconBg:"bg-red-500/20",headerBg:"bg-red-500/5",titleColor:"text-red-400",confirmBg:"bg-red-500 hover:bg-red-600"},warning:{icon:e.jsx(ua,{size:20}),iconBg:"bg-yellow-500/20",headerBg:"bg-yellow-500/5",titleColor:"text-yellow-400",confirmBg:"bg-yellow-500 hover:bg-yellow-600"},info:{icon:e.jsx(No,{size:20}),iconBg:"bg-blue-500/20",headerBg:"bg-blue-500/5",titleColor:"text-blue-400",confirmBg:"bg-blue-500 hover:bg-blue-600"}}[l];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-2xl shadow-2xl w-[400px] overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:g("px-6 py-4 border-b border-border",m.headerBg),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("w-10 h-10 rounded-xl flex items-center justify-center",m.iconBg),children:e.jsx("span",{className:"text-xl",children:m.icon})}),e.jsx("h3",{className:g("text-lg font-bold",m.titleColor),children:n})]})}),e.jsx("div",{className:"px-6 py-5",children:e.jsx("p",{className:"text-text-secondary whitespace-pre-line",children:a})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border bg-bg-medium/30 flex justify-end gap-3",children:[e.jsx("button",{onClick:r,disabled:c,className:"px-4 py-2 rounded-lg text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-bg-light transition-all disabled:opacity-50",children:o}),e.jsx("button",{onClick:s,disabled:c,className:g("px-4 py-2 rounded-lg text-sm font-medium text-white transition-all disabled:opacity-50",m.confirmBg),children:c?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"处理中..."]}):i})]})]})})}function Pm({className:t}){const[r,s]=d.useState(!1),[,n]=d.useState({}),a=Pe(m=>m.pluginStates),i=Pe(m=>m.currentDeviceId);d.useEffect(()=>he.subscribe(()=>n({})),[]);const o=d.useMemo(()=>{const m=he.getAll().map(f=>({pluginId:f.metadata.pluginId,displayName:f.metadata.displayName,description:f.metadata.description,icon:f.metadata.icon,dependencies:f.metadata.dependencies||[],isEnabled:he.isPluginEnabled(f.metadata.pluginId),isSubPlugin:f.metadata.isSubPlugin||!1,parentPluginId:f.metadata.parentPluginId,sdkEnabled:a[f.metadata.pluginId]??!0})),h=m.filter(f=>!f.isSubPlugin),y=m.filter(f=>f.isSubPlugin),p=[];for(const f of h){p.push(f);const w=y.filter(N=>N.parentPluginId===f.pluginId).sort((N,E)=>{const S={mock:0,breakpoint:1,chaos:2};return(S[N.pluginId]??99)-(S[E.pluginId]??99)});p.push(...w)}return p},[a]),l=d.useCallback((m,h)=>{if(h){const y=he.getRequiredDependencies(m);if(y.length>0){const p=y.map(f=>he.getPlugin(f)?.metadata.displayName||f).join("、");De.success(`已同时启用依赖插件：${p}`,{duration:3e3})}}else{const y=he.getDependentPlugins(m);if(y.length>0){const p=y.map(f=>he.getPlugin(f)?.metadata.displayName||f).join("、");De.success(`已同时禁用依赖插件：${p}`,{duration:3e3})}}he.setPluginEnabled(m,h)},[]),c=d.useCallback(()=>{for(const m of o)he.setPluginEnabled(m.pluginId,!0)},[o]),u=d.useCallback(()=>{const m=["http","log","database"];for(const h of o)m.includes(h.pluginId)||he.setPluginEnabled(h.pluginId,!1)},[o]),x=o.filter(m=>he.isPluginEnabled(m.pluginId)).length;return e.jsxs("div",{className:g("relative",t),children:[e.jsxs("button",{onClick:()=>s(!r),className:"btn btn-ghost p-1.5 rounded flex items-center gap-1 text-text-secondary hover:text-text-primary",title:"插件管理",children:[e.jsx(So,{size:14}),e.jsx("span",{className:"text-xs hidden sm:inline",children:"插件"}),e.jsxs("span",{className:"text-xs px-1 py-0 bg-bg-light rounded-full",children:[x,"/",o.length]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>s(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-bg-dark border border-border rounded-lg shadow-lg z-50",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(da,{size:16,className:"text-text-muted"}),e.jsx("span",{className:"font-medium text-text-primary",children:"插件管理"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,className:"text-xs text-primary hover:underline",children:"全部启用"}),e.jsx("span",{className:"text-text-muted",children:"|"}),e.jsx("button",{onClick:u,className:"text-xs text-text-muted hover:text-text-secondary",children:"仅保留常用"})]})]}),e.jsx("div",{className:"max-h-[400px] overflow-auto",children:o.map(m=>{const h=he.isPluginEnabled(m.pluginId),y=["http","log","database"].includes(m.pluginId),p=i&&m.sdkEnabled===!1,f=m.dependencies.map(N=>he.getPlugin(N)?.metadata.displayName||N),w=m.parentPluginId?he.getPlugin(m.parentPluginId)?.metadata.displayName||m.parentPluginId:null;return e.jsxs("div",{className:g("px-4 py-3 flex items-center gap-3 hover:bg-bg-light/50 transition-colors",!h&&"opacity-60",m.isSubPlugin&&"pl-8"),children:[e.jsx("div",{className:g("w-8 h-8 rounded-lg flex items-center justify-center",h?"bg-primary/10 text-primary":"bg-bg-medium text-text-muted"),children:m.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g("font-medium",h?"text-text-primary":"text-text-muted"),children:m.displayName}),y&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-500/10 text-blue-400 rounded",children:"常用"}),m.isSubPlugin&&w&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-purple-500/10 text-purple-400 rounded",children:[w," 子功能"]}),p&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-orange-500/10 text-orange-400 rounded",children:"SDK 已禁用"})]}),e.jsx("div",{className:"text-xs text-text-muted truncate",children:m.description}),!m.isSubPlugin&&f.length>0&&e.jsxs("div",{className:"text-xs text-yellow-500/80 mt-0.5",children:["依赖: ",f.join("、")]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:N=>l(m.pluginId,N.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-bg-medium rounded-full peer peer-checked:bg-primary peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"})]})]},m.pluginId)})}),e.jsx("div",{className:"px-4 py-2 border-t border-border bg-bg-medium/50",children:e.jsx("p",{className:"text-xs text-text-muted",children:"💡 禁用的插件不会在标签栏显示，重新启用后生效"})})]})]})]})}function bs({isLoading:t,text:r="刷新中..."}){return t?e.jsx("div",{className:g("absolute inset-0 z-50 flex items-center justify-center","bg-bg-dark/60 backdrop-blur-sm","animate-fadeIn"),children:e.jsxs("div",{className:"flex items-center gap-3 px-5 py-3 rounded-lg bg-bg-dark/90 border border-border shadow-lg",children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("div",{className:"absolute inset-0 border-2 border-primary/30 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-2 border-transparent border-t-primary rounded-full animate-spin"})]}),e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:r})]})}):null}async function rt(t){if(navigator.clipboard?.writeText)try{return await navigator.clipboard.writeText(t),!0}catch(r){console.warn("Clipboard API failed, falling back to execCommand:",r)}try{const r=document.createElement("textarea");r.value=t,r.style.position="fixed",r.style.left="-9999px",r.style.top="-9999px",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select();const s=document.execCommand("copy");if(document.body.removeChild(r),s)return!0}catch(r){console.error("execCommand fallback failed:",r)}return console.error("Unable to copy to clipboard"),!1}function Xo({deviceId:t,children:r}){const[s,n]=d.useState(!1),[a,i]=d.useState(!1),o=d.useRef(null),l=d.useRef(null);d.useEffect(()=>{const y=f=>{o.current&&!o.current.contains(f.target)&&l.current&&!l.current.contains(f.target)&&n(!1)},p=f=>{f.key==="Escape"&&n(!1)};return s&&(document.addEventListener("mousedown",y),document.addEventListener("keydown",p)),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("keydown",p)}},[s]),d.useEffect(()=>{s||i(!1)},[s]);const c=y=>{y.stopPropagation(),n(!s)},u=async y=>{y.stopPropagation();try{await rt(t),i(!0),De.success("设备 ID 已复制"),setTimeout(()=>i(!1),1500)}catch{De.error("复制失败")}},[x,m]=d.useState({top:0,left:0});d.useLayoutEffect(()=>{if(s&&l.current){const y=l.current.getBoundingClientRect(),p=window.innerWidth,f=window.innerHeight;let w=y.bottom+4,N=y.left;w+80>f&&(w=y.top-80-4),N+280>p&&(N=p-280-8),m({top:w,left:N})}},[s]);const h=s?ur.createPortal(e.jsx("div",{ref:o,style:{position:"fixed",top:x.top,left:x.left},className:"z-[300] min-w-[200px] max-w-[320px]",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-lg shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-border bg-bg-medium/50",children:e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:"设备 ID"})}),e.jsx("div",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 text-xs font-mono text-text-primary bg-bg-light px-2 py-1.5 rounded select-all break-all",children:t}),e.jsx("button",{onClick:u,className:g("p-1.5 rounded transition-colors flex-shrink-0",a?"bg-green-500/20 text-green-400":"bg-bg-light hover:bg-primary/20 text-text-muted hover:text-primary"),title:a?"已复制":"复制",children:a?e.jsx(Re,{size:14}):e.jsx(jo,{size:14})})]})})]})}),document.body):null;return e.jsxs(e.Fragment,{children:[e.jsx("span",{ref:l,onClick:c,className:"cursor-pointer",children:r}),h]})}function Om(t){const r=d.useCallback(s=>{const n=s.target,a=n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable;for(const i of t){const o=s.key.toLowerCase()===i.key.toLowerCase(),l=i.shift?s.shiftKey:!s.shiftKey,c=i.alt?s.altKey:!s.altKey,u=i.ctrl?s.ctrlKey||s.metaKey:!s.ctrlKey&&!s.metaKey;if(o&&u&&l&&c){if(a&&!i.allowInInput)continue;s.preventDefault(),i.action();return}}},[t]);d.useEffect(()=>(window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)),[r])}function Am(){const{deviceId:t}=zl(),r=Ur(),[s,n]=xr(),a=d.useCallback(()=>{const se=s.get("plugin");if(se&&he.isPluginEnabled(se))return se;const de=Br();return de.length>0?de[0].pluginId:""},[s]),[i,o]=d.useState(a),{devices:l,currentDevice:c,selectDevice:u,clearSelection:x,clearDeviceData:m,toggleFavorite:h,isFavorite:y,refreshDevice:p,updatePluginStates:f,error:w,fetchDevices:N}=Pe(),{setConnected:E,setInDeviceDetail:S}=bt(),j=Jr(se=>se.toggleTheme),{addActivity:k,clearActivities:R,loadDeviceActivities:D}=Po(),F=Ze(),P=Ft(),U=fs(),K=Us(),G=Zt(),q=Ws(),[C,b]=d.useState(!1),[M,T]=d.useState(!1),[B,A]=d.useState(!1),[I,O]=d.useState(!1),[z,H]=d.useState({});d.useEffect(()=>he.subscribe(()=>H({})),[]);const le=d.useMemo(()=>["mock","breakpoint","chaos"].some(de=>he.isPluginEnabled(de)),[z]),Y=d.useCallback(async()=>{O(!0);try{const se=await p();se.success?De.success("刷新成功"):se.error?.includes("not found")||se.error?.includes("offline")?De.error("设备已离线，无法获取最新信息"):De.error(se.error||"刷新失败")}finally{O(!1)}},[p]),V=d.useCallback(se=>{o(se);const de=new URLSearchParams(s);de.set("plugin",se),n(de,{replace:!0})},[s,n]);d.useEffect(()=>{const se=s.get("plugin");if(i&&(!se||se!==i)){const de=new URLSearchParams(s);de.set("plugin",i),n(de,{replace:!0})}},[]),d.useEffect(()=>he.subscribe(()=>{if(!he.isPluginEnabled(i)){const se=Br();se.length>0?V(se[0].pluginId):o("")}}),[i,V]),Om([{key:"r",ctrl:!0,description:"刷新",action:()=>{t&&(i==="http"?F.fetchEvents(t):i==="logs"?P.fetchEvents(t):i==="websocket"&&U.fetchSessions(t))}},{key:"l",ctrl:!0,description:"清屏",action:()=>{i==="http"?F.clearEvents():i==="logs"?P.clearEvents():i==="performance"&&q.clearData()}},{key:"t",ctrl:!0,description:"切换主题",action:j},{key:"/",ctrl:!0,description:"显示快捷键帮助",action:()=>b(!0)},{key:"Escape",description:"取消选择/关闭对话框",action:()=>{C?b(!1):K.isEditorOpen?K.closeEditor():F.isSelectMode?F.toggleSelectMode():F.clearSelection()}},{key:"a",ctrl:!0,description:"全选",action:()=>{i==="http"&&F.isSelectMode&&F.selectAll()}}]),d.useEffect(()=>{if(!t)return;S(!0),(async()=>{try{const me=(await ao(t,1))[0]?.connectedAt??new Date().toISOString();F.setSessionStartTimestamp(me),P.setSessionStartTimestamp(me)}catch{const ae=new Date().toISOString();F.setSessionStartTimestamp(ae),P.setSessionStartTimestamp(ae)}})(),u(t),D(t);const de=(ae,ee)=>{const me=Ze.getState();me.currentAppSessionId!==ae&&(F.setCurrentAppSessionId(ae),me.showCurrentSessionOnly&&F.setSessionStartTimestamp(ee));const Ce=Ft.getState();Ce.currentAppSessionId!==ae&&(P.setCurrentAppSessionId(ae),Ce.showCurrentSessionOnly&&P.setSessionStartTimestamp(ee))};os.connect(t);const _=os.onMessage(ae=>{if(ae.deviceId===t)switch(ae.type){case"httpEvent":F.addRealtimeEvent(ex(ae.payload));break;case"logEvent":P.addRealtimeEvent(tx(ae.payload));break;case"performanceEvent":{const ee=JSON.parse(ae.payload);q.handleRealtimeEvent(ee,t);break}case"deviceConnected":{const ee=JSON.parse(ae.payload),me=new Date().toISOString();k({id:`${ee.sessionId}-connected`,deviceId:t,sessionId:ee.sessionId,timestamp:me,type:"connected",deviceName:ee.deviceName});const Ce=ee.appSessionId??ee.sessionId;de(Ce,me),ee.pluginStates&&f(ee.pluginStates);break}case"deviceReconnected":{const ee=JSON.parse(ae.payload),me=new Date().toISOString();k({id:`${ee.sessionId}-reconnected`,deviceId:t,sessionId:ee.sessionId,timestamp:me,type:"connected",deviceName:ee.deviceName});const Ce=ee.appSessionId??ee.sessionId;de(Ce,me);break}case"deviceDisconnected":{k({id:`${Date.now()}-disconnected`,deviceId:t,sessionId:"",timestamp:new Date().toISOString(),type:"disconnected"});break}case"breakpointHit":{const ee=JSON.parse(ae.payload);G.addHit(ee);break}case"pluginStateChange":{const ee=JSON.parse(ae.payload),me=Pe.getState().pluginStates;f({...me,[ee.pluginId]:ee.isEnabled});break}}}),ue=os.onConnection(E);return()=>{_(),ue(),os.disconnect(),x(),F.clearEvents(),P.clearEvents(),U.clearSessions(),K.clearRules(),G.clear(),q.clearData(),R(),S(!1)}},[t]),d.useEffect(()=>{if(!t||!c?.deviceInfo?.appSessionId)return;const se=c.deviceInfo.appSessionId;F.currentAppSessionId!==se&&F.setCurrentAppSessionId(se),P.currentAppSessionId!==se&&P.setCurrentAppSessionId(se)},[t,c?.deviceInfo?.appSessionId]),d.useEffect(()=>{!w||!t||!(w.includes("404")||w.toLowerCase().includes("not found"))||l.some(_=>_.deviceId===t)||(De.error("设备不存在，已返回设备列表"),x(),N(),r("/"))},[w,t,l,x,N,r]),d.useEffect(()=>{const se=s.get("plugin");if(se&&se!==i){if(he.isPluginEnabled(se))o(se);else if(i){const de=new URLSearchParams(s);de.set("plugin",i),n(de,{replace:!0})}}},[s,i,n]);const ie=d.useCallback(()=>{r("/")},[r]),Ne=d.useCallback(async()=>{t&&(os.pauseReconnect(),await m(),F.clearEvents(),P.clearEvents(),U.clearSessions(),K.clearRules(),G.clear(),q.clearData(),T(!1),os.resumeReconnect())},[m,t]);return t?e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsx(bs,{isLoading:I,text:"刷新设备信息..."}),e.jsx("header",{className:"px-4 py-1.5 bg-bg-dark border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ie,className:"flex items-center gap-1 text-text-secondary hover:text-text-primary transition-colors group px-1.5 py-1 rounded hover:bg-bg-light",children:[e.jsx("span",{className:"group-hover:-translate-x-0.5 transition-transform",children:e.jsx(vo,{size:14})}),e.jsx("span",{className:"text-xs font-medium",children:"返回"})]}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-primary/10 flex items-center justify-center border border-border flex-shrink-0",children:c?ma(c.deviceInfo.platform,14,void 0,c.deviceInfo.isSimulator):e.jsx(wt,{size:14})}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("div",{className:"min-w-0",children:c?.deviceInfo.deviceAlias?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-sm font-semibold text-text-primary truncate",children:c.deviceInfo.deviceAlias}),e.jsx("p",{className:"text-xs text-text-muted truncate",children:c.deviceInfo.deviceName})]}):e.jsx("h1",{className:"text-sm font-semibold text-text-primary truncate",children:c?.deviceInfo.deviceName||"加载中..."})}),t&&e.jsx(Xo,{deviceId:t,children:e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded bg-bg-light text-text-muted font-mono flex-shrink-0 hover:bg-primary/20 hover:text-primary transition-colors",children:["#",t.slice(-4).toUpperCase()]})}),c?.deviceInfo.isSimulator&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-400 border border-yellow-500/30 flex-shrink-0",children:"模拟器"}),t&&e.jsx("button",{onClick:()=>h(t),className:g("p-0.5 rounded transition-colors flex-shrink-0",y(t)?"text-yellow-400 hover:text-yellow-300":"text-text-muted hover:text-yellow-400"),title:y(t)?"取消收藏":"收藏设备",children:e.jsx(Hs,{size:14,filled:y(t)})}),c&&e.jsxs("span",{className:g("text-xs px-2 py-0.5 rounded flex items-center gap-1.5 flex-shrink-0",c.isOnline?"bg-status-success-bg text-status-success border border-green-500/30":"bg-red-500/10 text-red-400 border border-red-500/30"),children:[e.jsx("span",{className:g("w-2 h-2 rounded-full border",c.isOnline?"bg-green-400 border-green-300/50 status-dot-online":"bg-red-400 border-red-300/50")}),c.isOnline?"在线":"离线"]}),c&&e.jsxs("span",{className:"text-xs text-text-muted hidden xl:block truncate",children:[c.deviceInfo.deviceModel," · ",c.deviceInfo.platform," ",c.deviceInfo.systemVersion," · ",c.deviceInfo.appName]}),e.jsx("button",{onClick:Y,disabled:I,className:"btn btn-primary !px-1.5 !py-0.5 !text-2xs disabled:opacity-50",title:"刷新设备信息",children:I?"刷新中...":"刷新"})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:()=>Fo.getState().open(),className:"btn btn-ghost p-1.5 rounded",title:"全局搜索 (⌘K)",children:e.jsx(St,{size:14})}),e.jsx(Pm,{}),e.jsx("button",{onClick:()=>b(!0),className:"btn btn-ghost p-1.5 rounded",title:"快捷键 (Ctrl+/)",children:e.jsx(Sd,{size:14})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>A(!B),className:"btn btn-ghost p-1.5 rounded",title:"更多操作",children:e.jsx(Td,{size:14})}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>A(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-bg-dark border border-border rounded-lg shadow-lg z-50 overflow-hidden",children:e.jsxs("button",{onClick:()=>{A(!1),T(!0)},className:"w-full px-3 py-2.5 text-left text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 transition-colors",children:[e.jsx(pr,{size:14}),e.jsx("span",{children:"清空设备数据"})]})})]})]})]})]})}),e.jsxs("div",{className:g("px-4 py-1.5 bg-bg-dark flex items-center justify-between gap-4",(i!=="http"||!le)&&"border-b border-border"),children:[e.jsx(nx,{activePluginId:i,onTabChange:V}),t&&e.jsx(Lm,{deviceId:t,alwaysShow:!0})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(rx,{deviceId:t,activePluginId:i,className:"h-full"})}),e.jsx(ix,{isOpen:C,onClose:()=>b(!1)}),e.jsx(xt,{isOpen:M,onClose:()=>T(!1),onConfirm:Ne,title:"清空设备数据",message:`确定要清空 "${c?.deviceInfo.deviceName||"该设备"}" 的所有数据吗？

这将删除：
• 所有 HTTP 请求记录
• 所有日志事件
• 所有 WebSocket 会话
• 所有性能监控数据

此操作不可恢复。`,confirmText:"确认清空",cancelText:"取消",type:"danger"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-tertiary",children:"未指定设备 ID"})}function Fm(){return e.jsx(Jt.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full text-text-tertiary",children:"加载中..."}),children:e.jsx(Am,{})})}function zm({device:t,style:r,isSelectMode:s,isSelected:n,onToggleSelect:a}){const i=Ur(),{favoriteDeviceIds:o,toggleFavorite:l}=Pe(),c=o.has(t.deviceId),u=!t.isOnline,x=!!t.deviceAlias,m=y=>{y.stopPropagation(),l(t.deviceId)},h=()=>{s?u&&a?.():i(`/device/${t.deviceId}`)};return e.jsx("div",{onClick:h,className:g("p-2.5 cursor-pointer transition-all group animate-fadeIn rounded-xl border",t.isOnline?"device-card-online":"glass-card opacity-60 hover:opacity-80",s&&u&&"cursor-pointer",s&&!u&&"cursor-not-allowed opacity-40",n&&"ring-2 ring-primary border-primary"),style:r,children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[s&&e.jsx("div",{className:g("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 mt-2.5",n?"bg-primary border-primary":"border-border",!u&&"opacity-30"),children:n&&e.jsx(Re,{size:12,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col items-center flex-shrink-0 gap-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:g("w-10 h-10 rounded-lg flex items-center justify-center border",t.isOnline?"bg-white/20 dark:bg-black/20 border-white/30 dark:border-white/10":"bg-bg-medium/50 border-border"),children:ma(t.platform,24,void 0,t.isSimulator)}),e.jsx("span",{className:g("absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 border rounded-full",t.isOnline?"bg-green-500 border-green-400/50 status-dot-online":"bg-gray-500 border-bg-dark")})]}),t.isSimulator&&e.jsx("span",{className:g("text-2xs px-1 py-0.5 rounded whitespace-nowrap",t.isOnline?"bg-white/20 dark:bg-black/20 text-yellow-700 dark:text-yellow-300":"bg-yellow-500/20 text-yellow-400"),children:"模拟器"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"min-h-[36px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:g("font-medium text-sm transition-colors truncate",t.isOnline?"text-gray-900 dark:text-white group-hover:text-primary-dark dark:group-hover:text-primary-light":"text-text-primary group-hover:text-primary"),children:x?t.deviceAlias:t.deviceName}),e.jsx(Xo,{deviceId:t.deviceId,children:e.jsxs("span",{className:g("text-2xs px-1 py-0.5 rounded font-mono flex-shrink-0 transition-colors",t.isOnline?"bg-white/30 dark:bg-black/30 text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-black/50":"bg-bg-light text-text-muted hover:bg-primary/20 hover:text-primary"),children:["#",t.deviceId.slice(-4).toUpperCase()]})}),u&&e.jsx("span",{className:"text-2xs px-1 py-0.5 rounded bg-gray-500/20 text-gray-400 flex-shrink-0",children:"离线"})]}),x&&e.jsx("p",{className:g("text-xs truncate mt-0.5",t.isOnline?"text-gray-700 dark:text-gray-300":"text-text-muted"),title:t.deviceName,children:t.deviceName})]}),e.jsxs("p",{className:g("text-xs truncate mt-0.5",t.isOnline?"text-gray-600 dark:text-gray-400":"text-text-muted"),children:[t.deviceModel," · ",t.platform," ",t.systemVersion]}),e.jsxs("div",{className:g("flex items-center gap-1.5 mt-1.5 pt-1.5 border-t",t.isOnline?"border-white/20 dark:border-white/10":"border-border"),children:[e.jsx("div",{className:g("w-4 h-4 rounded overflow-hidden flex items-center justify-center flex-shrink-0",t.isOnline?"bg-white/30 dark:bg-black/30":"bg-bg-light"),title:t.appName,children:t.appIcon?e.jsx("img",{src:`data:image/png;base64,${t.appIcon}`,alt:t.appName,className:"w-full h-full object-cover"}):e.jsx(Bt,{size:10,className:t.isOnline?"text-gray-600 dark:text-gray-400":"text-text-muted"})}),e.jsx("span",{className:g("text-xs truncate",t.isOnline?"text-gray-700 dark:text-gray-300":"text-text-secondary"),title:`${t.appName} ${t.appVersion}`,children:t.appName}),e.jsx("span",{className:g("text-xs truncate flex-shrink-0",t.isOnline?"text-gray-500 dark:text-gray-500":"text-text-muted/60"),children:t.appVersion}),e.jsx("span",{className:"flex-1"}),e.jsx("span",{className:g("text-2xs flex-shrink-0",t.isOnline?"text-gray-500 dark:text-gray-500":"text-text-muted/50"),children:Jo(t.lastSeenAt)})]})]}),!s&&e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("button",{onClick:m,className:g("p-1 rounded transition-all flex-shrink-0",c?"text-yellow-500 dark:text-yellow-400 hover:text-yellow-400 dark:hover:text-yellow-300":t.isOnline?"text-gray-500 dark:text-gray-400 opacity-0 group-hover:opacity-100 hover:text-yellow-500 dark:hover:text-yellow-400":"text-text-muted opacity-0 group-hover:opacity-100 hover:text-yellow-400"),title:c?"取消收藏":"收藏设备",children:e.jsx(Hs,{size:14,filled:c})})})]})})}function $m(){const{devices:t,isLoading:r,fetchDevices:s,isSelectMode:n,selectedIds:a,toggleSelectMode:i,toggleSelectId:o,selectAllOffline:l,batchRemoveSelected:c,favoriteDeviceIds:u}=Pe(),{isServerOnline:x}=bt(),[m,h]=d.useState("all"),[y,p]=d.useState(!1),[f,w]=d.useState(!1),N=t.filter(F=>F.isOnline).length,E=t.filter(F=>!F.isOnline).length,S=t.filter(F=>u.has(F.deviceId)).length,j=t.filter(F=>!F.isOnline).map(F=>F.deviceId),k=j.length>0&&j.every(F=>a.has(F)),R=d.useMemo(()=>m==="favorites"?t.filter(F=>u.has(F.deviceId)):t,[t,m,u]);d.useEffect(()=>{s()},[s]);const D=async()=>{w(!0);try{await c(),p(!1)}catch{}finally{w(!1)}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("header",{className:"px-6 py-5 bg-bg-dark border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"设备列表"}),e.jsxs("p",{className:"text-sm text-text-muted mt-1",children:["管理已连接的调试设备 · ",N," 在线 / ",t.length," 总计"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x&&e.jsxs("div",{className:"flex items-center gap-0.5 p-0.5 bg-bg-medium rounded-lg border border-border",children:[e.jsxs("button",{onClick:()=>h("all"),className:g("px-3 py-1.5 text-xs font-medium rounded transition-colors",m==="all"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:["全部 (",t.length,")"]}),e.jsxs("button",{onClick:()=>h("favorites"),className:g("px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1",m==="favorites"?"bg-yellow-500 text-bg-darkest":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:[e.jsx(Hs,{size:12,filled:m==="favorites"}),"仅收藏 (",S,")"]})]}),x&&n?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:l,disabled:E===0,className:g("btn btn-secondary flex items-center gap-2",E===0&&"opacity-50 cursor-not-allowed"),children:[e.jsx(Re,{size:16}),e.jsx("span",{children:k?"取消全选":"全选离线"})]}),e.jsxs("button",{onClick:()=>p(!0),disabled:a.size===0,className:g("btn btn-secondary text-red-400 hover:text-red-300 flex items-center gap-2",a.size===0&&"opacity-50 cursor-not-allowed"),children:[e.jsx(pr,{size:16}),e.jsxs("span",{children:["移除选中 (",a.size,")"]})]}),e.jsx("button",{onClick:i,className:"btn btn-secondary",children:"取消"})]}):x&&E>0?e.jsxs("button",{onClick:i,className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(Re,{size:16}),e.jsx("span",{children:"批量选择"})]}):null,e.jsx("button",{onClick:s,disabled:r,className:"btn btn-primary disabled:opacity-50",children:"刷新"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 relative",children:[R.length>0&&x&&e.jsx(bs,{isLoading:r,text:"刷新设备列表..."}),x?R.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:R.map((F,P)=>e.jsx(zm,{device:F,style:{animationDelay:`${P*50}ms`},isSelectMode:n,isSelected:a.has(F.deviceId),onToggleSelect:()=>o(F.deviceId)},F.deviceId))}):e.jsx(Bm,{isLoading:r,filter:m,totalCount:t.length}):e.jsx(_m,{onRetry:s,isLoading:r})]}),e.jsx(xt,{isOpen:y,onClose:()=>p(!1),onConfirm:D,title:"移除设备",message:`确定要移除选中的 ${a.size} 个离线设备吗？

此操作将从列表中移除这些设备，但不会删除它们的历史数据。`,confirmText:"确认移除",cancelText:"取消",type:"danger",loading:f})]})}function Bm({isLoading:t,filter:r,totalCount:s}){return s>0&&!t?e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"glass-card p-12 text-center max-w-md",children:[e.jsx(wt,{size:48,className:"mx-auto mb-4 text-text-muted opacity-50"}),e.jsxs("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:["没有",r==="favorites"?"收藏的":"","设备"]}),e.jsx("p",{className:"text-text-muted",children:r==="favorites"?"点击设备卡片上的星标收藏设备":"当前没有可显示的设备"})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("div",{className:"glass-card p-12 text-center max-w-md",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-bg-light animate-pulse"}),e.jsx("div",{className:"h-6 bg-bg-light rounded w-48 mx-auto mb-3 animate-pulse"}),e.jsx("div",{className:"h-4 bg-bg-light rounded w-64 mx-auto animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-bg-light flex items-center justify-center text-text-muted",children:e.jsx(wt,{size:40})}),e.jsx("h2",{className:"text-lg font-semibold text-text-primary mb-2",children:"暂无在线设备"}),e.jsx("p",{className:"text-sm text-text-muted mb-6",children:"请确保 App 已集成 DebugProbe 并连接到 Debug Platform"}),e.jsxs("div",{className:"text-left bg-bg-medium rounded-xl p-4 text-xs font-mono text-text-secondary overflow-x-auto",children:[e.jsx("p",{className:"text-text-muted mb-2",children:"// 在 AppDelegate 中初始化"}),e.jsxs("p",{children:[e.jsx("span",{className:"text-purple-400",children:"let"})," settings = ",e.jsx("span",{className:"text-primary",children:"DebugProbeSettings"}),".shared"]}),e.jsxs("p",{children:["settings.hubHost = ",e.jsxs("span",{className:"text-green-400",children:['"',"<","host",">",'"']})]}),e.jsxs("p",{children:["settings.hubPort = ",e.jsxs("span",{className:"text-green-400",children:["<","port",">"]})]}),e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"text-primary",children:"DebugProbe"}),".shared.start()"]})]})]})})})}function _m({onRetry:t,isLoading:r}){return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute top-1/3 left-1/3 w-[500px] h-[500px] bg-red-500/3 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/3 right-1/3 w-[400px] h-[400px] bg-yellow-500/3 rounded-full blur-[100px] animate-pulse",style:{animationDelay:"1s"}})]}),e.jsx("div",{className:"max-w-md w-full relative",children:e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsxs("div",{className:"w-20 h-20 mx-auto mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500/10 animate-ping",style:{animationDuration:"2s"}}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-red-500/20 animate-ping",style:{animationDuration:"2s",animationDelay:"0.3s"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-gradient-to-br from-red-500/20 to-red-600/10 border border-red-500/30",children:e.jsx(wo,{size:40,className:"text-red-400"})})]}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-text-primary",children:"服务未启动"}),e.jsx("p",{className:"text-sm text-text-muted mb-6",children:"无法连接到 Debug Platform 服务"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-red-500/10 border border-red-500/20 mb-6",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-red-400",children:"OFFLINE"})]}),e.jsxs("div",{className:"text-xs text-text-muted mb-6 p-3 bg-bg-medium/30 rounded-lg border border-border",children:[e.jsx("span",{className:"text-yellow-400/80",children:"💡"}),e.jsx("span",{className:"ml-2",children:"请确保 Debug Platform 服务已启动并运行在正确的端口上"})]}),e.jsx("button",{onClick:t,disabled:r,className:"btn btn-primary w-full flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"连接中..."})]}):e.jsx("span",{children:"重试连接"})})]})})]})}const Wm=[{icon:e.jsx(wt,{size:20}),title:"设备管理",endpoints:[{method:"GET",path:"/api/devices",description:"获取在线设备列表"},{method:"GET",path:"/api/devices/:deviceId",description:"获取设备详情"},{method:"PUT",path:"/api/devices/:deviceId/nickname",description:"更新设备备注名"},{method:"DELETE",path:"/api/devices/:deviceId/data",description:"清空设备数据"}]},{icon:e.jsx(Bs,{size:20}),title:"Network 插件 - HTTP 事件",endpoints:[{method:"GET",path:"/api/devices/:deviceId/http-events",description:"获取 HTTP 事件列表（支持分页和过滤）"},{method:"GET",path:"/api/devices/:deviceId/http-events/:eventId",description:"获取 HTTP 事件详情"},{method:"DELETE",path:"/api/devices/:deviceId/http-events/:eventId",description:"删除单条 HTTP 事件"},{method:"POST",path:"/api/devices/:deviceId/http-events/batch-delete",description:"批量删除 HTTP 事件"},{method:"DELETE",path:"/api/devices/:deviceId/http-events",description:"删除全部 HTTP 事件"},{method:"POST",path:"/api/devices/:deviceId/http-events/:eventId/replay",description:"重放 HTTP 请求"},{method:"PUT",path:"/api/devices/:deviceId/http-events/:eventId/favorite",description:"收藏/取消收藏"},{method:"GET",path:"/api/devices/:deviceId/http-events/:eventId/curl",description:"导出 cURL 命令"}]},{icon:e.jsx(_s,{size:20}),title:"Network 插件 - WebSocket 会话",endpoints:[{method:"GET",path:"/api/devices/:deviceId/ws-sessions",description:"获取 WebSocket 会话列表"},{method:"GET",path:"/api/devices/:deviceId/ws-sessions/:sessionId/frames",description:"获取 WebSocket 帧数据"},{method:"DELETE",path:"/api/devices/:deviceId/ws-sessions/:sessionId",description:"删除单条 WebSocket 会话"},{method:"POST",path:"/api/devices/:deviceId/ws-sessions/batch-delete",description:"批量删除 WebSocket 会话"},{method:"DELETE",path:"/api/devices/:deviceId/ws-sessions",description:"删除全部 WebSocket 会话"}]},{icon:e.jsx(es,{size:20}),title:"Log 插件 - 日志事件",endpoints:[{method:"GET",path:"/api/devices/:deviceId/log-events",description:"获取日志事件列表（支持分页和过滤）"},{method:"GET",path:"/api/devices/:deviceId/log-events/filter-options",description:"获取日志过滤选项（subsystem/category）"},{method:"DELETE",path:"/api/devices/:deviceId/log-events/:eventId",description:"删除单条日志"},{method:"POST",path:"/api/devices/:deviceId/log-events/batch-delete",description:"批量删除日志"},{method:"DELETE",path:"/api/devices/:deviceId/log-events",description:"删除全部日志"}]},{icon:e.jsx(vt,{size:20}),title:"Mock 插件 - Mock 规则",endpoints:[{method:"GET",path:"/api/devices/:deviceId/mock-rules",description:"获取 Mock 规则列表"},{method:"POST",path:"/api/devices/:deviceId/mock-rules",description:"创建 Mock 规则"},{method:"PUT",path:"/api/devices/:deviceId/mock-rules/:ruleId",description:"更新 Mock 规则"},{method:"DELETE",path:"/api/devices/:deviceId/mock-rules/:ruleId",description:"删除 Mock 规则"}]},{icon:e.jsx(qr,{size:20}),title:"Breakpoint 插件 - 断点调试",endpoints:[{method:"GET",path:"/api/devices/:deviceId/breakpoints",description:"获取断点规则列表"},{method:"POST",path:"/api/devices/:deviceId/breakpoints",description:"创建断点规则"}]},{icon:e.jsx(hr,{size:20}),title:"Chaos 插件 - 故障注入",endpoints:[{method:"GET",path:"/api/devices/:deviceId/chaos-rules",description:"获取故障注入规则"},{method:"POST",path:"/api/devices/:deviceId/chaos-rules",description:"创建故障注入规则"}]},{icon:e.jsx(Cd,{size:20}),title:"数据导出",endpoints:[{method:"GET",path:"/api/export/har/:deviceId",description:"导出 HAR 文件"}]},{icon:e.jsx(or,{size:20}),title:"WebSocket 连接",endpoints:[{method:"WS",path:"/debug-bridge",description:"设备连接端点（App 连接）"},{method:"WS",path:"/ws/live",description:"实时事件流订阅（Web UI 订阅）"}]},{icon:e.jsx(Ae,{size:20}),title:"数据管理",endpoints:[{method:"GET",path:"/api/cleanup/config",description:"获取清理配置"},{method:"PUT",path:"/api/cleanup/config",description:"更新清理配置"},{method:"POST",path:"/api/cleanup/run",description:"执行过期数据清理"},{method:"POST",path:"/api/cleanup/truncate",description:"清空所有数据（危险）"}]},{icon:e.jsx(Re,{size:20}),title:"系统状态",endpoints:[{method:"GET",path:"/api/health",description:"健康检查"}]}],Hm={GET:"bg-green-500/20 text-green-400",POST:"bg-blue-500/20 text-blue-400",PUT:"bg-yellow-500/20 text-yellow-400",DELETE:"bg-red-500/20 text-red-400",WS:"bg-purple-500/20 text-purple-400"};function Um(){return e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-12",children:[e.jsxs("header",{className:"text-center mb-16",children:[e.jsx("div",{className:"flex justify-center mb-4 text-primary",children:e.jsx(St,{size:64})}),e.jsx("h1",{className:"text-4xl font-bold mb-2 text-text-primary",children:"Debug Platform API"}),e.jsx("p",{className:"text-text-secondary text-lg mb-4",children:"网络和日志一体化调试平台"}),e.jsx("span",{className:"inline-block px-4 py-1 bg-bg-light rounded text-sm text-primary border border-border",children:"1.2.4"}),e.jsxs("nav",{className:"flex justify-center gap-4 mt-6",children:[e.jsxs(ct,{to:"/",className:"flex items-center text-text-secondary hover:text-primary transition-colors px-4 py-2 rounded hover:bg-bg-light",children:[e.jsx(wt,{size:16,className:"mr-2"}),"设备列表"]}),e.jsxs(ct,{to:"/health",className:"flex items-center text-text-secondary hover:text-primary transition-colors px-4 py-2 rounded hover:bg-bg-light",children:[e.jsx(Re,{size:16,className:"mr-2"}),"健康检查"]})]})]}),e.jsx("div",{className:"space-y-6",children:Wm.map(t=>e.jsxs("section",{className:"bg-bg-dark border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-bg-medium border-b border-border flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsx("h2",{className:"text-lg font-semibold",children:t.title})]}),e.jsx("div",{className:"p-2",children:t.endpoints.map(r=>e.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 rounded-lg hover:bg-bg-medium transition-colors",children:[e.jsx("span",{className:`font-mono text-xs font-bold px-2 py-1 rounded min-w-[60px] text-center ${Hm[r.method]}`,children:r.method}),e.jsx("code",{className:"font-mono text-sm text-text-primary flex-1",children:r.path}),e.jsx("span",{className:"text-text-secondary text-sm",children:r.description})]},`${r.method}-${r.path}`))})]},t.title))}),e.jsxs("section",{className:"mt-8 bg-bg-dark border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-bg-medium border-b border-border flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:e.jsx(Md,{size:20})}),e.jsx("h2",{className:"text-lg font-semibold",children:"快速开始"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary text-sm mb-2",children:"获取设备列表："}),e.jsx("pre",{className:"bg-bg-darkest border border-border rounded-lg p-4 font-mono text-sm overflow-x-auto",children:e.jsxs("code",{children:[e.jsx("span",{className:"text-info",children:"curl"})," ",e.jsx("span",{className:"text-green-400",children:"http://localhost:9527/api/devices"})]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary text-sm mb-2",children:"连接实时事件流："}),e.jsx("pre",{className:"bg-bg-darkest border border-border rounded-lg p-4 font-mono text-sm overflow-x-auto",children:e.jsxs("code",{children:[e.jsx("span",{className:"text-info",children:"websocat"})," ",e.jsx("span",{className:"text-green-400",children:"ws://localhost:9527/ws/live"})]})})]})]})]}),e.jsx("footer",{className:"text-center mt-12 py-8 text-text-secondary text-sm",children:e.jsx("p",{children:"Debug Platform © 2025 Sun. All rights reserved."})})]})})}function Vm(t){const r=Math.floor(t/86400),s=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),a=t%60,i=o=>o.toString().padStart(2,"0");return r>0?`${r}天 ${i(s)}:${i(n)}:${i(a)}`:`${i(s)}:${i(n)}:${i(a)}`}function qm(t){try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t}}function Gm(){const[t,r]=d.useState(null),[s,n]=d.useState(null),[a,i]=d.useState(new Date),[o,l]=d.useState("--:--:--"),c=d.useRef(null);d.useEffect(()=>{async function x(){try{const h=await fetch("/api/health",{headers:{Accept:"application/json"}});if(!h.ok)throw new Error("Failed to fetch health status");const y=await h.json();if(r(y),n(null),y.startTime){const p=new Date(y.startTime);c.current=p.getTime()}}catch(h){n(h instanceof Error?h.message:"Unknown error")}}x();const m=setInterval(x,3e4);return()=>clearInterval(m)},[]),d.useEffect(()=>{const x=()=>{if(i(new Date),c.current){const h=Math.floor((Date.now()-c.current)/1e3);l(Vm(Math.max(0,h)))}};x();const m=setInterval(x,1e3);return()=>clearInterval(m)},[]);const u=!s&&t?.status==="healthy";return e.jsxs("div",{className:"h-full overflow-auto flex items-center justify-center p-6",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-accent-blue/5 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"max-w-lg w-full relative",children:[e.jsxs("div",{className:"glass-card p-10 text-center",children:[e.jsxs("div",{className:"w-28 h-28 mx-auto mb-8 flex items-center justify-center relative",children:[!s&&e.jsx("div",{className:"absolute w-24 h-24 rounded-full animate-ping opacity-20 bg-green-500",style:{animationDuration:"2s"}}),s?e.jsx(wo,{size:80}):e.jsx(Id,{size:80})]}),e.jsx("h1",{className:`text-3xl font-bold mb-3 ${s?"text-red-400":"text-green-400"}`,children:s?"服务未启动":"服务正常运行"}),e.jsx("p",{className:"text-text-secondary mb-10",children:s?"无法连接到 Debug Platform 服务":"Debug Platform 所有系统运行正常"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-10",children:[e.jsx(Er,{label:"状态",value:t?.status?.toUpperCase()||"--",icon:e.jsx(Ed,{size:16}),highlight:u}),e.jsx(Er,{label:"版本",value:t?.version||"--",icon:e.jsx(Bt,{size:16})}),e.jsx(Er,{label:"运行时间",value:o,icon:e.jsx(Qt,{size:16}),mono:!0}),e.jsx(Er,{label:"当前时间",value:a.toLocaleTimeString("zh-CN"),icon:e.jsx(Qt,{size:16}),mono:!0})]}),t?.startTime&&e.jsxs("div",{className:"text-xs text-text-muted mb-8 p-3 bg-bg-medium/50 rounded-xl",children:[e.jsx("span",{className:"opacity-70",children:"服务启动于:"}),e.jsx("span",{className:"ml-2 font-mono text-text-secondary",children:qm(t.startTime)})]}),e.jsxs("nav",{className:"flex justify-center gap-3",children:[e.jsxs(ct,{to:"/",className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(wt,{size:16})," 设备列表"]}),e.jsxs(ct,{to:"/api-docs",className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(qn,{size:16})," API 文档"]})]})]}),e.jsx("p",{className:"text-center mt-8 text-text-muted text-sm",children:e.jsx("span",{className:"opacity-70",children:"Debug Platform © 2025 Sun"})})]})]})}function Er({label:t,value:r,icon:s,mono:n=!1,highlight:a=!1}){return e.jsxs("div",{className:`bg-bg-medium/50 rounded-xl p-4 border border-border transition-all ${a?"border-green-500/30":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s,e.jsx("span",{className:"text-xs text-text-muted uppercase tracking-wider",children:t})]}),e.jsx("div",{className:`text-xl font-semibold text-primary ${n?"font-mono":""}`,children:r})]})}function Ym(){const{rules:t,fetchRules:r,createOrUpdateRule:s,deleteRule:n,deleteAllRules:a,isLoading:i}=At(),[o,l]=d.useState(null),[c,u]=d.useState(!1),[x,m]=d.useState(!1),[h,y]=xr();d.useEffect(()=>{r()},[]),d.useEffect(()=>{const j=h.get("editRule");if(j&&t.length>0){const k=t.find(R=>R.id===j);k&&(l({...k}),u(!0),y({},{replace:!0}))}},[h,t,y]);const p=()=>{l({name:"",matchType:"domain",matchValue:"",action:"highlight",isEnabled:!0,priority:0}),u(!0)},f=j=>{l({...j}),u(!0)},w=async()=>{if(o)try{await s(o),u(!1),l(null)}catch(j){console.error("Failed to save rule",j)}},N=async j=>{confirm("确定要删除这条规则吗？")&&await n(j)},E=async j=>{await s({...j,isEnabled:!j.isEnabled})},S=async()=>{try{await a(),m(!1)}catch(j){console.error("Failed to clear all rules",j)}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"px-6 py-4 bg-bg-dark border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ct,{to:"/",className:"flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors group",children:[e.jsx("span",{className:"group-hover:-translate-x-1 transition-transform",children:e.jsx(vo,{size:16})}),e.jsx("span",{children:"返回"})]}),e.jsx("div",{className:"h-6 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-border text-primary",children:e.jsx(da,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"全局流量规则"}),e.jsx("p",{className:"text-xs text-text-muted",children:"管理域名高亮、隐藏等过滤规则，这里的规则全局生效"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.length>0&&e.jsxs("button",{onClick:()=>m(!0),className:"btn btn-ghost text-red-400 hover:bg-red-500/10",title:"清空所有规则",children:[e.jsx(Ae,{size:16,className:"mr-1"}),"清空规则"]}),e.jsx("button",{onClick:p,className:"btn btn-primary",children:"+ 新建规则"})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:i?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("div",{className:"mb-4 opacity-50",children:e.jsx(es,{size:48})}),e.jsx("h2",{className:"text-lg font-medium text-text-primary mb-2",children:"暂无规则"}),e.jsx("p",{className:"text-sm mb-4",children:'点击"新建规则"添加流量过滤规则'}),e.jsx("button",{onClick:p,className:"btn btn-primary",children:"+ 新建规则"})]}):e.jsx("div",{className:"space-y-3",children:t.map(j=>e.jsx("div",{className:g("p-4 bg-bg-dark border border-border rounded-xl transition-all",!j.isEnabled&&"opacity-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>E(j),className:g("w-10 h-6 rounded-full transition-colors relative",j.isEnabled?"bg-primary":"bg-bg-light"),children:e.jsx("span",{className:g("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",j.isEnabled?"left-5":"left-1")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-primary",children:j.name||j.matchValue}),e.jsxs("div",{className:"text-xs text-text-muted",children:[j.matchType==="domain"&&"域名匹配",j.matchType==="urlRegex"&&"正则匹配",j.matchType==="header"&&"请求头匹配",": ",e.jsx("code",{className:"text-text-secondary",children:j.matchValue})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:g("badge",j.action==="highlight"&&"badge-warning",j.action==="hide"&&"badge-danger",j.action==="mark"&&"badge-info"),children:[j.action==="highlight"&&e.jsxs(e.Fragment,{children:[e.jsx(Hs,{size:14,filled:!0,className:"mr-1"})," 高亮"]}),j.action==="hide"&&e.jsxs(e.Fragment,{children:[e.jsx(pr,{size:14,className:"mr-1"})," 隐藏"]}),j.action==="mark"&&e.jsxs(e.Fragment,{children:[e.jsx(Yr,{size:14,className:"mr-1"})," 标记"]})]}),e.jsx("button",{onClick:()=>f(j),className:"btn btn-ghost px-3",title:"编辑",children:e.jsx(ir,{size:16})}),e.jsx("button",{onClick:()=>j.id&&N(j.id),className:"btn btn-ghost px-3 text-red-400 hover:bg-red-500/10",title:"删除",children:e.jsx(Ae,{size:16})})]})]})},j.id))})}),c&&o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>u(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-2xl shadow-2xl w-full max-w-md",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:o.id?"编辑规则":"新建规则"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"规则名称"}),e.jsx("input",{type:"text",value:o.name||"",onChange:j=>l({...o,name:j.target.value}),placeholder:"例如：隐藏广告域名",className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"匹配类型"}),e.jsxs("select",{value:o.matchType||"domain",onChange:j=>l({...o,matchType:j.target.value}),className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"domain",children:"域名"}),e.jsx("option",{value:"urlRegex",children:"URL 正则"}),e.jsx("option",{value:"header",children:"请求头"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"匹配值"}),e.jsx("input",{type:"text",value:o.matchValue||"",onChange:j=>l({...o,matchValue:j.target.value}),placeholder:o.matchType==="domain"?"example.com":".*\\.example\\.com",className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"动作"}),e.jsxs("select",{value:o.action||"highlight",onChange:j=>l({...o,action:j.target.value}),className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"highlight",children:"高亮显示"}),e.jsx("option",{value:"hide",children:"隐藏"}),e.jsx("option",{value:"mark",children:"标记"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-border flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>u(!1),className:"btn btn-ghost",children:"取消"}),e.jsx("button",{onClick:w,className:"btn btn-primary",disabled:!o.matchValue,children:"保存"})]})]})})]}),e.jsx(xt,{isOpen:x,onClose:()=>m(!1),onConfirm:S,title:"清空规则",message:`确定要清空所有流量规则吗？

当前共有 ${t.length} 条规则将被删除。
此操作不可恢复。`,confirmText:"确认清空",type:"danger"})]})}function Km(){const{toasts:t,remove:r}=Tt();return t.length===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2",children:t.map(s=>e.jsxs("div",{className:g("px-4 py-3 rounded-lg shadow-lg text-sm font-medium flex items-center gap-2 min-w-[200px] max-w-[400px] animate-slide-in-up",{"bg-green-500/90 text-white":s.type==="success","bg-red-500/90 text-white":s.type==="error","bg-blue-500/90 text-white":s.type==="info","bg-yellow-500/90 text-black":s.type==="warning"}),onClick:()=>r(s.id),children:[e.jsxs("span",{className:"text-base",children:[s.type==="success"&&"✓",s.type==="error"&&"✕",s.type==="info"&&"ℹ",s.type==="warning"&&"⚠"]}),e.jsx("span",{children:s.message})]},s.id))})}function Jm(){const{pendingHits:t}=Zt(),[r,s]=d.useState(!1),[n,a]=d.useState(0),i=ra(),[o,l]=xr();d.useEffect(()=>{t.length>n&&s(!1),a(t.length)},[t.length,n]);const c=i.pathname.includes("/device/")&&o.get("plugin")==="http"&&o.get("subplugin")==="breakpoint",u=d.useCallback(()=>{l({plugin:"http",subplugin:"breakpoint"}),s(!0)},[l]),x=d.useCallback(y=>{y.stopPropagation(),s(!0)},[]);if(t.length===0||r||c)return null;const m=t[t.length-1],h=m?.request?.url?(()=>{try{return new URL(m.request.url).pathname}catch{return m.request.url}})():"";return e.jsxs("div",{className:g("fixed top-4 right-4 z-[9999] w-80","bg-orange-500/95 backdrop-blur-sm rounded-lg shadow-2xl","border border-orange-400/50","animate-slideInRight cursor-pointer","hover:bg-orange-500 transition-colors"),onClick:u,children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(xa,{size:24,className:"text-white animate-pulse"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h4",{className:"text-white font-medium",children:[t.length," 个断点等待处理"]}),e.jsxs("p",{className:"text-white/80 text-xs truncate",children:[m?.request?.method," ",h]})]}),e.jsx("button",{onClick:x,className:"flex-shrink-0 p-1 rounded hover:bg-white/20 transition-colors",title:"暂时关闭提示",children:e.jsx(cs,{size:16,className:"text-white"})})]}),e.jsxs("div",{className:"px-4 py-2 border-t border-white/20 flex items-center justify-between text-white/90 text-xs",children:[e.jsx("span",{children:"点击查看详情并处理"}),e.jsx(Kr,{size:14})]})]})}function Xm({isRefreshing:t}){const[r,s]=d.useState(!1),[n,a]=d.useState(0);return d.useEffect(()=>{if(t){s(!0),a(0);const i=setInterval(()=>{a(o=>o>=90?o:o+Math.random()*10)},100);return()=>clearInterval(i)}else{a(100);const i=setTimeout(()=>{s(!1),a(0)},300);return()=>clearTimeout(i)}},[t]),r?e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[200] h-1 bg-primary/10",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-200 ease-out",style:{width:`${n}%`}})}):null}function Qm(){const t=Ur(),[r]=xr(),s=d.useRef(null),n=d.useRef(null),{isOpen:a,query:i,results:o,selectedIndex:l,recentSearches:c,isSearching:u,open:x,close:m,setQuery:h,selectNext:y,selectPrev:p,getSelectedResult:f,addRecentSearch:w,clearRecentSearches:N}=Fo(),E=Ze(),S=fs(),j=Ft(),k=Us(),R=Zt(),D=Qr(),F=r.get("deviceId")||window.location.pathname.match(/\/device\/([^/]+)/)?.[1];d.useEffect(()=>{a&&s.current&&s.current.focus()},[a]),d.useEffect(()=>{if(n.current){const G=n.current.querySelector('[data-selected="true"]');G&&G.scrollIntoView({block:"nearest",behavior:"smooth"})}},[l]);const P=d.useCallback(G=>{switch(w(i),m(),G.type){case"http":{F&&(E.selectEvent(F,G.id),t(`/device/${F}?plugin=http`));break}case"websocket":{F&&(S.selectSession(F,G.id),t(`/device/${F}?plugin=websocket`));break}case"log":{j.selectEvent(G.id),F&&t(`/device/${F}?plugin=logs`);break}case"mock":{if(F){const q=G.raw;setTimeout(()=>{k.openEditor(q)},100),t(`/device/${F}?plugin=http&subplugin=mock`)}break}case"breakpoint":{if(F){const q=G.raw;setTimeout(()=>{R.openEditor(q)},100),t(`/device/${F}?plugin=http&subplugin=breakpoint`)}break}case"chaos":{if(F){const q=G.raw;setTimeout(()=>{D.openEditor(q)},100),t(`/device/${F}?plugin=http&subplugin=chaos`)}break}case"trafficRule":{t(`/rules?editRule=${G.id}`);break}}},[i,F,t,m,w,E,S,j,k,R,D]),U=d.useCallback(G=>{switch(G.key){case"ArrowDown":G.preventDefault(),y();break;case"ArrowUp":G.preventDefault(),p();break;case"Enter":{G.preventDefault();const q=f();q&&P(q);break}case"Escape":G.preventDefault(),m();break}},[y,p,f,P,m]);d.useEffect(()=>{const G=q=>{(q.metaKey||q.ctrlKey)&&q.key==="k"&&(q.preventDefault(),a?m():x()),q.key==="Escape"&&a&&m()};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[a,x,m]);const K=(G,q)=>{let C=0;for(let b=0;b<G;b++)C+=o[b].items.length;return C+q};return a?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-[15vh]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:m}),e.jsxs("div",{className:"relative w-full max-w-2xl mx-4 bg-bg-dark border border-border rounded-xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-border",children:[e.jsx(Zm,{className:"w-5 h-5 text-text-muted flex-shrink-0"}),e.jsx("input",{ref:s,type:"text",value:i,onChange:G=>h(G.target.value),onKeyDown:U,placeholder:"搜索 HTTP 请求、日志、规则...",className:"flex-1 bg-transparent text-text-primary placeholder-text-muted outline-none text-base",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),u&&e.jsx("div",{className:"w-4 h-4 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),e.jsx("kbd",{className:"hidden sm:inline-flex items-center gap-1 px-2 py-1 text-xs text-text-muted bg-bg-light rounded",children:"ESC"})]}),e.jsxs("div",{ref:n,className:"max-h-[60vh] overflow-auto",children:[!i&&c.length>0&&e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[e.jsx("span",{className:"text-xs text-text-muted font-medium",children:"最近搜索"}),e.jsx("button",{onClick:N,className:"text-xs text-text-muted hover:text-text-secondary transition-colors",children:"清除"})]}),e.jsx("div",{className:"mt-1",children:c.map((G,q)=>e.jsxs("button",{onClick:()=>h(G),className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-bg-light text-left transition-colors",children:[e.jsx(eh,{className:"w-4 h-4 text-text-muted"}),e.jsx("span",{className:"text-sm text-text-secondary",children:G})]},q))})]}),!i&&c.length===0&&e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx("p",{className:"text-text-muted text-sm",children:"输入关键词搜索 HTTP 请求、日志、规则等"}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-center gap-2 text-xs text-text-muted",children:[e.jsx("span",{className:"px-2 py-1 bg-bg-light rounded",children:"URL 路径"}),e.jsx("span",{className:"px-2 py-1 bg-bg-light rounded",children:"HTTP 方法"}),e.jsx("span",{className:"px-2 py-1 bg-bg-light rounded",children:"状态码"}),e.jsx("span",{className:"px-2 py-1 bg-bg-light rounded",children:"日志内容"}),e.jsx("span",{className:"px-2 py-1 bg-bg-light rounded",children:"规则名称"})]})]}),i&&o.length===0&&!u&&e.jsx("div",{className:"px-4 py-8 text-center",children:e.jsxs("p",{className:"text-text-muted text-sm",children:['没有找到匹配 "',i,'" 的结果']})}),o.map((G,q)=>e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5",children:[e.jsx("span",{className:"text-base",children:G.icon}),e.jsx("span",{className:"text-xs text-text-muted font-medium",children:G.label}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",G.total,")"]})]}),e.jsx("div",{className:"mt-1",children:G.items.map((C,b)=>{const T=K(q,b)===l;return e.jsxs("button",{"data-selected":T,onClick:()=>P(C),className:g("w-full flex items-start gap-3 px-3 py-2.5 rounded-lg text-left transition-colors",T?"bg-accent-primary/20 text-text-primary":"hover:bg-bg-light"),children:[e.jsx(th,{type:C.type,extra:C.extra}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-text-primary truncate",children:C.title}),e.jsx("div",{className:"text-xs text-text-muted truncate mt-0.5",children:C.subtitle}),C.highlight&&e.jsx("div",{className:"text-xs text-text-tertiary mt-1 truncate",children:e.jsx(sh,{text:C.highlight,query:i})})]}),C.timestamp&&e.jsx("span",{className:"text-xs text-text-muted flex-shrink-0",children:rh(C.timestamp)})]},C.id)})})]},G.type))]}),o.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-t border-border text-xs text-text-muted",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("kbd",{className:"kbd-sm",children:"↑"}),e.jsx("kbd",{className:"kbd-sm",children:"↓"}),"选择"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("kbd",{className:"kbd-sm",children:"↵"}),"打开"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("kbd",{className:"kbd-sm",children:"ESC"}),"关闭"]})]}),e.jsxs("span",{children:["共 ",o.reduce((G,q)=>G+q.items.length,0)," 条结果"]})]})]})]}):null}function Zm({className:t}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})})}function eh({className:t}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}function th({type:t,extra:r}){const s="w-8 h-8 rounded-lg flex items-center justify-center text-sm flex-shrink-0";switch(t){case"http":{const n=r?.statusCode,a=r?.error,i=r?.errorDescription,l=mr(n??null,a??null,i??null)?"bg-red-500/20":n&&n>=300?"bg-yellow-500/20":"bg-green-500/20";return e.jsx("span",{className:g(s,l),children:"🌐"})}case"websocket":{const n=r?.isOpen;return e.jsx("span",{className:g(s,n?"bg-green-500/20":"bg-gray-500/20"),children:"🔌"})}case"log":{const n=r?.level,a={error:"bg-red-500/20",warning:"bg-yellow-500/20",info:"bg-blue-500/20",debug:"bg-gray-500/20",verbose:"bg-gray-500/10"};return e.jsx("span",{className:g(s,a[n||"info"]||"bg-gray-500/20"),children:"📝"})}case"mock":return e.jsx("span",{className:g(s,"bg-purple-500/20"),children:"🎭"});case"breakpoint":return e.jsx("span",{className:g(s,"bg-red-500/20"),children:"🔴"});case"chaos":return e.jsx("span",{className:g(s,"bg-orange-500/20"),children:"💥"});case"trafficRule":return e.jsx("span",{className:g(s,"bg-cyan-500/20"),children:"🚦"});default:return e.jsx("span",{className:g(s,"bg-gray-500/20"),children:"📄"})}}function sh({text:t,query:r}){if(!r)return e.jsx(e.Fragment,{children:t});const s=t.toLowerCase(),n=r.toLowerCase(),a=s.indexOf(n);return a===-1?e.jsx(e.Fragment,{children:t}):e.jsxs(e.Fragment,{children:[t.slice(0,a),e.jsx("span",{className:"text-accent-primary font-medium",children:t.slice(a,a+r.length)}),t.slice(a+r.length)]})}function rh(t){try{const r=new Date(t),n=new Date().getTime()-r.getTime();return n<6e4?"刚刚":n<36e5?`${Math.floor(n/6e4)} 分钟前`:n<864e5?`${Math.floor(n/36e5)} 小时前`:r.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}catch{return""}}function Ss(t,r,s){let n=s.initialDeps??[],a;function i(){var o,l,c,u;let x;s.key&&((o=s.debug)!=null&&o.call(s))&&(x=Date.now());const m=t();if(!(m.length!==n.length||m.some((p,f)=>n[f]!==p)))return a;n=m;let y;if(s.key&&((l=s.debug)!=null&&l.call(s))&&(y=Date.now()),a=r(...m),s.key&&((c=s.debug)!=null&&c.call(s))){const p=Math.round((Date.now()-x)*100)/100,f=Math.round((Date.now()-y)*100)/100,w=f/16,N=(E,S)=>{for(E=String(E);E.length<S;)E=" "+E;return E};console.info(`%c⏱ ${N(f,5)} /${N(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*w,120))}deg 100% 31%);`,s?.key)}return(u=s?.onChange)==null||u.call(s,a),a}return i.updateDeps=o=>{n=o},i}function yi(t,r){if(t===void 0)throw new Error("Unexpected undefined");return t}const nh=(t,r)=>Math.abs(t-r)<1.01,ah=(t,r,s)=>{let n;return function(...a){t.clearTimeout(n),n=t.setTimeout(()=>r.apply(this,a),s)}},ji=t=>{const{offsetWidth:r,offsetHeight:s}=t;return{width:r,height:s}},ih=t=>t,oh=t=>{const r=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let a=r;a<=s;a++)n.push(a);return n},lh=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;const a=o=>{const{width:l,height:c}=o;r({width:Math.round(l),height:Math.round(c)})};if(a(ji(s)),!n.ResizeObserver)return()=>{};const i=new n.ResizeObserver(o=>{const l=()=>{const c=o[0];if(c?.borderBoxSize){const u=c.borderBoxSize[0];if(u){a({width:u.inlineSize,height:u.blockSize});return}}a(ji(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return i.observe(s,{box:"border-box"}),()=>{i.unobserve(s)}},vi={passive:!0},wi=typeof window>"u"?!0:"onscrollend"in window,ch=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;let a=0;const i=t.options.useScrollendEvent&&wi?()=>{}:ah(n,()=>{r(a,!1)},t.options.isScrollingResetDelay),o=x=>()=>{const{horizontal:m,isRtl:h}=t.options;a=m?s.scrollLeft*(h&&-1||1):s.scrollTop,i(),r(a,x)},l=o(!0),c=o(!1);c(),s.addEventListener("scroll",l,vi);const u=t.options.useScrollendEvent&&wi;return u&&s.addEventListener("scrollend",c,vi),()=>{s.removeEventListener("scroll",l),u&&s.removeEventListener("scrollend",c)}},dh=(t,r,s)=>{if(r?.borderBoxSize){const n=r.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},uh=(t,{adjustments:r=0,behavior:s},n)=>{var a,i;const o=t+r;(i=(a=n.scrollElement)==null?void 0:a.scrollTo)==null||i.call(a,{[n.options.horizontal?"left":"top"]:o,behavior:s})};class xh{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const n=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(a=>{a.forEach(i=>{const o=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var a;(a=n())==null||a.disconnect(),s=null},observe:a=>{var i;return(i=n())==null?void 0:i.observe(a,{box:"border-box"})},unobserve:a=>{var i;return(i=n())==null?void 0:i.unobserve(a)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([n,a])=>{typeof a>"u"&&delete s[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ih,rangeExtractor:oh,onChange:()=>{},measureElement:dh,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var n,a;(a=(n=this.options).onChange)==null||a.call(n,this,s)},this.maybeNotify=Ss(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(a=>{this.observer.observe(a)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,a=>{this.scrollRect=a,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(a,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<a?"forward":"backward":null,this.scrollOffset=a,this.isScrolling=i,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,n)=>{const a=new Map,i=new Map;for(let o=n-1;o>=0;o--){const l=s[o];if(a.has(l.lane))continue;const c=i.get(l.lane);if(c==null||l.end>c.end?i.set(l.lane,l):l.end<c.end&&a.set(l.lane,!0),a.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((o,l)=>o.end===l.end?o.index-l.index:o.end-l.end)[0]:void 0},this.getMeasurementOptions=Ss(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(s,n,a,i,o)=>(this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:n,scrollMargin:a,getItemKey:i,enabled:o}),{key:!1}),this.getMeasurements=Ss(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:n,scrollMargin:a,getItemKey:i,enabled:o},l)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(x=>{this.itemSizeCache.set(x.key,x.size)}));const c=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const u=this.measurementsCache.slice(0,c);for(let x=c;x<s;x++){const m=i(x),h=this.options.lanes===1?u[x-1]:this.getFurthestMeasurement(u,x),y=h?h.end+this.options.gap:n+a,p=l.get(m),f=typeof p=="number"?p:this.options.estimateSize(x),w=y+f,N=h?h.lane:x%this.options.lanes;u[x]={index:x,start:y,size:f,end:w,key:m,lane:N}}return this.measurementsCache=u,u},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ss(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,n,a,i)=>this.range=s.length>0&&n>0?mh({measurements:s,outerSize:n,scrollOffset:a,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ss(()=>{let s=null,n=null;const a=this.calculateRange();return a&&(s=a.startIndex,n=a.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,n]},(s,n,a,i,o)=>i===null||o===null?[]:s({startIndex:i,endIndex:o,overscan:n,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const n=this.options.indexAttribute,a=s.getAttribute(n);return a?parseInt(a,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(s,n)=>{const a=this.indexFromElement(s),i=this.measurementsCache[a];if(!i)return;const o=i.key,l=this.elementsCache.get(o);l!==s&&(l&&this.observer.unobserve(l),this.observer.observe(s),this.elementsCache.set(o,s)),s.isConnected&&this.resizeItem(a,this.options.measureElement(s,n,this))},this.resizeItem=(s,n)=>{const a=this.measurementsCache[s];if(!a)return;const i=this.itemSizeCache.get(a.key)??a.size,o=n-i;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(a,o,this):a.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(a.index),this.itemSizeCache=new Map(this.itemSizeCache.set(a.key,n)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((n,a)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(a))});return}this._measureElement(s,void 0)},this.getVirtualItems=Ss(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,n)=>{const a=[];for(let i=0,o=s.length;i<o;i++){const l=s[i],c=n[l];a.push(c)}return a},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const n=this.getMeasurements();if(n.length!==0)return yi(n[Qo(0,n.length-1,a=>yi(n[a]).start,s)])},this.getOffsetForAlignment=(s,n,a=0)=>{const i=this.getSize(),o=this.getScrollOffset();n==="auto"&&(n=s>=o+i?"end":"start"),n==="center"?s+=(a-i)/2:n==="end"&&(s-=i);const l=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(l,s),0)},this.getOffsetForIndex=(s,n="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const a=this.measurementsCache[s];if(!a)return;const i=this.getSize(),o=this.getScrollOffset();if(n==="auto")if(a.end>=o+i-this.options.scrollPaddingEnd)n="end";else if(a.start<=o+this.options.scrollPaddingStart)n="start";else return[o,n];const l=n==="end"?a.end+this.options.scrollPaddingEnd:a.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,n,a.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:n="start",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,n),{adjustments:void 0,behavior:a})},this.scrollToIndex=(s,{align:n="auto",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let i=0;const o=10,l=u=>{if(!this.targetWindow)return;const x=this.getOffsetForIndex(s,u);if(!x){console.warn("Failed to get offset for index:",s);return}const[m,h]=x;this._scrollToOffset(m,{adjustments:void 0,behavior:a}),this.targetWindow.requestAnimationFrame(()=>{const y=this.getScrollOffset(),p=this.getOffsetForIndex(s,h);if(!p){console.warn("Failed to get offset for index:",s);return}nh(p[0],y)||c(h)})},c=u=>{this.targetWindow&&(i++,i<o?this.targetWindow.requestAnimationFrame(()=>l(u)):console.warn(`Failed to scroll to index ${s} after ${o} attempts.`))};l(n)},this.scrollBy=(s,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var s;const n=this.getMeasurements();let a;if(n.length===0)a=this.options.paddingStart;else if(this.options.lanes===1)a=((s=n[n.length-1])==null?void 0:s.end)??0;else{const i=Array(this.options.lanes).fill(null);let o=n.length-1;for(;o>=0&&i.some(l=>l===null);){const l=n[o];i[l.lane]===null&&(i[l.lane]=l.end),o--}a=Math.max(...i.filter(l=>l!==null))}return Math.max(a-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:n,behavior:a})=>{this.options.scrollToFn(s,{behavior:a,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(r)}}const Qo=(t,r,s,n)=>{for(;t<=r;){const a=(t+r)/2|0,i=s(a);if(i<n)t=a+1;else if(i>n)r=a-1;else return a}return t>0?t-1:0};function mh({measurements:t,outerSize:r,scrollOffset:s,lanes:n}){const a=t.length-1,i=c=>t[c].start;if(t.length<=n)return{startIndex:0,endIndex:a};let o=Qo(0,a,i,s),l=o;if(n===1)for(;l<a&&t[l].end<s+r;)l++;else if(n>1){const c=Array(n).fill(0);for(;l<a&&c.some(x=>x<s+r);){const x=t[l];c[x.lane]=x.end,l++}const u=Array(n).fill(s+r);for(;o>=0&&u.some(x=>x>=s);){const x=t[o];u[x.lane]=x.start,o--}o=Math.max(0,o-o%n),l=Math.min(a,l+(n-1-l%n))}return{startIndex:o,endIndex:l}}const Ni=typeof document<"u"?d.useLayoutEffect:d.useEffect;function hh(t){const r=d.useReducer(()=>({}),{})[1],s={...t,onChange:(a,i)=>{var o;i?ur.flushSync(r):r(),(o=t.onChange)==null||o.call(t,a,i)}},[n]=d.useState(()=>new xh(s));return n.setOptions(s),Ni(()=>n._didMount(),[]),Ni(()=>n._willUpdate()),n}function wa(t){return hh({observeElementRect:lh,observeElementOffset:ch,scrollToFn:uh,...t})}function Zo({storageKey:t,columns:r}){const s=d.useCallback(()=>{const p={};for(const f of r)f.defaultWidth!==void 0&&(p[f.id]=f.defaultWidth);return p},[r]),n=d.useCallback(()=>{try{const p=localStorage.getItem(`column-widths-${t}`);if(p){const f=JSON.parse(p);return{...s(),...f}}}catch{}return s()},[t,s]),[a,i]=d.useState(n),[o,l]=d.useState(!1),c=d.useRef(null),u=d.useCallback(p=>{try{localStorage.setItem(`column-widths-${t}`,JSON.stringify(p))}catch{}},[t]),x=d.useCallback(p=>r.find(f=>f.id===p),[r]),m=d.useCallback((p,f)=>{const w=x(p);if(!w||w.resizable===!1||w.flex)return;const N=a[p]??w.defaultWidth??100;c.current={columnId:p,startX:f,startWidth:N},l(!0)},[a,x]);d.useEffect(()=>{if(!o)return;const p=w=>{if(!c.current)return;const{columnId:N,startX:E,startWidth:S}=c.current,j=x(N);if(!j)return;const k=w.clientX-E;let R=S+k;const D=j.minWidth??50,F=j.maxWidth??600;R=Math.max(D,Math.min(F,R)),i(P=>{const U={...P,[N]:R};return u(U),U})},f=()=>{c.current=null,l(!1)};return document.addEventListener("mousemove",p),document.addEventListener("mouseup",f),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",f)}},[o,x,u]);const h=d.useCallback(p=>{const f=x(p);if(!f)return{};if(f.flex)return{flex:1,minWidth:f.minWidth??100};const w=a[p]??f.defaultWidth;return w!==void 0?{width:w,flexShrink:0}:{}},[a,x]),y=d.useCallback(()=>{const p=s();i(p),u(p)},[s,u]);return{columnWidths:a,getColumnStyle:h,getHeaderStyle:h,isResizing:o,startResize:m,resetColumnWidths:y}}function Ot({onMouseDown:t,isResizing:r}){return e.jsx("div",{className:`
                absolute right-0 top-0 bottom-0 w-px cursor-col-resize
                bg-border hover:bg-primary/50 transition-colors
                ${r?"bg-primary w-0.5":""}
            `,onMouseDown:s=>{s.preventDefault(),s.stopPropagation(),t(s)},children:e.jsx("div",{className:"absolute -left-1.5 -right-1.5 top-0 bottom-0"})})}function $s(){return e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-px bg-border"})}function tn(t,r={}){const{duration:s=1500,enabled:n=!0}=r,a=d.useRef(new Set),i=d.useRef(!1),[o,l]=d.useState(new Set);d.useEffect(()=>{if(!n||t.length===0)return;const x=new Set(t.map(y=>y.id)),m=a.current;if(!i.current){a.current=x,i.current=!0;return}const h=new Set;x.forEach(y=>{m.has(y)||h.add(y)}),h.size>0&&(l(y=>new Set([...y,...h])),setTimeout(()=>{l(y=>{const p=new Set(y);return h.forEach(f=>p.delete(f)),p})},s)),a.current=x},[t,s,n]);const c=d.useCallback(x=>o.has(x),[o]),u=d.useCallback(()=>{a.current=new Set,i.current=!1,l(new Set)},[]);return{isNewItem:c,highlightedIds:o,reset:u}}function Na(t){return d.useMemo(()=>{const r=new Map,s=new Map,n=new Map;for(const h of t)r.set(h.id,h),h.redirectFromId&&(s.set(h.redirectFromId,h.id),n.set(h.id,h.redirectFromId));const a=new Map,i=[...t].filter(h=>typeof h.seqNum=="number").sort((h,y)=>h.seqNum-y.seqNum);for(const h of i){const y=a.get(h.url);y?y.push(h):a.set(h.url,[h])}const o=5e3,l=h=>{if(!h)return null;const y=Date.parse(h);return Number.isNaN(y)?null:y};for(const h of i){if(s.has(h.id)||!h.redirectToUrl||!h.statusCode||h.statusCode<300||h.statusCode>=400)continue;const y=a.get(h.redirectToUrl);if(!y||y.length===0)continue;const p=h.seqNum??0,f=l(h.startTime);let w=null;for(const N of y)if(!((N.seqNum??0)<=p)&&!n.has(N.id)){if(f){const E=l(N.startTime);if(E&&E-f>o)break}w=N;break}w&&(s.set(h.id,w.id),n.set(w.id,h.id))}const c=new Map,u=h=>{const y=[],p=new Set;let f=h;for(;f&&!p.has(f);){p.add(f),y.push(f);const w=s.get(f);if(!w)break;f=w}return y},x=h=>{const y=new Set;let p=h;for(;!y.has(p);){y.add(p);const f=n.get(p)??r.get(p)?.redirectFromId;if(!f||!r.has(f))break;p=f}return p},m=h=>{h.forEach((y,p)=>{c.has(y)||c.set(y,{index:p+1,total:h.length,rootId:h[0],prevId:p>0?h[p-1]:void 0,nextId:p<h.length-1?h[p+1]:void 0,chainIds:h})})};for(const h of t)if(!!!(h.redirectFromId&&r.has(h.redirectFromId))){const p=u(h.id);p.length>0&&m(p)}for(const h of t){if(c.has(h.id))continue;const y=x(h.id),p=u(y);p.length>0&&m(p)}for(const h of t)c.has(h.id)||c.set(h.id,{index:1,total:1,rootId:h.id,prevId:n.get(h.id)??h.redirectFromId??void 0,nextId:s.get(h.id),chainIds:[h.id]});return{chainMap:c,redirectNextMap:s,eventMap:r}},[t])}const ph={httpRequest:{label:"HTTP 请求",icon:e.jsx(Kn,{size:12}),color:"text-blue-400"},httpResponse:{label:"HTTP 响应",icon:e.jsx(zr,{size:12}),color:"text-green-400"},wsOutgoing:{label:"WS 发送",icon:e.jsx(Kn,{size:12}),color:"text-purple-400"},wsIncoming:{label:"WS 接收",icon:e.jsx(zr,{size:12}),color:"text-orange-400"}};function fh(t,r){if(!r)return!0;if(r.startsWith("^")||r.includes("\\"))try{return new RegExp(r).test(t)}catch{}const s=r.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");try{return new RegExp(`^${s}$`,"i").test(t)}catch{return!1}}function gh(t,r,s){if(s){const n=r.find(a=>a.id===s);if(n)return[n]}return r.filter(n=>!n.enabled||n.targetType!=="httpRequest"&&n.targetType!=="httpResponse"?!1:fh(t,n.condition.urlPattern))}function el({url:t,mockRuleId:r,rules:s,onEditRule:n,children:a}){const[i,o]=d.useState(!1),l=d.useRef(null),c=d.useRef(null),u=gh(t,s,r);d.useEffect(()=>{const f=w=>{l.current&&!l.current.contains(w.target)&&c.current&&!c.current.contains(w.target)&&o(!1)};return i&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[i]);const x=f=>{f.stopPropagation(),o(!i)},m=(f,w)=>{w.stopPropagation(),o(!1),n?.(f)},[h,y]=d.useState({top:0,left:0});d.useLayoutEffect(()=>{if(i&&c.current){const f=c.current.getBoundingClientRect();y({top:f.top-8,left:f.left+f.width/2})}},[i]);const p=i?ur.createPortal(e.jsxs("div",{ref:l,style:{position:"fixed",top:h.top,left:h.left,transform:"translate(-50%, -100%)"},className:"z-[300] min-w-[280px] max-w-[360px]",children:[e.jsxs("div",{className:"bg-bg-dark border border-border rounded-xl shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-border bg-bg-medium/50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:"匹配的 Mock 规则"}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",u.length,")"]})]})}),e.jsx("div",{className:"max-h-[240px] overflow-auto",children:u.length>0?e.jsx("div",{className:"divide-y divide-border/50",children:u.map(f=>{const w=ph[f.targetType];return e.jsx("div",{className:"px-3 py-2 hover:bg-bg-light/50 transition-colors group",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:g("flex items-center gap-1 text-xs",w.color),children:[w.icon,w.label]}),e.jsx("span",{className:"text-xs font-medium text-text-primary truncate",children:f.name})]}),e.jsx("div",{className:"text-xs text-text-muted font-mono truncate",title:f.condition.urlPattern||"所有 URL",children:f.condition.urlPattern||"*"})]}),n&&e.jsx("button",{onClick:N=>m(f,N),className:"p-1.5 rounded-lg text-text-muted hover:text-primary hover:bg-bg-light opacity-0 group-hover:opacity-100 transition-all",title:"编辑规则",children:e.jsx(Co,{size:12})})]})},f.id)})}):e.jsx("div",{className:"px-3 py-4 text-center text-text-muted text-xs",children:"没有找到匹配的规则"})}),e.jsx("div",{className:"px-3 py-2 border-t border-border bg-bg-medium/30",children:e.jsx("p",{className:"text-xs text-text-muted text-center",children:"点击规则可编辑"})})]}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-1 w-2 h-2 bg-bg-dark border-r border-b border-border rotate-45",style:{bottom:"-4px"}})]}),document.body):null;return e.jsxs("div",{className:"relative inline-flex",children:[e.jsx("div",{ref:c,onClick:x,className:"cursor-pointer",children:a}),p]})}function Ue({checked:t,onChange:r,disabled:s=!1,className:n,id:a,"aria-label":i}){return e.jsx("input",{type:"checkbox",id:a,checked:t,onChange:o=>r(o.target.checked),disabled:s,className:g("checkbox-custom",n),"aria-label":i})}function ka({onClick:t,isLoading:r=!1,hasMore:s,loadedCount:n,totalCount:a}){return s?e.jsx("div",{className:"py-4 px-4",children:e.jsx("button",{onClick:t,disabled:r,className:g("w-full py-2.5 px-4 rounded-lg text-xs font-medium transition-all","bg-primary/10 text-primary","hover:bg-primary/20","disabled:opacity-50 disabled:cursor-not-allowed"),children:r?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-3.5 h-3.5 animate-spin",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"加载中..."]}):e.jsxs("span",{children:["点击加载更多（已加载 ",n," / ",a,"）"]})})}):e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-xs text-text-muted",children:"没有更多数据了"})})}const ki=44,bh=[{id:"index",label:"#",defaultWidth:48,minWidth:40,maxWidth:80,resizable:!1},{id:"marker",label:"",defaultWidth:24,minWidth:24,maxWidth:24,resizable:!1},{id:"time",label:"时间",defaultWidth:100,minWidth:80,maxWidth:160,resizable:!0},{id:"method",label:"方法",defaultWidth:90,minWidth:70,maxWidth:120,resizable:!0},{id:"status",label:"状态",defaultWidth:80,minWidth:60,maxWidth:100,resizable:!0},{id:"url",label:"URL / 域名",flex:!0,minWidth:150,resizable:!0},{id:"duration",label:"耗时",defaultWidth:90,minWidth:60,maxWidth:120,resizable:!0},{id:"tags",label:"标记",defaultWidth:80,minWidth:60,maxWidth:120,resizable:!1}];function Ci(t,r){return r.find(s=>{if(!s.isEnabled)return!1;if(s.matchType==="domain")try{const n=new URL(t.url);return n.hostname===s.matchValue||n.hostname.endsWith("."+s.matchValue)}catch{return!1}if(s.matchType==="urlRegex")try{return new RegExp(s.matchValue).test(t.url)}catch{return!1}return!1})}function yh({items:t,selectedId:r,onSelect:s,autoScroll:n,deviceId:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l,mockRules:c=[],onEditMockRule:u,showBlacklisted:x=!1,onLoadMore:m,hasMore:h=!1,isLoading:y=!1,loadedCount:p=0,totalCount:f=0,onScrollControlsReady:w}){const N=d.useRef(null),E=d.useRef(null),[S,j]=d.useState(!0),[k,R]=d.useState(!1),{getColumnStyle:D,isResizing:F,startResize:P}=Zo({storageKey:"http-table",columns:bh}),{deviceRules:U,rules:K,fetchDeviceRules:G,fetchRules:q}=At(),{isFavorite:C}=Vr();d.useEffect(()=>{a?G(a):q()},[a,G,q]);const b=d.useMemo(()=>a?U:K,[a,U,K]),M=d.useMemo(()=>t.filter(_=>!Kt(_)),[t]),T=d.useMemo(()=>x||b.length===0?M:M.filter(_=>{const ue=Ci(_,b);return!ue||ue.action!=="hide"}),[M,b,x]),{chainMap:B,redirectNextMap:A}=Na(T),I=d.useMemo(()=>{let _=0;for(const ue of T)if(typeof ue.duration=="number"){const ae=ue.duration*1e3;ae>_&&(_=ae)}return _},[T]),{isNewItem:O}=tn(T),z=d.useMemo(()=>`${T[0]?.id||"empty"}-${T.length}`,[T]),H=wa({count:T.length,getScrollElement:()=>N.current,estimateSize:()=>ki,overscan:10,getItemKey:d.useCallback(_=>T[_]?.id??`item-${_}`,[T])}),le=H.getVirtualItems();d.useEffect(()=>{const _=N.current;if(!_)return;const ue=()=>{const{scrollTop:ae,scrollHeight:ee,clientHeight:me}=_,Ce=ae<=10,Fe=ae+me>=ee-10;j(Ce),R(Fe)};return ue(),_.addEventListener("scroll",ue,{passive:!0}),()=>_.removeEventListener("scroll",ue)},[]);const Y=d.useCallback(()=>{H.scrollToIndex(0,{align:"start",behavior:"smooth"})},[H]),V=d.useCallback(()=>{T.length>0&&H.scrollToIndex(T.length-1,{align:"end",behavior:"smooth"})},[H,T.length]);d.useEffect(()=>{w&&w({scrollToTop:Y,scrollToBottom:V,isAtTop:S,isAtBottom:k})},[w,Y,V,S,k]),d.useEffect(()=>{H.measure()},[z,H]),d.useEffect(()=>{const ue=T[0]?.id??null,ae=ue!==null&&ue!==E.current;n&&ae&&H.scrollToIndex(0,{align:"start",behavior:"smooth"}),E.current=ue},[T,n,H]);const ie=d.useCallback(_=>{const ue=T.findIndex(ae=>ae.id===_);ue>=0&&H.scrollToIndex(ue,{align:"center",behavior:"smooth"})},[T,H]),Ne=d.useCallback(_=>{s(_),ie(_)},[s,ie]),se=d.useCallback((_,ue)=>{i&&l?(ue.preventDefault(),l(_.id)):r===_.id?s(""):s(_.id)},[i,l,s,r]),de=(_,ue)=>{const ae=mr(_.statusCode,_.error,_.errorDescription),ee=_.id===r,me=o.has(_.id),Ce=A.get(_.id),Fe=B.get(_.id),et=Fe&&Fe.total>1?`重定向 ${Fe.index}/${Fe.total}`:null,ze=_.seqNum,re=a?C(a,_.url):_.isFavorite,Se=_.isMocked,L=Ci(_,b),Q=L?.action==="highlight",Z=L?.action==="mark",J=L?.color||(Z?"#60a5fa":void 0),be=Z&&J&&!ee?{borderLeftColor:J}:{},Ie=O(_.id);return e.jsxs("div",{style:be,onClick:ye=>se(_,ye),className:g("flex items-center cursor-pointer transition-all duration-150 group border-b border-border h-full",ee&&"bg-selected",!ee&&me&&"bg-primary/15",!ee&&!me&&Q&&"bg-yellow-500/10 hover:bg-yellow-500/20",!ee&&!me&&!Q&&Z&&"border-l-4",!ee&&!me&&!Q&&ae&&"bg-red-500/5 hover:bg-red-500/10",!ee&&!me&&!Q&&!ae&&"hover:bg-bg-light/60",Ie&&!ee&&"animate-row-new"),children:[e.jsx("div",{style:D("index"),className:g("flex items-center justify-center text-xs font-mono",ee?"text-selected-text-muted":"text-text-muted"),children:ze}),e.jsxs("div",{style:D("marker"),className:"flex items-center justify-center",children:[Q&&e.jsx(ca,{size:12,filled:!0,className:"text-yellow-500"}),Z&&!Q&&e.jsx(Yr,{size:12,style:{color:J}})]}),i&&e.jsx("div",{className:"w-10 flex-shrink-0 flex items-center justify-center",onClick:ye=>ye.stopPropagation(),children:e.jsx(Ue,{checked:me,onChange:()=>l?.(_.id)})}),e.jsx("div",{style:D("time"),className:g("px-3 py-2.5",ee?"text-selected-text-secondary":"text-text-muted"),children:e.jsx("span",{className:"text-xs font-mono",children:ut(_.startTime)})}),e.jsx("div",{style:D("method"),className:"px-3 py-2.5",children:e.jsx("span",{className:g("inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-[10px] font-mono font-semibold tracking-wider min-w-[52px]",va(_.method)),children:_.method})}),e.jsx("div",{style:D("status"),className:"px-3 py-2.5",children:e.jsx("span",{className:g("inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-[10px] font-mono font-semibold tracking-wider min-w-[44px]",nr(_.statusCode)),children:_.statusCode??"ERR"})}),e.jsx("div",{style:D("url"),className:"px-3 py-2.5 min-w-0 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:g("text-xs truncate transition-colors",ee?"text-selected-text-primary font-medium":"text-text-primary"),title:_.url,children:Dm(_.url)}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:g("text-2xs truncate font-mono",ee?"text-selected-text-muted":"text-text-muted"),children:en(_.url)}),et&&e.jsx("span",{className:"text-2xs font-mono text-cyan-400 shrink-0",title:et,children:et})]})]})}),e.jsxs("div",{style:D("duration"),className:"relative px-3 py-2.5",children:[e.jsx("span",{className:g("text-xs font-mono font-semibold",ya(_.duration)),children:zt(_.duration)}),(()=>{if(typeof _.duration!="number"||I<=0)return null;const ye=_.duration*1e3,je=ye/I;return ye>=100&&je>=.03?e.jsx("div",{className:"absolute left-3 right-3 bottom-1 h-0.5 bg-bg-light/40 rounded-full overflow-hidden pointer-events-none",children:e.jsx("div",{className:g("h-full rounded-full",ja(_.duration)),style:{width:`${Math.min(je,1)*100}%`}})}):null})()]}),e.jsxs("div",{style:D("tags"),className:"px-3 py-2.5 flex items-center justify-center gap-1.5",children:[_.redirectFromId&&e.jsx("button",{className:"inline-flex items-center justify-center w-5 h-5 text-cyan-400 hover:text-cyan-300 transition-colors",title:"跳转到重定向来源",onClick:ye=>{ye.stopPropagation();const je=_.redirectFromId;je&&Ne(je)},children:e.jsx(or,{size:12})}),!_.redirectFromId&&Ce&&e.jsx("button",{className:"inline-flex items-center justify-center w-5 h-5 text-emerald-400 hover:text-emerald-300 transition-colors",title:"跳转到重定向下一跳",onClick:ye=>{ye.stopPropagation(),Ne(Ce)},children:e.jsx(Kr,{size:12})}),!_.redirectFromId&&!Ce&&_.redirectToUrl&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-cyan-400",title:"已重定向",children:e.jsx(or,{size:12})}),_.isReplay&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-blue-400",title:"重放请求",children:e.jsx(Gr,{size:12})}),Se&&e.jsx(el,{url:_.url,mockRuleId:_.mockRuleId,rules:c,onEditRule:u,children:e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-purple-400 hover:text-purple-300 transition-colors cursor-pointer",title:"已 Mock - 点击查看规则",children:e.jsx(vt,{size:12})})}),re&&e.jsx("span",{className:"badge-favorite text-sm",title:"已收藏",children:e.jsx(Hs,{size:12,filled:!0})}),!Se&&!re&&!_.isReplay&&!_.redirectFromId&&!_.redirectToUrl&&!Ce&&e.jsx("span",{className:"w-5 h-5"})]})]})};return e.jsxs("div",{className:g("h-full flex flex-col",F&&"select-none"),children:[e.jsxs("div",{className:"flex items-center bg-bg-medium border-b border-border text-text-secondary sticky top-0 z-10 flex-shrink-0",children:[e.jsxs("div",{style:D("index"),className:"relative px-2 py-1.5 font-semibold text-xs uppercase tracking-wider text-center",children:["#",e.jsx($s,{})]}),e.jsx("div",{style:D("marker"),className:"relative",children:e.jsx($s,{})}),i&&e.jsxs("div",{className:"relative px-2 py-1.5 w-10 flex-shrink-0",children:[e.jsx("span",{className:"sr-only",children:"选择"}),e.jsx($s,{})]}),e.jsxs("div",{style:D("time"),className:"relative px-3 py-1.5 font-semibold text-xs uppercase tracking-wider",children:["时间",e.jsx(Ot,{onMouseDown:_=>P("time",_.clientX),isResizing:F})]}),e.jsxs("div",{style:D("method"),className:"relative px-3 py-1.5 font-semibold text-xs uppercase tracking-wider",children:["方法",e.jsx(Ot,{onMouseDown:_=>P("method",_.clientX),isResizing:F})]}),e.jsxs("div",{style:D("status"),className:"relative px-3 py-1.5 font-semibold text-xs uppercase tracking-wider",children:["状态",e.jsx(Ot,{onMouseDown:_=>P("status",_.clientX),isResizing:F})]}),e.jsxs("div",{style:D("url"),className:"relative px-3 py-1.5 font-semibold text-xs uppercase tracking-wider min-w-0",children:["URL / 域名",e.jsx(Ot,{onMouseDown:_=>P("url",_.clientX),isResizing:F})]}),e.jsxs("div",{style:D("duration"),className:"relative px-3 py-1.5 font-semibold text-xs uppercase tracking-wider",children:["耗时",e.jsx(Ot,{onMouseDown:_=>P("duration",_.clientX),isResizing:F})]}),e.jsx("div",{style:D("tags"),className:"px-3 py-1.5 font-semibold text-xs uppercase tracking-wider text-center",children:"标记"})]}),e.jsx("div",{ref:N,className:"flex-1 overflow-auto",children:T.length>0?e.jsxs("div",{style:{height:`${H.getTotalSize()+(m?60:0)}px`,width:"100%",position:"relative"},children:[le.map(_=>{const ue=T[_.index],ae=`${ue.id}-${_.index}`;return e.jsx("div",{style:{position:"absolute",top:`${_.start}px`,left:0,width:"100%",height:`${ki}px`},children:de(ue,_.index)},ae)}),m&&e.jsx("div",{style:{position:"absolute",top:`${H.getTotalSize()}px`,left:0,width:"100%"},children:e.jsx(ka,{onClick:m,hasMore:h,isLoading:y,loadedCount:p,totalCount:f})})]},z):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-20",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-bg-light flex items-center justify-center mb-4 border border-border",children:e.jsx(Bs,{size:32,className:"opacity-60"})}),e.jsx("p",{className:"text-sm font-medium text-text-secondary mb-1",children:"暂无 HTTP 请求"}),e.jsx("p",{className:"text-xs text-text-muted",children:"等待网络请求被捕获..."})]})})]})}function Si(t,r){return r.find(s=>{if(!s.isEnabled)return!1;if(s.matchType==="domain")try{const n=new URL(t.url);return n.hostname===s.matchValue||n.hostname.endsWith("."+s.matchValue)}catch{return!1}if(s.matchType==="urlRegex")try{return new RegExp(s.matchValue).test(t.url)}catch{return!1}return!1})}function jh(t){const r=new Map;for(const s of t){const n=en(s.url)||"unknown";r.has(n)||r.set(n,[]),r.get(n).push(s)}return r}function vh(t){const r=new Map;for(const s of t)try{const n=new URL(s.url),a=n.pathname.split("/").filter(Boolean),i=a.length>0?`${n.hostname}/${a.slice(0,2).join("/")}`:n.hostname;r.has(i)||r.set(i,[]),r.get(i).push(s)}catch{const n="invalid-url";r.has(n)||r.set(n,[]),r.get(n).push(s)}return r}function wh(t,r,s){if(r==="none")return[];const n=r==="domain"?jh(t):vh(t),a=[];for(const[i,o]of n){const l=o.filter(c=>c.duration!==null).map(c=>c.duration);a.push({key:i,label:i,count:o.length,events:o,expanded:s.has(i),avgDuration:l.length>0?l.reduce((c,u)=>c+u,0)/l.length:0,errorCount:o.filter(c=>mr(c.statusCode,c.error,c.errorDescription)).length,mockedCount:o.filter(c=>c.isMocked).length})}return a.sort((i,o)=>o.count-i.count),a}function Nh(t){const r=[];for(let s=0;s<t.length;s++){const n=t[s];r.push({type:"group-header",group:n,index:s}),n.expanded&&n.events.forEach((a,i)=>{r.push({type:"event",event:a,groupKey:n.key,eventIndex:i+1})})}return r}const kh=48,Ch=56;function Sh({events:t,groupMode:r,selectedId:s,onSelect:n,deviceId:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l,showBlacklisted:c=!1}){const u=d.useRef(null),[x,m]=d.useState(new Set),[h,y]=d.useState(null),[p,f]=d.useState(new Set),w=d.useRef({}),{deviceRules:N,rules:E,fetchDeviceRules:S,fetchRules:j}=At();d.useEffect(()=>{a?S(a):j()},[a,S,j]);const k=d.useMemo(()=>a?N:E,[a,N,E]),R=d.useMemo(()=>c||k.length===0?t:t.filter(I=>{const O=Si(I,k);return!O||O.action!=="hide"}),[t,k,c]),D=d.useMemo(()=>{let I=0;for(const O of R)if(typeof O.duration=="number"){const z=O.duration*1e3;z>I&&(I=z)}return I},[R]),{chainMap:F,redirectNextMap:P}=Na(R),U=d.useMemo(()=>wh(R,r,x),[R,r,x]);d.useEffect(()=>{if(r==="none"||U.length===0){w.current={};return}const I={};U.forEach(({key:z,count:H})=>{I[z]=H});const O=new Set;for(const[z,H]of Object.entries(I)){const le=w.current[z]||0;H>le&&le>0&&O.add(z)}O.size>0&&(f(z=>new Set([...z,...O])),setTimeout(()=>{f(z=>{const H=new Set(z);return O.forEach(le=>H.delete(le)),H})},1500)),w.current=I},[U,r]);const K=d.useMemo(()=>Nh(U),[U]),G=wa({count:K.length,getScrollElement:()=>u.current,estimateSize:I=>K[I].type==="group-header"?kh:Ch,overscan:10}),q=d.useCallback(I=>{if(!I)return;const O=U.find(z=>z.events.some(H=>H.id===I));O&&!O.expanded&&m(z=>{const H=new Set(z);return H.add(O.key),H}),y(I),n(I)},[U,n]);d.useEffect(()=>{if(!h)return;if(!U.some(z=>z.events.some(H=>H.id===h))){y(null);return}const O=K.findIndex(z=>z.type==="event"&&z.event.id===h);O>=0&&(G.scrollToIndex(O,{align:"center",behavior:"smooth"}),y(null))},[h,K,G,U]);const C=d.useCallback(I=>{m(O=>{const z=new Set(O);return z.has(I)?z.delete(I):z.add(I),z})},[]),b=d.useCallback(()=>{m(new Set(U.map(I=>I.key)))},[U]),M=d.useCallback(()=>{m(new Set)},[]);if(r==="none")return null;const T=(I,O)=>{i&&l?(O.preventDefault(),l(I.id)):n(I.id)},B=(I,O)=>{const z=p.has(I.key);return e.jsxs("div",{style:O,className:g("flex items-center px-4 py-2 bg-bg-light border-b border-border cursor-pointer hover:bg-bg-lighter",z&&"animate-domain-highlight"),onClick:()=>C(I.key),children:[e.jsx("span",{className:"mr-2 text-text-secondary",children:I.expanded?e.jsx(yt,{size:16}):e.jsx(at,{size:16})}),e.jsx("span",{className:"font-medium text-text-primary flex-1 truncate",children:I.label}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:g("px-2 py-1 bg-bg-medium rounded text-text-secondary",z&&"animate-count-pop"),children:[I.count," 请求"]}),e.jsxs("span",{className:"px-2 py-1 bg-bg-medium rounded text-text-muted",children:["平均 ",zt(I.avgDuration)]}),I.errorCount>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 rounded text-red-400",children:[I.errorCount," 错误"]}),I.mockedCount>0&&e.jsxs("span",{className:"px-2 py-1 bg-purple-500/20 rounded text-purple-400",children:[I.mockedCount," Mock"]})]})]},`group-${I.key}`)},A=(I,O,z)=>{const H=mr(I.statusCode,I.error,I.errorDescription),le=I.id===s,Y=o.has(I.id),V=P.get(I.id),ie=F.get(I.id),Ne=ie&&ie.total>1?`R${ie.index}/${ie.total}`:null,se=I.isMocked,de=Si(I,k),_=de?.action==="highlight",ue=de?.action==="mark",ae=de?.color||(ue?"#60a5fa":void 0);return e.jsxs("div",{style:ue&&ae&&!le?{...O,borderLeftColor:ae}:O,onClick:ee=>T(I,ee),className:g("flex items-center cursor-pointer transition-all duration-150 group border-b border-border-light pl-8",le&&"bg-selected",!le&&Y&&"bg-primary/15",!le&&!Y&&_&&"bg-yellow-500/10 hover:bg-yellow-500/20",!le&&!Y&&!_&&ue&&"border-l-4",!le&&!Y&&!_&&H&&"bg-red-500/5 hover:bg-red-500/10",!le&&!Y&&!_&&!H&&"hover:bg-bg-light/60"),children:[e.jsx("div",{className:g("w-10 flex-shrink-0 flex items-center justify-center text-xs font-mono",le?"text-selected-text-muted":"text-text-muted"),children:z}),e.jsxs("div",{className:"w-6 flex-shrink-0 flex items-center justify-center",children:[_&&e.jsx(ca,{size:12,filled:!0,className:"text-yellow-500"}),ue&&!_&&e.jsx(Yr,{size:12,style:{color:ae}})]}),i&&e.jsx("div",{className:"px-3 py-3.5 w-10 flex-shrink-0 flex items-center justify-center",onClick:ee=>ee.stopPropagation(),children:e.jsx(Ue,{checked:Y,onChange:()=>l?.(I.id)})}),e.jsx("div",{className:g("px-3 py-3.5 w-[90px] flex-shrink-0",le?"text-selected-text-secondary":"text-text-muted"),children:e.jsx("span",{className:"text-sm font-mono",children:ut(I.startTime)})}),e.jsx("div",{className:"px-3 py-3.5 w-[80px] flex-shrink-0",children:e.jsx("span",{className:g("inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-[10px] font-mono font-semibold tracking-wider min-w-[52px]",va(I.method)),children:I.method})}),e.jsx("div",{className:"px-3 py-3.5 w-[70px] flex-shrink-0",children:e.jsx("span",{className:g("inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-[10px] font-mono font-semibold tracking-wider min-w-[44px]",nr(I.statusCode)),children:I.statusCode??"ERR"})}),e.jsx("div",{className:"px-3 py-3.5 flex-1 min-w-0 overflow-hidden",children:e.jsx("span",{className:g("text-sm truncate",le?"text-selected-text-primary font-medium":"text-text-primary"),title:I.url,children:(()=>{try{return new URL(I.url).pathname}catch{return I.url}})()})}),e.jsxs("div",{className:"relative px-3 py-3.5 w-[90px] flex-shrink-0",children:[e.jsx("span",{className:g("text-xs font-mono font-semibold",ya(I.duration)),children:zt(I.duration)}),(()=>{if(typeof I.duration!="number"||D<=0)return null;const ee=I.duration*1e3,me=ee/D;return ee>=100&&me>=.03?e.jsx("div",{className:"absolute left-3 right-3 bottom-2 h-0.5 bg-bg-light/40 rounded-full overflow-hidden pointer-events-none",children:e.jsx("div",{className:g("h-full rounded-full",ja(I.duration)),style:{width:`${Math.min(me,1)*100}%`}})}):null})()]}),e.jsxs("div",{className:"px-3 py-3.5 w-[60px] flex-shrink-0 flex items-center justify-center gap-1",children:[Ne&&e.jsx("span",{className:"text-2xs font-mono text-cyan-400",title:`重定向 ${ie?.index}/${ie?.total}`,children:Ne}),I.redirectFromId&&e.jsx("button",{className:"text-cyan-400 hover:text-cyan-300 transition-colors",title:"跳转到重定向来源",onClick:ee=>{ee.stopPropagation();const me=I.redirectFromId;me&&q(me)},children:e.jsx(or,{size:14})}),!I.redirectFromId&&V&&e.jsx("button",{className:"text-emerald-400 hover:text-emerald-300 transition-colors",title:"跳转到重定向下一跳",onClick:ee=>{ee.stopPropagation(),q(V)},children:e.jsx(Kr,{size:14})}),!I.redirectFromId&&!V&&I.redirectToUrl&&e.jsx("span",{className:"text-cyan-400",title:"已重定向",children:e.jsx(or,{size:14})}),I.isReplay&&e.jsx("span",{className:"text-blue-400",title:"重放请求",children:e.jsx(Gr,{size:14})}),se&&e.jsx("span",{className:"text-purple-400",title:"已 Mock",children:e.jsx(vt,{size:14})}),I.isFavorite&&e.jsx("span",{title:"已收藏",children:e.jsx(Hs,{size:14,filled:!0,className:"text-accent-yellow"})})]})]},I.id)};return e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-bg-medium border-b border-border",children:[e.jsxs("span",{className:"text-sm text-text-secondary",children:[U.length," 个分组，",t.length," 个请求"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-2 py-1 text-xs text-text-muted hover:text-text-secondary hover:bg-bg-light rounded",children:"展开全部"}),e.jsx("button",{onClick:M,className:"px-2 py-1 text-xs text-text-muted hover:text-text-secondary hover:bg-bg-light rounded",children:"收起全部"})]})]}),e.jsx("div",{ref:u,className:"flex-1 overflow-auto",children:K.length>0?e.jsx("div",{style:{height:`${G.getTotalSize()}px`,width:"100%",position:"relative"},children:G.getVirtualItems().map(I=>{const O=K[I.index],z={position:"absolute",top:0,left:0,width:"100%",height:`${I.size}px`,transform:`translateY(${I.start}px)`};return O.type==="group-header"?B(O.group,z):A(O.event,z,O.eventIndex)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-20",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-bg-light/50 flex items-center justify-center mb-4",children:e.jsx(Wd,{size:32,className:"opacity-60"})}),e.jsx("p",{className:"text-sm font-medium text-text-secondary mb-1",children:"暂无 HTTP 请求"}),e.jsx("p",{className:"text-xs text-text-muted",children:"等待网络请求被捕获..."})]})})]})}function tl({data:t,initialExpanded:r=!0,maxInitialDepth:s=2}){return e.jsx("div",{className:"font-mono text-xs",children:e.jsx(sl,{value:t,depth:0,initialExpanded:r,maxInitialDepth:s})})}function sl({keyName:t,value:r,depth:s,initialExpanded:n,maxInitialDepth:a,isLast:i=!0}){const o=n&&s<a,[l,c]=d.useState(o),u=d.useMemo(()=>r===null?"null":Array.isArray(r)?"array":typeof r,[r]),x=u==="object"||u==="array",m=x&&(u==="array"?r.length===0:Object.keys(r).length===0),h=()=>{switch(u){case"string":return e.jsxs("span",{className:"text-emerald-400",children:['"',String(r),'"']});case"number":return e.jsx("span",{className:"text-amber-400",children:String(r)});case"boolean":return e.jsx("span",{className:"text-purple-400",children:String(r)});case"null":return e.jsx("span",{className:"text-gray-500",children:"null"});case"undefined":return e.jsx("span",{className:"text-gray-500",children:"undefined"});default:return null}},y=()=>{const p=u==="array"?r.map((N,E)=>[String(E),N]):Object.entries(r),f=u==="array"?["[","]"]:["{","}"],w=u==="array"?`Array(${r.length})`:`Object(${Object.keys(r).length})`;return m?e.jsxs("span",{className:"text-gray-500",children:[f[0],f[1]]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c(!l),className:"inline-flex items-center hover:bg-bg-light rounded px-0.5 -ml-0.5",children:[e.jsx("span",{className:"w-4 text-center text-gray-500",children:l?"▼":"▶"}),!l&&e.jsx("span",{className:"text-gray-500 ml-1",children:w})]}),l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:f[0]}),e.jsx("div",{className:"pl-4 border-l border-border ml-1",children:p.map(([N,E],S)=>e.jsx(sl,{keyName:u==="array"?void 0:N,value:E,depth:s+1,initialExpanded:n,maxInitialDepth:a,isLast:S===p.length-1},N))}),e.jsx("span",{className:"text-gray-400",children:f[1]})]}):null]})};return e.jsxs("div",{className:g("leading-relaxed",!i&&"mb-0.5"),children:[t!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sky-400",children:t}),e.jsx("span",{className:"text-gray-500",children:": "})]}),x?y():h(),!i&&!l&&e.jsx("span",{className:"text-gray-500",children:","})]})}function Ti({content:t,className:r,initialViewMode:s="raw",treeInitialExpanded:n=!0,treeMaxInitialDepth:a=2,buttonOrder:i="raw-first"}){const[o,l]=d.useState(s),c=d.useMemo(()=>{try{return JSON.parse(t)}catch{return null}},[t]);return c!==null?e.jsxs("div",{className:r,children:[e.jsx("div",{className:"flex gap-2 mb-2",children:i==="tree-first"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l("tree"),className:g("px-2 py-1 text-xs rounded",o==="tree"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"树形"}),e.jsx("button",{onClick:()=>l("raw"),className:g("px-2 py-1 text-xs rounded",o==="raw"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"原始"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l("raw"),className:g("px-2 py-1 text-xs rounded",o==="raw"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"原始"}),e.jsx("button",{onClick:()=>l("tree"),className:g("px-2 py-1 text-xs rounded",o==="tree"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"树形"})]})}),o==="tree"?e.jsx("div",{className:"bg-bg-dark p-3 rounded overflow-x-auto max-h-96 overflow-y-auto",children:e.jsx(tl,{data:c,initialExpanded:n,maxInitialDepth:a})}):e.jsx("pre",{className:"text-xs font-mono bg-bg-dark p-3 rounded overflow-x-auto whitespace-pre-wrap break-all max-h-96 overflow-y-auto",children:JSON.stringify(c,null,2)})]}):e.jsx("pre",{className:g("text-xs font-mono whitespace-pre-wrap break-all",r),children:t})}function Th({timing:t,totalDuration:r}){const s=[{label:"DNS",value:t.dnsLookup,color:"bg-cyan-500",description:"DNS 解析"},{label:"TCP",value:t.tcpConnection,color:"bg-green-500",description:"TCP 连接"},{label:"TLS",value:t.tlsHandshake,color:"bg-purple-500",description:"TLS 握手"},{label:"TTFB",value:t.timeToFirstByte,color:"bg-amber-500",description:"首字节时间"},{label:"Download",value:t.contentDownload,color:"bg-blue-500",description:"内容下载"}],n=s.reduce((l,c)=>l+(c.value||0),0),a=r||n||1,i=l=>{if(l==null)return"-";const c=l*1e3;return c<1?`${Math.round(c*1e3)}µs`:c<1e3?`${Math.round(c)}ms`:`${(c/1e3).toFixed(2)}s`},o=l=>l==null?0:l/a*100;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:s.map(l=>{const c=o(l.value);return l.value===null?null:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 text-xs text-text-muted shrink-0",children:l.label}),e.jsxs("div",{className:"flex-1 h-5 bg-bg-dark rounded overflow-hidden relative",children:[e.jsx("div",{className:`h-full ${l.color} transition-all duration-300`,style:{width:`${Math.max(c,1)}%`}}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs font-mono",children:i(l.value)})]}),e.jsxs("div",{className:"w-12 text-xs text-text-muted text-right shrink-0",children:[c.toFixed(1),"%"]})]},l.label)})}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-border",children:[e.jsx("div",{className:"w-16 text-xs font-medium shrink-0",children:"Total"}),e.jsx("div",{className:"flex-1 text-xs font-mono text-primary",children:i(a)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-border text-xs",children:[t.protocolName&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"协议:"})," ",e.jsx("span",{className:"font-mono text-primary",children:ea(t.protocolName)})]}),t.connectionReused!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"连接复用:"})," ",e.jsx("span",{className:t.connectionReused?"text-green-400":"text-yellow-400",children:t.connectionReused?"是":"否"})]}),t.localAddress&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"本地地址:"})," ",e.jsx("span",{className:"font-mono",children:t.localAddress})]}),t.remoteAddress&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"远程地址:"})," ",e.jsx("span",{className:"font-mono",children:t.remoteAddress})]}),t.requestBodyBytesSent!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"发送:"})," ",e.jsx("span",{className:"font-mono",children:ps(t.requestBodyBytesSent)})]}),t.responseBodyBytesReceived!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"接收:"})," ",e.jsx("span",{className:"font-mono",children:ps(t.responseBodyBytesReceived)})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3 pt-2 border-t border-border",children:s.map(l=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:`w-3 h-3 rounded ${l.color}`}),e.jsx("span",{className:"text-text-muted",children:l.description})]},l.label))})]})}function Eh({base64Data:t,contentType:r,className:s=""}){const[n,a]=d.useState(!1),[i,o]=d.useState(!1),l=d.useMemo(()=>{const c=Mh(r);return c?`data:${c};base64,${t}`:null},[t,r]);return!l||i?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative ${s}`,children:[e.jsx("img",{src:l,alt:"Response preview",className:"image-preview cursor-pointer",onClick:()=>a(!0),onError:()=>o(!0)}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-2",children:[e.jsx("button",{onClick:()=>a(!0),className:"p-1.5 bg-bg-dark/80 rounded-lg hover:bg-bg-dark transition-colors",title:"全屏预览",children:e.jsx(Dh,{className:"w-4 h-4"})}),e.jsx("a",{href:l,download:"response-image",className:"p-1.5 bg-bg-dark/80 rounded-lg hover:bg-bg-dark transition-colors",title:"下载图片",children:e.jsx(Rh,{className:"w-4 h-4"})})]})]}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:()=>a(!1),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 text-white/70 hover:text-white transition-colors",onClick:()=>a(!1),children:e.jsx(Lh,{className:"w-6 h-6"})}),e.jsx("img",{src:l,alt:"Response preview fullscreen",className:"max-w-[90vw] max-h-[90vh] object-contain",onClick:c=>c.stopPropagation()})]})]})}function Ih(t){if(!t)return!1;const r=t.toLowerCase();return r.startsWith("image/")||r.includes("image/png")||r.includes("image/jpeg")||r.includes("image/gif")||r.includes("image/webp")||r.includes("image/svg+xml")||r.includes("image/bmp")||r.includes("image/ico")}function Mh(t){if(!t)return null;const r=t.split(";")[0].trim().toLowerCase();return["image/png","image/jpeg","image/jpg","image/gif","image/webp","image/svg+xml","image/bmp","image/x-icon","image/ico"].some(n=>r.includes(n)||r===n)||r.startsWith("image/")?r:null}function Dh({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}function Rh({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}function Lh({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}function Ei(t){if(!t)return!1;const r=t.toLowerCase();return r.includes("application/x-protobuf")||r.includes("application/protobuf")||r.includes("application/grpc")||r.includes("application/grpc+proto")||r.includes("application/octet-stream")}function Ii(t){const r=atob(t),s=new Uint8Array(r.length);for(let n=0;n<r.length;n++)s[n]=r.charCodeAt(n);return s}function En(t,r){let s=0n,n=0n,a=0;for(;r+a<t.length;){const i=t[r+a];if(s|=BigInt(i&127)<<n,a++,(i&128)===0)break;if(n+=7n,a>10)throw new Error("Varint too long")}return{value:s,bytesRead:a}}function rl(t){const r=[],s=[];let n=0;for(;n<t.length;)try{const a=n,{value:i,bytesRead:o}=En(t,n);n+=o;const l=Number(i>>3n),c=Number(i&0x7n);if(l===0){s.push(`Invalid field number 0 at offset ${a}`);break}let u,x;switch(c){case 0:{const{value:m,bytesRead:h}=En(t,n);u=m,n+=h,x=n-a;break}case 1:{if(n+8>t.length)throw new Error("Unexpected end of data for Fixed64");u=new DataView(t.buffer,t.byteOffset+n,8).getBigUint64(0,!0),n+=8,x=n-a;break}case 2:{const{value:m,bytesRead:h}=En(t,n);n+=h;const y=Number(m);if(n+y>t.length)throw new Error(`Length-delimited field extends beyond data: ${y} bytes at offset ${n}`);const p=t.slice(n,n+y);u=Ph(p),n+=y,x=n-a;break}case 5:{if(n+4>t.length)throw new Error("Unexpected end of data for Fixed32");u=new DataView(t.buffer,t.byteOffset+n,4).getUint32(0,!0),n+=4,x=n-a;break}case 3:case 4:s.push(`Deprecated wire type ${c} at field ${l}`),n=t.length,x=0;break;default:throw new Error(`Unknown wire type ${c}`)}r.push({fieldNumber:l,wireType:c,value:u,rawBytes:t.slice(a,n),offset:a,length:x})}catch(a){s.push(`Parse error at offset ${n}: ${a instanceof Error?a.message:String(a)}`);break}return{fields:r,errors:s}}function Ph(t){try{const s=new TextDecoder("utf-8",{fatal:!0}).decode(t);if(Oh(s))return{type:"string",value:s}}catch{}if(t.length>0)try{const r=rl(t);if(r.fields.length>0&&r.errors.length===0&&r.fields.reduce((n,a)=>n+a.length,0)===t.length)return{type:"nested",value:r.fields}}catch{}return{type:"bytes",value:t}}function Oh(t){if(t.length===0)return!1;let r=0;for(const s of t){const n=s.charCodeAt(0);(n>=32&&n<127||n>127)&&r++}return r/t.length>.9}function Ah(t,r=32){const s=Array.from(t.slice(0,r)).map(n=>n.toString(16).padStart(2,"0")).join(" ");return t.length>r?`${s} ... (${t.length} bytes)`:s}function Fh(t){const r=Number(t),s=[];s.push(`uint: ${t}`);const n=Number(t>>1n^-(t&1n));if(n!==r&&s.push(`sint: ${n}`),(t===0n||t===1n)&&s.push(`bool: ${t===1n}`),r>1e9&&r<2e9){const a=new Date(r*1e3);s.push(`timestamp(s): ${a.toISOString()}`)}else if(r>1e12&&r<2e12){const a=new Date(r);s.push(`timestamp(ms): ${a.toISOString()}`)}return e.jsx("span",{className:"text-xs",children:s.map((a,i)=>e.jsx("span",{className:i===0?"text-green-400":"text-text-muted ml-2",children:a},i))})}function zh(t){switch(t){case 0:return"Varint";case 1:return"Fixed64";case 2:return"Length-Delimited";case 5:return"Fixed32";case 3:return"StartGroup (deprecated)";case 4:return"EndGroup (deprecated)";default:return"Unknown"}}function ta({base64Data:t,contentType:r,className:s}){const[n,a]=d.useState(new Set),[i,o]=d.useState("parsed"),l=d.useMemo(()=>{try{const x=Ii(t);return rl(x)}catch(x){return{fields:[],errors:[`Failed to decode base64: ${x instanceof Error?x.message:String(x)}`]}}},[t]),c=d.useMemo(()=>{try{return Ii(t)}catch{return new Uint8Array}},[t]),u=x=>{const m=new Set(n);m.has(x)?m.delete(x):m.add(x),a(m)};return e.jsxs("div",{className:g("bg-bg-dark rounded-lg overflow-hidden",s),children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-bg-darker border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-medium text-purple-400 flex items-center gap-1",children:[e.jsx(Bt,{size:14})," Protobuf"]}),r&&e.jsx("span",{className:"text-xs text-text-muted",children:r}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",c.length," bytes)"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>o("parsed"),className:g("px-2 py-1 text-xs rounded transition-colors",i==="parsed"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-primary"),children:"Parsed"}),e.jsx("button",{onClick:()=>o("hex"),className:g("px-2 py-1 text-xs rounded transition-colors",i==="hex"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-primary"),children:"Hex"})]})]}),e.jsxs("div",{className:"p-3 max-h-96 overflow-auto",children:[l.errors.length>0&&e.jsx("div",{className:"mb-3 p-2 bg-red-500/10 border border-red-500/30 rounded text-xs text-red-400",children:l.errors.map((x,m)=>e.jsx("div",{children:x},m))}),i==="parsed"?l.fields.length>0?e.jsx(nl,{fields:l.fields,expandedFields:n,toggleField:u}):e.jsx("div",{className:"text-text-muted text-xs",children:"无法解析为有效的 Protobuf 消息"}):e.jsx(Bh,{bytes:c})]})]})}function nl({fields:t,expandedFields:r,toggleField:s,prefix:n=""}){return e.jsx("div",{className:"space-y-1 font-mono text-xs",children:t.map((a,i)=>{const o=`${n}${a.fieldNumber}-${i}`,l=r.has(o),c=typeof a.value=="object"&&a.value!==null&&"type"in a.value&&a.value.type==="nested";return e.jsxs("div",{className:"border-l-2 border-border pl-2",children:[e.jsxs("div",{className:g("flex items-start gap-2 py-1",c&&"cursor-pointer hover:bg-bg-lighter rounded"),onClick:c?()=>s(o):void 0,children:[c&&e.jsx("span",{className:"text-text-muted",children:l?"▼":"▶"}),e.jsxs("span",{className:"text-yellow-400",children:["field ",a.fieldNumber]}),e.jsxs("span",{className:"text-text-muted",children:["(",zh(a.wireType),")"]}),e.jsx("span",{className:"text-text-muted",children:"="}),e.jsx($h,{field:a,expanded:l})]}),c&&l&&e.jsx("div",{className:"ml-4 mt-1",children:e.jsx(nl,{fields:a.value.value,expandedFields:r,toggleField:s,prefix:`${o}-`})})]},o)})})}function $h({field:t,expanded:r}){const{wireType:s,value:n}=t;if(s===0)return Fh(n);if(s===5){const a=n,i=new DataView(new Uint32Array([a]).buffer).getFloat32(0,!0);return e.jsxs("span",{className:"text-xs",children:[e.jsxs("span",{className:"text-green-400",children:["uint32: ",a]}),!isNaN(i)&&isFinite(i)&&e.jsxs("span",{className:"text-text-muted ml-2",children:["float: ",i.toFixed(4)]})]})}if(s===1){const a=n;return e.jsx("span",{className:"text-xs",children:e.jsxs("span",{className:"text-green-400",children:["uint64: ",a.toString()]})})}if(s===2&&typeof n=="object"&&n!==null&&"type"in n){const a=n;if(a.type==="string"){const i=String(a.value);return e.jsxs("span",{className:"text-green-400",children:['"',i.length>100?i.slice(0,100)+"...":i,'"']})}if(a.type==="nested"){const i=a.value;return r?null:e.jsx("span",{className:"text-blue-400",children:`{ ${i.length} fields }`})}if(a.type==="bytes"){const i=a.value;return e.jsxs("span",{className:"text-text-muted",children:["[",Ah(i),"]"]})}}return e.jsx("span",{className:"text-text-muted",children:"?"})}function Bh({bytes:t}){const r=[];for(let n=0;n<t.length;n+=16){const a=t.slice(n,n+16),i=Array.from(a).map(l=>l.toString(16).padStart(2,"0")).join(" "),o=Array.from(a).map(l=>l>=32&&l<127?String.fromCharCode(l):".").join("");r.push(e.jsxs("div",{className:"flex gap-4 font-mono text-xs",children:[e.jsx("span",{className:"text-text-muted w-12",children:n.toString(16).padStart(8,"0")}),e.jsx("span",{className:"text-green-400 flex-1",children:i.padEnd(47," ")}),e.jsx("span",{className:"text-yellow-400",children:o})]},n))}return e.jsx("div",{className:"space-y-0.5",children:r})}const _h=1024*1024,Wh=4096,Hh=5*1024*1024;function Uh(t){return t.length>=2&&t[0]===31&&t[1]===139}function Vh(t){if(t.length<2)return!1;const r=t[0],s=t[1];return r!==120?!1:s===1||s===156||s===218}function qh(t){if(t.length<4)return!1;const r=t[0]>>1&127;return r>=10&&r<=24?!t.slice(0,Math.min(4,t.length)).every(n=>n>=32&&n<=126||n===9||n===10||n===13):t[0]===27||t[0]===11||t[0]===129}function Gh(t,r,s){if(!s)return!0;switch(t){case"gzip":return Uh(r);case"deflate":return Vh(r);case"br":return qh(r);default:return!0}}const Yh=["application/json","application/ld+json","application/problem+json","application/vnd.api+json","application/xml","application/problem+xml","application/xhtml+xml","application/javascript","application/x-javascript","application/graphql","application/x-www-form-urlencoded","image/svg+xml"],Kh=["application/octet-stream","application/zip","application/x-zip-compressed","application/gzip","application/x-gzip","application/x-tar","application/x-bzip2","application/x-7z-compressed","application/x-rar-compressed","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-fontobject","font/woff","font/woff2","font/ttf","font/otf","application/font-woff","application/font-woff2","application/x-font-ttf","application/x-font-otf","application/protobuf","application/x-protobuf","application/vnd.google.protobuf","application/grpc","application/grpc+proto","application/grpc-web+proto","application/msgpack","application/x-msgpack","application/vnd.msgpack","application/cbor","application/thrift","application/x-thrift","application/avro","application/flatbuffers","application/x-sqlite3","application/vnd.sqlite3","application/wasm","application/x-shockwave-flash","application/java-archive","application/x-java-archive"];function Pt(t,r){if(!t)return null;const s=r.toLowerCase();for(const[n,a]of Object.entries(t))if(n.toLowerCase()===s)return a;return null}function ds(t){if(!t)return{mimeType:null,charset:null};const[r,...s]=t.split(";"),n=r.trim().toLowerCase();let a=null;for(const i of s){const[o,l]=i.split("=").map(c=>c.trim());if(o&&l&&o.toLowerCase()==="charset"){a=l.replace(/^"|"$/g,"").toLowerCase();break}}return{mimeType:n,charset:a}}function Jh(t){if(!t)return!1;const{mimeType:r}=ds(t);return r?r.startsWith("text/")||r.endsWith("+json")||r.endsWith("+xml")?!0:Yh.includes(r):!1}function Xh(t){if(!t)return!1;const{mimeType:r}=ds(t);return r?r.startsWith("image/")&&r!=="image/svg+xml"||r.startsWith("audio/")||r.startsWith("video/")?!0:Kh.includes(r):!1}function al(t){const r=t.trim(),s=r.endsWith("==")?2:r.endsWith("=")?1:0;return Math.max(0,Math.floor(r.length*3/4)-s)}function sr(t,r){let s=t;if(r!==void 0){const i=Math.ceil(r/3)*4;s=t.slice(0,i)}const n=atob(s),a=new Uint8Array(n.length);for(let i=0;i<n.length;i++)a[i]=n.charCodeAt(i);return a}function In(t,r){const s=r||"utf-8";try{return new TextDecoder(s).decode(t)}catch{return new TextDecoder("utf-8").decode(t)}}function Qh(t){if(t.length===0)return!0;let r=0,s=0,n=0,a=0;for(;a<t.length;){const i=t[a];if(i===0)return!1;if(i===9||i===10||i===13){r++,a++;continue}if(i>=32&&i<=126){r++,a++;continue}if(i>=128){const o=Zh(t,a);o.valid?(r+=o.length,a+=o.length):(n++,a++);continue}s++,a++}return n>t.length*.05?!1:s/t.length<.1&&r/t.length>.7}function Zh(t,r){const s=t[r];if((s&224)===192)return r+1>=t.length?{valid:!1,length:1}:(t[r+1]&192)!==128?{valid:!1,length:1}:(s&30)===0?{valid:!1,length:1}:{valid:!0,length:2};if((s&240)===224){if(r+2>=t.length)return{valid:!1,length:1};if((t[r+1]&192)!==128)return{valid:!1,length:1};if((t[r+2]&192)!==128)return{valid:!1,length:1};const n=(s&15)<<12|(t[r+1]&63)<<6|t[r+2]&63;return n<2048||n>=55296&&n<=57343?{valid:!1,length:1}:{valid:!0,length:3}}if((s&248)===240){if(r+3>=t.length)return{valid:!1,length:1};if((t[r+1]&192)!==128)return{valid:!1,length:1};if((t[r+2]&192)!==128)return{valid:!1,length:1};if((t[r+3]&192)!==128)return{valid:!1,length:1};const n=(s&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63;return n<65536||n>1114111?{valid:!1,length:1}:{valid:!0,length:4}}return{valid:!1,length:1}}function ep(t){if(!t)return null;const r=t.match(/filename\*=([^']*)''([^;]+)/i);if(r&&r[2])try{return decodeURIComponent(r[2])}catch{return r[2]}return t.match(/filename="?([^";]+)"?/i)?.[1]??null}function tp(t){return t?t.split(",").map(r=>r.trim().toLowerCase()).filter(r=>r.length>0&&r!=="identity"):[]}async function sp(t,r){const s=t.getReader(),n=[];let a=0,i=!1;for(;;){const c=await s.read();if(c.done)break;const u=c.value;if(a+=u.length,a>r){const x=r-(a-u.length);x>0&&n.push(u.slice(0,x)),i=!0;try{await s.cancel()}catch{}break}n.push(u)}const o=new Uint8Array(n.reduce((c,u)=>c+u.length,0));let l=0;for(const c of n)o.set(c,l),l+=c.length;return{bytes:o,truncated:i}}function Ir(t,r,s,n,a){const i=new Error(t);return i.name="DecompressError",i.encoding=r,i.originalSize=s,i.decompressedSoFar=n,a&&(i.cause=a),i}async function rp(t,r,s){const n=globalThis.DecompressionStream;if(!n)throw Ir("当前浏览器不支持 DecompressionStream API",r.join(", "),t.length,0);const a=["gzip","br","deflate"];let i=t,o=!1;for(let l=r.length-1;l>=0;l--){const c=r[l];if(!a.includes(c))throw Ir(`不支持的压缩编码: ${c}`,c,i.length,0);try{const u=new n(c),x=new Blob([i]).stream().pipeThrough(u),m=await sp(x,s);if(m.bytes.length===0&&i.length>0)throw Ir(`${c} 解压后数据为空，可能是数据损坏或编码不匹配`,c,i.length,0);i=m.bytes,o=o||m.truncated}catch(u){if(u.name==="DecompressError")throw u;const x=u instanceof Error?u.message:String(u);throw Ir(`${c} 解压失败: ${x}`,c,i.length,0,u)}}return{bytes:i,truncated:o}}async function Mi(t,r,s){const n=s?.contentType??Pt(r,"content-type"),a=Pt(r,"content-encoding"),i=Pt(r,"content-length"),o=i?parseInt(i,10):NaN,l=Number.isFinite(o)?o:t?al(t):0,c=s?.maxPreviewBytes??_h;if(!t)return{kind:"empty",size:l||0,contentType:n,contentEncoding:a};const u=Jh(n),x=Xh(n),m=sr(t,Math.min(Wh,c)),h=Qh(m);if(x&&!u&&!h)return{kind:"binary",size:l,contentType:n,contentEncoding:a};if(u&&!h)return{kind:"binary",size:l,contentType:n,contentEncoding:a,warning:"Content-Type 标记为文本，但内容看起来是二进制"};if(!(u||h))return{kind:"binary",size:l,contentType:n,contentEncoding:a,warning:"内容类型未知，按二进制处理"};let p=sr(t,c),f=l>p.length,w;x&&!u&&h&&(w="内容类型标记为二进制，但内容像文本，已按文本展示");const N=tp(a);if(N.length>0){if(l>Hh)return{kind:"binary",size:l,contentType:n,contentEncoding:a,warning:"压缩内容过大，已跳过解压，请下载查看"};const j=N[N.length-1];if(!Gh(j,m,h)){const{charset:k}=ds(n),R=sr(t,c),D=l>R.length,F=In(R,k),P=D?`内容过大，仅显示前 ${Math.round(R.length/1024)} KB`:void 0;return{kind:"text",size:l,contentType:n,contentEncoding:a,text:F,truncated:D,warning:P}}try{p=sr(t),f=!1;const k=await rp(p,N,c);p=k.bytes,f=f||k.truncated}catch{if(h){const{charset:R}=ds(n),D=In(p,R);return{kind:"text",size:l,contentType:n,contentEncoding:a,text:D,warning:"响应体标记为压缩，但解压失败，已按原始文本展示"}}return{kind:"binary",size:l,contentType:n,contentEncoding:a,warning:"响应体已压缩，当前环境无法解压，请下载查看"}}}const{charset:E}=ds(n),S=In(p,E);if(f){const j=`内容过大，仅显示前 ${Math.round(p.length/1024)} KB`;w=w?`${w}；${j}`:j}return{kind:"text",size:l,contentType:n,contentEncoding:a,text:S,truncated:f,warning:w}}function Di({base64Data:t,contentType:r,contentEncoding:s,size:n,filename:a,url:i,suggestedName:o,warning:l}){const[c,u]=d.useState(!1),{mimeType:x}=ds(r),m=n??al(t),h=np({filename:a,url:i,contentType:r,suggestedName:o}),y=()=>{u(!0);try{const p=sr(t),f=new Blob([p],{type:x||"application/octet-stream"}),w=URL.createObjectURL(f),N=document.createElement("a");N.href=w,N.download=h,N.click(),URL.revokeObjectURL(w)}finally{u(!1)}};return e.jsxs("div",{className:"border border-border rounded-lg p-3 bg-bg-dark",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-text-primary",children:"二进制内容"}),e.jsxs("div",{className:"text-xs text-text-muted mt-1 space-y-0.5",children:[e.jsxs("div",{children:["类型: ",e.jsx("span",{className:"font-mono",children:x??"unknown"})]}),s&&e.jsxs("div",{children:["编码: ",e.jsx("span",{className:"font-mono",children:s})]}),e.jsxs("div",{children:["大小: ",e.jsx("span",{className:"font-mono",children:ps(m)})]}),a&&e.jsxs("div",{children:["文件名: ",e.jsx("span",{className:"font-mono",children:a})]})]})]}),e.jsx("button",{onClick:y,className:"px-2 py-1 text-xs bg-bg-light border border-border-subtle rounded hover:bg-bg-lighter transition-colors",disabled:c,title:"下载文件",children:c?"下载中...":"下载"})]}),l&&e.jsx("div",{className:"mt-2 text-xs text-yellow-400",children:l})]})}function np({filename:t,url:r,contentType:s,suggestedName:n}){const a=op(s);let i=ip(t||ap(r)||n||`download-${Date.now()}`);if(i||(i=`download-${Date.now()}`),!Ri(i)&&a&&(i=`${i}.${a}`),i.length>120){const o=i.slice(0,120);i=Ri(o)||!a?o:`${o}.${a}`}return i}function ap(t){if(!t)return null;try{const s=new URL(t).pathname.split("/").filter(Boolean).pop();return s?decodeURIComponent(s):null}catch{return null}}function ip(t){return t.replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g," ").trim()}function Ri(t){const r=t.lastIndexOf(".");return r>0&&r<t.length-1}function op(t){if(!t)return null;const{mimeType:r}=ds(t);if(!r)return null;const s={"application/json":"json","application/ld+json":"json","application/problem+json":"json","application/xml":"xml","application/xhtml+xml":"html","application/javascript":"js","application/x-javascript":"js","application/graphql":"graphql","application/x-www-form-urlencoded":"txt","text/plain":"txt","text/html":"html","text/css":"css","text/csv":"csv","text/xml":"xml","application/pdf":"pdf","application/zip":"zip","application/x-zip-compressed":"zip","application/gzip":"gz","application/octet-stream":"bin","image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/webp":"webp","image/svg+xml":"svg","image/bmp":"bmp","image/x-icon":"ico","image/ico":"ico","audio/mpeg":"mp3","audio/wav":"wav","audio/ogg":"ogg","video/mp4":"mp4","video/webm":"webm"};return s[r]?s[r]:r.startsWith("text/")?"txt":(r.startsWith("image/")||r.startsWith("audio/")||r.startsWith("video/"))&&r.split("/")[1]||null}function Mn(t){try{const r=new URL(t);return{domain:r.host,path:r.pathname||"/",query:r.search||""}}catch{return{domain:"",path:t,query:""}}}function lp({event:t,deviceId:r,onShowRelatedLogs:s,onFavoriteChange:n,mockRules:a=[],onEditMockRule:i,onCreateMockFromRequest:o}){const[l,c]=d.useState("response"),[u,x]=d.useState(null),[m,h]=d.useState(!1),[y,p]=d.useState(!1),[f,w]=d.useState(null),[N,E]=d.useState(!1),[S,j]=d.useState(!1),[k,R]=d.useState(!1),[D,F]=d.useState(!1),[P,U]=d.useState(!1),[K,G]=d.useState(!1),[q,C]=d.useState(null),[b,M]=d.useState(null),[T,B]=d.useState(!1),[A,I]=d.useState(!1),[O,z]=d.useState("prev"),[H,le]=d.useState(null),[Y,V]=d.useState(!1),[ie,Ne]=d.useState(null),[se,de]=d.useState(!1),[,_]=d.useState({}),{isFavorite:ue,toggleFavorite:ae}=Vr(),ee=t?ue(r,t.url):!1;d.useEffect(()=>he.subscribe(()=>_({})),[_]);const me=Pe(te=>te.isPluginEnabled(we.MOCK)),Ce=he.isPluginEnabled(we.MOCK)&&me,Fe=Ze(te=>te.events),{chainMap:et,eventMap:ze}=Na(Fe),re=t?et.get(t.id):void 0,Se=d.useMemo(()=>{let te=0;for(const Te of Fe)if(typeof Te.duration=="number"){const Ke=Te.duration*1e3;Ke>te&&(te=Ke)}return te},[Fe]),L=d.useMemo(()=>{if(!t)return null;const te=re?.chainIds;if(te&&te.length>0){const Te=te[te.length-1];return ze.get(Te)??null}return ze.get(t.id)??null},[t,re,ze]),Q=d.useMemo(()=>{if(!t)return null;const te=re?.chainIds;if(!te||te.length===0)return t.duration??null;let Te=0,Ke=!1;for(const rs of te){const jr=ze.get(rs)?.duration;typeof jr=="number"&&(Te+=jr,Ke=!0)}return Ke?Te:null},[t,re,ze]),Z=!!(re?.prevId||re?.nextId),J=O==="prev"?re?.prevId:re?.nextId,be=d.useMemo(()=>J?ze.get(J)??null:null,[J,ze]);d.useEffect(()=>{re&&(O==="prev"&&!re.prevId&&re.nextId&&z("next"),O==="next"&&!re.nextId&&re.prevId&&z("prev"))},[re,O]),d.useEffect(()=>{l==="diff"&&!Z&&c("response")},[l,Z]),d.useEffect(()=>{le(null),Ne(null),V(!1)},[t?.id]),d.useEffect(()=>{le(null),Ne(null)},[J]),d.useEffect(()=>{if(l!=="diff"||!J||H?.id===J)return;let te=!1;return V(!0),Ne(null),io(r,J).then(Te=>{te||le(Te)}).catch(()=>{te||Ne("加载失败")}).finally(()=>{te||V(!1)}),()=>{te=!0}},[l,J,r,H?.id]);const Ie=d.useMemo(()=>{if(q?.kind!=="text"||!q.text)return"";try{return JSON.stringify(JSON.parse(q.text),null,2)}catch{return q.text}},[q]),ye=d.useMemo(()=>{if(b?.kind!=="text"||!b.text)return"";try{return JSON.stringify(JSON.parse(b.text),null,2)}catch{return b.text}},[b]),je=Pt(t?.responseHeaders??null,"content-type"),$e=Pt(t?.responseHeaders??null,"content-encoding"),_e=!!($e&&$e.toLowerCase()!=="identity"),We=ep(Pt(t?.responseHeaders??null,"content-disposition")),mt=Ih(je),He=Ei(je),Xe=mt&&!_e,Nt=He&&!_e,tt=!!(t?.responseBody&&!Xe&&!Nt&&!b&&!A),Et=Pt(t?.requestHeaders??null,"content-type"),kt=Pt(t?.requestHeaders??null,"content-encoding"),ht=Ei(Et),oe=!!(t?.requestBody&&!ht&&!q&&!T);if(d.useEffect(()=>{let te=!1;if(!t?.requestBody||ht){C(null),B(!1);return}return C(null),B(!0),Mi(t.requestBody,t.requestHeaders,{contentType:Et}).then(Te=>{te||C(Te)}).finally(()=>{te||B(!1)}),()=>{te=!0}},[t?.requestBody,t?.requestHeaders,Et,kt,ht]),d.useEffect(()=>{G(!1),x(null),p(!1)},[t?.id]),d.useEffect(()=>{let te=!1;if(!t?.responseBody||Xe||Nt){M(null),I(!1);return}return M(null),I(!0),Mi(t.responseBody,t.responseHeaders,{contentType:je}).then(Te=>{te||M(Te)}).finally(()=>{te||I(!1)}),()=>{te=!0}},[t?.responseBody,t?.responseHeaders,je,$e,Xe,Nt]),!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("span",{className:"text-4xl mb-3 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:"选择一个请求查看详情"})]});const pt=async()=>{if(u){await rt(u),p(!0),setTimeout(()=>p(!1),2e3);return}h(!0);try{const te=await sc(r,t.id);x(te.curl),await rt(te.curl),p(!0),setTimeout(()=>p(!1),2e3)}catch(te){console.error("Failed to generate cURL:",te)}finally{h(!1)}},ys=async()=>{w("发送中...");try{const te=await rc(r,t.id);w(te.success?"✓ 已发送":"✗ 失败"),setTimeout(()=>w(null),3e3)}catch{w("✗ 失败"),setTimeout(()=>w(null),3e3)}},js=()=>{if(!t)return;const te=ae(r,t.url);n?.(t.id,te)},br=async()=>{await rt(t.url),E(!0),setTimeout(()=>E(!1),2e3)},ft=async()=>{const{domain:te}=Mn(t.url);te&&(await rt(te),j(!0),setTimeout(()=>j(!1),2e3))},Vs=async()=>{const{path:te}=Mn(t.url);te&&(await rt(te),R(!0),setTimeout(()=>R(!1),2e3))},an=async()=>{ye&&(await rt(ye),F(!0),setTimeout(()=>F(!1),2e3))},on=async()=>{Ie&&(await rt(Ie),U(!0),setTimeout(()=>U(!1),2e3))},Oe=Mn(t.url),It=(()=>{const te=Object.entries(t.queryItems??{});if(te.length>0)return te;if(!Oe.query)return[];const Te=new URLSearchParams(Oe.query.startsWith("?")?Oe.query.slice(1):Oe.query);return Array.from(Te.entries())})(),qs=It.length,gt=re&&re.total>1?`${re.index}/${re.total}`:null,Gs=L?.statusCode??t.statusCode,Ys=(te,Te)=>{if(!te)return null;const Ke=te.trim();if(!Ke)return null;try{return new URL(Ke,Te).toString()}catch{return Ke}},Ks=Ys(Pt(t.responseHeaders??null,"Location"),t.url),ss=Ys(t.redirectToUrl,t.url)??Ks,vs=!!(re&&re.total>1),yr=L?.url??t.url,Wt=ss&&(yr===t.url||!vs)?ss:L?.url??ss??t.url,ln=re&&re.total>1?zt(Q):zt(t.duration),Ht=t.error?.message??t.errorDescription;return e.jsxs("div",{className:"h-full overflow-auto",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4 bg-bg-dark border-b border-border",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-xs text-text-muted shrink-0",children:"域名"}),e.jsx("span",{className:"text-sm font-mono text-text-primary truncate max-w-[260px]",title:Oe.domain||"-",children:Oe.domain||"-"}),e.jsx("span",{className:"text-xs text-text-muted shrink-0",children:"路径"}),e.jsx("span",{className:"text-sm font-mono text-text-primary truncate flex-1",title:Oe.path||"/",children:Oe.path||"/"}),qs>0&&e.jsxs("button",{type:"button",onClick:()=>G(te=>!te),className:g("text-xs font-mono shrink-0 whitespace-nowrap underline decoration-dotted underline-offset-4 transition-colors",K?"text-primary":"text-text-muted hover:text-text-primary"),title:K?"收起查询参数":"展开查询参数","aria-expanded":K,children:["参数 +",qs]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-px bg-border-subtle"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs pt-2",children:[e.jsxs("button",{onClick:br,className:"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-bg-light border border-border-subtle text-text-muted hover:text-text-primary hover:bg-bg-lighter transition-colors leading-none whitespace-nowrap",title:"复制完整 URL",children:[N?e.jsx(Re,{size:12}):e.jsx(dt,{size:12}),e.jsx("span",{children:N?"已复制 URL":"复制 URL"})]}),e.jsxs("button",{onClick:ft,className:"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-bg-light border border-border-subtle text-text-muted hover:text-text-primary hover:bg-bg-lighter transition-colors leading-none whitespace-nowrap max-w-[240px]",title:Oe.domain||"域名",children:[S?e.jsx(Re,{size:12,className:"shrink-0"}):e.jsx(dt,{size:12,className:"shrink-0"}),e.jsx("span",{className:"text-text-muted shrink-0 whitespace-nowrap",children:"域名"}),e.jsx("span",{className:"font-mono text-text-primary truncate min-w-0",children:Oe.domain||"-"})]}),e.jsxs("button",{onClick:Vs,className:"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-bg-light border border-border-subtle text-text-muted hover:text-text-primary hover:bg-bg-lighter transition-colors leading-none whitespace-nowrap max-w-[320px]",title:Oe.path||"路径",children:[k?e.jsx(Re,{size:12,className:"shrink-0"}):e.jsx(dt,{size:12,className:"shrink-0"}),e.jsx("span",{className:"text-text-muted shrink-0 whitespace-nowrap",children:"路径"}),e.jsx("span",{className:"font-mono text-text-primary truncate min-w-0",children:Oe.path||"/"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-xs",children:[e.jsx("button",{onClick:pt,disabled:m,className:"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-bg-light border border-border-subtle text-text-muted hover:text-text-primary hover:bg-bg-lighter transition-colors leading-none whitespace-nowrap disabled:opacity-50",children:m?"生成中...":y?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:12,className:"mr-1"})," 已复制 cURL"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:12,className:"mr-1"})," 复制 cURL"]})}),e.jsx("button",{onClick:ys,disabled:f!==null,className:"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-bg-light border border-border-subtle text-text-muted hover:text-text-primary hover:bg-bg-lighter transition-colors leading-none whitespace-nowrap disabled:opacity-50",children:f||e.jsxs(e.Fragment,{children:[e.jsx(To,{size:12,className:"mr-1"})," 重放请求"]})}),o&&Ce&&e.jsxs("button",{onClick:()=>o(t.url,t.method,t.responseBody??void 0,t.responseHeaders??void 0),className:"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-purple-500/20 border border-purple-500/30 text-purple-400 hover:bg-purple-500/30 transition-colors leading-none whitespace-nowrap",children:[e.jsx(vt,{size:12,className:"mr-1"})," 创建 Mock 规则"]})]}),K&&qs>0&&e.jsx("div",{className:"mt-2 bg-bg-base/60 border border-border rounded-lg p-2 space-y-1",children:It.map(([te,Te],Ke)=>e.jsxs("div",{className:"flex items-start gap-2 text-2xs font-mono",children:[e.jsx("span",{className:"text-text-muted",children:te}),e.jsx("span",{className:"text-text-primary break-all",children:Te||"-"})]},`${te}-${Ke}`))}),t.redirectFromId&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs",children:[e.jsx("span",{className:"text-text-muted w-12",children:"来源"}),e.jsx("span",{className:"font-mono text-text-primary flex-1 truncate",children:t.redirectFromId})]}),ss&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs",children:[e.jsx("span",{className:"text-text-muted w-12",children:"重定向"}),e.jsx("span",{className:"font-mono text-text-primary flex-1 truncate",children:ss})]})]})]}),e.jsx("button",{onClick:js,className:g("p-1.5 rounded transition-colors",ee?"text-yellow-400 hover:text-yellow-300":"text-text-muted hover:text-yellow-400"),title:ee?"取消收藏（URL 级别）":"收藏（URL 级别）",children:ee?e.jsx(up,{className:"w-5 h-5"}):e.jsx(xp,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-px bg-border-subtle"}),e.jsxs("div",{className:"pt-2 flex flex-wrap items-center gap-x-2 gap-y-2 mb-0",children:[e.jsx("span",{className:g("inline-flex items-center justify-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none min-w-[40px] cursor-default select-none",va(t.method)),children:t.method}),e.jsx("span",{className:g("inline-flex items-center justify-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none min-w-[40px] cursor-default select-none",nr(t.statusCode)),children:t.statusCode??"ERR"}),gt&&e.jsxs("span",{className:"inline-flex items-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none bg-cyan-500/15 text-cyan-300 border border-cyan-500/20 cursor-default select-none",children:["重定向 ",gt]}),e.jsxs("div",{className:g("relative inline-flex items-center h-6 px-2 rounded-full border border-border-subtle bg-bg-light min-w-[56px] cursor-default select-none",ya(t.duration)),children:[e.jsx("span",{className:g("text-[10px] font-mono font-medium leading-none"),children:zt(t.duration)}),(()=>{if(typeof t.duration!="number"||Se<=0)return null;const te=t.duration*1e3,Te=te/Se;return te>=100&&Te>=.03?e.jsx("div",{className:"absolute left-2 right-2 bottom-0.5 h-0.5 bg-bg-light/40 rounded-full overflow-hidden pointer-events-none",children:e.jsx("div",{className:g("h-full rounded-full",ja(t.duration)),style:{width:`${Math.min(Te,1)*100}%`}})}):null})()]}),t.isReplay&&e.jsxs("span",{className:"inline-flex items-center justify-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none bg-blue-500/15 text-blue-300 border border-blue-500/20 cursor-default select-none",children:[e.jsx(Gr,{size:12,className:"mr-1"})," Replay"]}),t.timing?.protocolName&&e.jsx("span",{className:g("inline-flex items-center justify-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none cursor-default select-none",nr(t.statusCode)),children:ea(t.timing.protocolName)})]})]}),(t.isMocked||t.timing?.connectionReused)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2 text-xs",children:[t.isMocked&&e.jsx(el,{url:t.url,mockRuleId:t.mockRuleId,rules:a,onEditRule:i,children:e.jsxs("span",{className:"inline-flex items-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none bg-yellow-500/15 text-yellow-300 border border-yellow-500/20 cursor-pointer hover:bg-yellow-500/20 transition-colors",children:[e.jsx(vt,{size:12,className:"mr-1"})," Mocked"]})}),t.timing?.connectionReused&&e.jsx("span",{className:"inline-flex items-center h-6 px-2 rounded-full text-[10px] font-mono font-medium tracking-wider leading-none bg-green-500/15 text-green-300 border border-green-500/20 cursor-default select-none",children:"复用连接"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-px bg-border-subtle"}),e.jsxs("div",{className:"pt-2 mb-0",children:[e.jsxs("button",{type:"button",onClick:()=>de(te=>!te),className:"flex items-center gap-1 text-xs text-text-muted hover:text-text-primary transition-colors mb-0","aria-expanded":se,children:[se?e.jsx(yt,{size:14}):e.jsx(at,{size:14}),"摘要"]}),se&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs mt-2 bg-bg-base/60 border border-border rounded-lg p-3",children:[e.jsx(lt,{label:"最终状态",children:e.jsx("span",{className:g("inline-flex items-center justify-center px-2 py-1 rounded text-xs font-mono font-semibold min-w-[40px] shadow-sm",nr(Gs)),children:Gs??"ERR"})}),e.jsx(lt,{label:"链路位置",children:e.jsx("span",{className:"font-mono text-text-primary",children:gt??"-"})}),e.jsx(lt,{label:"最终 URL",className:"col-span-2",children:e.jsx("span",{className:"font-mono text-text-primary break-all whitespace-normal",title:Wt,children:Wt})}),e.jsx(lt,{label:"链路耗时",children:e.jsx("span",{className:"font-mono text-text-primary",children:ln})}),e.jsx(lt,{label:"请求大小",children:e.jsx("span",{className:"font-mono text-text-primary",children:ps(t.timing?.requestBodyBytesSent)})}),e.jsx(lt,{label:"响应大小",children:e.jsx("span",{className:"font-mono text-text-primary",children:ps(t.timing?.responseBodyBytesReceived)})}),e.jsx(lt,{label:"协议",children:e.jsx("span",{className:"font-mono text-text-primary",children:ea(t.timing?.protocolName)})}),e.jsx(lt,{label:"连接复用",children:e.jsx("span",{className:"font-mono text-text-primary",children:t.timing?.connectionReused==null?"-":t.timing.connectionReused?"是":"否"})})]})]})]}),t.traceId&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:["TraceId: ",e.jsx("span",{className:"font-mono text-text-primary",children:t.traceId})]})]}),e.jsxs("div",{className:"flex border-b border-border bg-bg-dark",children:[e.jsx(Mr,{active:l==="response",onClick:()=>c("response"),children:"Response"}),e.jsx(Mr,{active:l==="request",onClick:()=>c("request"),children:"Request"}),t.timing&&e.jsx(Mr,{active:l==="timing",onClick:()=>c("timing"),children:"Timing"}),Z&&e.jsx(Mr,{active:l==="diff",onClick:()=>c("diff"),children:"Diff"})]}),e.jsxs("div",{className:"p-4",children:[l==="request"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Rt,{title:"Query Params",children:e.jsx(Dn,{headers:t.queryItems||{}})}),e.jsx(Rt,{title:"Body",children:e.jsxs("div",{className:"space-y-2",children:[t.requestBody?ht?e.jsx(ta,{base64Data:t.requestBody,contentType:Et}):T||oe?e.jsx("div",{className:"text-text-muted text-sm",children:"解析中..."}):q?.kind==="binary"?e.jsx(Di,{base64Data:t.requestBody,contentType:q.contentType,contentEncoding:q.contentEncoding,size:q.size,url:t.url,suggestedName:"request-body",warning:q.warning||(q.contentEncoding?"请求体已压缩，暂不支持预览":void 0)}):e.jsx(Ti,{content:q?.text??""}):e.jsx("div",{className:"text-text-muted text-sm",children:"无请求体"}),q?.warning&&q.kind==="text"&&e.jsx("div",{className:"text-xs text-yellow-400",children:q.warning}),q?.kind==="text"&&q.text&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:on,className:"px-2 py-1 text-xs bg-bg-light border border-border-subtle rounded hover:bg-bg-lighter transition-colors flex items-center",title:"复制原始请求内容",children:P?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:12,className:"mr-1"})," 已复制"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:12,className:"mr-1"})," 复制"]})})})]})}),e.jsx(Rt,{title:"Headers",children:e.jsx(Dn,{headers:t.requestHeaders,enableRaw:!0})})]}),l==="response"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Rt,{title:"Body",children:e.jsxs("div",{className:"space-y-2",children:[t.responseBody?Xe?e.jsx(Eh,{base64Data:t.responseBody,contentType:je??null}):Nt?e.jsx(ta,{base64Data:t.responseBody,contentType:je}):A||tt?e.jsx("div",{className:"text-text-muted text-sm",children:"解析中..."}):b?.kind==="binary"?e.jsx(Di,{base64Data:t.responseBody,contentType:b.contentType,contentEncoding:b.contentEncoding,size:b.size,filename:We,url:t.url,suggestedName:"response-body",warning:b.warning||(b.contentEncoding?"响应体已压缩，暂不支持预览":void 0)}):e.jsx(Ti,{content:b?.text??"",initialViewMode:"tree",treeInitialExpanded:!0,treeMaxInitialDepth:Number.MAX_SAFE_INTEGER,buttonOrder:"tree-first"}):e.jsx("div",{className:"text-text-muted text-sm",children:"无响应体"}),b?.warning&&b.kind==="text"&&e.jsx("div",{className:"text-xs text-yellow-400",children:b.warning}),b?.kind==="text"&&b.text&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:an,className:"px-2 py-1 text-xs bg-bg-light border border-border-subtle rounded hover:bg-bg-lighter transition-colors flex items-center",title:"复制原始响应内容",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:12,className:"mr-1"})," 已复制"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:12,className:"mr-1"})," 复制"]})})})]})}),t.responseHeaders&&e.jsx(Rt,{title:"Headers",children:e.jsx(Dn,{headers:t.responseHeaders,enableRaw:!0})}),(Ht||t.error)&&e.jsx(Rt,{title:"错误信息",children:e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(lt,{label:"分类",children:Lc(t.error?.category??null)}),e.jsx(lt,{label:"网络错误",children:t.error?.isNetworkError==null?"-":t.error.isNetworkError?"是":"否"}),e.jsx(lt,{label:"Domain",children:e.jsx("span",{className:"font-mono",children:t.error?.domain??"-"})}),e.jsx(lt,{label:"Code",children:e.jsx("span",{className:"font-mono",children:t.error?.code??"-"})})]}),Ht&&e.jsx("pre",{className:"text-xs font-mono bg-bg-dark p-3 rounded text-red-400 whitespace-pre-wrap",children:Ht})]})})]}),l==="timing"&&t.timing&&e.jsx(Rt,{title:"性能时间线",children:e.jsx(Th,{timing:t.timing,totalDuration:t.duration})}),l==="diff"&&e.jsxs("div",{className:"space-y-6",children:[!J&&e.jsx("div",{className:"text-text-muted text-sm",children:"无可对比的重定向链路"}),J&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-muted",children:"对比对象"}),re?.prevId&&e.jsx("button",{onClick:()=>z("prev"),className:g("px-2 py-1 rounded border text-xs",O==="prev"?"bg-primary text-white border-primary":"bg-bg-light text-text-muted border-border hover:bg-bg-lighter"),children:"上一跳"}),re?.nextId&&e.jsx("button",{onClick:()=>z("next"),className:g("px-2 py-1 rounded border text-xs",O==="next"?"bg-primary text-white border-primary":"bg-bg-light text-text-muted border-border hover:bg-bg-lighter"),children:"下一跳"}),Y&&e.jsx("span",{className:"text-text-muted",children:"加载中..."}),ie&&e.jsx("span",{className:"text-red-400",children:ie})]}),e.jsx(Rt,{title:"基本信息对比",children:e.jsx(cp,{current:t,compare:be})}),e.jsx(Rt,{title:"Headers 对比",children:H?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Pi,{title:"请求头",diffs:Li(t.requestHeaders,H.requestHeaders)}),e.jsx(Pi,{title:"响应头",diffs:Li(t.responseHeaders??{},H.responseHeaders??{})})]}):Y?e.jsx("div",{className:"text-text-muted text-sm",children:"加载对比详情中..."}):ie?e.jsx("div",{className:"text-red-400 text-sm",children:"加载对比详情失败"}):e.jsx("div",{className:"text-text-muted text-sm",children:"暂无对比详情"})})]})]})]}),t.traceId&&s&&e.jsx("div",{className:"p-4 border-t border-border",children:e.jsx("button",{onClick:()=>s(t.traceId),className:"px-3 py-1.5 bg-bg-light border border-border rounded text-sm hover:bg-bg-lighter transition-colors",children:"查看 TraceId 关联日志"})})]})}function Mr({active:t,onClick:r,children:s}){return e.jsx("button",{onClick:r,className:g("px-4 py-2 text-xs font-medium transition-colors",t?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-primary"),children:s})}function Rt({title:t,children:r}){return e.jsxs("div",{className:"bg-bg-dark rounded-lg border border-border",children:[e.jsx("h4",{className:"text-xs uppercase text-text-muted px-3 py-2 border-b border-border font-medium",children:t}),e.jsx("div",{className:"p-3",children:r})]})}function lt({label:t,children:r,className:s}){return e.jsxs("div",{className:g("flex flex-col gap-1 min-w-0",s),children:[e.jsx("span",{className:"text-2xs uppercase text-text-muted",children:t}),e.jsx("div",{className:"text-xs text-text-primary min-w-0",children:r})]})}function cp({current:t,compare:r}){const s=[{label:"Method",current:t.method,compare:r?.method??"-",diff:r?t.method!==r.method:!1},{label:"URL",current:t.url,compare:r?.url??"-",diff:r?t.url!==r.url:!1},{label:"Status",current:String(t.statusCode??"ERR"),compare:String(r?.statusCode??"ERR"),diff:r?t.statusCode!==r.statusCode:!1},{label:"Duration",current:zt(t.duration),compare:zt(r?.duration??null),diff:r?t.duration!==r.duration:!1},{label:"TraceId",current:t.traceId??"-",compare:r?.traceId??"-",diff:r?t.traceId!==r.traceId:!1}];return e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-text-muted border-b border-border",children:[e.jsx("th",{className:"py-2 w-24",children:"字段"}),e.jsx("th",{className:"py-2",children:"当前"}),e.jsx("th",{className:"py-2",children:"对比"})]})}),e.jsx("tbody",{children:s.map(n=>e.jsxs("tr",{className:g("border-b border-border/50",n.diff&&"bg-yellow-500/10"),children:[e.jsx("td",{className:"py-2 text-text-muted",children:n.label}),e.jsx("td",{className:g("py-2 font-mono break-all",n.diff&&"text-red-400"),children:n.current}),e.jsx("td",{className:g("py-2 font-mono break-all",n.diff&&"text-green-400"),children:n.compare})]},n.label))})]})})}function Li(t,r){const s=new Set([...Object.keys(t),...Object.keys(r)]),n=[];for(const i of s){const o=t[i]??null,l=r[i]??null;let c="same";o===null&&l!==null?c="added":o!==null&&l===null?c="removed":o!==l&&(c="modified"),n.push({key:i,current:o,compare:l,status:c})}const a={removed:0,modified:1,added:2,same:3};return n.sort((i,o)=>a[i.status]-a[o.status])}function Pi({title:t,diffs:r}){const s=r.filter(n=>n.status!=="same");return e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs uppercase text-text-muted mb-2",children:t}),e.jsx(dp,{diffs:s})]})}function dp({diffs:t}){if(t.length===0)return e.jsx("div",{className:"text-sm text-text-muted",children:"无差异"});const r={added:"新增",removed:"缺失",modified:"变更",same:"相同"},s={added:"bg-green-500/10 text-green-400",removed:"bg-red-500/10 text-red-400",modified:"bg-yellow-500/10 text-yellow-400",same:"bg-bg-light text-text-muted"};return e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-xs font-mono",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-text-muted border-b border-border",children:[e.jsx("th",{className:"py-2 w-28",children:"状态"}),e.jsx("th",{className:"py-2 w-40",children:"Header"}),e.jsx("th",{className:"py-2",children:"当前"}),e.jsx("th",{className:"py-2",children:"对比"})]})}),e.jsx("tbody",{children:t.map(n=>e.jsxs("tr",{className:"border-b border-border/50",children:[e.jsx("td",{className:"py-2",children:e.jsx("span",{className:g("px-2 py-1 rounded text-2xs",s[n.status]),children:r[n.status]})}),e.jsx("td",{className:"py-2 text-primary break-all",children:n.key}),e.jsx("td",{className:g("py-2 break-all",n.status==="removed"&&"text-red-400"),children:n.current??"-"}),e.jsx("td",{className:g("py-2 break-all",n.status==="added"&&"text-green-400"),children:n.compare??"-"})]},n.key))})]})})}function Dn({headers:t,enableRaw:r=!1}){const s=Object.entries(t),[n,a]=d.useState("kv"),[i,o]=d.useState(!1),l=d.useMemo(()=>s.map(([c,u])=>`${c}: ${u}`).join(`
`),[s]);return s.length===0?e.jsx("span",{className:"text-text-muted text-sm",children:"无"}):e.jsxs("div",{className:"space-y-2",children:[r&&e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("kv"),className:g("px-2 py-1 text-xs rounded",n==="kv"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"键值"}),e.jsx("button",{onClick:()=>a("raw"),className:g("px-2 py-1 text-xs rounded",n==="raw"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"原始"})]})}),n==="raw"&&r?e.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap break-all",children:l}):e.jsx("table",{className:"w-full text-xs font-mono",children:e.jsx("tbody",{children:s.map(([c,u])=>e.jsxs("tr",{className:"border-b border-border last:border-0",children:[e.jsx("td",{className:"py-1.5 pr-4 text-primary align-top whitespace-nowrap",children:c}),e.jsx("td",{className:"py-1.5 break-all",children:u})]},c))})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:async()=>{await rt(l),o(!0),setTimeout(()=>o(!1),2e3)},className:"px-2 py-1 text-xs bg-bg-light border border-border-subtle rounded hover:bg-bg-lighter transition-colors flex items-center",title:"复制原始 Headers",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:12,className:"mr-1"})," 已复制"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:12,className:"mr-1"})," 复制"]})})})]})}function up({className:t=""}){return e.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})}function xp({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}function mp({options:t,selectOptions:r=[],className:s}){const[n,a]=d.useState(!1),i=d.useRef(null);d.useEffect(()=>{const x=m=>{i.current&&!i.current.contains(m.target)&&a(!1)};return n&&document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[n]);const o=t.filter(x=>x.checked),l=r.filter(x=>x.value!==""),c=o.length>0||l.length>0,u=()=>{const x=[];return l.forEach(m=>{const h=m.options.find(y=>y.value===m.value);h&&x.push(h.label)}),o.forEach(m=>x.push(m.shortLabel)),x.join("、")};return e.jsxs("div",{ref:i,className:g("relative",s),children:[e.jsxs("button",{onClick:()=>a(!n),className:g("flex items-center gap-1.5 px-2.5 py-1.5 rounded text-xs font-medium border transition-colors",c?"bg-primary/15 text-primary border-primary hover:bg-primary/20":"bg-bg-light text-text-secondary border-border hover:text-text-primary hover:border-text-muted"),children:[e.jsx(yo,{size:14}),c?e.jsx("span",{className:"flex items-center gap-1",children:u()}):e.jsx("span",{children:"过滤器"}),e.jsx(yt,{size:12,className:g("transition-transform",n&&"rotate-180")})]}),n&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 z-50 bg-bg-medium border border-border rounded-lg shadow-lg py-1 min-w-[200px] whitespace-nowrap",children:[r.map(x=>e.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[e.jsx("span",{className:"text-xs text-text-muted mb-2 block",children:x.label}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.options.map(m=>e.jsx("button",{onClick:()=>x.onChange(m.value),className:g("px-2 py-1 text-xs rounded transition-colors",x.value===m.value?"bg-primary text-white":"bg-bg-light text-text-secondary hover:bg-bg-lighter hover:text-text-primary"),children:m.label},m.value))})]},x.key)),t.map(x=>e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-bg-light transition-colors",children:[e.jsx(Ue,{checked:x.checked,onChange:m=>x.onChange(m)}),e.jsx("span",{className:"text-sm text-text-primary",children:x.label})]},x.key))]})]})}const hp=[{value:"httpRequest",label:"HTTP 请求",description:"修改发出的请求"},{value:"httpResponse",label:"HTTP 响应",description:"模拟或修改响应"},{value:"wsOutgoing",label:"WebSocket 发送",description:"修改发送的 WS 消息"},{value:"wsIncoming",label:"WebSocket 接收",description:"修改接收的 WS 消息"}],pp=[{value:"httpRequest",label:"HTTP 请求",description:"修改发出的请求"},{value:"httpResponse",label:"HTTP 响应",description:"模拟或修改响应"}];function il({rule:t,isOpen:r,onClose:s,onSave:n,loading:a,httpOnly:i=!1}){const o=i?pp:hp,l=!!t,c=t||oi(),[u,x]=d.useState(c.name),[m,h]=d.useState(c.targetType),[y,p]=d.useState(c.priority),[f,w]=d.useState(c.enabled),[N,E]=d.useState(c.condition.urlPattern||""),[S,j]=d.useState(c.condition.method||""),[k,R]=d.useState(c.condition.statusCode?.toString()||""),[D,F]=d.useState(c.condition.bodyContains||""),[P,U]=d.useState(c.condition.wsPayloadContains||""),[K,G]=d.useState(c.action.mockResponseStatusCode?.toString()||"200"),[q,C]=d.useState(c.action.mockResponseBody?Ls(c.action.mockResponseBody):""),[b,M]=d.useState(JSON.stringify(c.action.mockResponseHeaders||{},null,2)),[T,B]=d.useState(c.action.mockWebSocketPayload?Ls(c.action.mockWebSocketPayload):""),[A,I]=d.useState(c.action.delayMilliseconds?.toString()||"");d.useEffect(()=>{if(r){const Y=t||oi();x(Y.name),h(Y.targetType),p(Y.priority),w(Y.enabled),E(Y.condition.urlPattern||""),j(Y.condition.method||""),R(Y.condition.statusCode?.toString()||""),F(Y.condition.bodyContains||""),U(Y.condition.wsPayloadContains||""),G(Y.action.mockResponseStatusCode?.toString()||"200"),C(Y.action.mockResponseBody?Ls(Y.action.mockResponseBody):""),M(JSON.stringify(Y.action.mockResponseHeaders||{},null,2)),B(Y.action.mockWebSocketPayload?Ls(Y.action.mockWebSocketPayload):""),I(Y.action.delayMilliseconds?.toString()||"")}},[r,t]);const O=()=>{const Y={urlPattern:N||null,method:S||null,statusCode:k?parseInt(k):null,headerContains:null,bodyContains:D||null,wsPayloadContains:P||null,enabled:!0};let V=null;try{V=b?JSON.parse(b):null}catch{}const ie={modifyRequestHeaders:null,modifyRequestBody:null,mockResponseStatusCode:K?parseInt(K):null,mockResponseHeaders:V,mockResponseBody:q?btoa(q):null,mockWebSocketPayload:T?btoa(T):null,delayMilliseconds:A?parseInt(A):null};n({name:u,targetType:m,condition:Y,action:ie,priority:y,enabled:f})};if(!r)return null;const z=m==="httpRequest"||m==="httpResponse",H=m==="wsOutgoing"||m==="wsIncoming",le=m==="httpResponse";return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] bg-bg-dark border border-border rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:l?"编辑规则":"创建 Mock 规则"}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-bg-light text-text-muted hover:text-text-primary transition-all",children:"✕"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted uppercase tracking-wider",children:"基本信息"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"规则名称 *"}),e.jsx("input",{type:"text",value:u,onChange:Y=>x(Y.target.value),placeholder:"例如：Mock 用户信息接口",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"目标类型 *"}),e.jsx("select",{value:m,onChange:Y=>h(Y.target.value),className:"select w-full",children:o.map(Y=>e.jsx("option",{value:Y.value,children:Y.label},Y.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"优先级"}),e.jsx("input",{type:"number",value:y,onChange:Y=>p(parseInt(Y.target.value)||0),className:"input w-full"})]}),e.jsx("div",{className:"flex items-center gap-3 pt-5",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Ue,{checked:f,onChange:Y=>w(Y)}),e.jsx("span",{className:"text-sm text-text-secondary",children:"启用规则"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted uppercase tracking-wider",children:"匹配条件"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"URL 模式（支持 * 通配符和正则）"}),e.jsx("input",{type:"text",value:N,onChange:Y=>E(Y.target.value),placeholder:"例如：*/api/user/* 或 ^https://api\\\\.example\\\\.com",className:"input w-full font-mono text-sm"})]}),z&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"HTTP 方法"}),e.jsxs("select",{value:S,onChange:Y=>j(Y.target.value),className:"select w-full",children:[e.jsx("option",{value:"",children:"任意方法"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]})]}),le&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"原始状态码"}),e.jsx("input",{type:"number",value:k,onChange:Y=>R(Y.target.value),placeholder:"仅匹配指定状态码的响应",className:"input w-full"})]})]}),z&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"请求体包含"}),e.jsx("input",{type:"text",value:D,onChange:Y=>F(Y.target.value),placeholder:"匹配请求体中包含的内容",className:"input w-full font-mono text-sm"})]}),H&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"消息包含"}),e.jsx("input",{type:"text",value:P,onChange:Y=>U(Y.target.value),placeholder:"匹配 WebSocket 消息中包含的内容",className:"input w-full font-mono text-sm"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted uppercase tracking-wider",children:"响应配置"}),z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"Mock 状态码"}),e.jsx("input",{type:"number",value:K,onChange:Y=>G(Y.target.value),placeholder:"200",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"延迟 (ms)"}),e.jsx("input",{type:"number",value:A,onChange:Y=>I(Y.target.value),placeholder:"0",className:"input w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"响应头 (JSON)"}),e.jsx("textarea",{value:b,onChange:Y=>M(Y.target.value),placeholder:'{"Content-Type": "application/json"}',rows:3,className:"input w-full font-mono text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"响应体"}),e.jsx("textarea",{value:q,onChange:Y=>C(Y.target.value),placeholder:'{"success": true, "data": {...}}',rows:6,className:"input w-full font-mono text-sm resize-none"})]})]}),H&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"延迟 (ms)"}),e.jsx("input",{type:"number",value:A,onChange:Y=>I(Y.target.value),placeholder:"0",className:"input w-32"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"替换消息内容"}),e.jsx("textarea",{value:T,onChange:Y=>B(Y.target.value),placeholder:'{"type": "mock", "data": {...}}',rows:6,className:"input w-full font-mono text-sm resize-none"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:O,disabled:a||!u.trim(),className:"btn btn-primary disabled:opacity-50",children:a?"保存中...":"保存"})]})]})]})}function fp(t,r){const n=document.createElement("canvas").getContext("2d");return n?(n.font=r,n.measureText(t).width):0}function ol({value:t,onChange:r,placeholder:s="搜索...",className:n="",minWidth:a=160,maxWidthMultiplier:i=5}){const o=d.useRef(null),[l,c]=d.useState(a),[u,x]=d.useState("");d.useEffect(()=>{if(!o.current)return;const h=window.getComputedStyle(o.current),y=`${h.fontWeight} ${h.fontSize} ${h.fontFamily}`;x(y)},[]),d.useLayoutEffect(()=>{if(!u)return;const f=fp(t||s,u)+38,w=a*i,N=Math.max(a,Math.min(f,w));c(N)},[t,s,u,a,i]);const m=d.useCallback(h=>{const y=h.target.value;r(y)},[r]);return e.jsx("input",{ref:o,type:"text",value:t,onChange:m,placeholder:s,className:g("input text-xs py-1.5 px-2.5 transition-[width] duration-150 ease-out",n),style:{width:l}})}function Ca({checked:t,onChange:r,disabled:s=!1,label:n,size:a="sm",className:i}){const o=a==="sm"?{track:"w-7 h-4",thumb:"h-3 w-3",thumbOn:"left-[14px]",thumbOff:"left-0.5"}:{track:"w-9 h-5",thumb:"h-4 w-4",thumbOn:"left-[18px]",thumbOff:"left-0.5"},l=c=>{c.preventDefault(),c.stopPropagation(),s||r(!t)};return e.jsxs("div",{className:g("flex items-center gap-1.5 cursor-pointer select-none",s&&"opacity-50 cursor-not-allowed",i),onClick:l,children:[n&&e.jsx("span",{className:"text-xs text-text-secondary",children:n}),e.jsx("div",{className:g("relative inline-flex items-center rounded-full transition-colors duration-200",o.track,t?"bg-primary":"bg-bg-medium border border-border"),children:e.jsx("div",{className:g(o.thumb,"absolute rounded-full transition-all duration-200",t?g(o.thumbOn,"bg-white"):g(o.thumbOff,"bg-text-muted"))})})]})}const gp={httpRequest:{label:"HTTP 请求",icon:e.jsx(Kn,{size:12}),color:"text-blue-400 bg-blue-500/10 border-blue-500/20"},httpResponse:{label:"HTTP 响应",icon:e.jsx(zr,{size:12}),color:"text-green-400 bg-green-500/10 border-green-500/20"},wsOutgoing:{label:"WS 发送",icon:e.jsx(ms,{size:12}),color:"text-purple-400 bg-purple-500/10 border-purple-500/20"},wsIncoming:{label:"WS 接收",icon:e.jsx(hs,{size:12}),color:"text-orange-400 bg-orange-500/10 border-orange-500/20"}};function bp({rules:t,loading:r,onEdit:s,onDelete:n,onToggleEnabled:a,onCreateNew:i}){return t.length===0&&!r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-12",children:[e.jsx(vt,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"暂无 Mock 规则"}),e.jsx("p",{className:"text-sm mb-6",children:"创建规则来模拟 API 响应或修改请求"}),e.jsx("button",{onClick:i,className:"btn btn-primary",children:"创建第一条规则"})]}):e.jsxs("div",{className:"p-4 space-y-3",children:[t.map(o=>e.jsx(yp,{rule:o,onEdit:()=>s(o),onDelete:()=>n(o.id),onToggleEnabled:()=>a(o.id)},o.id)),r&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})})]})}function yp({rule:t,onEdit:r,onDelete:s,onToggleEnabled:n}){const a=gp[t.targetType],i=jp(t),o=vp(t);return e.jsx("div",{className:g("p-4 bg-bg-dark border border-border rounded-xl transition-all group",!t.enabled&&"opacity-50"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:n,className:g("w-10 h-6 rounded-full relative transition-all flex-shrink-0 mt-1",t.enabled?"bg-primary":"bg-bg-light border border-border"),children:e.jsx("span",{className:g("absolute top-1 w-4 h-4 rounded-full bg-white shadow transition-all",t.enabled?"left-5":"left-1")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-text-primary",children:t.name}),e.jsxs("span",{className:g("inline-flex items-center gap-1 px-2 py-0.5 text-xs rounded-full border",a.color),children:[e.jsx("span",{children:a.icon}),e.jsx("span",{children:a.label})]}),!t.deviceId&&e.jsx("span",{className:"text-2xs px-1.5 py-0.5 bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 rounded",children:"全局"})]}),e.jsx("div",{className:"text-xs text-text-muted mb-1.5 space-y-0.5",children:i.map((l,c)=>e.jsxs("p",{children:[e.jsxs("span",{className:"text-text-secondary",children:[l.label,":"]})," ",e.jsx("span",{className:"font-mono",children:l.value})]},c))}),e.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-1",children:[e.jsx("span",{className:"text-primary",children:e.jsx(Kr,{size:12})})," ",o]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-2xs text-text-muted",children:[e.jsxs("span",{children:["优先级: ",t.priority]}),t.updatedAt&&e.jsxs("span",{children:["更新于 ",ut(t.updatedAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-bg-light text-text-muted hover:text-text-primary transition-all",title:"编辑",children:e.jsx(Co,{size:16})}),e.jsx("button",{onClick:()=>{confirm("确定要删除这条规则吗？")&&s()},className:"p-2 rounded-lg hover:bg-red-500/10 text-text-muted hover:text-red-400 transition-all",title:"删除",children:e.jsx(Ae,{size:16})})]})]})})}function jp(t){const r=[],s=t.condition;return s.urlPattern&&r.push({label:"URL",value:s.urlPattern}),s.method&&r.push({label:"方法",value:s.method}),s.statusCode&&r.push({label:"状态码",value:String(s.statusCode)}),s.bodyContains&&r.push({label:"包含",value:s.bodyContains}),s.wsPayloadContains&&r.push({label:"WS包含",value:s.wsPayloadContains}),r.length===0&&r.push({label:"匹配",value:"所有请求"}),r}function vp(t){const r=t.action,s=[];return r.mockResponseStatusCode&&s.push(`返回 ${r.mockResponseStatusCode}`),r.modifyRequestHeaders&&Object.keys(r.modifyRequestHeaders).length>0&&s.push("修改请求头"),r.modifyRequestBody&&s.push("修改请求体"),r.mockResponseBody&&s.push("自定义响应体"),r.mockWebSocketPayload&&s.push("替换 WS 消息"),r.delayMilliseconds&&s.push(`延迟 ${r.delayMilliseconds}ms`),s.length>0?s.join(", "):"无动作"}class wp{metadata={pluginId:we.MOCK,displayName:"Mock",version:"1.0.0",description:"Mock 规则管理",icon:e.jsx(vt,{size:16}),dependencies:[we.HTTP],isSubPlugin:!0,parentPluginId:we.HTTP};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["mock_rule_change"],s=>this.handleEvent(s)),this.state="ready"}render(r){return e.jsx(Np,{...r})}onActivate(){console.log("[MockPlugin] Activated")}onDeactivate(){console.log("[MockPlugin] Deactivated")}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}handleEvent(r){if(r.eventType==="mock_rule_change"){const s=this.pluginContext?.deviceId;s&&Us.getState().fetchRules(s)}}}function Np({context:t,isActive:r}){return!r||!t.deviceId?null:e.jsx(ll,{deviceId:t.deviceId,isActive:r})}function ll({deviceId:t,isActive:r}){const{rules:s,loading:n,editingRule:a,isEditorOpen:i,fetchRules:o,createRule:l,updateRule:c,deleteRule:u,toggleRuleEnabled:x,openEditor:m,closeEditor:h,clearRules:y}=Us(),p=Tt(),[f,w]=d.useState(!1),[N,E]=d.useState(null);d.useEffect(()=>{r&&t&&o(t)},[r,t,o]);const S=d.useCallback(()=>{t&&o(t)},[t,o]),j=d.useCallback(()=>{y(),w(!1),p.show("success","已清空 Mock 规则")},[y,p]),k=d.useCallback(K=>{m(K)},[m]),R=d.useCallback(async K=>{E(K)},[]),D=d.useCallback(async()=>{!t||!N||(await u(t,N),E(null),p.show("success","规则已删除"))},[t,N,u,p]),F=d.useCallback(async K=>{t&&await x(t,K)},[t,x]),P=d.useCallback(()=>{m()},[m]),U=d.useCallback(async K=>{if(t)try{a?.id?(await c(t,a.id,K),p.show("success","规则已更新")):(await l(t,K),p.show("success","规则已创建")),h()}catch{p.show("error","保存失败")}},[t,a,l,c,h,p]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:S,className:"btn btn-secondary text-xs px-2.5 py-1.5",title:"刷新",disabled:n,children:"刷新"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx("button",{onClick:P,className:"btn btn-primary text-xs px-2.5 py-1.5",children:"新建规则"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[s.length>0&&e.jsxs("button",{onClick:()=>w(!0),className:"btn btn-ghost text-red-400 hover:bg-red-500/10 text-xs px-2 py-1.5 flex-shrink-0 flex items-center",title:"清空所有规则",children:[e.jsx(Ae,{size:14,className:"mr-1"}),"清空规则"]}),s.length>0&&e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("span",{children:["共 ",s.length," 条规则"]}),e.jsx("span",{className:"text-text-muted",children:"•"}),e.jsxs("span",{className:"text-status-success",children:[s.filter(K=>K.enabled).length," 条启用"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto relative",children:[e.jsx(bp,{rules:s,loading:n,onEdit:k,onDelete:R,onToggleEnabled:F,onCreateNew:P}),e.jsx(bs,{isLoading:n})]}),e.jsx(il,{rule:a,isOpen:i,onSave:U,onClose:h}),e.jsx(xt,{isOpen:f,onClose:()=>w(!1),onConfirm:j,title:"清空 Mock 规则",message:"确定要清空所有 Mock 规则吗？此操作无法撤销。",confirmText:"清空",type:"danger"}),e.jsx(xt,{isOpen:!!N,onClose:()=>E(null),onConfirm:D,title:"删除规则",message:"确定要删除这条规则吗？此操作无法撤销。",confirmText:"删除",type:"danger"})]})}const kp=new wp;function Cp({hits:t,onResume:r,loading:s}){const[n,a]=d.useState(null),i=d.useMemo(()=>t.find(o=>o.requestId===n)||t[0]||null,[t,n]);return t.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-text-muted",children:[e.jsx(Re,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"暂无等待处理的断点"}),e.jsx("p",{className:"text-xs mt-1",children:"当请求命中断点规则时会在这里显示"})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border bg-orange-500/10 flex items-center gap-3",children:[e.jsx(xa,{size:24,className:"text-orange-400 animate-pulse"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-orange-400",children:[t.length," 个断点等待处理"]}),e.jsx("p",{className:"text-xs text-text-muted",children:"请求已被拦截，等待您的操作"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-1/3 border-r border-border overflow-auto",children:t.map(o=>e.jsxs("div",{onClick:()=>a(o.requestId),className:g("p-3 border-b border-border cursor-pointer transition-colors",i?.requestId===o.requestId?"bg-primary/10 border-l-2 border-l-primary":"hover:bg-bg-light"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:g("px-1.5 py-0.5 text-xs rounded font-medium",o.phase==="request"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:o.phase==="request"?"请求":"响应"}),e.jsx("span",{className:"text-xs font-mono text-text-secondary",children:o.request.method})]}),e.jsx("div",{className:"text-xs text-text-muted truncate font-mono",children:new URL(o.request.url).pathname})]},o.requestId))}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:i&&e.jsx(Sp,{hit:i,onResume:r,loading:s})})]})]})}function Sp({hit:t,onResume:r,loading:s}){const[n,a]=d.useState(!1),[i,o]=d.useState(t.request),[l,c]=d.useState(t.response),[u,x]=d.useState("request");d.useState(()=>{o(t.request),c(t.response),a(!1)});const m=()=>{r(t.requestId,{type:"resume"})},h=()=>{r(t.requestId,{type:"abort"})},y=()=>{const w={type:"modify",modification:{request:t.phase==="request"?i:void 0,response:t.phase==="response"?l??void 0:void 0}};r(t.requestId,w)},p=()=>{l&&r(t.requestId,{type:"mockResponse",mockResponse:l})},f=w=>{try{return btoa(w)}catch{return w}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-bg-dark/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:g("px-2 py-1 text-xs rounded font-bold",{"bg-green-500/20 text-green-400":t.request.method==="GET","bg-blue-500/20 text-blue-400":t.request.method==="POST","bg-yellow-500/20 text-yellow-400":t.request.method==="PUT","bg-red-500/20 text-red-400":t.request.method==="DELETE","bg-purple-500/20 text-purple-400":t.request.method==="PATCH"}),children:t.request.method}),e.jsx("span",{className:g("px-2 py-0.5 text-xs rounded",t.phase==="request"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:t.phase==="request"?"请求阶段":"响应阶段"})]}),e.jsx("code",{className:"text-sm text-text-primary break-all",children:t.request.url})]}),e.jsxs("div",{className:"flex border-b border-border",children:[e.jsx("button",{onClick:()=>x("request"),className:g("px-4 py-2 text-sm font-medium transition-colors",u==="request"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-primary"),children:"请求"}),(t.phase==="response"||n)&&e.jsx("button",{onClick:()=>x("response"),className:g("px-4 py-2 text-sm font-medium transition-colors",u==="response"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-primary"),children:"响应"}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>a(!n),className:g("px-4 py-2 text-sm transition-colors flex items-center gap-1.5",n?"text-primary":"text-text-muted hover:text-text-primary"),children:[e.jsx(ir,{size:14}),n?"编辑中":"编辑"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:u==="request"?e.jsx(Tp,{request:i,onChange:o,editable:n&&t.phase==="request"}):e.jsx(Ep,{response:l,onChange:c,editable:n,showCreateButton:!l&&n,onCreateResponse:()=>c({statusCode:200,headers:{"Content-Type":"application/json"},body:f("{}")})})}),e.jsxs("div",{className:"p-4 border-t border-border bg-bg-dark/50 flex items-center gap-3",children:[e.jsxs("button",{onClick:m,disabled:s,className:"btn btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Bd,{size:16})," 继续"]}),n&&e.jsxs("button",{onClick:y,disabled:s,className:"btn bg-blue-500/20 text-blue-400 border border-blue-500/30 hover:bg-blue-500/30 flex-1 flex items-center justify-center gap-2",children:[e.jsx(ir,{size:16})," 修改后继续"]}),t.phase==="request"&&n&&l&&e.jsxs("button",{onClick:p,disabled:s,className:"btn bg-purple-500/20 text-purple-400 border border-purple-500/30 hover:bg-purple-500/30 flex-1 flex items-center justify-center gap-2",children:[e.jsx(vt,{size:16})," 返回 Mock 响应"]}),e.jsxs("button",{onClick:h,disabled:s,className:"btn btn-danger flex items-center justify-center gap-2",children:[e.jsx(_d,{size:16})," 中止"]})]})]})}function Tp({request:t,onChange:r,editable:s}){const n=d.useMemo(()=>t.body?Ls(t.body):"",[t.body]),a=i=>{try{return JSON.stringify(JSON.parse(i),null,2)}catch{return i}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Headers"}),e.jsx("div",{className:"bg-bg-dark rounded-lg border border-border overflow-hidden",children:Object.entries(t.headers).map(([i,o])=>e.jsxs("div",{className:"flex border-b border-border last:border-b-0",children:[e.jsx("div",{className:"w-1/3 px-3 py-2 text-xs font-mono text-text-muted bg-bg-medium/50 border-r border-border",children:i}),e.jsx("div",{className:"flex-1 px-3 py-2 text-xs font-mono text-text-primary break-all",children:s?e.jsx("input",{type:"text",value:o,onChange:l=>r({...t,headers:{...t.headers,[i]:l.target.value}}),className:"w-full bg-transparent border-none outline-none"}):o})]},i))})]}),t.body&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Body"}),s?e.jsx("textarea",{value:n,onChange:i=>r({...t,body:btoa(i.target.value)}),className:"w-full h-64 bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary resize-none",spellCheck:!1}):e.jsx("pre",{className:"bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary overflow-auto max-h-64",children:a(n)})]})]})}function Ep({response:t,onChange:r,editable:s,showCreateButton:n,onCreateResponse:a}){if(!t)return n&&a?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("p",{className:"text-sm mb-3",children:"尚无响应数据"}),e.jsx("button",{onClick:a,className:"btn btn-primary",children:"创建 Mock 响应"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:e.jsx("p",{className:"text-sm",children:"请求阶段断点，暂无响应数据"})});const i=d.useMemo(()=>t.body?Ls(t.body):"",[t.body]),o=l=>{try{return JSON.stringify(JSON.parse(l),null,2)}catch{return l}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Status Code"}),s?e.jsx("input",{type:"number",value:t.statusCode,onChange:l=>r({...t,statusCode:parseInt(l.target.value)||200}),className:"input w-32"}):e.jsx("span",{className:g("px-2 py-1 rounded text-sm font-medium",t.statusCode>=200&&t.statusCode<300?"bg-green-500/20 text-green-400":t.statusCode>=400?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"),children:t.statusCode})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Headers"}),e.jsx("div",{className:"bg-bg-dark rounded-lg border border-border overflow-hidden",children:Object.entries(t.headers).map(([l,c])=>e.jsxs("div",{className:"flex border-b border-border last:border-b-0",children:[e.jsx("div",{className:"w-1/3 px-3 py-2 text-xs font-mono text-text-muted bg-bg-medium/50 border-r border-border",children:l}),e.jsx("div",{className:"flex-1 px-3 py-2 text-xs font-mono text-text-primary break-all",children:s?e.jsx("input",{type:"text",value:c,onChange:u=>r({...t,headers:{...t.headers,[l]:u.target.value}}),className:"w-full bg-transparent border-none outline-none"}):c})]},l))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Body"}),s?e.jsx("textarea",{value:i,onChange:l=>r({...t,body:btoa(l.target.value)}),className:"w-full h-64 bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary resize-none",spellCheck:!1}):e.jsx("pre",{className:"bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary overflow-auto max-h-64",children:o(i)||"(empty)"})]})]})}class Ip{metadata={pluginId:we.BREAKPOINT,displayName:"Breakpoint",version:"1.0.0",description:"请求断点调试",icon:e.jsx(qr,{size:16}),dependencies:[we.HTTP],isSubPlugin:!0,parentPluginId:we.HTTP};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["breakpoint_hit","breakpoint_rule_change"],s=>this.handleEvent(s)),this.state="ready"}render(r){return e.jsx(Mp,{...r})}onActivate(){console.log("[BreakpointPlugin] Activated")}onDeactivate(){console.log("[BreakpointPlugin] Deactivated")}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}handleEvent(r){if(r.eventType==="breakpoint_hit"&&r.payload){const s=r.payload;Zt.getState().addHit(s)}else if(r.eventType==="breakpoint_rule_change"){const s=this.pluginContext?.deviceId;s&&Zt.getState().fetchPendingHits(s)}}}function Mp({context:t,isActive:r}){return!r||!t.deviceId?null:e.jsx(cl,{deviceId:t.deviceId,isActive:r})}function cl({deviceId:t,isActive:r}){const{pendingHits:s,fetchPendingHits:n,resumeBreakpoint:a,editingRule:i,isEditorOpen:o,closeEditor:l}=Zt(),c=Tt(),[u,x]=d.useState([]),[m,h]=d.useState(!1),[y,p]=d.useState(null),[f,w]=d.useState(!1),[N,E]=d.useState("rules"),[S,j]=d.useState(!1);d.useEffect(()=>{o&&i&&(p({...i}),w(!0),l())},[o,i,l]);const k=d.useCallback(async()=>{if(t){h(!0);try{const b=[...await aa(t)].sort((M,T)=>!M.createdAt&&!T.createdAt?0:M.createdAt?T.createdAt?new Date(T.createdAt).getTime()-new Date(M.createdAt).getTime():-1:1);x(b)}catch(C){console.error("Failed to fetch breakpoint rules:",C)}finally{h(!1)}}},[t]);d.useEffect(()=>{r&&t&&(k(),n(t))},[r,t,k,n]),d.useEffect(()=>{if(!r||!t)return;const C=setInterval(()=>n(t),2e3);return()=>clearInterval(C)},[r,t,n]),d.useEffect(()=>{s.length>0&&E("pending")},[s.length]);const R=()=>{p({name:"",urlPattern:"",method:"",phase:"request",enabled:!0,priority:0}),w(!0)},D=C=>{p({...C}),w(!0)},F=async()=>{if(!(!y||!t))try{y.id?await Ya(t,y.id,y):await vc(t,y),w(!1),p(null),k()}catch(C){console.error("Failed to save breakpoint rule:",C)}},P=async C=>{if(confirm("确定要删除这条断点规则吗？")&&t)try{await uo(t,C),k()}catch(b){console.error("Failed to delete breakpoint rule:",b)}},U=async()=>{if(confirm("确定要清空所有断点规则吗？此操作不可恢复。")&&t)try{await xo(t),k()}catch(C){console.error("Failed to clear all breakpoint rules:",C)}},K=async C=>{if(t)try{await Ya(t,C.id,{enabled:!C.enabled}),k()}catch(b){console.error("Failed to toggle breakpoint rule:",b)}},G=d.useCallback(async(C,b)=>{if(t){j(!0);try{await a(t,C,b),c.show("success","断点已处理")}catch{c.show("error","处理断点失败")}finally{j(!1)}}},[t,a,c]),q=d.useMemo(()=>u.filter(C=>C.enabled).length,[u]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:k,className:"btn btn-secondary text-xs px-2.5 py-1.5",title:"刷新规则列表",disabled:m,children:"刷新"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),N==="rules"&&e.jsx("button",{onClick:R,className:"btn btn-primary text-xs px-2.5 py-1.5",children:"新建规则"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[u.length>0&&e.jsxs("button",{onClick:U,className:"btn btn-ghost text-red-400 hover:bg-red-500/10 text-xs px-2 py-1.5 flex-shrink-0 flex items-center",title:"清空所有规则",children:[e.jsx(Ae,{size:14,className:"mr-1"}),"清空规则"]}),u.length>0&&e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("span",{children:["共 ",u.length," 条规则"]}),e.jsx("span",{className:"text-text-muted",children:"•"}),e.jsxs("span",{className:"text-status-success",children:[q," 条启用"]})]})]}),e.jsx("div",{className:"flex-shrink-0 px-4 py-2 border-b border-border bg-bg-medium",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>E("rules"),className:g("px-4 py-2 rounded-lg text-sm font-medium transition-colors",N==="rules"?"bg-bg-light text-text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light/50"),children:["规则列表 (",u.length,")"]}),e.jsxs("button",{onClick:()=>E("pending"),className:g("px-4 py-2 rounded-lg text-sm font-medium transition-colors relative",N==="pending"?"bg-bg-light text-text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light/50"),children:["等待处理",s.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-orange-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse",children:s.length})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:N==="rules"?e.jsx("div",{className:"h-full overflow-auto p-4",children:m?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-12",children:[e.jsx(xa,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"暂无断点规则"}),e.jsx("p",{className:"text-sm mb-6",children:"创建规则来拦截和调试请求"}),e.jsx("button",{onClick:R,className:"btn btn-primary",children:"创建第一条规则"})]}):e.jsx("div",{className:"space-y-3",children:u.map(C=>e.jsx(Dp,{rule:C,onEdit:()=>D(C),onDelete:()=>P(C.id),onToggle:()=>K(C)},C.id))})}):e.jsx(Cp,{hits:s,onResume:G,loading:S})}),f&&y&&e.jsx(Rp,{rule:y,onChange:p,onSave:F,onCancel:()=>{w(!1),p(null)}})]})}function Dp({rule:t,onEdit:r,onDelete:s,onToggle:n}){const a={request:"请求阶段",response:"响应阶段",both:"双向拦截"};return e.jsx("div",{className:g("p-4 bg-bg-dark border border-border rounded-xl transition-all",!t.enabled&&"opacity-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:g("w-10 h-6 rounded-full transition-colors relative",t.enabled?"bg-primary":"bg-bg-light"),children:e.jsx("span",{className:g("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",t.enabled?"left-5":"left-1")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-primary",children:t.name||"未命名规则"}),e.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-500/20 text-orange-400 rounded text-2xs",children:a[t.phase]}),t.method&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 rounded text-2xs",children:t.method}),t.urlPattern&&e.jsx("code",{className:"text-text-secondary truncate max-w-[200px]",children:t.urlPattern})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"p-2 text-text-muted hover:text-text-primary hover:bg-bg-light rounded-lg transition-colors",children:e.jsx(ir,{size:16})}),e.jsx("button",{onClick:s,className:"p-2 text-text-muted hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(Ae,{size:16})})]})]})})}function Rp({rule:t,onChange:r,onSave:s,onCancel:n}){return d.useEffect(()=>{const a=i=>{if(i.key==="Escape"){const o=i.target;o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||(i.stopPropagation(),n())}};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[n]),e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-bg-dark border border-border rounded-2xl w-full max-w-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:t.id?"编辑断点规则":"新建断点规则"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"规则名称"}),e.jsx("input",{type:"text",value:t.name||"",onChange:a=>r({...t,name:a.target.value}),placeholder:"例如：拦截登录接口",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"URL 匹配模式"}),e.jsx("input",{type:"text",value:t.urlPattern||"",onChange:a=>r({...t,urlPattern:a.target.value}),placeholder:"例如：*/api/login* 或留空匹配所有",className:"input w-full font-mono"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"HTTP 方法"}),e.jsxs("select",{value:t.method||"",onChange:a=>r({...t,method:a.target.value||null}),className:"select w-full",children:[e.jsx("option",{value:"",children:"全部方法"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"拦截阶段"}),e.jsxs("select",{value:t.phase||"request",onChange:a=>r({...t,phase:a.target.value}),className:"select w-full",children:[e.jsx("option",{value:"request",children:"请求阶段"}),e.jsx("option",{value:"response",children:"响应阶段"}),e.jsx("option",{value:"both",children:"双向拦截"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"优先级"}),e.jsx("input",{type:"number",value:t.priority||0,onChange:a=>r({...t,priority:parseInt(a.target.value)||0}),className:"input w-full"}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"数值越大优先级越高"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:n,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:s,className:"btn btn-primary",children:"保存"})]})]})]})}const Lp=new Ip;class Pp{metadata={pluginId:we.CHAOS,displayName:"Chaos",version:"1.0.0",description:"混沌工程测试",icon:e.jsx(hr,{size:16}),dependencies:[we.HTTP],isSubPlugin:!0,parentPluginId:we.HTTP};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["chaos_triggered","chaos_config_change"],s=>this.handleEvent(s)),this.state="ready"}render(r){return e.jsx(Op,{...r})}onActivate(){console.log("[ChaosPlugin] Activated")}onDeactivate(){console.log("[ChaosPlugin] Deactivated")}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}handleEvent(r){console.log("[ChaosPlugin] Received event:",r.eventType)}}function Op({context:t,isActive:r}){return!r||!t.deviceId?null:e.jsx(dl,{deviceId:t.deviceId,isActive:r})}function dl({deviceId:t,isActive:r}){const[s,n]=d.useState([]),[a,i]=d.useState(!1),[o,l]=d.useState(null),[c,u]=d.useState(!1),{editingRule:x,isEditorOpen:m,closeEditor:h}=Qr();d.useEffect(()=>{m&&x&&(l({...x}),u(!0),h())},[m,x,h]);const y=d.useCallback(async()=>{if(t){i(!0);try{const R=[...await ia(t)].sort((D,F)=>!D.createdAt&&!F.createdAt?0:D.createdAt?F.createdAt?new Date(F.createdAt).getTime()-new Date(D.createdAt).getTime():-1:1);n(R)}catch(k){console.error("Failed to fetch chaos rules:",k)}finally{i(!1)}}},[t]);d.useEffect(()=>{r&&t&&y()},[r,t,y]);const p=()=>{l({name:"",urlPattern:"",chaos:{type:"latency",minLatency:500,maxLatency:2e3},enabled:!0,priority:0,probability:1}),u(!0)},f=k=>{l({...k}),u(!0)},w=async()=>{if(!(!o||!t))try{o.id?await Hn(t,o.id,o):await mo(t,o),u(!1),l(null),y()}catch(k){console.error("Failed to save chaos rule:",k)}},N=async k=>{if(confirm("确定要删除这条故障注入规则吗？")&&t)try{await oa(t,k),y()}catch(R){console.error("Failed to delete chaos rule:",R)}},E=async()=>{if(confirm("确定要清空所有故障注入规则吗？此操作不可恢复。")&&t)try{await la(t),y()}catch(k){console.error("Failed to clear all chaos rules:",k)}},S=async k=>{if(t)try{await Hn(t,k.id,{enabled:!k.enabled}),y()}catch(R){console.error("Failed to toggle chaos rule:",R)}},j=d.useMemo(()=>s.filter(k=>k.enabled).length,[s]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-4 py-1.5 border-b border-border bg-bg-medium",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:y,className:"btn btn-secondary text-xs px-2.5 py-1.5",title:"刷新规则列表",disabled:a,children:"刷新"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx("button",{onClick:p,className:"btn btn-primary text-xs px-2.5 py-1.5",children:"新建规则"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[s.length>0&&e.jsxs("button",{onClick:E,className:"btn btn-ghost text-red-400 hover:bg-red-500/10 text-xs px-2 py-1.5 flex-shrink-0 flex items-center",title:"清空所有规则",children:[e.jsx(Ae,{size:14,className:"mr-1"}),"清空规则"]}),s.length>0&&e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsxs("span",{children:["共 ",s.length," 条规则"]}),e.jsx("span",{className:"text-text-muted",children:"•"}),e.jsxs("span",{className:"text-status-success",children:[j," 条启用"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:a?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-12",children:[e.jsx(hr,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"暂无故障注入规则"}),e.jsx("p",{className:"text-sm mb-6",children:"创建规则来模拟网络故障和异常"}),e.jsx("button",{onClick:p,className:"btn btn-primary",children:"创建第一条规则"})]}):e.jsx("div",{className:"space-y-3",children:s.map(k=>e.jsx(Ap,{rule:k,onEdit:()=>f(k),onDelete:()=>N(k.id),onToggle:()=>S(k)},k.id))})}),c&&o&&e.jsx(Fp,{rule:o,onChange:l,onSave:w,onCancel:()=>{u(!1),l(null)}})]})}const ul={latency:{label:"延迟",color:"bg-yellow-500/20 text-yellow-400",icon:e.jsx(Ud,{size:16}),description:"增加网络延迟"},timeout:{label:"超时",color:"bg-orange-500/20 text-orange-400",icon:e.jsx(Qt,{size:16}),description:"请求超时"},connectionReset:{label:"连接重置",color:"bg-red-500/20 text-red-400",icon:e.jsx(So,{size:16}),description:"模拟连接重置"},randomError:{label:"随机错误",color:"bg-pink-500/20 text-pink-400",icon:e.jsx(Hd,{size:16}),description:"返回随机错误码"},corruptResponse:{label:"数据损坏",color:"bg-purple-500/20 text-purple-400",icon:e.jsx(Vd,{size:16}),description:"损坏响应数据"},slowNetwork:{label:"慢速网络",color:"bg-blue-500/20 text-blue-400",icon:e.jsx(qd,{size:16}),description:"限制网络带宽"},dropRequest:{label:"丢弃请求",color:"bg-gray-500/20 text-gray-400",icon:e.jsx(Ae,{size:16}),description:"直接丢弃请求"}};function Ap({rule:t,onEdit:r,onDelete:s,onToggle:n}){const a=ul[t.chaos.type],o=(()=>{const l=t.chaos;switch(l.type){case"latency":return`延迟: ${l.minLatency}-${l.maxLatency}ms`;case"slowNetwork":return`带宽: ${l.bytesPerSecond} B/s`;case"randomError":return`错误码: ${l.errorCodes.join(", ")}`;default:return null}})();return e.jsxs("div",{className:g("p-4 bg-bg-dark border border-border rounded-xl transition-all",!t.enabled&&"opacity-50"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:g("w-10 h-6 rounded-full transition-colors relative",t.enabled?"bg-primary":"bg-bg-light"),children:e.jsx("span",{className:g("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",t.enabled?"left-5":"left-1")})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-text-primary flex items-center gap-2",children:[e.jsx("span",{children:a.icon}),t.name||"未命名规则"]}),e.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-2 mt-1",children:[e.jsx("span",{className:g("px-1.5 py-0.5 rounded text-2xs",a.color),children:a.label}),t.probability<1&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-500/20 text-purple-400 rounded text-2xs",children:[Math.round(t.probability*100),"% 概率"]}),t.urlPattern&&e.jsx("code",{className:"text-text-secondary truncate max-w-[200px]",children:t.urlPattern})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"p-2 text-text-muted hover:text-text-primary hover:bg-bg-light rounded-lg transition-colors",children:e.jsx(ir,{size:16})}),e.jsx("button",{onClick:s,className:"p-2 text-text-muted hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(Ae,{size:16})})]})]}),o&&e.jsx("div",{className:"mt-2 text-xs text-text-muted",children:o})]})}function Fp({rule:t,onChange:r,onSave:s,onCancel:n}){const a=t.chaos?.type||"latency";d.useEffect(()=>{const l=c=>{if(c.key==="Escape"){const u=c.target;u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable||(c.stopPropagation(),n())}};return window.addEventListener("keydown",l,!0),()=>window.removeEventListener("keydown",l,!0)},[n]);const i=l=>{let c;switch(l){case"latency":c={type:"latency",minLatency:500,maxLatency:2e3};break;case"timeout":c={type:"timeout"};break;case"connectionReset":c={type:"connectionReset"};break;case"randomError":c={type:"randomError",errorCodes:[500,502,503]};break;case"corruptResponse":c={type:"corruptResponse"};break;case"slowNetwork":c={type:"slowNetwork",bytesPerSecond:1024};break;case"dropRequest":c={type:"dropRequest"};break;default:c={type:"latency",minLatency:500,maxLatency:2e3}}r({...t,chaos:c})},o=l=>{t.chaos&&r({...t,chaos:{...t.chaos,...l}})};return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-bg-dark border border-border rounded-2xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:t.id?"编辑故障注入规则":"新建故障注入规则"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"规则名称"}),e.jsx("input",{type:"text",value:t.name||"",onChange:l=>r({...t,name:l.target.value}),placeholder:"例如：登录接口延迟",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"URL 匹配模式"}),e.jsx("input",{type:"text",value:t.urlPattern||"",onChange:l=>r({...t,urlPattern:l.target.value}),placeholder:"例如：*/api/login* 或留空匹配所有",className:"input w-full font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-2",children:"故障注入类型"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(ul).map(([l,c])=>e.jsxs("button",{onClick:()=>i(l),className:g("p-3 rounded-lg border text-left transition-all",a===l?"border-primary bg-primary/10":"border-border hover:border-border-hover"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.icon}),e.jsx("span",{className:"font-medium text-text-primary",children:c.label})]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:c.description})]},l))})]}),t.chaos?.type==="latency"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"最小延迟 (ms)"}),e.jsx("input",{type:"number",value:t.chaos.minLatency,onChange:l=>o({minLatency:parseInt(l.target.value)||0}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"最大延迟 (ms)"}),e.jsx("input",{type:"number",value:t.chaos.maxLatency,onChange:l=>o({maxLatency:parseInt(l.target.value)||0}),className:"input w-full"})]})]}),t.chaos?.type==="slowNetwork"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"带宽限制 (B/s)"}),e.jsx("input",{type:"number",value:t.chaos.bytesPerSecond,onChange:l=>o({bytesPerSecond:parseInt(l.target.value)||1024}),className:"input w-full"}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"1024 = 1KB/s, 10240 = 10KB/s"})]}),t.chaos?.type==="randomError"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"错误状态码 (逗号分隔)"}),e.jsx("input",{type:"text",value:t.chaos.errorCodes.join(", "),onChange:l=>{const c=l.target.value.split(",").map(u=>parseInt(u.trim())).filter(u=>!isNaN(u));o({errorCodes:c.length>0?c:[500]})},placeholder:"500, 502, 503",className:"input w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"触发概率"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:(t.probability||1)*100,onChange:l=>r({...t,probability:parseInt(l.target.value)/100}),className:"flex-1"}),e.jsxs("span",{className:"text-text-primary w-12 text-right",children:[Math.round((t.probability||1)*100),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"优先级"}),e.jsx("input",{type:"number",value:t.priority||0,onChange:l=>r({...t,priority:parseInt(l.target.value)||0}),className:"input w-full"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:n,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:s,className:"btn btn-primary",children:"保存"})]})]})]})}const zp=new Pp;class $p{metadata={pluginId:we.HTTP,displayName:"HTTP",version:"1.0.0",description:"HTTP/HTTPS 请求监控",icon:e.jsx(Bs,{size:16})};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["mock_rule_change","breakpoint_hit","breakpoint_rule_change","chaos_triggered","chaos_config_change"],s=>this.handleEvent(s)),this.state="ready"}render(r){return e.jsx(_p,{...r})}onActivate(){console.log("[HttpPlugin] Activated")}onDeactivate(){console.log("[HttpPlugin] Deactivated")}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}handleEvent(r){console.log("[HttpPlugin] Received event:",r.eventType)}get context(){return this.pluginContext}}const Bp=[{id:"requests",label:"请求列表",icon:e.jsx(gd,{size:16})},{id:"mock",label:"Mock",icon:e.jsx(vt,{size:16}),pluginId:we.MOCK,badge:({mockRulesCount:t,mockPluginEnabled:r})=>e.jsxs(e.Fragment,{children:[!r&&e.jsx(As,{size:12,className:"ml-1 text-text-muted"}),r&&t>0&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 text-[10px] bg-accent/20 text-accent rounded-full",children:t})]})},{id:"breakpoint",label:"断点",icon:e.jsx(qr,{size:16}),pluginId:we.BREAKPOINT,badge:({breakpointRulesCount:t,breakpointHasPending:r,breakpointPluginEnabled:s})=>e.jsxs(e.Fragment,{children:[!s&&e.jsx(As,{size:12,className:"ml-1 text-text-muted"}),s&&t>0&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 text-[10px] bg-warning/20 text-warning rounded-full",children:t}),s&&r&&e.jsx("span",{className:"ml-1.5 w-2 h-2 rounded-full bg-warning animate-pulse"})]})},{id:"chaos",label:"故障注入",icon:e.jsx(hr,{size:16}),pluginId:we.CHAOS,badge:({chaosHasActive:t,chaosPluginEnabled:r})=>e.jsxs(e.Fragment,{children:[!r&&e.jsx(As,{size:12,className:"ml-1 text-text-muted"}),r&&t&&e.jsx("span",{className:"ml-1.5 w-2 h-2 rounded-full bg-error animate-pulse"})]})}];function _p({context:t,isActive:r}){const s=t.deviceId??"",[n,a]=xr(),[i,o]=d.useState({});d.useEffect(()=>he.subscribe(()=>o({})),[]);const l=d.useMemo(()=>Bp.filter(O=>O.pluginId?he.isPluginEnabled(O.pluginId):!0),[i]),c=l.length>1,u=n.get("subplugin"),x=d.useMemo(()=>u&&l.some(O=>O.id===u)?u:l[0]?.id??"requests",[u,l]),m=d.useCallback(O=>{const z=new URLSearchParams(n);O==="requests"?z.delete("subplugin"):z.set("subplugin",O),a(z,{replace:!0})},[n,a]),h=Ze(),y=Us(),p=Zt(),f=Qr(),{isConnected:w}=bt(),{isPluginEnabled:N}=Pe(),E=Tt(),[S,j]=d.useState(!1),[k,R]=d.useState(!1),[D,F]=d.useState(!1),[P,U]=d.useState(!1),K=d.useCallback(async()=>{if(!s||!h.sessionStartTimestamp)return;let O=0;for(;O<3;){const z=Ze.getState();if(!z.hasMore())break;const H=z.events[z.events.length-1];if(!H?.startTime||H.startTime<h.sessionStartTimestamp)break;await z.loadMore(s),O+=1}},[s,h.sessionStartTimestamp]),G=h.filteredItems.filter(O=>!Kt(O)),q=h.selectedIds.size===G.length&&G.length>0;d.useEffect(()=>{!s||!r||(h.sessionStartTimestamp||h.setSessionStartTimestamp(new Date().toISOString()),h.fetchEvents(s),y.fetchRules(s),p.fetchRules(s),f.fetchRules(s))},[s,r]);const C=d.useCallback(O=>{s&&h.selectEvent(s,O)},[s]),b=d.useCallback((O,z)=>{h.updateEventFavorite(O,z)},[]),M=d.useCallback(()=>{s&&h.fetchEvents(s)},[s]),T=d.useCallback(async()=>{if(s){const z=Ze.getState().selectedIds.size;if(z===0){E.show("warning","没有选中任何请求"),j(!1);return}try{await h.batchDelete(s),E.show("success",`已删除 ${z} 条请求`)}catch{E.show("error","删除失败")}j(!1)}},[s,h,E]),B=d.useCallback(()=>{const O=Array.from(h.selectedIds);O.length>0&&window.open(jc(s,O),"_blank")},[s]),A=d.useCallback(async()=>{if(s){F(!0);try{const O=await ac(s);h.clearEvents(),E.show("success",`已清除 ${O.deleted} 个请求`),R(!1)}catch{E.show("error","清除失败")}finally{F(!1)}}},[s,E]);if(!r)return null;const I={mockRulesCount:y.rules.filter(O=>O.enabled).length,breakpointRulesCount:p.activeRulesCount(),breakpointHasPending:p.pendingHits.length>0,chaosHasActive:f.hasActiveRules(),mockPluginEnabled:N(we.MOCK),breakpointPluginEnabled:N(we.BREAKPOINT),chaosPluginEnabled:N(we.CHAOS)};return e.jsxs("div",{className:"h-full flex flex-col",children:[c&&e.jsx("div",{className:"bg-bg-dark flex-shrink-0 px-4 pb-2 border-b border-border",children:e.jsx("div",{className:"flex items-center gap-0.5 p-0.5 bg-bg-medium rounded-lg border border-border w-fit",children:l.map(O=>{const z=O.pluginId?!N(O.pluginId):!1;return e.jsxs("button",{onClick:()=>m(O.id),title:z?`${O.label}（设备端已禁用）`:void 0,className:g("flex items-center gap-1 px-2.5 py-1 rounded text-xs font-medium transition-colors whitespace-nowrap",x===O.id?"bg-primary text-bg-darkest":z?"text-text-muted opacity-50":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:[e.jsx("span",{className:"text-xs",children:O.icon}),e.jsx("span",{children:O.label}),O.badge?.(I)]},O.id)})})}),e.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden",children:[x==="requests"&&e.jsx(Wp,{deviceId:s,httpStore:h,mockStore:y,isConnected:w,onSelectEvent:C,onFavoriteChange:b,onRefresh:M,filteredEvents:G,allSelected:q,showBatchDeleteConfirm:S,setShowBatchDeleteConfirm:j,showClearAllConfirm:k,setShowClearAllConfirm:R,isClearingAll:D,handleClearAll:A,showMoreMenu:P,setShowMoreMenu:U,handleExportSelected:B,handleBatchDelete:T,ensureHistoryLoaded:K,toast:E}),x==="mock"&&(N(we.MOCK)?e.jsx(ll,{deviceId:s,isActive:!0}):e.jsx(Rn,{pluginName:"Mock"})),x==="breakpoint"&&(N(we.BREAKPOINT)?e.jsx(cl,{deviceId:s,isActive:!0}):e.jsx(Rn,{pluginName:"断点"})),x==="chaos"&&(N(we.CHAOS)?e.jsx(dl,{deviceId:s,isActive:!0}):e.jsx(Rn,{pluginName:"故障注入"}))]})]})}function Wp({deviceId:t,httpStore:r,mockStore:s,isConnected:n,onSelectEvent:a,onFavoriteChange:i,onRefresh:o,filteredEvents:l,allSelected:c,showBatchDeleteConfirm:u,setShowBatchDeleteConfirm:x,showClearAllConfirm:m,setShowClearAllConfirm:h,isClearingAll:y,handleClearAll:p,showMoreMenu:f,setShowMoreMenu:w,handleExportSelected:N,handleBatchDelete:E,ensureHistoryLoaded:S,toast:j}){const[k,R]=d.useState(null);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"bg-bg-medium border-b border-border flex-shrink-0",children:[e.jsxs("div",{className:"px-4 py-1.5 flex items-center gap-2 flex-nowrap min-w-0",children:[e.jsx("button",{onClick:o,disabled:r.isLoading,className:g("btn btn-secondary text-xs px-2.5 py-1.5 flex-shrink-0",r.isLoading&&"opacity-70"),title:"刷新列表 (Ctrl+R)",children:"刷新"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("button",{onClick:()=>r.toggleSelectMode(),className:g("btn text-xs px-2.5 py-1.5 flex-shrink-0",r.isSelectMode?"btn-primary":"btn-secondary"),title:r.isSelectMode?"退出选择模式":"进入选择模式",children:r.isSelectMode?"取消选择":"批量选择"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx(ol,{value:r.filters.urlContains,onChange:D=>r.setFilter("urlContains",D),placeholder:"搜索 URL...",minWidth:160,maxWidthMultiplier:5}),e.jsx(mp,{selectOptions:[{key:"method",label:"请求方法",value:r.filters.method,options:[{value:"",label:"全部方法"},{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"PUT",label:"PUT"},{value:"DELETE",label:"DELETE"},{value:"PATCH",label:"PATCH"}],onChange:D=>r.setFilter("method",D)}],options:[{key:"mocked",label:"仅显示 Mock 的请求",shortLabel:"Mock",checked:r.filters.mockedOnly,onChange:D=>r.setFilter("mockedOnly",D)},{key:"favorites",label:"仅显示收藏请求",shortLabel:"收藏",checked:r.filters.favoritesOnly,onChange:D=>r.setFilter("favoritesOnly",D)},{key:"errors",label:"仅显示 Error 请求",shortLabel:"Error",checked:r.filters.statusRange==="400-599",onChange:D=>r.setFilter("statusRange",D?"400-599":"")}]}),e.jsx("div",{className:"flex-1 min-w-4"}),r.filteredItems.length>0&&e.jsx("button",{onClick:()=>r.clearScreen(),className:"btn btn-secondary text-xs px-2 py-1.5 flex-shrink-0",title:"清屏（清除当前显示的数据，刷新不恢复）",children:"清屏"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"自动滚动"}),e.jsx(Ca,{checked:r.autoScroll,onChange:D=>r.setAutoScroll(D)})]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{onClick:()=>w(!f),className:"btn btn-secondary text-xs px-2 py-1.5",title:"更多选项",children:"更多 ▾"}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]",onClick:()=>w(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-bg-dark border border-border rounded-lg shadow-lg z-[101] py-1",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"分组模式"}),e.jsx("div",{className:"flex items-center gap-1 mt-1.5",children:["none","domain","path"].map(D=>e.jsx("button",{onClick:()=>r.setGroupMode(D),className:g("px-2 py-1 text-xs rounded transition-colors",r.groupMode===D?"bg-primary text-white":"bg-bg-light text-text-muted hover:text-text-secondary"),children:D==="none"?"无":D==="domain"?"域名":"路径"},D))})]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary cursor-pointer hover:bg-bg-light border-b border-border",children:[e.jsx(Ue,{checked:r.filters.showBlacklisted,onChange:D=>r.setFilter("showBlacklisted",D)}),"显示已隐藏请求"]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary cursor-pointer hover:bg-bg-light border-b border-border",children:[e.jsx(Ue,{checked:r.showCurrentSessionOnly,onChange:async D=>{r.setShowCurrentSessionOnly(D),D||await S()}}),"仅显示本次启动"]}),e.jsx("a",{href:yc(t),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary hover:bg-bg-light hover:text-text-primary border-b border-border",onClick:()=>w(!1),children:"导出全部 HAR"}),r.events.length>0&&e.jsxs("button",{onClick:()=>{w(!1),h(!0)},className:"w-full flex items-center gap-2 px-3 py-2 text-xs text-red-400 hover:bg-red-500/10",disabled:y,children:[e.jsx(Ae,{size:14}),"清空全部（从数据库删除）"]})]})]})]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs flex-shrink-0",n?"bg-status-success-bg text-status-success":"bg-red-500/20 text-red-400"),children:n?"已连接":"已断开"}),e.jsxs("span",{className:"text-xs text-text-secondary flex-shrink-0",children:["共 ",r.total," 条",r.events.length<r.total&&e.jsxs("span",{className:"text-text-muted",children:["（已加载 ",r.events.length,"）"]})]})]}),r.isSelectMode&&e.jsxs("div",{className:"px-3 py-1.5 bg-primary/5 border-t border-border flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-text-secondary",children:["已选 ",e.jsx("span",{className:"text-primary font-medium",children:r.selectedIds.size})," / ",l.length," 项"]}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsx("button",{onClick:()=>r.selectAll(),className:"btn btn-secondary text-xs px-2.5 py-1",children:c?"取消全选":"全选"}),e.jsx("button",{onClick:()=>r.clearSelectedIds(),className:g("btn btn-secondary text-xs px-2.5 py-1",r.selectedIds.size===0&&"opacity-50 cursor-not-allowed"),disabled:r.selectedIds.size===0,children:"清除选择"}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsx("button",{onClick:async()=>{try{const D=await r.batchFavorite(t,!0);D&&j.show("success",`已收藏 ${D} 条请求`)}catch{j.show("error","收藏失败")}},disabled:r.selectedIds.size===0,className:g("btn bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 hover:bg-yellow-500/20 text-xs px-2.5 py-1",r.selectedIds.size===0&&"opacity-50 cursor-not-allowed hover:bg-yellow-500/10"),children:"收藏"}),e.jsx("button",{onClick:async()=>{try{const D=await r.batchFavorite(t,!1);D&&j.show("success",`已取消收藏 ${D} 条请求`)}catch{j.show("error","取消收藏失败")}},disabled:r.selectedIds.size===0,className:g("btn btn-secondary text-xs px-2.5 py-1",r.selectedIds.size===0&&"opacity-50 cursor-not-allowed"),children:"取消收藏"}),e.jsx("button",{onClick:N,disabled:r.selectedIds.size===0,className:g("btn btn-secondary text-xs px-2.5 py-1",r.selectedIds.size===0&&"opacity-50 cursor-not-allowed"),children:"导出选中"}),e.jsx("button",{onClick:()=>x(!0),disabled:r.selectedIds.size===0,className:g("btn text-xs px-2.5 py-1 border",r.selectedIds.size===0?"bg-red-500/5 text-red-400/50 border-red-500/10 cursor-not-allowed":"bg-red-500/10 text-red-400 border-red-500/20 hover:bg-red-500/20"),children:"删除选中"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[e.jsxs("div",{className:"flex-1 min-w-[400px] border-r border-border flex flex-col relative min-h-0",children:[e.jsx(bs,{isLoading:r.isLoading,text:"刷新 HTTP 列表..."}),e.jsx("div",{className:"flex-1 min-h-0",children:r.groupMode==="none"?e.jsx(yh,{items:r.filteredItems,selectedId:r.selectedEventId,onSelect:a,autoScroll:r.autoScroll,deviceId:t,isSelectMode:r.isSelectMode,selectedIds:r.selectedIds,onToggleSelect:r.toggleSelectId,mockRules:s.rules,onEditMockRule:D=>{s.openEditor(D)},showBlacklisted:r.filters.showBlacklisted,onLoadMore:()=>t&&r.loadMore(t),hasMore:r.hasMore(),isLoading:r.isLoading,loadedCount:r.events.length,totalCount:r.total,onScrollControlsReady:R}):e.jsx(Sh,{events:r.filteredItems.filter(D=>!Kt(D)),groupMode:r.groupMode,selectedId:r.selectedEventId,onSelect:a,deviceId:t,isSelectMode:r.isSelectMode,selectedIds:r.selectedIds,onToggleSelect:r.toggleSelectId,showBlacklisted:r.filters.showBlacklisted})}),k&&e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 z-10",children:[e.jsx("button",{onClick:()=>k.scrollToTop(),disabled:k.isAtTop,className:g("w-8 h-8 rounded-full flex items-center justify-center transition-all shadow-lg",k.isAtTop?"bg-primary/30 text-white/30 cursor-not-allowed":"bg-primary text-white hover:bg-primary/80"),title:"滚动到顶部",children:e.jsx(ms,{size:16})}),e.jsx("button",{onClick:()=>k.scrollToBottom(),disabled:k.isAtBottom,className:g("w-8 h-8 rounded-full flex items-center justify-center transition-all shadow-lg",k.isAtBottom?"bg-primary/30 text-white/30 cursor-not-allowed":"bg-primary text-white hover:bg-primary/80"),title:"滚动到底部",children:e.jsx(hs,{size:16})})]})]}),e.jsx("div",{className:"w-[45%] min-w-[400px] bg-bg-dark/50",children:e.jsx(lp,{event:r.selectedEvent,deviceId:t,onFavoriteChange:i,mockRules:s.rules,onEditMockRule:D=>{s.openEditor(D)},onCreateMockFromRequest:(D,F,P,U)=>{s.openEditorWithTemplate({url:D,method:F,responseBody:P,responseHeaders:U})}})})]}),e.jsx(xt,{isOpen:u,onClose:()=>x(!1),onConfirm:E,title:"删除 HTTP 请求",message:`确定要删除选中的 ${r.selectedIds.size} 个 HTTP 请求吗？

此操作不可恢复。`,confirmText:"确认删除",cancelText:"取消",type:"danger"}),e.jsx(xt,{isOpen:m,onClose:()=>h(!1),onConfirm:p,title:"清除全部请求",message:`确定要清除该设备的全部 HTTP 请求记录吗？

此操作将从数据库永久删除所有请求数据，且不可恢复。`,confirmText:"确认清除",cancelText:"取消",type:"danger",loading:y}),e.jsx(il,{rule:s.editingRule,isOpen:s.isEditorOpen,onClose:s.closeEditor,onSave:async D=>{s.editingRule?.id?await s.updateRule(t,s.editingRule.id,D):await s.createRule(t,D)},loading:s.loading,httpOnly:!0})]})}function Rn({pluginName:t}){return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-text-muted py-12",children:[e.jsx(As,{size:48,className:"mb-4 opacity-50"}),e.jsxs("p",{className:"text-lg font-medium mb-2 text-text-secondary",children:[t," 功能已禁用"]}),e.jsx("p",{className:"text-sm text-text-muted",children:"该功能在设备端已被禁用"}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"如需使用，请在 SDK 中启用对应插件"})]})}const Hp=new $p,Up=36,Vp=[{id:"indicator",label:"",defaultWidth:4,minWidth:4,maxWidth:4,resizable:!1},{id:"index",label:"#",defaultWidth:48,minWidth:40,maxWidth:80,resizable:!1},{id:"time",label:"时间",defaultWidth:112,minWidth:80,maxWidth:180,resizable:!0},{id:"level",label:"级别",defaultWidth:80,minWidth:60,maxWidth:100,resizable:!0},{id:"category",label:"分类",defaultWidth:128,minWidth:80,maxWidth:200,resizable:!0},{id:"message",label:"消息内容",flex:!0,minWidth:150,resizable:!0}],qp={verbose:"VERBOSE",debug:"DEBUG",info:"INFO",warning:"WARN",error:"ERROR"};function Gp({events:t,autoScroll:r,selectedId:s,onSelect:n,onDoubleClick:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l,onLoadMore:c,hasMore:u=!1,isLoading:x=!1,loadedCount:m=0,totalCount:h=0,onScrollControlsReady:y}){const p=d.useRef(null),f=d.useRef(null),[w,N]=d.useState(!0),[E,S]=d.useState(!1),{getColumnStyle:j,isResizing:k,startResize:R}=Zo({storageKey:"log-table",columns:Vp}),{isNewItem:D}=tn(t),F=d.useMemo(()=>`${t[0]?.id||"empty"}-${t.length}`,[t]),P=wa({count:t.length,getScrollElement:()=>p.current,estimateSize:()=>Up,overscan:5,getItemKey:d.useCallback(C=>t[C]?.id??`item-${C}`,[t])}),U=P.getVirtualItems();d.useEffect(()=>{const C=p.current;if(!C)return;const b=()=>{const{scrollTop:M,scrollHeight:T,clientHeight:B}=C,A=M<=10,I=M+B>=T-10;N(A),S(I)};return b(),C.addEventListener("scroll",b,{passive:!0}),()=>C.removeEventListener("scroll",b)},[]);const K=d.useCallback(()=>{P.scrollToIndex(0,{align:"start",behavior:"smooth"})},[P]),G=d.useCallback(()=>{t.length>0&&P.scrollToIndex(t.length-1,{align:"end",behavior:"smooth"})},[P,t.length]);d.useEffect(()=>{y&&y({scrollToTop:K,scrollToBottom:G,isAtTop:w,isAtBottom:E})},[y,K,G,w,E]),d.useEffect(()=>{P.measure()},[F,P]),d.useEffect(()=>{const b=t[0]?.id??null,M=b!==null&&b!==f.current;r&&M&&P.scrollToIndex(0,{align:"start",behavior:"smooth"}),f.current=b},[t,r,P]);const q=d.useCallback((C,b)=>{const M=Rm(C.level),T=o.has(C.id),B=!i&&s===C.id,A=C.seqNum,I=D(C.id),O=()=>{i?l?.(C.id):n?.(C.id)},z=()=>{i||a?.(C)};return e.jsxs("div",{onClick:O,onDoubleClick:z,className:g("flex items-start border-b border-border transition-all duration-150 cursor-pointer py-1.5 min-h-[36px]",B&&"bg-selected",!B&&T&&"bg-primary/15",!B&&!T&&(b%2===0?"bg-bg-dark/20":"bg-transparent"),!B&&!T&&"hover:bg-bg-light/60",I&&!B&&"animate-row-new"),children:[e.jsx("div",{style:j("indicator"),className:g("self-stretch",M.bg)}),e.jsx("div",{style:j("index"),className:g("px-2 whitespace-nowrap text-2xs font-mono text-center leading-5",B?"text-selected-text-muted":"text-text-muted"),children:A}),i&&e.jsx("div",{className:"w-10 px-2 flex-shrink-0 flex items-center h-5",onClick:H=>H.stopPropagation(),children:e.jsx(Ue,{checked:T,onChange:()=>l?.(C.id)})}),e.jsx("div",{style:j("time"),className:g("px-2 whitespace-nowrap text-2xs leading-5",B?"text-selected-text-secondary":"text-text-muted"),children:ut(C.timestamp)}),e.jsx("div",{style:j("level"),className:"px-2 leading-5",children:e.jsx("span",{className:g("inline-flex items-center justify-center px-1.5 py-0.5 rounded text-2xs font-bold",M.bg,M.color),children:qp[C.level]})}),e.jsx("div",{style:j("category"),className:g("px-2 truncate text-2xs font-medium leading-5",B?"text-selected-text-primary":"text-primary"),title:C.category||C.subsystem||"-",children:C.category||C.subsystem||"-"}),e.jsx("div",{style:j("message"),className:g("px-2 text-2xs whitespace-pre-wrap break-words min-w-0 leading-5",B?"text-selected-text-primary":"text-text-primary"),children:C.message})]})},[s,i,o,n,l,a,j,D]);return e.jsxs("div",{className:g("h-full flex flex-col overflow-hidden",k&&"select-none"),children:[e.jsx("div",{className:"flex-shrink-0 bg-bg-medium border-b border-border",children:e.jsxs("div",{className:"flex items-center text-xs font-semibold text-text-secondary uppercase tracking-wider",children:[e.jsx("div",{style:j("indicator"),className:"relative",children:e.jsx($s,{})}),e.jsxs("div",{style:j("index"),className:"relative px-2 py-1.5 text-center",children:["#",e.jsx($s,{})]}),i&&e.jsxs("div",{className:"relative w-10 px-2 py-1.5 flex-shrink-0",children:[e.jsx("span",{className:"sr-only",children:"选择"}),e.jsx($s,{})]}),e.jsxs("div",{style:j("time"),className:"relative px-2 py-1.5",children:["时间",e.jsx(Ot,{onMouseDown:C=>R("time",C.clientX),isResizing:k})]}),e.jsxs("div",{style:j("level"),className:"relative px-2 py-1.5",children:["级别",e.jsx(Ot,{onMouseDown:C=>R("level",C.clientX),isResizing:k})]}),e.jsxs("div",{style:j("category"),className:"relative px-2 py-1.5",children:["分类",e.jsx(Ot,{onMouseDown:C=>R("category",C.clientX),isResizing:k})]}),e.jsxs("div",{style:j("message"),className:"relative px-2 py-1.5 min-w-0",children:["消息内容",e.jsx(Ot,{onMouseDown:C=>R("message",C.clientX),isResizing:k})]})]})}),e.jsx("div",{ref:p,className:"flex-1 overflow-auto font-mono text-sm",children:t.length>0?e.jsxs("div",{style:{height:`${P.getTotalSize()+(c?60:0)}px`,width:"100%",position:"relative"},children:[U.map(C=>{const b=t[C.index],M=`${b.id}-${C.index}`;return e.jsx("div",{"data-index":C.index,ref:P.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${C.start}px)`},children:q(b,C.index)},M)}),c&&e.jsx("div",{style:{position:"absolute",top:`${P.getTotalSize()}px`,left:0,width:"100%"},children:e.jsx(ka,{onClick:c,hasMore:u,isLoading:x,loadedCount:m,totalCount:h})})]},F):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-20",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-bg-light/50 flex items-center justify-center mb-4",children:e.jsx(es,{size:32,className:"opacity-60"})}),e.jsx("p",{className:"text-sm font-medium text-text-secondary mb-1",children:"暂无日志"}),e.jsx("p",{className:"text-xs text-text-muted",children:"等待日志事件到达..."})]})})]})}function Yp(t,r){const s=new Map,n=[...t].sort((o,l)=>{const c=r?r(o):o,u=r?r(l):l;return c.localeCompare(u,void 0,{sensitivity:"base"})});for(const o of n){const c=(r?r(o):o).charAt(0).toUpperCase(),u=/^[A-Z]$/.test(c)?c:"#";s.has(u)||s.set(u,[]),s.get(u).push(o)}const a=new Map,i=Array.from(s.keys()).sort((o,l)=>o==="#"?1:l==="#"?-1:o.localeCompare(l));for(const o of i)a.set(o,s.get(o));return a}function $t({options:t,value:r,placeholder:s,onChange:n,onClear:a,formatOption:i,showEmptyOption:o=!1,className:l}){const[c,u]=d.useState(!1),[x,m]=d.useState(""),[h,y]=d.useState({top:0,left:0,width:0}),p=d.useRef(null),f=d.useRef(null),w=d.useRef(null),N=P=>i?i(P):P;d.useEffect(()=>{if(c&&p.current){const P=p.current.getBoundingClientRect();y({top:P.bottom+4,left:P.left,width:Math.max(P.width,256)})}},[c]),d.useEffect(()=>{function P(U){const K=U.target;p.current&&!p.current.contains(K)&&f.current&&!f.current.contains(K)&&u(!1)}return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[]),d.useEffect(()=>{c&&w.current&&w.current.focus()},[c]);const E=d.useMemo(()=>{if(!x.trim())return t;const P=x.toLowerCase();return t.filter(U=>{const K=i?i(U):U;return U.toLowerCase().includes(P)||K.toLowerCase().includes(P)})},[t,x,i]),S=d.useMemo(()=>Yp(E,i),[E,i]),j=r?N(r):s,k=o||!!r,R=P=>{n(P),u(!1),m("")},D=P=>{P.stopPropagation(),a?a():n(""),m("")},F=P=>{P.key==="Escape"&&(u(!1),m(""))};return e.jsxs("div",{ref:p,className:g("relative",l),children:[e.jsxs("button",{type:"button",onClick:()=>u(!c),className:g("flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors w-full","bg-bg-medium border border-border hover:bg-bg-light",k?"text-text-primary":"text-text-muted",c&&"ring-1 ring-primary"),children:[e.jsx("span",{className:"flex-1 text-left",children:j}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[r&&e.jsx("span",{onClick:D,className:"p-0.5 rounded hover:bg-bg-dark text-text-muted hover:text-text-secondary cursor-pointer",children:e.jsx($r,{size:12})}),e.jsx(yt,{size:14,className:g("text-text-muted transition-transform",c&&"rotate-180")})]})]}),c&&ur.createPortal(e.jsxs("div",{ref:f,className:"fixed bg-bg-dark border border-border rounded-lg shadow-xl overflow-hidden",style:{top:h.top,left:h.left,width:h.width,zIndex:9999},children:[e.jsx("div",{className:"p-2 border-b border-border",children:e.jsxs("div",{className:"relative",children:[e.jsx(St,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{ref:w,type:"text",value:x,onChange:P=>m(P.target.value),onKeyDown:F,placeholder:"搜索...",className:"w-full pl-8 pr-3 py-1.5 text-sm bg-bg-medium border border-border rounded-md focus:outline-none focus:border-primary"}),x&&e.jsx("button",{onClick:()=>m(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary",children:e.jsx($r,{size:12})})]})}),e.jsxs("div",{className:"max-h-64 overflow-y-auto",children:[e.jsxs("button",{onClick:()=>R(""),className:g("w-full px-3 py-2 text-left text-sm transition-colors flex items-center gap-2",r?"text-text-secondary hover:bg-bg-medium":"bg-primary/10 text-primary"),children:[o&&!r&&e.jsx(Re,{size:14,className:"shrink-0"}),e.jsx("span",{className:o&&r?"ml-[22px]":"",children:s})]}),S.size>0?Array.from(S.entries()).map(([P,U])=>e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 px-3 py-1 text-xs font-semibold text-text-muted bg-bg-dark border-y border-border",children:P}),U.map(K=>e.jsxs("button",{onClick:()=>R(K),className:g("w-full px-3 py-1.5 text-left text-sm transition-colors truncate flex items-center gap-2",K===r?"bg-primary/10 text-primary":"text-text-primary hover:bg-bg-medium"),children:[o&&K===r&&e.jsx(Re,{size:14,className:"shrink-0"}),e.jsx("span",{className:o&&K!==r?"ml-[22px]":"",children:N(K)})]},K))]},P)):e.jsx("div",{className:"px-3 py-4 text-center text-sm text-text-muted",children:"无匹配结果"})]}),e.jsxs("div",{className:"px-3 py-1.5 border-t border-border text-xs text-text-muted",children:["共 ",t.length," 项",x&&E.length!==t.length&&e.jsxs("span",{children:["，已筛选 ",E.length," 项"]})]})]}),document.body)]})}const Kp=[{level:"error",label:"Error",icon:e.jsx($r,{size:14}),bgClass:"bg-level-error",textClass:"text-white"},{level:"warning",label:"Warning",icon:e.jsx(jt,{size:14}),bgClass:"bg-level-warning",textClass:"text-white"},{level:"info",label:"Info",icon:e.jsx(No,{size:14}),bgClass:"bg-level-info",textClass:"text-white"},{level:"debug",label:"Debug",icon:e.jsx(Pd,{size:14}),bgClass:"bg-level-debug",textClass:"text-white"},{level:"verbose",label:"Verbose",icon:e.jsx(ko,{size:14}),bgClass:"bg-level-verbose",textClass:"text-white"}];function Jp({minLevel:t,subsystems:r,categories:s,selectedSubsystem:n,selectedCategory:a,searchText:i,searchQuery:o,onMinLevelChange:l,onSubsystemChange:c,onCategoryChange:u,onSearchChange:x,onSearchQueryChange:m}){const[h,y]=d.useState(!1),[p,f]=d.useState(!1),w=d.useRef(null);return d.useEffect(()=>{function N(E){w.current&&!w.current.contains(E.target)&&f(!1)}return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[]),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex gap-0.5",children:Kp.map(({level:N,label:E,icon:S,bgClass:j,textClass:k})=>{const R=N===t;return e.jsxs("button",{onClick:()=>l(N),title:`显示 ${E} 及更高级别日志`,className:g("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium whitespace-nowrap",R?`${j} ${k} shadow-sm`:"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:[e.jsx("span",{children:S}),e.jsx("span",{children:E})]},N)})}),e.jsx("div",{className:"w-px h-6 bg-border"}),e.jsx($t,{options:r,value:n,placeholder:"所有 Subsystem",onChange:c}),e.jsx($t,{options:s,value:a,placeholder:"所有 Category",onChange:u}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-[200px] max-w-[600px]",children:[e.jsx("button",{onClick:()=>y(!h),className:g("px-2 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap",h?"bg-primary text-white":"bg-bg-light text-text-muted hover:text-text-secondary"),title:"切换高级搜索",children:h?"高级":"简单"}),h?e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o,onChange:N=>m(N.target.value),placeholder:"level:error subsystem:Network message:timeout...",className:"input w-full font-mono text-sm"}),e.jsx("button",{onClick:()=>f(!p),className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary",title:"搜索语法帮助",children:"?"}),p&&e.jsxs("div",{ref:w,className:"absolute top-full right-0 mt-2 w-80 p-3 bg-bg-dark border border-border rounded-lg shadow-xl z-50",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary mb-2",children:"搜索语法"}),e.jsx("pre",{className:"text-xs text-text-secondary whitespace-pre-wrap font-mono",children:zc})]})]}):e.jsx("input",{type:"text",value:i,onChange:N=>x(N.target.value),placeholder:"搜索日志内容...",className:"input flex-1"})]})]})}const Xp=t=>{switch(t?.toLowerCase()){case"debug":return"bg-gray-500/20 text-gray-400 border-gray-500/30";case"info":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"notice":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"warning":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"error":return"bg-red-500/20 text-red-400 border-red-500/30";case"fault":case"critical":return"bg-red-600/20 text-red-300 border-red-600/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}},Qp=({event:t,onClose:r})=>{const s=d.useRef(null),[n,a]=d.useState({x:0,y:0}),[i,o]=d.useState(!1),[l,c]=d.useState({x:0,y:0}),[u,x]=d.useState(null);d.useEffect(()=>{const S=j=>{j.key==="Escape"&&r()};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[r]),d.useEffect(()=>{if(s.current){const S=s.current.getBoundingClientRect();a({x:(window.innerWidth-S.width)/2,y:(window.innerHeight-S.height)/2})}},[]);const m=d.useCallback(S=>{S.target.closest(".modal-header")&&(o(!0),c({x:S.clientX-n.x,y:S.clientY-n.y}))},[n]),h=d.useCallback(S=>{i&&a({x:S.clientX-l.x,y:S.clientY-l.y})},[i,l]),y=d.useCallback(()=>{o(!1)},[]);d.useEffect(()=>{if(i)return window.addEventListener("mousemove",h),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",y)}},[i,h,y]);const p=d.useCallback(async(S,j)=>{try{await rt(S),x(j),setTimeout(()=>x(null),2e3)}catch(k){console.error("Failed to copy:",k)}},[]),f=S=>{const j=new Date(S);return j.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(j.getMilliseconds()).padStart(3,"0")},w=({text:S,fieldKey:j})=>e.jsx("button",{onClick:()=>p(S,j),className:"opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-bg-light rounded",title:"复制",children:u===j?e.jsx(Re,{size:14,className:"text-green-400"}):e.jsx(dt,{size:14,className:"text-text-muted hover:text-text-primary"})}),N=(S,j,k,R=!1)=>{const D=j?.toString()||"-",F=j!=null&&j!=="";return e.jsxs("div",{className:"flex items-start gap-3 py-2 border-b border-border last:border-b-0 group",children:[e.jsx("div",{className:"w-24 flex-shrink-0 text-text-secondary text-xs font-medium",children:S}),e.jsx("div",{className:g("flex-1 text-xs break-all",R?"font-mono":"",F?"text-text-primary":"text-text-muted"),children:D}),F&&e.jsx(w,{text:D,fieldKey:k})]})},E=()=>!t.tags||t.tags.length===0?e.jsx("span",{className:"text-text-muted",children:"-"}):e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.tags.map((S,j)=>e.jsx("span",{className:"px-2 py-0.5 text-2xs bg-bg-light rounded-full text-text-secondary",children:S},j))});return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsxs("div",{ref:s,className:"absolute bg-bg-dark rounded-lg shadow-2xl border border-border min-w-[500px] max-w-[700px] max-h-[80vh] flex flex-col",style:{left:n.x,top:n.y,cursor:i?"grabbing":"default"},onMouseDown:m,children:[e.jsxs("div",{className:"modal-header flex items-center justify-between px-4 py-3 border-b border-border cursor-grab active:cursor-grabbing",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"日志详情"}),e.jsx("span",{className:g("px-2 py-0.5 text-2xs font-medium rounded border",Xp(t.level)),children:t.level?.toUpperCase()||"UNKNOWN"})]}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-bg-light rounded-md transition-colors",title:"关闭 (ESC)",children:e.jsx($r,{size:20,className:"text-text-muted hover:text-text-primary"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-1",children:[N("ID",t.id,"id",!0),N("序号",t.seqNum,"seqNum"),N("时间",f(t.timestamp),"timestamp"),N("级别",t.level,"level"),N("来源",t.source,"source"),N("子系统",t.subsystem,"subsystem"),N("分类",t.category,"category"),N("Logger",t.loggerName,"loggerName"),N("线程",t.thread,"thread"),N("文件",t.file,"file"),N("函数",t.function,"function"),N("行号",t.line,"line"),N("Trace ID",t.traceId,"traceId",!0),e.jsxs("div",{className:"py-2 border-b border-border group",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-24 flex-shrink-0 text-text-secondary text-xs font-medium",children:"消息"}),e.jsx("div",{className:"flex-1"}),t.message&&e.jsx(w,{text:t.message,fieldKey:"message"})]}),e.jsx("div",{className:"mt-2 p-3 bg-bg-medium rounded-md",children:e.jsx("pre",{className:"text-xs text-text-primary whitespace-pre-wrap break-all font-mono",children:t.message||"-"})})]}),e.jsx("div",{className:"py-2",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-24 flex-shrink-0 text-text-secondary text-xs font-medium",children:"标签"}),e.jsx("div",{className:"flex-1",children:E()})]})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-border bg-bg-medium/50 rounded-b-lg",children:e.jsx("p",{className:"text-2xs text-text-muted text-center",children:"按 ESC 或点击外部区域关闭 • 拖动标题栏可移动窗口"})})]})]})};class Zp{metadata={pluginId:we.LOG,displayName:"Log",version:"1.0.0",description:"应用日志监控",icon:e.jsx(es,{size:16})};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.state="ready"}render(r){return e.jsx(ef,{...r})}onActivate(){console.log("[LogPlugin] Activated")}onDeactivate(){console.log("[LogPlugin] Deactivated")}onEvent(r){}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}}function ef({context:t,isActive:r}){const s=t.deviceId,{events:n,filteredEvents:a,total:i,isLoading:o,autoScroll:l,selectedId:c,selectedIds:u,isSelectMode:x,filters:m,subsystems:h,categories:y,fetchEvents:p,fetchFilterOptions:f,clearEvents:w,setAutoScroll:N,setFilter:E,setMinLevel:S,setSearchQuery:j,selectEvent:k,toggleSelectMode:R,toggleSelectId:D,selectAll:F,clearSelectedIds:P,batchDelete:U,loadMore:K,hasMore:G,showCurrentSessionOnly:q,sessionStartTimestamp:C,setShowCurrentSessionOnly:b,clearScreen:M}=Ft(),{isConnected:T}=bt(),B=Tt(),[A,I]=d.useState(!1),[O,z]=d.useState(!1),[H,le]=d.useState(!1),[Y,V]=d.useState(!1),[ie,Ne]=d.useState(null),[se,de]=d.useState(!1),[_,ue]=d.useState(null),[ae,ee]=d.useState(!1),me=d.useCallback(async()=>{if(!s||!C)return;let L=0;for(;L<3;){const Q=Ft.getState();if(!Q.hasMore())break;const Z=Q.events[Q.events.length-1];if(!Z?.timestamp||Z.timestamp<C)break;await Q.loadMore(s),L+=1}},[s,C]),Ce=async()=>{if(!(!s||ae)){ee(!0),V(!1);try{B.show("info","正在请求设备导出日志..."),await bc(s),B.show("success","日志导出成功")}catch(L){console.error("Export logs failed:",L),B.show("error","导出失败: "+(L instanceof Error?L.message:"未知错误"))}finally{ee(!1)}}};d.useEffect(()=>{if(r&&s){const L=Ft.getState();L.sessionStartTimestamp||L.setSessionStartTimestamp(new Date().toISOString()),p(s),f(s)}},[r,s,p,f]);const Fe=d.useCallback(()=>{s&&p(s)},[s,p]),et=d.useCallback(async()=>{if(s){de(!0);try{const L=await uc(s);w(),B.show("success",`已清除 ${L.deleted} 条日志`),I(!1)}catch{B.show("error","清除失败")}finally{de(!1)}}},[s,w,B]),ze=d.useCallback(async()=>{!s||u.size===0||(await U(s),z(!1),R(),B.show("success",`已删除 ${u.size} 条日志`))},[s,u.size,U,R,B]),re=d.useCallback(L=>{k(L)},[k]),Se=d.useCallback(L=>{ue(L)},[]);return r?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Fe,className:"btn btn-secondary text-xs px-2.5 py-1.5",title:"刷新",disabled:o,children:"刷新"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("button",{onClick:R,className:g("btn text-xs px-2.5 py-1.5 flex-shrink-0",x?"btn-primary":"btn-secondary"),title:x?"退出选择":"批量选择",children:x?"取消选择":"批量选择"}),e.jsx(ol,{value:m.searchQuery||"",onChange:L=>j(L),placeholder:"搜索日志...",minWidth:160,maxWidthMultiplier:5}),e.jsxs("button",{onClick:()=>le(!H),className:g("flex items-center gap-1.5 px-2.5 py-1.5 rounded text-xs font-medium border transition-colors flex-shrink-0",H||m.minLevel!=="verbose"||m.subsystem||m.category||m.text?"bg-primary/15 text-primary border-primary hover:bg-primary/20":"bg-bg-light text-text-secondary border-border hover:text-text-primary hover:border-text-muted"),title:"过滤器",children:[e.jsx(yo,{size:14}),"过滤器"]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F,className:"btn btn-secondary text-xs px-2 py-1.5",children:"全选"}),e.jsx("button",{onClick:P,className:"btn btn-secondary text-xs px-2 py-1.5",children:"清除选择"}),u.size>0&&e.jsxs("button",{onClick:()=>z(!0),className:"btn text-xs px-2 py-1.5 bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20 flex items-center gap-1",children:[e.jsx(Ae,{size:12}),"删除 (",u.size,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[a.length>0&&e.jsx("button",{onClick:()=>M(),className:"btn btn-secondary text-xs px-2 py-1.5 flex-shrink-0",title:"清屏（清除当前显示的数据，刷新不恢复）",children:"清屏"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"自动滚动"}),e.jsx(Ca,{checked:l,onChange:L=>N(L)})]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{onClick:()=>V(!Y),className:"btn btn-secondary text-xs px-2 py-1.5",title:"更多选项",children:"更多 ▾"}),Y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]",onClick:()=>V(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-bg-dark border border-border rounded-lg shadow-lg z-[101] py-1",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary cursor-pointer hover:bg-bg-light border-b border-border",children:[e.jsx(Ue,{checked:q,onChange:async L=>{b(L),L||await me()}}),"仅显示本次启动"]}),e.jsxs("button",{onClick:Ce,disabled:ae,className:g("w-full flex items-center gap-2 px-3 py-2 text-xs text-text-secondary hover:bg-bg-light hover:text-text-primary border-b border-border",ae&&"opacity-50 cursor-wait"),children:[ae?e.jsx("div",{className:"w-3.5 h-3.5 border-2 border-text-secondary border-t-transparent rounded-full animate-spin"}):e.jsx(zr,{size:14}),ae?"正在导出设备日志...":"导出设备日志 (ZIP)"]}),a.length>0&&e.jsxs("button",{onClick:()=>{V(!1),I(!0)},className:"w-full flex items-center gap-2 px-3 py-2 text-xs text-red-400 hover:bg-red-500/10",disabled:se,children:[e.jsx(Ae,{size:14}),"清空全部（从数据库删除）"]})]})]})]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs",T?"bg-status-success-bg text-status-success":"bg-red-500/20 text-red-400"),children:T?"已连接":"已断开"}),e.jsxs("span",{className:"text-xs text-text-secondary",children:["共 ",i," 条",n.length<i&&e.jsxs("span",{className:"text-text-muted",children:["（已加载 ",n.length,"）"]})]})]})]}),H&&e.jsx("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium",children:e.jsx(Jp,{minLevel:m.minLevel,subsystems:h,categories:y,selectedSubsystem:m.subsystem,selectedCategory:m.category,searchText:m.text,searchQuery:m.searchQuery,onMinLevelChange:S,onSubsystemChange:L=>E("subsystem",L),onCategoryChange:L=>E("category",L),onSearchChange:L=>E("text",L),onSearchQueryChange:j})}),e.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[e.jsx(Gp,{events:a,autoScroll:l,selectedId:c,onSelect:re,onDoubleClick:Se,isSelectMode:x,selectedIds:u,onToggleSelect:D,onLoadMore:()=>s&&K(s),hasMore:G(),isLoading:o,loadedCount:n.length,totalCount:i,onScrollControlsReady:Ne}),e.jsx(bs,{isLoading:o}),ie&&e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 z-10",children:[e.jsx("button",{onClick:()=>ie.scrollToTop(),disabled:ie.isAtTop,className:g("w-8 h-8 rounded-full flex items-center justify-center transition-all shadow-lg",ie.isAtTop?"bg-primary/30 text-white/30 cursor-not-allowed":"bg-primary text-white hover:bg-primary/80"),title:"滚动到顶部",children:e.jsx(ms,{size:16})}),e.jsx("button",{onClick:()=>ie.scrollToBottom(),disabled:ie.isAtBottom,className:g("w-8 h-8 rounded-full flex items-center justify-center transition-all shadow-lg",ie.isAtBottom?"bg-primary/30 text-white/30 cursor-not-allowed":"bg-primary text-white hover:bg-primary/80"),title:"滚动到底部",children:e.jsx(hs,{size:16})})]})]}),e.jsx(xt,{isOpen:A,onClose:()=>I(!1),onConfirm:et,title:"清除全部日志",message:`确定要清除该设备的全部日志记录吗？

此操作将从数据库永久删除所有日志数据，且不可恢复。`,confirmText:"确认清除",cancelText:"取消",type:"danger",loading:se}),e.jsx(xt,{isOpen:O,onClose:()=>z(!1),onConfirm:ze,title:"删除日志",message:`确定要删除选中的 ${u.size} 条日志吗？

此操作不可恢复。`,confirmText:"确认删除",cancelText:"取消",type:"danger"}),_&&e.jsx(Qp,{event:_,onClose:()=>ue(null)})]}):null}const tf=new Zp;function sf(t){const r=new Map;for(const s of t){const n=s.url;r.has(n)||r.set(n,{url:n,domain:en(n),sessions:[],hasActiveSession:!1});const a=r.get(n);a.sessions.push(s),s.isOpen&&(a.hasActiveSession=!0)}for(const s of r.values())s.sessions.sort((n,a)=>new Date(a.connectTime).getTime()-new Date(n.connectTime).getTime());return Array.from(r.values()).sort((s,n)=>{if(s.hasActiveSession!==n.hasActiveSession)return s.hasActiveSession?-1:1;const a=new Date(s.sessions[0].connectTime).getTime();return new Date(n.sessions[0].connectTime).getTime()-a})}function rf({sessions:t,selectedId:r,onSelect:s,loading:n,autoScroll:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l}){const c=d.useRef(null),u=d.useRef(null),x=d.useMemo(()=>sf(t),[t]),[m,h]=d.useState(new Set);d.useEffect(()=>{h(new Set(x.map(p=>p.url)))},[x.length]),d.useEffect(()=>{if(!a||t.length===0)return;const p=t[0]?.id;p&&p!==u.current&&c.current&&(c.current.scrollTop=0),u.current=p},[t,a]);const y=p=>{h(f=>{const w=new Set(f);return w.has(p)?w.delete(p):w.add(p),w})};return t.length===0&&!n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-12",children:[e.jsx(_s,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"暂无 WebSocket 会话"}),e.jsx("p",{className:"text-xs mt-1 text-text-muted",children:"当设备建立 WebSocket 连接时会显示在这里"})]}):e.jsxs("div",{ref:c,className:"overflow-auto h-full",children:[e.jsx("div",{children:x.map(p=>e.jsx(nf,{group:p,isExpanded:m.has(p.url),onToggleExpand:()=>y(p.url),selectedId:r,onSelect:s,isSelectMode:i,selectedIds:o,onToggleSelect:l},p.url))}),n&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})}),!n&&t.length>0&&e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-xs text-text-muted",children:"没有更多数据了"})})]})}const nf=d.memo(function({group:r,isExpanded:s,onToggleExpand:n,selectedId:a,onSelect:i,isSelectMode:o,selectedIds:l,onToggleSelect:c}){const u=r.sessions.length;return u>1?e.jsxs("div",{className:"border-b border-border",children:[e.jsxs("div",{onClick:n,className:"px-4 py-3 cursor-pointer hover:bg-bg-light/50 transition-colors flex items-center gap-2",children:[e.jsx("span",{className:"text-text-muted w-4 h-4 flex items-center justify-center",children:s?e.jsx(yt,{size:14}):e.jsx(at,{size:14})}),e.jsx(xl,{isOpen:r.hasActiveSession}),e.jsx("span",{className:"font-mono text-sm truncate flex-1 text-text-primary",children:r.domain}),e.jsxs("span",{className:"text-xs text-text-muted bg-bg-light px-2 py-0.5 rounded-full",children:[u," 个连接"]})]}),s&&e.jsx("div",{className:"bg-bg-base/50",children:r.sessions.map(m=>e.jsx(Oi,{session:m,isSelected:a===m.id,isChecked:l.has(m.id),isSelectMode:o,onSelect:i,onToggleSelect:c,isGrouped:!0},m.id))})]}):e.jsx("div",{className:"border-b border-border",children:e.jsx(Oi,{session:r.sessions[0],isSelected:a===r.sessions[0].id,isChecked:l.has(r.sessions[0].id),isSelectMode:o,onSelect:i,onToggleSelect:c,isGrouped:!1})})}),Oi=d.memo(function({session:r,isSelected:s,isChecked:n,isSelectMode:a,onSelect:i,onToggleSelect:o,isGrouped:l}){const c=r.disconnectTime?zt(new Date(r.connectTime),new Date(r.disconnectTime)):null,u=()=>{a&&o?o(r.id):i(r.id)};return e.jsxs("div",{onClick:u,className:g("cursor-pointer transition-all",l?"px-4 py-2 pl-10":"px-4 py-3",s&&!a&&"bg-selected",a&&n&&"bg-primary/15",!s&&!n&&"hover:bg-bg-light/50",l&&"border-b border-border last:border-0"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a?e.jsx("div",{onClick:x=>x.stopPropagation(),children:e.jsx(Ue,{checked:n,onChange:()=>o?.(r.id)})}):e.jsx(xl,{isOpen:r.isOpen,isSelectedRow:s&&!a}),l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:g("text-sm flex-1",s&&!a?"text-white":"text-text-primary"),children:ut(r.connectTime)}),r.isOpen?e.jsxs("span",{className:g("inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full",s&&!a?"text-green-500 bg-green-500/20":"text-green-400 bg-green-500/10"),children:[e.jsx("span",{className:g("w-1.5 h-1.5 rounded-full animate-pulse",s&&!a?"bg-green-500":"bg-green-400")}),"活跃"]}):e.jsxs("span",{className:g("text-xs px-2 py-0.5 rounded-full",s&&!a?"text-white/70 bg-white/10":"text-text-muted bg-bg-light"),children:["已断开",r.closeCode?` (${r.closeCode})`:""]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:g("font-mono text-sm truncate flex-1",s&&!a?"text-white font-medium":"text-text-primary"),children:en(r.url)}),e.jsx("span",{className:g("text-xs",s&&!a?"text-white/70":"text-text-muted"),children:ut(r.connectTime)})]})]}),!l&&e.jsx("div",{className:g("text-xs truncate font-mono ml-5",s&&!a?"text-white/70":"text-text-muted"),children:r.url}),l&&!r.isOpen&&c&&e.jsxs("div",{className:g("text-xs ml-5",s&&!a?"text-white/60":"text-text-muted"),children:["持续 ",c]}),!l&&e.jsx("div",{className:"flex items-center gap-3 mt-1.5 ml-5",children:r.isOpen?e.jsxs("span",{className:g("inline-flex items-center gap-1 text-xs",s&&!a?"text-green-500":"text-green-400"),children:[e.jsx("span",{className:g("w-1.5 h-1.5 rounded-full animate-pulse",s&&!a?"bg-green-500":"bg-green-400")}),"连接中"]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:g("text-xs",s&&!a?"text-white/70":"text-text-muted"),children:["已关闭",r.closeCode?` (${r.closeCode})`:""]}),c&&e.jsxs("span",{className:g("text-xs",s&&!a?"text-white/70":"text-text-muted"),children:["持续 ",c]})]})})]})});function xl({isOpen:t,isSelectedRow:r}){return e.jsx("span",{className:g("w-3 h-3 rounded-full flex-shrink-0",t?"bg-green-500 shadow-green-500/50 shadow-sm":r?"bg-gray-400":"bg-gray-500")})}function af({deviceId:t,session:r,frames:s,loading:n,onLoadMore:a,hasMore:i,frameDirection:o,onFrameDirectionChange:l,loadedCount:c,totalCount:u,autoScroll:x,onAutoScrollChange:m}){const[h,y]=d.useState("frames"),[p,f]=d.useState(null);return r?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/50",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"🔌"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-mono text-sm text-text-primary truncate",children:r.url}),e.jsxs("p",{className:"text-xs text-text-muted",children:[r.frameCount," 帧 • 连接于 ",ut(r.connectTime)]})]}),e.jsx(of,{isOpen:!r.disconnectTime,closeCode:r.closeCode})]})}),e.jsxs("div",{className:"px-4 py-2 border-b border-border bg-bg-dark flex gap-2",children:[e.jsxs("button",{onClick:()=>y("frames"),className:g("px-3 py-1.5 text-xs font-medium rounded-lg transition-all",h==="frames"?"bg-primary/20 text-primary":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:["📨 消息帧 (",r.frameCount,")"]}),e.jsx("button",{onClick:()=>y("info"),className:g("px-3 py-1.5 text-xs font-medium rounded-lg transition-all",h==="info"?"bg-primary/20 text-primary":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:"ℹ️ 连接信息"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[h==="frames"&&e.jsx(lf,{deviceId:t,sessionId:r.id,frames:s,loading:n,onLoadMore:a,hasMore:i,expandedFrameId:p,onToggleExpand:f,direction:o,onDirectionChange:l,loadedCount:c,totalCount:u,autoScroll:x,onAutoScrollChange:m}),h==="info"&&e.jsx(uf,{session:r})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("span",{className:"text-4xl mb-3 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:"选择一个 WebSocket 会话查看详情"})]})}function of({isOpen:t,closeCode:r}){return t?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium rounded-full bg-green-500/10 text-green-400 border border-green-500/20",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),"连接中"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium rounded-full bg-text-muted/10 text-text-muted border border-border",children:["已关闭",r?` (${r})`:""]})}function lf({deviceId:t,sessionId:r,frames:s,loading:n,onLoadMore:a,hasMore:i,expandedFrameId:o,onToggleExpand:l,direction:c,onDirectionChange:u,loadedCount:x,totalCount:m,autoScroll:h,onAutoScrollChange:y}){const p=d.useRef(null),f=d.useRef(s.length),{isNewItem:w}=tn(s),N=s.filter(j=>j.direction==="send").length,E=s.filter(j=>j.direction==="receive").length,S=s.reduce((j,k)=>j+(k.payloadSize||0),0);return d.useEffect(()=>{s.length>f.current&&h&&p.current&&(p.current.scrollTop=0),f.current=s.length},[s.length,h]),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-4 py-2 border-b-2 border-border flex items-center justify-between gap-3 bg-bg-dark/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-bg-light/50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>u(""),className:g("px-2 py-1 text-xs rounded transition-colors",c?"text-text-muted hover:text-text-primary":"bg-bg-dark text-text-primary"),children:"全部"}),e.jsxs("button",{onClick:()=>u("send"),className:g("px-2 py-1 text-xs rounded transition-colors flex items-center gap-1",c==="send"?"bg-blue-500/20 text-blue-400":"text-text-muted hover:text-blue-400"),children:[e.jsx("span",{children:"↑"})," 发送"]}),e.jsxs("button",{onClick:()=>u("receive"),className:g("px-2 py-1 text-xs rounded transition-colors flex items-center gap-1",c==="receive"?"bg-green-500/20 text-green-400":"text-text-muted hover:text-green-400"),children:[e.jsx("span",{children:"↓"})," 接收"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[e.jsxs("span",{className:"text-blue-400",children:["↑",N]}),e.jsxs("span",{className:"text-green-400",children:["↓",E]}),e.jsxs("span",{children:["• ",ps(S)]})]})]}),e.jsx(Ca,{checked:h,onChange:y,label:"自动滚动"})]}),e.jsx("div",{ref:p,className:"flex-1 overflow-auto",children:s.length===0&&!n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-8",children:[e.jsx("span",{className:"text-3xl mb-2 opacity-50",children:"📭"}),e.jsx("p",{className:"text-sm",children:"暂无消息帧"})]}):e.jsxs("div",{className:"divide-y divide-border",children:[s.map(j=>{const k=o===j.id,R=j.seqNum;return e.jsx(cf,{deviceId:t,sessionId:r,frame:j,isExpanded:k,onToggle:()=>l(k?null:j.id),rowNumber:R,isNew:w(j.id)},j.id)}),a&&s.length>0&&e.jsx(ka,{onClick:a,isLoading:n,hasMore:i??!1,loadedCount:x??s.length,totalCount:m??s.length})]})})]})}const cf=d.memo(function({deviceId:r,sessionId:s,frame:n,isExpanded:a,onToggle:i,rowNumber:o,isNew:l=!1}){const c=n.direction==="send",u=n.opcode==="text",[x,m]=d.useState(null),[h,y]=d.useState(!1),[p,f]=d.useState(null),[w,N]=d.useState("auto"),E=d.useCallback(async()=>{if(!(x||h)){y(!0),f(null);try{const k=await mc(r,s,n.id);m(k)}catch(k){f(k instanceof Error?k.message:"加载失败")}finally{y(!1)}}},[r,s,n.id,x,h]),S=()=>{a||E(),i()},j=()=>{if(h)return e.jsx("div",{className:"bg-bg-dark rounded-lg p-4 text-center text-text-muted text-sm",children:e.jsx("span",{className:"animate-pulse",children:"加载中..."})});if(p)return e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 text-center text-red-400 text-sm",children:p});if(!x)return e.jsx("div",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary",children:n.payloadPreview||"(无法预览)"});const{payloadText:k,payloadBase64:R}=x;switch(w==="auto"?df(k,R):w){case"json":try{const F=JSON.parse(k||"");return e.jsx("div",{className:"bg-bg-dark rounded-lg p-3 max-h-80 overflow-auto",children:e.jsx(tl,{data:F})})}catch{return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:k||R})}case"text":return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:k||"(binary - cannot display as text)"});case"hex":return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:Ai(R)});case"base64":return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:R});case"protobuf":return e.jsx("div",{className:"bg-bg-dark rounded-lg max-h-80 overflow-auto",children:e.jsx(ta,{base64Data:R})});default:return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:k||Ai(R)})}};return e.jsxs("div",{className:g("px-4 py-2 cursor-pointer transition-all border-b border-border","hover:bg-bg-light/30",a&&"bg-bg-light/50",c?"border-l-2 border-l-blue-500/50":"border-l-2 border-l-green-500/50",l&&"animate-row-new"),onClick:S,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-8 text-xs font-mono text-text-muted text-right flex-shrink-0",children:o}),e.jsx("span",{className:g("w-7 h-7 rounded-lg flex items-center justify-center text-sm font-medium",c?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:c?"↑":"↓"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g("text-xs font-mono uppercase px-1.5 py-0.5 rounded",n.opcode==="text"?"bg-blue-500/10 text-blue-400":"bg-purple-500/10 text-purple-400"),children:n.opcode}),e.jsx("span",{className:"text-xs text-text-muted",children:ps(n.payloadSize)}),n.isMocked&&e.jsx("span",{className:"text-2xs px-1.5 py-0.5 bg-purple-500/20 text-purple-400 rounded",children:"MOCK"})]}),!a&&e.jsx("p",{className:"text-xs text-text-secondary truncate font-mono mt-0.5",children:n.payloadPreview||(u?"(empty)":"(binary data)")})]}),e.jsx("span",{className:"text-xs text-text-muted whitespace-nowrap",children:ut(n.timestamp)}),e.jsx("span",{className:g("text-xs text-text-muted transition-transform",a&&"rotate-90"),children:"▶"})]}),a&&e.jsxs("div",{className:"mt-3 ml-10",onClick:k=>k.stopPropagation(),children:[x&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"格式:"}),["auto","text","json","protobuf","hex","base64"].map(k=>e.jsx("button",{onClick:()=>N(k),className:g("px-2 py-0.5 text-xs rounded transition-colors",w===k?"bg-primary/20 text-primary":"text-text-muted hover:text-text-primary hover:bg-bg-light"),children:k.toUpperCase()},k))]}),j()]})]})});function df(t,r){if(!t){if(r)try{const s=atob(r),n=new Uint8Array(s.length);for(let a=0;a<s.length;a++)n[a]=s.charCodeAt(a);if(n.length>0&&(n[0]&7)<=5)return"protobuf"}catch{}return"hex"}try{return JSON.parse(t),"json"}catch{return"text"}}function Ai(t){try{const r=atob(t),s=new Uint8Array(r.length);for(let a=0;a<r.length;a++)s[a]=r.charCodeAt(a);const n=[];for(let a=0;a<s.length;a+=16){const i=s.slice(a,a+16),o=Array.from(i).map(u=>u.toString(16).padStart(2,"0")).join(" "),l=Array.from(i).map(u=>u>=32&&u<=126?String.fromCharCode(u):".").join(""),c=a.toString(16).padStart(8,"0");n.push(`${c}  ${o.padEnd(48)}  ${l}`)}return n.join(`
`)}catch{return t}}function uf({session:t}){return e.jsxs("div",{className:"p-4 space-y-4 overflow-auto h-full",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h4",{className:"text-xs font-medium text-text-muted uppercase tracking-wider mb-3",children:"连接信息"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsx(Ts,{label:"URL",value:t.url,mono:!0}),e.jsx(Ts,{label:"连接时间",value:ut(t.connectTime)}),t.disconnectTime&&e.jsx(Ts,{label:"断开时间",value:ut(t.disconnectTime)}),t.closeCode&&e.jsx(Ts,{label:"关闭码",value:String(t.closeCode)}),t.closeReason&&e.jsx(Ts,{label:"关闭原因",value:t.closeReason}),t.subprotocols.length>0&&e.jsx(Ts,{label:"子协议",value:t.subprotocols.join(", ")})]})]}),Object.keys(t.requestHeaders).length>0&&e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h4",{className:"text-xs font-medium text-text-muted uppercase tracking-wider mb-3",children:"请求头"}),e.jsx("dl",{className:"space-y-1.5",children:Object.entries(t.requestHeaders).map(([r,s])=>e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-primary font-medium",children:[r,":"]}),e.jsx("span",{className:"text-text-secondary font-mono break-all",children:s})]},r))})]})]})}function Ts({label:t,value:r,mono:s}){return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("dt",{className:"text-text-muted w-20 flex-shrink-0",children:t}),e.jsx("dd",{className:g("text-text-primary break-all",s&&"font-mono text-xs"),children:r})]})}class xf{metadata={pluginId:we.WEBSOCKET,displayName:"WebSocket",version:"1.0.0",description:"WebSocket 连接监控",icon:e.jsx(_s,{size:16})};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["ws_connection","ws_message","ws_frame"],s=>this.handleEvent(s)),this.state="ready"}render(r){return e.jsx(mf,{...r})}onActivate(){console.log("[WebSocketPlugin] Activated")}onDeactivate(){console.log("[WebSocketPlugin] Deactivated")}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}handleEvent(r){if(!r.payload)return;const s=fs.getState(),n=typeof r.payload=="string"?r.payload:JSON.stringify(r.payload),a=sx(n);if(a){if(a.type==="sessionCreated"){const i=a.data;s.addRealtimeSession({id:i.id,url:i.url,connectTime:i.connectTime,disconnectTime:null,closeCode:null,closeReason:null,isOpen:!0})}else if(a.type==="sessionClosed"){const i=a.data;s.updateSessionStatus(i.id,!1,i.closeCode,i.closeReason)}else if(a.type==="frame"){const i=a.data;if(!s.sessions.some(l=>l.id===i.sessionId)){const l=i.sessionUrl||"(loading...)";if(s.addRealtimeSession({id:i.sessionId,url:l,connectTime:i.timestamp,disconnectTime:null,closeCode:null,closeReason:null,isOpen:!0}),!i.sessionUrl&&this.pluginContext?.deviceId){const c=this.pluginContext.deviceId;oo(c,i.sessionId).then(u=>{s.updateSessionUrl(i.sessionId,u.url)}).catch(()=>{})}}const o=i.payload?Math.floor(i.payload.length*3/4):0;s.addRealtimeFrame({id:i.id,sessionId:i.sessionId,direction:i.direction,opcode:i.opcode,payloadPreview:i.payloadPreview??null,payloadSize:o,timestamp:i.timestamp,isMocked:i.isMocked,seqNum:i.seqNum??0})}}}}function mf({context:t,isActive:r}){const s=t.deviceId,{sessions:n,sessionsLoading:a,totalSessions:i,selectedSessionId:o,selectedSession:l,sessionLoading:c,frames:u,totalFrames:x,framesLoading:m,frameDirection:h,autoScroll:y,isSelectMode:p,selectedIds:f,fetchSessions:w,selectSession:N,loadMoreFrames:E,clearSessions:S,setAutoScroll:j,setFrameDirection:k,toggleSelectMode:R,toggleSelectId:D,selectAll:F,clearSelectedIds:P,batchDelete:U,fetchFrames:K}=fs(),{isConnected:G}=bt(),q=Tt(),[C,b]=d.useState(!1),[M,T]=d.useState(!1),[B,A]=d.useState(!1);d.useEffect(()=>{r&&s&&w(s)},[r,s,w]);const I=d.useCallback(V=>{s&&(p?D(V):N(s,V))},[s,p,N,D]),O=d.useCallback(()=>{s&&w(s)},[s,w]),z=d.useCallback(async()=>{if(s){A(!0);try{const V=await pc(s);S(),q.show("success",`已清除 ${V.deleted} 个会话`),b(!1)}catch{q.show("error","清除失败")}finally{A(!1)}}},[s,S,q]),H=d.useCallback(async()=>{!s||f.size===0||(await U(s),T(!1),R(),q.show("success",`已删除 ${f.size} 个会话`))},[s,f.size,U,R,q]),le=d.useCallback(()=>{!s||!o||E(s,o)},[s,o,E]),Y=d.useCallback(V=>{s&&o?K(s,o,V):k(V)},[s,o,K,k]);return r?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:O,className:"btn btn-secondary text-xs px-2.5 py-1.5",title:"刷新",disabled:a,children:"刷新"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("button",{onClick:R,className:g("btn text-xs px-2.5 py-1.5 flex-shrink-0",p?"btn-primary":"btn-secondary"),title:p?"退出选择":"批量选择",children:p?"取消选择":"批量选择"}),p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F,className:"btn btn-secondary text-xs px-2 py-1.5",children:"全选"}),e.jsx("button",{onClick:P,className:"btn btn-secondary text-xs px-2 py-1.5",children:"清除选择"}),f.size>0&&e.jsxs("button",{onClick:()=>T(!0),className:"btn text-xs px-2 py-1.5 bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20 flex items-center gap-1",children:[e.jsx(Ae,{size:12}),"删除 (",f.size,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[n.length>0&&e.jsxs("button",{onClick:()=>b(!0),className:"btn btn-ghost text-red-400 hover:bg-red-500/10 text-xs px-2 py-1.5 flex-shrink-0",title:"清空所有会话（从数据库删除）",disabled:B,children:[e.jsx(Ae,{size:14,className:"mr-1"}),"清空"]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs",G?"bg-status-success-bg text-status-success":"bg-red-500/20 text-red-400"),children:G?"已连接":"已断开"}),e.jsxs("span",{className:"text-xs text-text-secondary",children:["共 ",i," 个会话",n.length<i&&e.jsxs("span",{className:"text-text-muted",children:["（已加载 ",n.length,"）"]})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-80 border-r border-border flex flex-col relative",children:[e.jsx(rf,{sessions:n,selectedId:o,onSelect:I,loading:a,autoScroll:y,isSelectMode:p,selectedIds:f,onToggleSelect:D}),e.jsx(bs,{isLoading:a})]}),e.jsx("div",{className:"flex-1 flex flex-col relative",children:s&&e.jsx(af,{deviceId:s,session:l,frames:u,loading:m||c,onLoadMore:le,hasMore:u.length<x,frameDirection:h,onFrameDirectionChange:Y,loadedCount:u.length,totalCount:x,autoScroll:y,onAutoScrollChange:j})})]}),e.jsx(xt,{isOpen:C,onClose:()=>b(!1),onConfirm:z,title:"清除全部会话",message:`确定要清除该设备的全部 WebSocket 会话记录吗？

此操作将从数据库永久删除所有会话及帧数据，且不可恢复。`,confirmText:"确认清除",cancelText:"取消",type:"danger",loading:B}),e.jsx(xt,{isOpen:M,onClose:()=>T(!1),onConfirm:H,title:"删除会话",message:`确定要删除选中的 ${f.size} 个会话吗？

此操作不可恢复。`,confirmText:"确认删除",cancelText:"取消",type:"danger"})]}):null}const hf=new xf,Fi={databases:[],dbLoading:!1,dbError:null,dbSortOrder:"name",dbSortAscending:!0,selectedDb:null,selectedTable:null,tables:[],tablesLoading:!1,schema:[],showSchema:!1,tableData:null,dataLoading:!1,dataError:null,page:1,pageSize:100,orderBy:null,ascending:!0,queryMode:!1,queryInput:"",queryResult:null,queryLoading:!1,queryError:null,globalSearchKeyword:"",globalSearchResult:null,globalSearchLoading:!1,globalSearchError:null,searchHistory:[],highlightRowId:null,pendingTargetRowId:null,isJumpingToMatch:!1},ml=Ve((t,r)=>({...Fi,loadDatabases:async s=>{t({dbLoading:!0,dbError:null,selectedDb:null,selectedTable:null,tables:[],schema:[],tableData:null});try{const n=await kc(s);t({databases:n.databases,dbLoading:!1})}catch(n){let a="Failed to load databases";n instanceof Error&&(n.message.includes("404")?a="设备未连接或数据库功能未启用":n.message.includes("504")||n.message.includes("timeout")?a="设备连接超时，请确保设备已连接且 DebugProbe SDK 已启用数据库功能":a=n.message),t({dbError:a,dbLoading:!1})}},loadTables:async(s,n)=>{t({tablesLoading:!0,tables:[]});try{const a=await Cc(s,n);t({tables:a.tables,tablesLoading:!1})}catch(a){console.error("Failed to load tables:",a),t({tablesLoading:!1})}},loadSchema:async(s,n,a)=>{try{const i=await Sc(s,n,a);t({schema:i.columns})}catch(i){console.error("Failed to load schema:",i),t({schema:[]})}},loadTableData:async(s,n,a,i)=>{const{page:o,pageSize:l,orderBy:c,ascending:u,tables:x}=r();t({dataLoading:!0,dataError:null});try{const m=await yn(s,n,a,{page:o,pageSize:l,orderBy:c??void 0,ascending:u,targetRowId:i});i&&m.page!==o&&t({page:m.page});const h=x.map(y=>y.name===a&&m.totalRows!==null?{...y,rowCount:m.totalRows}:y);t({tableData:m,dataLoading:!1,tables:h,pendingTargetRowId:i?null:r().pendingTargetRowId,isJumpingToMatch:i?!1:r().isJumpingToMatch})}catch(m){const h=m instanceof Error?m.message:"Failed to load table data";console.error("Failed to load table data:",m),t({tableData:null,dataLoading:!1,dataError:h,pendingTargetRowId:i?null:r().pendingTargetRowId,isJumpingToMatch:i?!1:r().isJumpingToMatch})}},selectDb:s=>{r().selectedDb!==s&&t({selectedDb:s,selectedTable:null,tables:[],schema:[],tableData:null,page:1,orderBy:null,globalSearchKeyword:"",globalSearchResult:null,globalSearchError:null,isJumpingToMatch:!1})},selectTable:s=>{r().selectedTable!==s&&t({selectedTable:s,schema:[],tableData:null,page:1,orderBy:null,showSchema:!1,queryMode:!1,queryInput:"",queryResult:null,queryError:null,isJumpingToMatch:!1})},setShowSchema:s=>{t({showSchema:s})},setPage:s=>{t({page:s})},setSort:s=>{const{orderBy:n,ascending:a}=r();t(n===s?a?{ascending:!1,page:1}:{orderBy:null,ascending:!0,page:1}:{orderBy:s,ascending:!0,page:1})},setSortAndReload:async(s,n)=>{const{orderBy:a,ascending:i,selectedDb:o,selectedTable:l,pageSize:c}=r();let u=n,x=!0;if(a===n&&(i?x=!1:(u=null,x=!0)),t({orderBy:u,ascending:x,page:1,dataLoading:!0}),o&&l)try{const m=await yn(s,o,l,{page:1,pageSize:c,orderBy:u??void 0,ascending:x});t({tableData:m,dataLoading:!1})}catch(m){console.error("Failed to load table data:",m),t({dataLoading:!1})}},setPageAndReload:async(s,n)=>{const{selectedDb:a,selectedTable:i,pageSize:o,orderBy:l,ascending:c}=r();if(t({page:n,dataLoading:!0}),a&&i)try{const u=await yn(s,a,i,{page:n,pageSize:o,orderBy:l??void 0,ascending:c});t({tableData:u,dataLoading:!1})}catch(u){console.error("Failed to load table data:",u),t({dataLoading:!1})}},setQueryMode:s=>{t({queryMode:s,queryError:null}),s||t({queryResult:null})},setQueryInput:s=>{t({queryInput:s})},executeQuery:async s=>{const{selectedDb:n,queryInput:a}=r();if(!n||!a.trim()){t({queryError:"请选择数据库并输入 SQL 查询语句"});return}t({queryLoading:!0,queryError:null,queryResult:null});try{const i=await Tc(s,n,a);!i.success&&i.error?t({queryError:i.error,queryLoading:!1}):t({queryResult:i,queryLoading:!1})}catch(i){t({queryError:i instanceof Error?i.message:"Query execution failed",queryLoading:!1})}},clearQueryResult:()=>{t({queryResult:null,queryError:null})},setDbSortOrder:s=>{t({dbSortOrder:s})},toggleDbSortDirection:()=>{t(s=>({dbSortAscending:!s.dbSortAscending}))},getSortedDatabases:()=>{const{databases:s,dbSortOrder:n,dbSortAscending:a}=r();return[...s].sort((o,l)=>{let c=0;switch(n){case"name":c=o.descriptor.name.localeCompare(l.descriptor.name);break;case"size":c=(o.fileSizeBytes??0)-(l.fileSizeBytes??0);break;case"tableCount":c=(o.tableCount??0)-(l.tableCount??0);break}return a?c:-c})},setGlobalSearchKeyword:s=>{t({globalSearchKeyword:s})},executeGlobalSearch:async s=>{const{selectedDb:n,globalSearchKeyword:a}=r();if(!n){t({globalSearchError:"请先选择数据库"});return}const i=a.trim();if(!i){t({globalSearchError:"请输入搜索关键词"});return}t({globalSearchLoading:!0,globalSearchError:null,globalSearchResult:null});try{const o=await Ec(s,n,{keyword:i,maxResultsPerTable:10});t({globalSearchResult:o,globalSearchLoading:!1}),r().addToSearchHistory(i)}catch(o){t({globalSearchError:o instanceof Error?o.message:"搜索失败",globalSearchLoading:!1})}},clearGlobalSearch:()=>{t({globalSearchKeyword:"",globalSearchResult:null,globalSearchError:null,isJumpingToMatch:!1})},navigateToSearchResult:(s,n)=>{t(a=>{const i=a.selectedTable!==s;return{selectedTable:s,highlightRowId:n??null,pendingTargetRowId:null,isJumpingToMatch:!1,...i?{schema:[],tableData:null,page:1,orderBy:null,showSchema:!1,queryMode:!1,queryInput:"",queryResult:null,queryError:null}:n?{tableData:null,page:1}:{}}})},jumpToSearchResultRow:async(s,n,a,i)=>{const o=r().selectedTable!==a;t({selectedTable:a,highlightRowId:i,pendingTargetRowId:i,dataLoading:!0,dataError:null,isJumpingToMatch:!0,...o?{schema:[],tableData:null,orderBy:null,showSchema:!1,queryMode:!1,queryInput:"",queryResult:null,queryError:null}:{tableData:r().tableData}}),await r().loadSchema(s,n,a),await r().loadTableData(s,n,a,i)},clearHighlightRow:()=>{t({highlightRowId:null})},addToSearchHistory:s=>{const{searchHistory:n}=r(),a=s.trim();if(!a)return;const i=n.filter(l=>l!==a),o=[a,...i].slice(0,10);t({searchHistory:o});try{localStorage.setItem("db_search_history",JSON.stringify(o))}catch{}},removeFromSearchHistory:s=>{const{searchHistory:n}=r(),a=n.filter(i=>i!==s);t({searchHistory:a});try{localStorage.setItem("db_search_history",JSON.stringify(a))}catch{}},clearSearchHistory:()=>{t({searchHistory:[]});try{localStorage.removeItem("db_search_history")}catch{}},reset:()=>{t(Fi)}}));try{const t=localStorage.getItem("db_search_history");if(t){const r=JSON.parse(t);Array.isArray(r)&&ml.setState({searchHistory:r.slice(0,10)})}}catch{}var pf=ro();const cr=so(pf);var Dr={exports:{}};const ff=JSON.parse('{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}'),gf={nested:ff};var zi;function bf(){return zi||(zi=1,(function(t,r){var s=ro();t.exports=r=s.descriptor=s.Root.fromJSON(gf).lookup(".google.protobuf");var n=s.Namespace,a=s.Root,i=s.Enum,o=s.Type,l=s.Field,c=s.MapField,u=s.OneOf,x=s.Service,m=s.Method;a.fromDescriptor=function(b){typeof b.length=="number"&&(b=r.FileDescriptorSet.decode(b));var M=new a;if(b.file)for(var T,B,A=0,I;A<b.file.length;++A){B=M,(T=b.file[A]).package&&T.package.length&&(B=M.define(T.package));var O=G(T);if(T.name&&T.name.length&&M.files.push(B.filename=T.name),T.messageType)for(I=0;I<T.messageType.length;++I)B.add(o.fromDescriptor(T.messageType[I],O));if(T.enumType)for(I=0;I<T.enumType.length;++I)B.add(i.fromDescriptor(T.enumType[I],O));if(T.extension)for(I=0;I<T.extension.length;++I)B.add(l.fromDescriptor(T.extension[I],O));if(T.service)for(I=0;I<T.service.length;++I)B.add(x.fromDescriptor(T.service[I],O));var z=D(T.options,r.FileOptions);if(z){var H=Object.keys(z);for(I=0;I<H.length;++I)B.setOption(H[I],z[H[I]])}}return M.resolveAll()},a.prototype.toDescriptor=function(b){var M=r.FileDescriptorSet.create();return h(this,M.file,b),M};function h(C,b,M){var T=r.FileDescriptorProto.create({name:C.filename||(C.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});q(M,T),C instanceof a||(T.package=C.fullName.substring(1));for(var B=0,A;B<C.nestedArray.length;++B)(A=C._nestedArray[B])instanceof o?T.messageType.push(A.toDescriptor(M)):A instanceof i?T.enumType.push(A.toDescriptor()):A instanceof l?T.extension.push(A.toDescriptor(M)):A instanceof x?T.service.push(A.toDescriptor()):A instanceof n&&h(A,b,M);T.options=P(C.options,r.FileOptions),T.messageType.length+T.enumType.length+T.extension.length+T.service.length&&b.push(T)}var y=0;o.fromDescriptor=function(b,M,T){typeof b.length=="number"&&(b=r.DescriptorProto.decode(b));var B=new o(b.name.length?b.name:"Type"+y++,D(b.options,r.MessageOptions)),A;if(T||(B._edition=M),b.oneofDecl)for(A=0;A<b.oneofDecl.length;++A)B.add(u.fromDescriptor(b.oneofDecl[A]));if(b.field)for(A=0;A<b.field.length;++A){var I=l.fromDescriptor(b.field[A],M,!0);B.add(I),b.field[A].hasOwnProperty("oneofIndex")&&B.oneofsArray[b.field[A].oneofIndex].add(I)}if(b.extension)for(A=0;A<b.extension.length;++A)B.add(l.fromDescriptor(b.extension[A],M,!0));if(b.nestedType)for(A=0;A<b.nestedType.length;++A)B.add(o.fromDescriptor(b.nestedType[A],M,!0)),b.nestedType[A].options&&b.nestedType[A].options.mapEntry&&B.setOption("map_entry",!0);if(b.enumType)for(A=0;A<b.enumType.length;++A)B.add(i.fromDescriptor(b.enumType[A],M,!0));if(b.extensionRange&&b.extensionRange.length)for(B.extensions=[],A=0;A<b.extensionRange.length;++A)B.extensions.push([b.extensionRange[A].start,b.extensionRange[A].end]);if(b.reservedRange&&b.reservedRange.length||b.reservedName&&b.reservedName.length){if(B.reserved=[],b.reservedRange)for(A=0;A<b.reservedRange.length;++A)B.reserved.push([b.reservedRange[A].start,b.reservedRange[A].end]);if(b.reservedName)for(A=0;A<b.reservedName.length;++A)B.reserved.push(b.reservedName[A])}return B},o.prototype.toDescriptor=function(b){var M=r.DescriptorProto.create({name:this.name}),T;for(T=0;T<this.fieldsArray.length;++T){var B;if(M.field.push(B=this._fieldsArray[T].toDescriptor(b)),this._fieldsArray[T]instanceof c){var A=k(this._fieldsArray[T].keyType,this._fieldsArray[T].resolvedKeyType,!1),I=k(this._fieldsArray[T].type,this._fieldsArray[T].resolvedType,!1),O=I===11||I===14?this._fieldsArray[T].resolvedType&&U(this.parent,this._fieldsArray[T].resolvedType)||this._fieldsArray[T].type:void 0;M.nestedType.push(r.DescriptorProto.create({name:B.typeName,field:[r.FieldDescriptorProto.create({name:"key",number:1,label:1,type:A}),r.FieldDescriptorProto.create({name:"value",number:2,label:1,type:I,typeName:O})],options:r.MessageOptions.create({mapEntry:!0})}))}}for(T=0;T<this.oneofsArray.length;++T)M.oneofDecl.push(this._oneofsArray[T].toDescriptor());for(T=0;T<this.nestedArray.length;++T)this._nestedArray[T]instanceof l?M.field.push(this._nestedArray[T].toDescriptor(b)):this._nestedArray[T]instanceof o?M.nestedType.push(this._nestedArray[T].toDescriptor(b)):this._nestedArray[T]instanceof i&&M.enumType.push(this._nestedArray[T].toDescriptor());if(this.extensions)for(T=0;T<this.extensions.length;++T)M.extensionRange.push(r.DescriptorProto.ExtensionRange.create({start:this.extensions[T][0],end:this.extensions[T][1]}));if(this.reserved)for(T=0;T<this.reserved.length;++T)typeof this.reserved[T]=="string"?M.reservedName.push(this.reserved[T]):M.reservedRange.push(r.DescriptorProto.ReservedRange.create({start:this.reserved[T][0],end:this.reserved[T][1]}));return M.options=P(this.options,r.MessageOptions),M};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(b,M,T){if(typeof b.length=="number"&&(b=r.DescriptorProto.decode(b)),typeof b.number!="number")throw Error("missing field id");var B;b.typeName&&b.typeName.length?B=b.typeName:B=S(b.type);var A;switch(b.label){case 1:A=void 0;break;case 2:A="required";break;case 3:A="repeated";break;default:throw Error("illegal label: "+b.label)}var I=b.extendee;b.extendee!==void 0&&(I=I.length?I:void 0);var O=new l(b.name.length?b.name:"field"+b.number,b.number,B,A,I);if(T||(O._edition=M),O.options=D(b.options,r.FieldOptions),b.proto3_optional&&(O.options.proto3_optional=!0),b.defaultValue&&b.defaultValue.length){var z=b.defaultValue;switch(z){case"true":case"TRUE":z=!0;break;case"false":case"FALSE":z=!1;break;default:var H=p.exec(z);H&&(z=parseInt(z));break}O.setOption("default",z)}return j(b.type)&&(M==="proto3"?b.options&&!b.options.packed&&O.setOption("packed",!1):(!M||M==="proto2")&&b.options&&b.options.packed&&O.setOption("packed",!0)),O},l.prototype.toDescriptor=function(b){var M=r.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)M.type=11,M.typeName=s.util.ucFirst(this.name),M.label=3;else{switch(M.type=k(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:M.typeName=this.resolvedType?U(this.parent,this.resolvedType):this.type;break}this.rule==="repeated"?M.label=3:this.required&&b==="proto2"?M.label=2:M.label=1}if(M.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(M.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(M.options=P(this.options,r.FieldOptions),this.options.default!=null&&(M.defaultValue=String(this.options.default)),this.options.proto3_optional&&(M.proto3_optional=!0)),b==="proto3"?this.packed||((M.options||(M.options=r.FieldOptions.create())).packed=!1):(!b||b==="proto2")&&this.packed&&((M.options||(M.options=r.FieldOptions.create())).packed=!0),M};var f=0;i.fromDescriptor=function(b,M,T){typeof b.length=="number"&&(b=r.EnumDescriptorProto.decode(b));var B={};if(b.value)for(var A=0;A<b.value.length;++A){var I=b.value[A].name,O=b.value[A].number||0;B[I&&I.length?I:"NAME"+O]=O}var z=new i(b.name&&b.name.length?b.name:"Enum"+f++,B,D(b.options,r.EnumOptions));return T||(z._edition=M),z},i.prototype.toDescriptor=function(){for(var b=[],M=0,T=Object.keys(this.values);M<T.length;++M)b.push(r.EnumValueDescriptorProto.create({name:T[M],number:this.values[T[M]]}));return r.EnumDescriptorProto.create({name:this.name,value:b,options:P(this.options,r.EnumOptions)})};var w=0;u.fromDescriptor=function(b){return typeof b.length=="number"&&(b=r.OneofDescriptorProto.decode(b)),new u(b.name&&b.name.length?b.name:"oneof"+w++)},u.prototype.toDescriptor=function(){return r.OneofDescriptorProto.create({name:this.name})};var N=0;x.fromDescriptor=function(b,M,T){typeof b.length=="number"&&(b=r.ServiceDescriptorProto.decode(b));var B=new x(b.name&&b.name.length?b.name:"Service"+N++,D(b.options,r.ServiceOptions));if(T||(B._edition=M),b.method)for(var A=0;A<b.method.length;++A)B.add(m.fromDescriptor(b.method[A]));return B},x.prototype.toDescriptor=function(){for(var b=[],M=0;M<this.methodsArray.length;++M)b.push(this._methodsArray[M].toDescriptor());return r.ServiceDescriptorProto.create({name:this.name,method:b,options:P(this.options,r.ServiceOptions)})};var E=0;m.fromDescriptor=function(b){return typeof b.length=="number"&&(b=r.MethodDescriptorProto.decode(b)),new m(b.name&&b.name.length?b.name:"Method"+E++,"rpc",b.inputType,b.outputType,!!b.clientStreaming,!!b.serverStreaming,D(b.options,r.MethodOptions))},m.prototype.toDescriptor=function(){return r.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:P(this.options,r.MethodOptions)})};function S(C){switch(C){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+C)}function j(C){switch(C){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function k(C,b,M){switch(C){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(b instanceof i)return 14;if(b instanceof o)return M?10:11;throw Error("illegal type: "+C)}function R(C,b){for(var M={},T=0,B,A;T<b.fieldsArray.length;++T)if((A=(B=b._fieldsArray[T]).name)!=="uninterpretedOption"&&Object.prototype.hasOwnProperty.call(C,A)){var I=K(A);B.resolvedType instanceof o?M[I]=R(C[A],B.resolvedType):B.resolvedType instanceof i?M[I]=B.resolvedType.valuesById[C[A]]:M[I]=C[A]}return M}function D(C,b){if(C)return R(b.toObject(C),b)}function F(C,b){for(var M={},T=Object.keys(C),B=0;B<T.length;++B){var A=T[B],I=s.util.camelCase(A);if(Object.prototype.hasOwnProperty.call(b.fields,I)){var O=b.fields[I];O.resolvedType instanceof o?M[I]=F(C[A],O.resolvedType):M[I]=C[A],O.repeated&&!Array.isArray(M[I])&&(M[I]=[M[I]])}}return M}function P(C,b){if(C)return b.fromObject(F(C,b))}function U(C,b){var M=C.fullName.split("."),T=b.fullName.split("."),B=0,A=0,I=T.length-1;if(!(C instanceof a)&&b instanceof n)for(;B<M.length&&A<I&&M[B]===T[A];){var O=b.lookup(M[B++],!0);if(O!==null&&O!==b)break;++A}else for(;B<M.length&&A<I&&M[B]===T[A];++B,++A);return T.slice(A).join(".")}function K(C){return C.substring(0,1)+C.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(b,M){return"_"+M.toLowerCase()})}function G(C){if(C.syntax==="editions"){if(C.edition===r.Edition.EDITION_2023)return"2023";throw new Error("Unsupported edition "+C.edition)}return C.syntax==="proto3"?"proto3":"proto2"}function q(C,b){if(C)if(C==="proto2"||C==="proto3")b.syntax=C;else if(b.syntax="editions",C==="2023")b.edition=r.Edition.EDITION_2023;else throw new Error("Unsupported edition "+C)}})(Dr,Dr.exports)),Dr.exports}bf();async function yf(t){return new Promise((r,s)=>{const n=new FileReader;n.onload=async()=>{try{const a=n.result,i=new Uint8Array(a),o=cr.Root.fromDescriptor(i),l=hl(o);r({name:t.name,messageTypes:l,root:o,uploadedAt:new Date})}catch(a){s(new Error(`解析描述符文件失败: ${a instanceof Error?a.message:String(a)}`))}},n.onerror=()=>{s(new Error("读取文件失败"))},n.readAsArrayBuffer(t)})}async function jf(t,r){const s=atob(t),n=new Uint8Array(s.length);for(let o=0;o<s.length;o++)n[o]=s.charCodeAt(o);const a=cr.Root.fromDescriptor(n),i=hl(a);return{name:r,messageTypes:i,root:a,uploadedAt:new Date}}function hl(t){const r=[];function s(n,a){for(const i of n.nestedArray){const o=a?`${a}.${i.name}`:i.name;i instanceof cr.Type?(r.push(o),s(i,o)):i instanceof cr.Namespace&&s(i,o)}}return s(t,""),r.sort()}function Ln(t,r,s){try{const n=t.root.lookupType(r);let a;if(typeof s=="string"){const c=atob(s);a=new Uint8Array(c.length);for(let u=0;u<c.length;u++)a[u]=c.charCodeAt(u)}else a=s;const i=n.decode(a),o=n.toObject(i,{longs:String,enums:String,bytes:Array,defaults:!1,arrays:!0,objects:!0});return{success:!0,data:sa(o)}}catch(n){return{success:!1,error:n instanceof Error?n.message:String(n)}}}function sa(t){const r={};for(const[s,n]of Object.entries(t)){if(n==null){r[s]=n;continue}n instanceof Uint8Array||Array.isArray(n)&&$i(n)?r[s]=Bi(n):Array.isArray(n)?r[s]=n.map(a=>a instanceof Uint8Array||Array.isArray(a)&&$i(a)?Bi(a):typeof a=="object"&&a!==null?sa(a):a):typeof n=="object"?r[s]=sa(n):r[s]=n}return r}function $i(t){if(t.length===0)return!1;const r=Math.min(t.length,10);for(let s=0;s<r;s++){const n=t[s];if(typeof n!="number"||n<0||n>255||!Number.isInteger(n))return!1}return!0}function Bi(t){const r=t instanceof Uint8Array?Array.from(t):t;try{const s=new Uint8Array(r),n=new TextDecoder("utf-8",{fatal:!0}).decode(s),{nonPrintableRatio:a}=pl(n);if(a<.1)return n}catch{}if(r.length<=32)return`[Bytes: ${r.map(s=>s.toString(16).padStart(2,"0")).join(" ")}]`;{const s=r.slice(0,16).map(n=>n.toString(16).padStart(2,"0")).join(" ");return`[Bytes: ${r.length} bytes, hex: ${s}...]`}}function _i(t){try{let r;if(typeof t=="string"){const a=atob(t);r=new Uint8Array(a.length);for(let i=0;i<a.length;i++)r[i]=a.charCodeAt(i)}else r=t;const s=new cr.Reader(r),n={};for(;s.pos<s.len;){const a=s.uint32(),i=a>>>3,o=a&7;let l;switch(o){case 0:l=s.int64().toString();break;case 1:l=s.fixed64().toString();break;case 2:const u=s.bytes();try{const x=new TextDecoder("utf-8",{fatal:!0}).decode(u);vf(x)?l=x:l=`[${u.length} bytes]`}catch{l=`[${u.length} bytes]`}break;case 5:l=s.fixed32();break;default:s.skipType(o);continue}const c=`field_${i}`;c in n?Array.isArray(n[c])?n[c].push(l):n[c]=[n[c],l]:n[c]=l}return Object.keys(n).length>0?n:null}catch{return null}}function vf(t){return/^[\x20-\x7E\u4E00-\u9FFF\u3000-\u303F\s]+$/.test(t)}function wf(t,r){let s;if(typeof r=="string")try{const n=atob(r);s=new Uint8Array(n.length);for(let a=0;a<n.length;a++)s[a]=n.charCodeAt(a)}catch{return null}else s=r;if(s.length===0)return null;for(const n of t.messageTypes)try{const a=t.root.lookupType(n),i=a.decode(s),o=a.toObject(i,{longs:String,enums:String,bytes:String,defaults:!1,arrays:!0,objects:!0});if(Object.keys(o).length>0){const c=a.encode(i).finish();if(c.length>0&&c.length<=s.length*2)return n}}catch{continue}return null}function Ps(t,r=0){const s="  ".repeat(r),n=[];for(const[a,i]of Object.entries(t))if(i!=null)if(Array.isArray(i)){if(i.length===0)continue;n.push(`${s}${a}: [`);for(const o of i)typeof o=="object"&&o!==null?(n.push(`${s}  {`),n.push(Ps(o,r+2)),n.push(`${s}  }`)):n.push(`${s}  ${Wi(o)}`);n.push(`${s}]`)}else typeof i=="object"?(n.push(`${s}${a}: {`),n.push(Ps(i,r+1)),n.push(`${s}}`)):n.push(`${s}${a}: ${Wi(i)}`);return n.join(`
`)}function Wi(t){if(typeof t=="string"){if(Nf(t))return`[Binary: ${Math.floor(t.length*3/4)} bytes, Base64: ${t.slice(0,50)}${t.length>50?"...":""}]`;const{nonPrintableRatio:r,totalChecked:s}=pl(t);if(r>.2&&s>10)return`[Binary string: ${t.length} chars, contains ${Math.round(r*100)}% non-printable]`;if(r>0){const a=kf(t);return a.length>200?`"${a.slice(0,200)}..." (${t.length} chars)`:`"${a}"`}const n=Number(t);if(!isNaN(n)){if(n>1e12&&n<2e12)return`${t} (${new Date(n).toISOString()})`;if(n>1e9&&n<2e9)return`${t} (${new Date(n*1e3).toISOString()})`}return t.length>500?`"${t.slice(0,500)}..." (${t.length} chars)`:`"${t}"`}return String(t)}function pl(t){const r=Math.min(t.length,500);let s=0;for(let n=0;n<r;n++){const a=t.charCodeAt(n);(a<32&&a!==9&&a!==10&&a!==13||a>=55296&&a<=57343||a>=57344&&a<=63743)&&s++}return{nonPrintableRatio:r>0?s/r:0,totalChecked:r}}function Nf(t){if(t.length<20||!/^[A-Za-z0-9+/]+=*$/.test(t)||t.length%4!==0)return!1;try{const r=atob(t);let s=0;const n=Math.min(r.length,100);for(let a=0;a<n;a++){const i=r.charCodeAt(a);(i<32||i>126)&&s++}return s/n>.3}catch{return!1}}function kf(t){let r="";for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);n<32&&n!==9&&n!==10&&n!==13?r+=`\\x${n.toString(16).padStart(2,"0")}`:n>=55296&&n<=57343?r+=`\\u${n.toString(16).padStart(4,"0")}`:n>=57344&&n<=63743?r+=`\\u${n.toString(16).padStart(4,"0")}`:r+=t[s]}return r}function Cf(t){const r=t.trim().split(/\r?\n/);if(r.length<2)throw new Error("CSV 文件至少需要包含标题行和一行数据");const s=Hi(r[0]),n=[],a=[];if(s.forEach((o,l)=>{o.trim()&&(n.push(l),a.push(o.trim()))}),a.length===0)throw new Error("CSV 文件没有有效的列名");const i=[];for(let o=1;o<r.length;o++){const l=r[o].trim();if(!l)continue;const c=Hi(l);if(!n.some(m=>c[m]?.trim()))continue;const x={};n.forEach((m,h)=>{x[a[h]]=c[m]?.trim()||""}),i.push(x)}return{columns:a,rows:i}}function Hi(t){const r=[];let s="",n=!1;for(let a=0;a<t.length;a++){const i=t[a];i==='"'?n&&t[a+1]==='"'?(s+='"',a++):n=!n:i===","&&!n?(r.push(s.trim()),s=""):s+=i}return r.push(s.trim()),r}async function Sf(t){const r=t.name.replace(/\.(csv|xlsx?)$/i,"");if(t.name.toLowerCase().endsWith(".csv")){const s=await t.text(),{columns:n,rows:a}=Cf(s);return{name:r,columns:n,rows:a,uploadedAt:new Date}}else throw t.name.toLowerCase().match(/\.xlsx?$/)?new Error("暂不支持 Excel 文件，请将其转换为 CSV 格式后上传"):new Error("不支持的文件格式，请上传 CSV 文件")}function Tf(t,r){const s=new Map,n=new Map;for(const a of r){const i=a.split(".").pop()||a,o=n.get(i.toLowerCase())||[];o.push(a),n.set(i.toLowerCase(),o)}for(const a of t){if(r.includes(a)){s.set(a,a);continue}const i=n.get(a.toLowerCase());if(i&&i.length===1){s.set(a,i[0]);continue}const o=r.find(l=>l.toLowerCase().endsWith("."+a.toLowerCase())||l.toLowerCase()===a.toLowerCase());o&&s.set(a,o)}return s}async function Ef(t){return new Promise((r,s)=>{const n=new FileReader;n.onload=()=>{const a=n.result,i=a.split(",")[1]||a;r(i)},n.onerror=s,n.readAsDataURL(t)})}const sn=Ve()(na((t,r)=>({descriptorMeta:[],activeDescriptors:new Map,mappingTables:[],columnConfigs:[],loading:!1,error:null,uploadDescriptor:async(s,n,a)=>{t({loading:!0,error:null});try{const i=await yf(s),o=await Ef(s),l=r().descriptorMeta.findIndex(c=>c.name===i.name&&c.dbId===n&&c.tableName===a);t(c=>{const u=[...c.descriptorMeta],x={name:i.name,messageTypes:i.messageTypes,uploadedAt:i.uploadedAt.toISOString(),rawData:o,dbId:n,tableName:a};l>=0?u[l]=x:u.push(x);const m=new Map(c.activeDescriptors);return m.set(i.name,i),{descriptorMeta:u,activeDescriptors:m,loading:!1}})}catch(i){t({error:i instanceof Error?i.message:String(i),loading:!1})}},restoreDescriptor:async s=>{const{activeDescriptors:n,descriptorMeta:a}=r();if(n.has(s))return n.get(s);const i=a.find(o=>o.name===s);if(!i)return null;try{const o=await jf(i.rawData,i.name);return t(l=>{const c=new Map(l.activeDescriptors);return c.set(s,o),{activeDescriptors:c}}),o}catch(o){return console.error("Failed to restore descriptor:",o),null}},removeDescriptor:s=>{t(n=>({descriptorMeta:n.descriptorMeta.filter(a=>a.name!==s),activeDescriptors:new Map([...n.activeDescriptors].filter(([a])=>a!==s)),columnConfigs:n.columnConfigs.filter(a=>a.descriptorName!==s)}))},getTableDescriptors:(s,n)=>r().descriptorMeta.filter(a=>a.dbId===s&&a.tableName===n),addColumnConfig:s=>{t(n=>{const a=n.columnConfigs.findIndex(o=>o.dbId===s.dbId&&o.tableName===s.tableName&&o.columnName===s.columnName),i=[...n.columnConfigs];return a>=0?i[a]=s:i.push(s),{columnConfigs:i}})},removeColumnConfig:(s,n,a)=>{t(i=>({columnConfigs:i.columnConfigs.filter(o=>!(o.dbId===s&&o.tableName===n&&o.columnName===a))}))},getColumnConfig:(s,n,a)=>r().columnConfigs.find(i=>i.dbId===s&&i.tableName===n&&i.columnName===a)||null,getTableColumnConfigs:(s,n)=>r().columnConfigs.filter(a=>a.dbId===s&&a.tableName===n),autoDetectTypeWithDescriptor:async(s,n)=>{const a=await r().restoreDescriptor(s);return a?wf(a,n):null},decodeBlobWithType:async(s,n,a)=>{const i=await r().restoreDescriptor(s);return i?Ln(i,n,a):{success:!1,error:`描述符 "${s}" 未找到`}},getMessageTypeByMapping:(s,n)=>{if(!s.typeSourceColumn||!s.typeMappings||s.typeMappings.length===0)return null;const a=n[s.typeSourceColumn];if(a==null)return null;const i=String(a);let o=s.typeMappings.find(c=>c.sourceValue===i);if(o)return o.messageType;const l=i.replace(/_/g,"");return o=s.typeMappings.find(c=>c.sourceValue.replace(/_/g,"")===l),o?.messageType||null},decodeBlobWithMapping:async(s,n,a)=>{const{restoreDescriptor:i,getMessageTypeByMapping:o,autoDetectTypeWithDescriptor:l}=r(),c=await i(s.descriptorName);if(!c)return{success:!1,error:`描述符 "${s.descriptorName}" 未找到`};const u=o(s,a);if(u){const m=Ln(c,u,n);return m.success?{...m,messageType:u,source:"mapping"}:{success:!1,error:`类型 "${u}" 解码失败: ${m.error}`}}const x=await l(s.descriptorName,n);if(x){const m=Ln(c,x,n);if(m.success)return{...m,messageType:x,source:"auto"}}return{success:!1,error:"无法确定消息类型"}},getDescriptorMessageTypes:s=>r().descriptorMeta.find(a=>a.name===s)?.messageTypes||[],uploadMappingTable:async(s,n,a)=>{t({loading:!0,error:null});try{const i=await Sf(s);console.log("[ProtobufStore] 映射表解析结果:",{name:i.name,columns:i.columns,rowCount:i.rows.length,firstRow:i.rows[0]});const o=r().mappingTables.findIndex(l=>l.name===i.name&&l.dbId===n&&l.tableName===a);t(l=>{const c=[...l.mappingTables],u={name:i.name,columns:i.columns,rows:i.rows,uploadedAt:i.uploadedAt.toISOString(),dbId:n,tableName:a};return o>=0?c[o]=u:c.push(u),{mappingTables:c,loading:!1}})}catch(i){t({error:i instanceof Error?i.message:String(i),loading:!1})}},configureMappingTableColumns:(s,n,a,i,o)=>{const l=r(),c=l.mappingTables.findIndex(p=>p.name===s);if(console.log("[ProtobufStore] configureMappingTableColumns 调用:",{mappingTableName:s,keyColumn:n,valueColumn:a,dbSourceColumn:o,tableIdx:c,existingTables:l.mappingTables.map(p=>p.name)}),c<0){console.error("[ProtobufStore] 找不到映射表:",s);return}const u=l.mappingTables[c],x=u.rows.map(p=>p[a]).filter(Boolean),m=Tf(x,i);console.log("[ProtobufStore] 配置映射表:",{mappingTableName:s,keyColumn:n,valueColumn:a,dbSourceColumn:o,mappingValuesCount:x.length,matchedCount:m.size});const h=[...l.mappingTables];h[c]={...u,keyColumn:n,valueColumn:a,dbSourceColumn:o};const y=l.columnConfigs.map(p=>{if(p.mappingTableName!==s)return p;const f=[];for(const w of u.rows){const N=w[n],E=w[a],S=m.get(E);N&&S&&f.push({sourceValue:N,messageType:S})}return{...p,typeSourceColumn:o,typeMappings:f}});t(()=>({mappingTables:h,columnConfigs:y})),console.log("[ProtobufStore] 映射表配置已更新:",{updatedTable:h[c],hasKeyColumn:!!h[c].keyColumn,hasValueColumn:!!h[c].valueColumn,hasDbSourceColumn:!!h[c].dbSourceColumn})},removeMappingTable:s=>{t(n=>({mappingTables:n.mappingTables.filter(a=>a.name!==s),columnConfigs:n.columnConfigs.map(a=>a.mappingTableName===s?{...a,mappingTableName:void 0,typeMappings:void 0}:a)}))},getTableMappingTables:(s,n)=>r().mappingTables.filter(a=>a.dbId===s&&a.tableName===n),getMappingTable:s=>r().mappingTables.find(n=>n.name===s)||null,getMessageTypeByMappingTable:(s,n)=>{const a=r().mappingTables.find(l=>l.name===s);if(!a||!a.keyColumn||!a.valueColumn)return null;const i=r().columnConfigs.find(l=>l.mappingTableName===s);return i?.typeMappings&&i.typeMappings.find(l=>l.sourceValue===n)?.messageType||null},clearAll:()=>{t({descriptorMeta:[],activeDescriptors:new Map,mappingTables:[],columnConfigs:[],error:null})}}),{name:"protobuf-store",partialize:t=>({descriptorMeta:t.descriptorMeta,mappingTables:t.mappingTables,columnConfigs:t.columnConfigs})}));function If({className:t,dbId:r,tableName:s,columns:n,onClose:a}){const{loading:i,error:o,descriptorMeta:l,mappingTables:c,columnConfigs:u,uploadDescriptor:x,removeDescriptor:m,uploadMappingTable:h,configureMappingTableColumns:y,removeMappingTable:p,addColumnConfig:f,removeColumnConfig:w,getColumnConfig:N}=sn(),E=d.useRef(null),S=d.useRef(null),[j,k]=d.useState(null),[R,D]=d.useState(""),[F,P]=d.useState(""),[U,K]=d.useState(null),[G,q]=d.useState(null),C=d.useMemo(()=>!r||!s?[]:l.filter(V=>V.dbId===r&&V.tableName===s),[l,r,s]),b=!r||!s?[]:c.filter(V=>V.dbId===r&&V.tableName===s),M=b.filter(V=>V.keyColumn&&V.valueColumn&&V.dbSourceColumn),T=d.useMemo(()=>!r||!s?[]:u.filter(V=>V.dbId===r&&V.tableName===s),[u,r,s]),B=n.filter(V=>{const ie=V.type?.toLowerCase();return ie==="blob"||ie===null||ie===""}),A=n.filter(V=>{const ie=V.type?.toLowerCase();return ie!=="blob"&&ie!==null&&ie!==""}),I=B.filter(V=>!N(r||"",s||"",V.name)),O=d.useCallback(async V=>{const ie=V.target.files?.[0];!ie||!r||!s||(await x(ie,r,s),E.current&&(E.current.value=""))},[x,r,s]),z=d.useCallback(async V=>{const ie=V.target.files?.[0];!ie||!r||!s||(await h(ie,r,s),S.current&&(S.current.value=""))},[h,r,s]),H=d.useCallback(()=>{if(!r||!s||!j||!R)return;const V=F?M.find(_=>_.name===F):null,Ne=C.find(_=>_.name===R)?.messageTypes||[];let se,de;if(V&&V.keyColumn&&V.valueColumn&&V.dbSourceColumn){de=V.dbSourceColumn,se=[];for(const _ of V.rows){const ue=_[V.keyColumn],ae=_[V.valueColumn];if(ue&&ae){const ee=Ne.find(me=>{const Ce=me.split(".").pop()||me;return me===ae||Ce.toLowerCase()===ae.toLowerCase()||me.toLowerCase().endsWith("."+ae.toLowerCase())});ee&&se.push({sourceValue:ue,messageType:ee})}}}f({dbId:r,tableName:s,columnName:j,descriptorName:R,mappingTableName:F||void 0,typeSourceColumn:de,typeMappings:se}),k(null),D(""),P("")},[r,s,j,R,F,M,C,f]),le=C.length>0,Y=T.length>0;return!r||!s?e.jsxs("div",{className:g("bg-bg-dark rounded-lg border border-border shadow-lg",t),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bt,{size:16,className:"text-purple-400"}),e.jsx("h3",{className:"font-medium text-purple-400 text-sm",children:"Protobuf 配置"})]}),e.jsx("button",{onClick:a,className:"px-2 py-1 rounded text-xs hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:"收起"})]}),e.jsxs("div",{className:"text-center py-12 text-text-muted",children:[e.jsx("div",{className:"text-3xl mb-2 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:"请先选择一个数据表"})]})]}):e.jsxs("div",{className:g("bg-bg-dark rounded-lg border border-border shadow-lg",t),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bt,{size:16,className:"text-purple-400"}),e.jsx("h3",{className:"font-medium text-purple-400 text-sm",children:"Protobuf 配置"}),e.jsxs("span",{className:"text-xs text-text-muted",children:["· ",s]})]}),e.jsx("button",{onClick:a,className:"px-2 py-1 rounded text-xs hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:"收起"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[o&&e.jsx("div",{className:"px-3 py-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-400",children:o}),e.jsxs(Pn,{step:1,title:"上传 Protobuf 描述符",subtitle:"使用 protoc --descriptor_set_out 生成 .desc 文件",isComplete:le,isRequired:!0,children:[e.jsx("input",{ref:E,type:"file",accept:".desc,.bin",onChange:O,className:"hidden"}),e.jsx("button",{onClick:()=>E.current?.click(),disabled:i,className:"w-full px-4 py-2 bg-purple-500/20 text-purple-400 rounded-lg text-sm font-medium hover:bg-purple-500/30 disabled:opacity-50 transition-colors flex items-center justify-center gap-2",children:i?"加载中...":e.jsxs(e.Fragment,{children:[e.jsx(Yn,{size:16})," 选择 .desc 文件"]})}),C.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:C.map(V=>e.jsx(Mf,{descriptor:V,isExpanded:U===V.name,onToggle:()=>K(U===V.name?null:V.name),onRemove:()=>m(V.name)},V.name))})]}),e.jsxs(Pn,{step:2,title:"配置类型映射",subtitle:"上传 CSV 定义数据列值与 Protobuf 类型的对应关系",isComplete:M.length>0,isOptional:!0,children:[e.jsx("input",{ref:S,type:"file",accept:".csv",onChange:z,className:"hidden"}),e.jsx("button",{onClick:()=>S.current?.click(),disabled:i,className:"w-full px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg text-sm font-medium hover:bg-blue-500/30 disabled:opacity-50 transition-colors flex items-center justify-center gap-2",children:i?"加载中...":e.jsxs(e.Fragment,{children:[e.jsx(Yn,{size:16})," 选择 CSV 文件"]})}),b.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:b.map(V=>e.jsx(Df,{table:V,dbTableColumns:A.map(ie=>ie.name),isExpanded:G===V.name,onToggle:()=>q(G===V.name?null:V.name),onConfigure:(ie,Ne,se)=>{y(V.name,ie,Ne,C.flatMap(de=>de.messageTypes),se)},onRemove:()=>p(V.name)},V.name))}),b.length===0&&e.jsx("p",{className:"text-2xs text-text-muted/60 mt-2 text-center",children:"不配置映射表时，将使用自动类型检测"})]}),e.jsx(Pn,{step:3,title:"配置 BLOB 列",subtitle:"选择需要解析的 BLOB 列并关联描述符",isComplete:Y,isRequired:!0,disabled:!le,children:le?B.length===0?e.jsx("div",{className:"text-center py-4 text-text-muted text-xs",children:"当前表没有 BLOB 类型的列"}):e.jsxs(e.Fragment,{children:[T.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-xs text-text-muted",children:"已配置:"}),T.map(V=>e.jsx(Rf,{config:V,onRemove:()=>w(V.dbId,V.tableName,V.columnName)},V.columnName))]}),I.length>0&&e.jsxs("div",{className:"space-y-3 p-3 bg-bg-lighter rounded-lg border border-border",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"添加配置:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"BLOB 列"}),e.jsx($t,{options:I.map(V=>V.name),value:j||"",placeholder:"选择列",onChange:V=>k(V||null)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"描述符"}),e.jsx($t,{options:C.map(V=>V.name),value:R,placeholder:"选择描述符",onChange:D})]})]}),M.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-2xs text-text-muted mb-1",children:["类型映射 ",e.jsx("span",{className:"text-text-muted/50",children:"(可选)"})]}),e.jsx($t,{options:M.map(V=>V.name),value:F,placeholder:"不使用映射（自动检测）",showEmptyOption:!0,onChange:P})]}),e.jsx("button",{onClick:H,disabled:!j||!R,className:"w-full px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"添加列配置"})]})]}):e.jsx("div",{className:"text-center py-4 text-text-muted text-xs",children:"请先完成步骤 1"})}),Y&&e.jsxs("div",{className:"mt-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm font-medium",children:[e.jsx(Re,{size:16}),"配置完成"]}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["已为 ",T.length," 个 BLOB 列配置了 Protobuf 解析"]})]})]})]})}function Pn({step:t,title:r,subtitle:s,isComplete:n,isRequired:a,isOptional:i,disabled:o,children:l}){return e.jsxs("div",{className:g("rounded-lg border border-border transition-colors overflow-hidden",o?"bg-bg-darker/50 opacity-60":"bg-bg-darker"),children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 border-b border-border",children:[e.jsx("div",{className:g("flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold shrink-0",n?"bg-green-500 text-white":"bg-bg-light text-text-muted"),children:n?e.jsx(Re,{size:14}):t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm text-text-primary",children:r}),a&&e.jsx("span",{className:"text-2xs text-red-400",children:"*必需"}),i&&e.jsx("span",{className:"text-2xs text-text-muted/50",children:"可选"})]}),e.jsx("p",{className:"text-2xs text-text-muted mt-0.5",children:s})]})]}),e.jsx("div",{className:"p-3",children:l})]})}function Mf({descriptor:t,isExpanded:r,onToggle:s,onRemove:n}){return e.jsxs("div",{className:"bg-bg-light rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center p-2 cursor-pointer hover:bg-bg-lighter/50 transition-colors",onClick:s,children:[e.jsx("div",{className:"p-1 text-text-muted",children:r?e.jsx(yt,{size:14}):e.jsx(at,{size:14})}),e.jsxs("div",{className:"flex-1 min-w-0 ml-1",children:[e.jsx("div",{className:"font-mono text-sm text-text-primary truncate",children:t.name}),e.jsxs("div",{className:"text-2xs text-text-muted",children:[t.messageTypes.length," 个消息类型"]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),n()},className:"p-1 rounded text-red-400 hover:bg-red-500/10 transition-colors",title:"删除",children:e.jsx(Ae,{size:14})})]}),r&&e.jsx("div",{className:"border-t border-border p-2 bg-bg-darker/50",children:e.jsx("div",{className:"max-h-32 overflow-auto",children:e.jsx("div",{className:"text-2xs font-mono text-text-muted space-y-0.5",children:t.messageTypes.map(a=>e.jsx("div",{className:"truncate hover:text-text-secondary",children:a},a))})})})]})}function Df({table:t,dbTableColumns:r,isExpanded:s,onToggle:n,onConfigure:a,onRemove:i}){const o=sn(E=>E.mappingTables.find(S=>S.name===t.name))||t,[l,c]=d.useState(o.keyColumn||""),[u,x]=d.useState(o.valueColumn||""),[m,h]=d.useState(o.dbSourceColumn||""),[y,p]=d.useState("idle"),f=!!o.keyColumn&&!!o.valueColumn&&!!o.dbSourceColumn;d.useEffect(()=>{o.keyColumn&&c(o.keyColumn),o.valueColumn&&x(o.valueColumn),o.dbSourceColumn&&h(o.dbSourceColumn)},[o.keyColumn,o.valueColumn,o.dbSourceColumn]);const w=()=>{l&&u&&m&&(a(l,u,m),p("success"),setTimeout(()=>p("idle"),1500))},N=d.useMemo(()=>!l||!u?[]:t.rows.slice(0,3).map(E=>({key:E[l]||"",value:E[u]||""})),[t.rows,l,u]);return e.jsxs("div",{className:"bg-bg-light rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center p-2 cursor-pointer hover:bg-bg-lighter/50 transition-colors",onClick:n,children:[e.jsx("div",{className:"p-1 text-text-muted",children:s?e.jsx(yt,{size:14}):e.jsx(at,{size:14})}),e.jsxs("div",{className:"flex-1 min-w-0 ml-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm text-blue-400",children:t.name}),e.jsx("span",{className:g("px-1.5 py-0.5 text-2xs rounded",f?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"),children:f?"已配置":"待配置"})]}),e.jsxs("div",{className:"text-2xs text-text-muted",children:[t.rows.length," 行 · ",t.columns.length," 列"]})]}),e.jsx("button",{onClick:E=>{E.stopPropagation(),i()},className:"p-1 rounded text-red-400 hover:bg-red-500/10 transition-colors",title:"删除",children:e.jsx(Ae,{size:14})})]}),s&&e.jsxs("div",{className:"border-t border-border p-3 space-y-3 bg-bg-darker/50",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"CSV 键列"}),e.jsx($t,{options:t.columns,value:l,placeholder:"选择列",onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"CSV 值列"}),e.jsx($t,{options:t.columns,value:u,placeholder:"选择列",onChange:x})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"关联数据库列"}),e.jsx($t,{options:r,value:m,placeholder:"选择要关联的数据库列",onChange:h}),e.jsx("p",{className:"text-2xs text-text-muted/60 mt-1",children:"此列的值将在 CSV 键列中查找对应的 Protobuf 类型"})]}),N.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xs text-text-muted",children:"预览:"}),N.map((E,S)=>e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-bg-light rounded text-xs",children:[e.jsx("span",{className:"font-mono text-yellow-400",children:E.key}),e.jsx("span",{className:"text-text-muted",children:"→"}),e.jsx("span",{className:"font-mono text-green-400 truncate",children:E.value})]},S))]}),e.jsx("button",{onClick:w,disabled:!l||!u||!m,className:g("w-full px-3 py-1.5 rounded text-xs font-medium transition-colors",y==="success"?"bg-green-500 text-white":"bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"),children:y==="success"?"✓ 配置成功":"保存配置"})]})]})}function Rf({config:t,onRemove:r}){const s=t.typeMappings?.filter(a=>a.sourceValue&&a.sourceValue.trim()!==""&&a.messageType).length||0,n=!!t.mappingTableName&&s>0;return e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-bg-light rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm text-primary",children:t.columnName}),n?e.jsxs("span",{className:"px-1.5 py-0.5 text-2xs bg-green-500/20 text-green-400 rounded",children:["可匹配 ",s," 种类型"]}):e.jsx("span",{className:"px-1.5 py-0.5 text-2xs bg-blue-500/20 text-blue-400 rounded",children:"自动检测"})]}),e.jsxs("div",{className:"text-2xs text-text-muted truncate",children:[t.descriptorName,t.mappingTableName&&` · ${t.mappingTableName}`]})]}),e.jsx("button",{onClick:r,className:"p-1 rounded text-red-400 hover:bg-red-500/10 transition-colors shrink-0",title:"删除",children:e.jsx(Ae,{size:14})})]})}function Lf(t={}){const{initialPosition:r=null,enabled:s=!0}=t,[n,a]=d.useState(r),[i,o]=d.useState(!1),l=d.useRef(null),c=d.useCallback(h=>{if(!s)return;h.preventDefault(),o(!0);const y=n?.x??0,p=n?.y??0;l.current={mouseX:h.clientX,mouseY:h.clientY,posX:y,posY:p}},[s,n]),u=d.useCallback(h=>{if(!i||!l.current)return;const y=h.clientX-l.current.mouseX,p=h.clientY-l.current.mouseY;a({x:l.current.posX+y,y:l.current.posY+p})},[i]),x=d.useCallback(()=>{o(!1),l.current=null},[]);d.useEffect(()=>{if(i)return document.addEventListener("mousemove",u),document.addEventListener("mouseup",x),()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",x)}},[i,u,x]);const m=d.useCallback(()=>{a(null)},[]);return{position:n,isDragging:i,dragHandleProps:{onMouseDown:c,style:{cursor:s?"move":"default"}},resetPosition:m}}function Rr(t){const r=t.lastIndexOf(".");return r>=0?t.slice(r+1):t}function Pf({value:t,columnName:r,dbId:s,tableName:n,rowData:a,onExpandChange:i,isHighlighted:o=!1}){const{getColumnConfig:l,autoDetectTypeWithDescriptor:c,decodeBlobWithType:u,getDescriptorMessageTypes:x,getMessageTypeByMapping:m}=sn(),[h,y]=d.useState(!1),[p,f]=d.useState("decoded"),[w,N]=d.useState(null),[E,S]=d.useState(null),[j,k]=d.useState(!1),{position:R,isDragging:D,dragHandleProps:F,resetPosition:P}=Lf({enabled:h}),U=d.useCallback(()=>{y(!1),P(),i?.(!1)},[P,i]),[K,G]=d.useState(!1),[q,C]=d.useState(null),[b,M]=d.useState(null),[T,B]=d.useState(""),[A,I]=d.useState(!1),O=s&&n?l(s,n,r):null,z=O?.descriptorName||null,H=!!(O?.typeSourceColumn&&O?.typeMappings?.length),le=z?x(z):[],Y=A?"":T||b||q||"",V=H?"映射匹配":"自动匹配",ie=T?Rr(T):V;d.useEffect(()=>{if(!(!h||!t||!z||!O)&&!(A||T)){if(H&&a){const re=m(O,a);if(re){M(re),C(null);return}}M(null),G(!0),c(z,t).then(re=>{G(!1),re&&C(re)})}},[h,t,z,O,a,H,T,A,m,c]),d.useEffect(()=>{if(!t||!h||p!=="decoded")return;k(!0),S(null),N(null),(async()=>{const Se=T||b||q;if(Se&&z){const Q=await u(z,Se,t);k(!1),Q.success?(N(Q.data),S(null)):(N(null),S(Q.error));return}const L=_i(t);N(L),S(L?null:"无法自动解析"),k(!1)})()},[t,h,p,T,b,q,z,A,u]);const Ne=re=>{B(re),I(!1)},se=()=>{B(""),I(!0)},de=d.useMemo(()=>{try{return atob(t).length}catch{return 0}},[t]),_=d.useMemo(()=>{try{const re=atob(t),Se=[];for(let L=0;L<Math.min(re.length,256);L++)Se.push(re.charCodeAt(L).toString(16).padStart(2,"0"));return Se}catch{return[]}},[t]),ue=d.useMemo(()=>p!=="wire"||!h?null:_i(t),[t,p,h]),ae=d.useMemo(()=>{if(!z||le.length===0)return 400;const Se=32,L=85,Q=12,Z=ie.length*7.5,J=24,be=T?20:0,je=Z+J+be+20+8,$e=12;let _e=0;!A&&!T&&(K?_e=75:(b||q)&&(_e=20+Rr(b||q||"").length*7));const We=Se+L+Q+je+(_e>0?$e+_e:0);return Math.max(400,Math.min(We,800))},[z,le.length,ie,Y,A,K,b,q,T]);d.useEffect(()=>{if(!h)return;const re=Se=>{Se.key==="Escape"&&U()};return document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)},[h,U]);const[ee,me]=d.useState(!1),Ce=d.useCallback(re=>{rt(re).then(()=>{me(!0),setTimeout(()=>me(!1),2e3)})},[]),Fe=d.useMemo(()=>p==="decoded"&&w?Ps(w):p==="wire"&&ue?Ps(ue):p==="hex"?_.join(" "):"",[p,w,ue,_]),et=d.useCallback(()=>{y(!0),i?.(!0)},[i]),ze=e.jsxs("button",{onClick:et,className:g("flex items-center gap-1 text-xs transition-colors",o?"text-white":"text-purple-400 hover:text-purple-300"),title:"点击展开查看详情",children:[e.jsx(Bt,{size:14,className:"opacity-70"}),e.jsxs("span",{className:"font-mono",children:["[BLOB ",de,"B]"]})]});return h?e.jsxs(e.Fragment,{children:[ze,e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:U,children:e.jsxs("div",{className:g("bg-bg-dark rounded-lg border border-border shadow-2xl max-h-[80vh] flex flex-col",D?"":"transition-[width] duration-200"),style:{width:`${ae}px`,...R?{transform:`translate(${R.x}px, ${R.y}px)`}:{}},onClick:re=>re.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border select-none",...F,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bt,{size:16,className:"text-purple-400"}),e.jsx("span",{className:"font-mono text-sm text-text-primary",children:r}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",de," bytes)"]})]}),e.jsx("button",{onClick:U,className:"p-1 rounded hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",onMouseDown:re=>re.stopPropagation(),children:"✕"})]}),z&&le.length>0&&e.jsx("div",{className:"px-4 py-2 border-b border-border bg-bg-darker/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-text-muted shrink-0",children:"Protobuf 类型:"}),A?e.jsxs("button",{onClick:()=>I(!1),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs text-text-muted hover:text-primary bg-bg-medium hover:bg-bg-light rounded-lg border border-border transition-colors",children:[e.jsx(ai,{size:12}),"启用 Protobuf 解析"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx($t,{options:le,value:T,placeholder:V,formatOption:Rr,showEmptyOption:!0,onChange:Ne,onClear:se})}),K&&e.jsxs("span",{className:"flex items-center gap-1 text-2xs text-primary shrink-0",children:[e.jsx(ai,{size:12,className:"animate-pulse"}),"检测中..."]}),!T&&!K&&(b||q)&&e.jsxs("span",{className:g("flex items-center gap-1 text-2xs shrink-0",b?"text-blue-400":"text-green-400"),children:["→",e.jsx("span",{className:"font-mono",children:Rr(b||q||"")})]})]})]})}),e.jsxs("div",{className:"flex gap-1 px-4 py-2 border-b border-border",children:[e.jsx("button",{onClick:()=>f("decoded"),className:g("px-3 py-1 text-xs rounded transition-colors",p==="decoded"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),children:Y?"Schema 解码":"自动解析"}),e.jsx("button",{onClick:()=>f("wire"),className:g("px-3 py-1 text-xs rounded transition-colors",p==="wire"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),children:"Wire Format"}),e.jsx("button",{onClick:()=>f("hex"),className:g("px-3 py-1 text-xs rounded transition-colors",p==="hex"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),children:"Hex"}),e.jsx("div",{className:"flex-1"}),Fe&&e.jsx("button",{onClick:()=>Ce(Fe),className:g("flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors",ee?"text-green-400 bg-green-400/10":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),title:ee?"已复制":"复制内容",children:ee?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:12}),"已复制"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:12}),"复制"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-0",children:j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full"})}):p==="decoded"?w?e.jsx("pre",{className:"text-xs font-mono text-text-secondary whitespace-pre-wrap break-all",children:Ps(w)}):E?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-yellow-400 mb-2 flex justify-center",children:e.jsx(jt,{size:24})}),e.jsx("p",{className:"text-sm text-text-muted",children:E}),!z&&e.jsx("p",{className:"text-xs text-text-muted/50 mt-2",children:"请在 Protobuf 配置中添加此列的描述符"}),z&&!Y&&e.jsx("p",{className:"text-xs text-text-muted/50 mt-2",children:"请在上方选择 Protobuf 消息类型"})]}):null:p==="wire"?ue?e.jsx("pre",{className:"text-xs font-mono text-text-secondary whitespace-pre-wrap break-all",children:Ps(ue)}):e.jsx("div",{className:"text-center py-8 text-text-muted",children:"无法解析 Wire Format"}):e.jsxs("div",{className:"font-mono text-xs",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[_.map((re,Se)=>e.jsx("span",{className:g("px-1 py-0.5 rounded",Se%16<8?"bg-bg-light":"bg-bg-lighter"),children:re},Se)),de>256&&e.jsxs("span",{className:"text-text-muted px-2",children:["... 还有 ",de-256," bytes"]})]}),e.jsxs("div",{className:"mt-4 text-text-muted",children:["共 ",de," bytes"]})]})}),!z&&p==="decoded"&&e.jsx("div",{className:"px-4 py-2 border-t border-border text-xs text-text-muted bg-bg-darker",children:"💡 提示：在 Protobuf 配置中为此列添加描述符可启用自动类型检测"})]})})]}):ze}function Of(t){if(!t||typeof t!="string"||t.length<4||t.length%4!==0||!/^[A-Za-z0-9+/]+=*$/.test(t))return!1;try{const s=atob(t);let n=0;for(let a=0;a<Math.min(s.length,100);a++){const i=s.charCodeAt(a);(i<32||i>126)&&n++}return n/Math.min(s.length,100)>.3}catch{return!1}}function Ui(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,n=Array(r);s<r;s++)n[s]=t[s];return n}function Af(t){if(Array.isArray(t))return t}function Ff(t,r,s){return(r=Uf(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function zf(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var n,a,i,o,l=[],c=!0,u=!1;try{if(i=(s=s.call(t)).next,r!==0)for(;!(c=(n=i.call(s)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(x){u=!0,a=x}finally{try{if(!c&&s.return!=null&&(o=s.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}function $f(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vi(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),s.push.apply(s,n)}return s}function qi(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Vi(Object(s),!0).forEach(function(n){Ff(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Vi(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Bf(t,r){if(t==null)return{};var s,n,a=_f(t,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],r.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(a[s]=t[s])}return a}function _f(t,r){if(t==null)return{};var s={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(r.indexOf(n)!==-1)continue;s[n]=t[n]}return s}function Wf(t,r){return Af(t)||zf(t,r)||Vf(t,r)||$f()}function Hf(t,r){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,r);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Uf(t){var r=Hf(t,"string");return typeof r=="symbol"?r:r+""}function Vf(t,r){if(t){if(typeof t=="string")return Ui(t,r);var s={}.toString.call(t).slice(8,-1);return s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set"?Array.from(t):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Ui(t,r):void 0}}function qf(t,r,s){return r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Gi(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),s.push.apply(s,n)}return s}function Yi(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Gi(Object(s),!0).forEach(function(n){qf(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Gi(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Gf(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return function(n){return r.reduceRight(function(a,i){return i(a)},n)}}function rr(t){return function r(){for(var s=this,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return a.length>=t.length?t.apply(this,a):function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return r.apply(s,[].concat(a,l))}}}function Hr(t){return{}.toString.call(t).includes("Object")}function Yf(t){return!Object.keys(t).length}function dr(t){return typeof t=="function"}function Kf(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function Jf(t,r){return Hr(r)||Xt("changeType"),Object.keys(r).some(function(s){return!Kf(t,s)})&&Xt("changeField"),r}function Xf(t){dr(t)||Xt("selectorType")}function Qf(t){dr(t)||Hr(t)||Xt("handlerType"),Hr(t)&&Object.values(t).some(function(r){return!dr(r)})&&Xt("handlersType")}function Zf(t){t||Xt("initialIsRequired"),Hr(t)||Xt("initialType"),Yf(t)&&Xt("initialContent")}function eg(t,r){throw new Error(t[r]||t.default)}var tg={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},Xt=rr(eg)(tg),Lr={changes:Jf,selector:Xf,handler:Qf,initial:Zf};function sg(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Lr.initial(t),Lr.handler(r);var s={current:t},n=rr(ag)(s,r),a=rr(ng)(s),i=rr(Lr.changes)(t),o=rr(rg)(s);function l(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(x){return x};return Lr.selector(u),u(s.current)}function c(u){Gf(n,a,i,o)(u)}return[l,c]}function rg(t,r){return dr(r)?r(t.current):r}function ng(t,r){return t.current=Yi(Yi({},t.current),r),r}function ag(t,r,s){return dr(r)?r(t.current):Object.keys(s).forEach(function(n){var a;return(a=r[n])===null||a===void 0?void 0:a.call(r,t.current[n])}),s}var ig={create:sg},og={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function lg(t){return function r(){for(var s=this,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return a.length>=t.length?t.apply(this,a):function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return r.apply(s,[].concat(a,l))}}}function cg(t){return{}.toString.call(t).includes("Object")}function dg(t){return t||Ki("configIsRequired"),cg(t)||Ki("configType"),t.urls?(ug(),{paths:{vs:t.urls.monacoBase}}):t}function ug(){console.warn(fl.deprecation)}function xg(t,r){throw new Error(t[r]||t.default)}var fl={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Ki=lg(xg)(fl),mg={config:dg},hg=function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return function(a){return s.reduceRight(function(i,o){return o(i)},a)}};function gl(t,r){return Object.keys(r).forEach(function(s){r[s]instanceof Object&&t[s]&&Object.assign(r[s],gl(t[s],r[s]))}),qi(qi({},t),r)}var pg={type:"cancelation",msg:"operation is manually canceled"};function On(t){var r=!1,s=new Promise(function(n,a){t.then(function(i){return r?a(pg):n(i)}),t.catch(a)});return s.cancel=function(){return r=!0},s}var fg=["monaco"],gg=ig.create({config:og,isInitialized:!1,resolve:null,reject:null,monaco:null}),bl=Wf(gg,2),gr=bl[0],rn=bl[1];function bg(t){var r=mg.config(t),s=r.monaco,n=Bf(r,fg);rn(function(a){return{config:gl(a.config,n),monaco:s}})}function yg(){var t=gr(function(r){var s=r.monaco,n=r.isInitialized,a=r.resolve;return{monaco:s,isInitialized:n,resolve:a}});if(!t.isInitialized){if(rn({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),On(An);if(window.monaco&&window.monaco.editor)return yl(window.monaco),t.resolve(window.monaco),On(An);hg(jg,wg)(Ng)}return On(An)}function jg(t){return document.body.appendChild(t)}function vg(t){var r=document.createElement("script");return t&&(r.src=t),r}function wg(t){var r=gr(function(n){var a=n.config,i=n.reject;return{config:a,reject:i}}),s=vg("".concat(r.config.paths.vs,"/loader.js"));return s.onload=function(){return t()},s.onerror=r.reject,s}function Ng(){var t=gr(function(s){var n=s.config,a=s.resolve,i=s.reject;return{config:n,resolve:a,reject:i}}),r=window.require;r.config(t.config),r(["vs/editor/editor.main"],function(s){var n=s.m||s;yl(n),t.resolve(n)},function(s){t.reject(s)})}function yl(t){gr().monaco||rn({monaco:t})}function kg(){return gr(function(t){var r=t.monaco;return r})}var An=new Promise(function(t,r){return rn({resolve:t,reject:r})}),jl={config:bg,init:yg,__getMonacoInstance:kg},Cg={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Fn=Cg,Sg={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},Tg=Sg;function Eg({children:t}){return Jt.createElement("div",{style:Tg.container},t)}var Ig=Eg,Mg=Ig;function Dg({width:t,height:r,isEditorReady:s,loading:n,_ref:a,className:i,wrapperProps:o}){return Jt.createElement("section",{style:{...Fn.wrapper,width:t,height:r},...o},!s&&Jt.createElement(Mg,null,n),Jt.createElement("div",{ref:a,style:{...Fn.fullWidth,...!s&&Fn.hide},className:i}))}var Rg=Dg,vl=d.memo(Rg);function Lg(t){d.useEffect(t,[])}var wl=Lg;function Pg(t,r,s=!0){let n=d.useRef(!0);d.useEffect(n.current||!s?()=>{n.current=!1}:t,r)}var nt=Pg;function ar(){}function Os(t,r,s,n){return Og(t,n)||Ag(t,r,s,n)}function Og(t,r){return t.editor.getModel(Nl(t,r))}function Ag(t,r,s,n){return t.editor.createModel(r,s,n?Nl(t,n):void 0)}function Nl(t,r){return t.Uri.parse(r)}function Fg({original:t,modified:r,language:s,originalLanguage:n,modifiedLanguage:a,originalModelPath:i,modifiedModelPath:o,keepCurrentOriginalModel:l=!1,keepCurrentModifiedModel:c=!1,theme:u="light",loading:x="Loading...",options:m={},height:h="100%",width:y="100%",className:p,wrapperProps:f={},beforeMount:w=ar,onMount:N=ar}){let[E,S]=d.useState(!1),[j,k]=d.useState(!0),R=d.useRef(null),D=d.useRef(null),F=d.useRef(null),P=d.useRef(N),U=d.useRef(w),K=d.useRef(!1);wl(()=>{let b=jl.init();return b.then(M=>(D.current=M)&&k(!1)).catch(M=>M?.type!=="cancelation"&&console.error("Monaco initialization: error:",M)),()=>R.current?C():b.cancel()}),nt(()=>{if(R.current&&D.current){let b=R.current.getOriginalEditor(),M=Os(D.current,t||"",n||s||"text",i||"");M!==b.getModel()&&b.setModel(M)}},[i],E),nt(()=>{if(R.current&&D.current){let b=R.current.getModifiedEditor(),M=Os(D.current,r||"",a||s||"text",o||"");M!==b.getModel()&&b.setModel(M)}},[o],E),nt(()=>{let b=R.current.getModifiedEditor();b.getOption(D.current.editor.EditorOption.readOnly)?b.setValue(r||""):r!==b.getValue()&&(b.executeEdits("",[{range:b.getModel().getFullModelRange(),text:r||"",forceMoveMarkers:!0}]),b.pushUndoStop())},[r],E),nt(()=>{R.current?.getModel()?.original.setValue(t||"")},[t],E),nt(()=>{let{original:b,modified:M}=R.current.getModel();D.current.editor.setModelLanguage(b,n||s||"text"),D.current.editor.setModelLanguage(M,a||s||"text")},[s,n,a],E),nt(()=>{D.current?.editor.setTheme(u)},[u],E),nt(()=>{R.current?.updateOptions(m)},[m],E);let G=d.useCallback(()=>{if(!D.current)return;U.current(D.current);let b=Os(D.current,t||"",n||s||"text",i||""),M=Os(D.current,r||"",a||s||"text",o||"");R.current?.setModel({original:b,modified:M})},[s,r,a,t,n,i,o]),q=d.useCallback(()=>{!K.current&&F.current&&(R.current=D.current.editor.createDiffEditor(F.current,{automaticLayout:!0,...m}),G(),D.current?.editor.setTheme(u),S(!0),K.current=!0)},[m,u,G]);d.useEffect(()=>{E&&P.current(R.current,D.current)},[E]),d.useEffect(()=>{!j&&!E&&q()},[j,E,q]);function C(){let b=R.current?.getModel();l||b?.original?.dispose(),c||b?.modified?.dispose(),R.current?.dispose()}return Jt.createElement(vl,{width:y,height:h,isEditorReady:E,loading:x,_ref:F,className:p,wrapperProps:f})}var zg=Fg;d.memo(zg);function $g(t){let r=d.useRef();return d.useEffect(()=>{r.current=t},[t]),r.current}var Bg=$g,Pr=new Map;function _g({defaultValue:t,defaultLanguage:r,defaultPath:s,value:n,language:a,path:i,theme:o="light",line:l,loading:c="Loading...",options:u={},overrideServices:x={},saveViewState:m=!0,keepCurrentModel:h=!1,width:y="100%",height:p="100%",className:f,wrapperProps:w={},beforeMount:N=ar,onMount:E=ar,onChange:S,onValidate:j=ar}){let[k,R]=d.useState(!1),[D,F]=d.useState(!0),P=d.useRef(null),U=d.useRef(null),K=d.useRef(null),G=d.useRef(E),q=d.useRef(N),C=d.useRef(),b=d.useRef(n),M=Bg(i),T=d.useRef(!1),B=d.useRef(!1);wl(()=>{let O=jl.init();return O.then(z=>(P.current=z)&&F(!1)).catch(z=>z?.type!=="cancelation"&&console.error("Monaco initialization: error:",z)),()=>U.current?I():O.cancel()}),nt(()=>{let O=Os(P.current,t||n||"",r||a||"",i||s||"");O!==U.current?.getModel()&&(m&&Pr.set(M,U.current?.saveViewState()),U.current?.setModel(O),m&&U.current?.restoreViewState(Pr.get(i)))},[i],k),nt(()=>{U.current?.updateOptions(u)},[u],k),nt(()=>{!U.current||n===void 0||(U.current.getOption(P.current.editor.EditorOption.readOnly)?U.current.setValue(n):n!==U.current.getValue()&&(B.current=!0,U.current.executeEdits("",[{range:U.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),U.current.pushUndoStop(),B.current=!1))},[n],k),nt(()=>{let O=U.current?.getModel();O&&a&&P.current?.editor.setModelLanguage(O,a)},[a],k),nt(()=>{l!==void 0&&U.current?.revealLine(l)},[l],k),nt(()=>{P.current?.editor.setTheme(o)},[o],k);let A=d.useCallback(()=>{if(!(!K.current||!P.current)&&!T.current){q.current(P.current);let O=i||s,z=Os(P.current,n||t||"",r||a||"",O||"");U.current=P.current?.editor.create(K.current,{model:z,automaticLayout:!0,...u},x),m&&U.current.restoreViewState(Pr.get(O)),P.current.editor.setTheme(o),l!==void 0&&U.current.revealLine(l),R(!0),T.current=!0}},[t,r,s,n,a,i,u,x,m,o,l]);d.useEffect(()=>{k&&G.current(U.current,P.current)},[k]),d.useEffect(()=>{!D&&!k&&A()},[D,k,A]),b.current=n,d.useEffect(()=>{k&&S&&(C.current?.dispose(),C.current=U.current?.onDidChangeModelContent(O=>{B.current||S(U.current.getValue(),O)}))},[k,S]),d.useEffect(()=>{if(k){let O=P.current.editor.onDidChangeMarkers(z=>{let H=U.current.getModel()?.uri;if(H&&z.find(le=>le.path===H.path)){let le=P.current.editor.getModelMarkers({resource:H});j?.(le)}});return()=>{O?.dispose()}}return()=>{}},[k,j]);function I(){C.current?.dispose(),h?m&&Pr.set(i,U.current.saveViewState()):U.current.getModel()?.dispose(),U.current.dispose()}return Jt.createElement(vl,{width:y,height:p,isEditorReady:k,loading:c,_ref:K,className:f,wrapperProps:w})}var Wg=_g,Hg=d.memo(Wg),Ug=Hg;const Ji=["SELECT","FROM","WHERE","AND","OR","NOT","IN","LIKE","BETWEEN","IS","NULL","TRUE","FALSE","AS","ON","JOIN","LEFT","RIGHT","INNER","OUTER","CROSS","FULL","UNION","ALL","DISTINCT","ORDER","BY","ASC","DESC","LIMIT","OFFSET","GROUP","HAVING","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","TABLE","DROP","ALTER","ADD","COLUMN","INDEX","PRIMARY","KEY","FOREIGN","REFERENCES","CONSTRAINT","DEFAULT","UNIQUE","CHECK","EXISTS","CASE","WHEN","THEN","ELSE","END","CAST","COALESCE","COUNT","SUM","AVG","MIN","MAX","SUBSTR","LENGTH","UPPER","LOWER","TRIM","REPLACE","INSTR","IFNULL","NULLIF","TYPEOF","ABS","ROUND","DATE","TIME","DATETIME","STRFTIME","JULIANDAY"],Xi=["COUNT","SUM","AVG","MIN","MAX","TOTAL","GROUP_CONCAT","ABS","ROUND","RANDOM","SUBSTR","LENGTH","UPPER","LOWER","TRIM","LTRIM","RTRIM","REPLACE","INSTR","PRINTF","UNICODE","TYPEOF","COALESCE","IFNULL","NULLIF","IIF","CASE","DATE","TIME","DATETIME","JULIANDAY","STRFTIME","HEX","UNHEX","ZEROBLOB","QUOTE","GLOB","LIKE"];function Vg({value:t,onChange:r,onExecute:s,placeholder:n="SELECT * FROM table_name LIMIT 100",height:a=120,tables:i=[],tableColumns:o={},readOnly:l=!1,disabled:c=!1}){const u=d.useRef(null),x=d.useRef(null),m=d.useRef(null),h=d.useCallback(p=>{p.editor.defineTheme("sql-dark",{base:"vs-dark",inherit:!0,rules:[{token:"keyword",foreground:"569cd6",fontStyle:"bold"},{token:"string",foreground:"ce9178"},{token:"number",foreground:"b5cea8"},{token:"comment",foreground:"6a9955",fontStyle:"italic"},{token:"operator",foreground:"d4d4d4"},{token:"identifier",foreground:"9cdcfe"}],colors:{"editor.background":"#1a1a2e","editor.foreground":"#e0e0e0","editor.lineHighlightBackground":"#2a2a3e","editor.selectionBackground":"#3a3a5e","editorCursor.foreground":"#7c3aed","editorLineNumber.foreground":"#4a4a6a","editorLineNumber.activeForeground":"#8a8aaa","editor.inactiveSelectionBackground":"#2a2a4e"}})},[]),y=d.useCallback((p,f)=>{u.current=p,x.current=f,m.current=f.languages.registerCompletionItemProvider("sql",{provideCompletionItems:(w,N)=>{const E=w.getWordUntilPosition(N),S={startLineNumber:N.lineNumber,endLineNumber:N.lineNumber,startColumn:E.startColumn,endColumn:E.endColumn},j=[];return Ji.forEach(k=>{j.push({label:k,kind:f.languages.CompletionItemKind.Keyword,insertText:k,range:S,detail:"SQL Keyword"})}),Xi.forEach(k=>{j.push({label:k,kind:f.languages.CompletionItemKind.Function,insertText:`${k}($0)`,insertTextRules:f.languages.CompletionItemInsertTextRule.InsertAsSnippet,range:S,detail:"SQL Function"})}),i.forEach(k=>{j.push({label:k,kind:f.languages.CompletionItemKind.Class,insertText:k,range:S,detail:"Table"})}),Object.entries(o).forEach(([k,R])=>{R.forEach(D=>{j.push({label:D,kind:f.languages.CompletionItemKind.Field,insertText:D,range:S,detail:`Column (${k})`})})}),{suggestions:j}}}),p.addCommand(f.KeyMod.CtrlCmd|f.KeyCode.Enter,()=>{s?.()}),p.focus()},[i,o,s]);return d.useEffect(()=>()=>{m.current?.dispose()},[]),d.useEffect(()=>{if(!x.current||!u.current)return;m.current?.dispose();const p=x.current;m.current=p.languages.registerCompletionItemProvider("sql",{provideCompletionItems:(f,w)=>{const N=f.getWordUntilPosition(w),E={startLineNumber:w.lineNumber,endLineNumber:w.lineNumber,startColumn:N.startColumn,endColumn:N.endColumn},S=[];return Ji.forEach(j=>{S.push({label:j,kind:p.languages.CompletionItemKind.Keyword,insertText:j,range:E,detail:"SQL Keyword"})}),Xi.forEach(j=>{S.push({label:j,kind:p.languages.CompletionItemKind.Function,insertText:`${j}($0)`,insertTextRules:p.languages.CompletionItemInsertTextRule.InsertAsSnippet,range:E,detail:"SQL Function"})}),i.forEach(j=>{S.push({label:j,kind:p.languages.CompletionItemKind.Class,insertText:j,range:E,detail:"Table"})}),Object.entries(o).forEach(([j,k])=>{k.forEach(R=>{S.push({label:R,kind:p.languages.CompletionItemKind.Field,insertText:R,range:E,detail:`Column (${j})`})})}),{suggestions:S}}})},[i,o]),e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-border",children:[e.jsx(Ug,{height:a,language:"sql",theme:"sql-dark",value:t,onChange:p=>r(p||""),beforeMount:h,onMount:y,options:{minimap:{enabled:!1},lineNumbers:"off",glyphMargin:!1,folding:!1,lineDecorationsWidth:8,lineNumbersMinChars:0,renderLineHighlight:"none",scrollBeyondLastLine:!1,overviewRulerBorder:!1,overviewRulerLanes:0,hideCursorInOverviewRuler:!0,scrollbar:{vertical:"auto",horizontal:"auto",verticalScrollbarSize:8,horizontalScrollbarSize:8},fontSize:12,fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, monospace',tabSize:2,wordWrap:"on",automaticLayout:!0,suggest:{showKeywords:!0,showSnippets:!0,showClasses:!0,showFunctions:!0,showFields:!0},quickSuggestions:{other:!0,comments:!1,strings:!1},readOnly:l||c,domReadOnly:c,placeholder:n},loading:e.jsx("div",{className:"flex items-center justify-center h-full bg-bg-light text-text-muted text-xs",children:"加载编辑器..."})}),!t&&e.jsx("div",{className:"absolute top-2 left-2 text-text-muted text-xs pointer-events-none opacity-50 font-mono",children:n})]})}function Qi({text:t,title:r="内容",children:s,trigger:n="dblclick",className:a}){const[i,o]=d.useState(!1),[l,c]=d.useState(!1),u=d.useRef(null),x=d.useRef(null);d.useEffect(()=>{const N=S=>{u.current&&!u.current.contains(S.target)&&x.current&&!x.current.contains(S.target)&&o(!1)},E=S=>{S.key==="Escape"&&o(!1)};return i&&(document.addEventListener("mousedown",N),document.addEventListener("keydown",E)),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("keydown",E)}},[i]),d.useEffect(()=>{i||c(!1)},[i]);const m=N=>{N.stopPropagation(),o(!i)},h=async N=>{N.stopPropagation();try{await rt(t),c(!0),De.success("已复制到剪贴板"),setTimeout(()=>c(!1),1500)}catch{De.error("复制失败")}},[y,p]=d.useState({top:0,left:0});d.useLayoutEffect(()=>{if(i&&x.current){const N=x.current.getBoundingClientRect(),E=window.innerWidth,S=window.innerHeight;let j=N.bottom+4,k=N.left;j+80>S&&(j=N.top-80-4),k+280>E&&(k=E-280-8),p({top:j,left:k})}},[i]);const f=i?ur.createPortal(e.jsx("div",{ref:u,style:{position:"fixed",top:y.top,left:y.left},className:"z-[300] min-w-[200px] max-w-[320px]",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-lg shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-border bg-bg-medium/50",children:e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:r})}),e.jsx("div",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 text-xs font-mono text-text-primary bg-bg-light px-2 py-1.5 rounded select-all break-all",children:t}),e.jsx("button",{onClick:h,className:g("p-1.5 rounded transition-colors flex-shrink-0",l?"bg-green-500/20 text-green-400":"bg-bg-light hover:bg-primary/20 text-text-muted hover:text-primary"),title:l?"已复制":"复制",children:l?e.jsx(Re,{size:14}):e.jsx(jo,{size:14})})]})})]})}),document.body):null,w=n==="dblclick"?{onDoubleClick:m}:{onClick:m};return e.jsxs(e.Fragment,{children:[e.jsx("span",{ref:x,...w,className:g("cursor-pointer",a),children:s}),f]})}const qg={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Gg=3e5,Yg=1e5;function kl(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()!==""){const r=Number(t);return Number.isFinite(r)?r:null}return null}function Zi(t){try{const r=localStorage.getItem(t);return r?kl(r):null}catch{return null}}function eo(t){const r=qg?.[t];return r?kl(r):null}function Kg(){const t=Zi("db_search_warn_total")??eo("VITE_DB_SEARCH_WARN_TOTAL")??Gg,r=Zi("db_search_warn_table")??eo("VITE_DB_SEARCH_WARN_TABLE")??Yg;return{totalMatches:Math.max(0,Math.floor(t)),perTableMatches:Math.max(0,Math.floor(r))}}function zn(t,r){if(!r||!t)return t;const s=r.trim().toLowerCase();if(!s)return t;const n=[],a=t.toLowerCase();let i=0,o=a.indexOf(s);for(;o!==-1;)o>i&&n.push(t.substring(i,o)),n.push(e.jsx("mark",{className:"bg-yellow-400/40 text-inherit px-0.5 rounded",children:t.substring(o,o+s.length)},o)),i=o+s.length,o=a.indexOf(s,i);return i<t.length&&n.push(t.substring(i)),n.length>0?n:t}const is=50;function Jg(t){return t==null?"-":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}function Xg(t){switch(t){case"log":return e.jsx(es,{size:16});case"cache":return e.jsx(ua,{size:16});default:return e.jsx(xs,{size:16})}}const Qg={syntax_error:jt,table_not_found:xs,column_not_found:xs,access_denied:Gn,timeout:es,invalid_query:jt,internal_error:jt},Zg={syntax_error:"语法错误",table_not_found:"表不存在",column_not_found:"列不存在",access_denied:"访问被拒绝",timeout:"查询超时",invalid_query:"无效查询",internal_error:"内部错误"};function eb({error:t,onApplySuggestion:r}){if(typeof t=="string")return e.jsx("div",{className:"mt-2 px-3 py-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-400",children:t});const s=Qg[t.type]||jt,n=Zg[t.type]||"查询错误";return e.jsxs("div",{className:"mt-2 bg-red-500/10 border border-red-500/20 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-red-500/20 bg-red-500/5",children:[e.jsx(s,{size:14,className:"text-red-400 flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium text-red-400",children:n})]}),e.jsxs("div",{className:"px-3 py-2 space-y-2",children:[e.jsx("p",{className:"text-xs text-red-300",children:t.description}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"text-xs text-red-400/70 cursor-pointer hover:text-red-400 select-none",children:"查看详细错误"}),e.jsx("pre",{className:"mt-1 p-2 bg-red-500/5 rounded text-xs text-red-400/80 font-mono whitespace-pre-wrap break-all",children:t.message})]})]}),t.suggestions&&t.suggestions.length>0&&e.jsxs("div",{className:"px-3 py-2 border-t border-red-500/20 bg-amber-500/5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(ua,{size:12,className:"text-amber-400"}),e.jsx("span",{className:"text-xs font-medium text-amber-400",children:"建议"})]}),e.jsx("ul",{className:"space-y-1.5",children:t.suggestions.map((a,i)=>{const o=/^(SELECT|INSERT|UPDATE|DELETE)\s/i.test(a.trim())||a.includes("SELECT")&&a.includes("FROM");return e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-500/60 text-xs mt-0.5",children:"•"}),e.jsx("div",{className:"flex-1 min-w-0",children:o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 px-2 py-1 bg-amber-500/10 rounded text-xs font-mono text-amber-300 break-all",children:a}),r&&e.jsx("button",{onClick:()=>r(a),className:"flex-shrink-0 px-2 py-1 bg-amber-500/20 hover:bg-amber-500/30 rounded text-xs text-amber-300 transition-colors",title:"应用此建议",children:"应用"})]}):e.jsx("span",{className:"text-xs text-amber-300/90",children:a})})]},i)})})]})]})}function tb({deviceId:t}){const{databases:r,dbLoading:s,dbError:n,selectedDb:a,selectedTable:i,tables:o,tablesLoading:l,schema:c,showSchema:u,tableData:x,dataLoading:m,dataError:h,page:y,pageSize:p,orderBy:f,ascending:w,queryMode:N,queryInput:E,queryResult:S,queryLoading:j,queryError:k,dbSortOrder:R,dbSortAscending:D,globalSearchKeyword:F,globalSearchResult:P,globalSearchLoading:U,globalSearchError:K,searchHistory:G,highlightRowId:q,pendingTargetRowId:C,isJumpingToMatch:b,loadDatabases:M,loadTables:T,loadSchema:B,loadTableData:A,selectDb:I,selectTable:O,setShowSchema:z,setSortAndReload:H,setPageAndReload:le,setQueryMode:Y,setQueryInput:V,executeQuery:ie,setDbSortOrder:Ne,toggleDbSortDirection:se,getSortedDatabases:de,setGlobalSearchKeyword:_,executeGlobalSearch:ue,clearGlobalSearch:ae,navigateToSearchResult:ee,jumpToSearchResultRow:me,clearHighlightRow:Ce,removeFromSearchHistory:Fe,clearSearchHistory:et,reset:ze}=ml(),[re,Se]=d.useState(!1),[L,Q]=d.useState(!1),Z=d.useRef(null),[J,be]=d.useState(null),[Ie,ye]=d.useState(0),[je,$e]=d.useState({}),[_e,We]=d.useState({}),[mt,He]=d.useState({}),[Xe,Nt]=d.useState({}),{descriptorMeta:tt,getColumnConfig:Et}=sn(),[kt,ht]=d.useState(!1);d.useEffect(()=>{ht(!1)},[i]),d.useEffect(()=>{be(null),ye(0),$e({}),We({}),He({}),Nt({})},[P?.keyword,P?.dbId]),d.useEffect(()=>{if(!L)return;const v=setTimeout(()=>{Z.current?.focus()},0);return()=>clearTimeout(v)},[L]);const oe=d.useMemo(()=>(P?.tableResults??[]).map(W=>({...W,matchRowIds:W.matchRowIds??[]})),[P]),pt=d.useMemo(()=>{if(!P)return null;const v=Kg(),W=v.totalMatches>0&&P.totalMatches>=v.totalMatches,X=P.tableResults.filter(ne=>v.perTableMatches>0&&ne.matchCount>=v.perTableMatches);return!W&&X.length===0?null:{thresholds:v,totalOver:W,tableOver:X}},[P]),ys=d.useCallback(v=>oe.find(W=>W.tableName===v)||null,[oe]),js=d.useCallback(async(v,W)=>{if(!P||!a)return;const X=ys(v);if(!X)return;const ne=X.matchRowIds||[],Ee=(W-1)*is,xe=ne.slice(Ee,Ee+is);if(He(pe=>({...pe,[v]:!0})),Nt(pe=>({...pe,[v]:null})),xe.length===0){We(pe=>({...pe,[v]:[]})),He(pe=>({...pe,[v]:!1}));return}try{const pe=await Ic(t,a,{tableName:v,rowIds:xe});We(ke=>({...ke,[v]:pe.rows})),He(ke=>({...ke,[v]:!1}))}catch(pe){const ke=pe instanceof Error?pe.message:"加载匹配结果失败";Nt(ge=>({...ge,[v]:ke})),He(ge=>({...ge,[v]:!1}))}},[t,ys,P,a]),br=d.useCallback((v,W)=>{const X=Math.floor(W/is)+1;$e(ne=>ne[v]===X?ne:{...ne,[v]:X}),js(v,X)},[js]),ft=d.useMemo(()=>{if(!J)return{currentTableIndex:-1,totalTables:oe.length,totalMatchesInTable:0,hasPrevMatch:oe.length>0,hasNextMatch:oe.length>0,hasPrevTable:oe.length>0,hasNextTable:oe.length>0};const v=oe.findIndex(ge=>ge.tableName===J),W=oe.length,ne=(v>=0?oe[v]:null)?.matchRowIds.length??0;let Ee=Ie>0;if(!Ee){for(let ge=v-1;ge>=0;ge-=1)if(oe[ge].matchRowIds.length>0){Ee=!0;break}}let xe=Ie+1<ne;if(!xe){for(let ge=v+1;ge<oe.length;ge+=1)if(oe[ge].matchRowIds.length>0){xe=!0;break}}let pe=!1;for(let ge=v-1;ge>=0;ge-=1)if(oe[ge].matchRowIds.length>0){pe=!0;break}let ke=!1;for(let ge=v+1;ge<oe.length;ge+=1)if(oe[ge].matchRowIds.length>0){ke=!0;break}return{currentTableIndex:v,totalTables:W,totalMatchesInTable:ne,hasPrevMatch:Ee,hasNextMatch:xe,hasPrevTable:pe,hasNextTable:ke}},[Ie,J,oe]),Vs=d.useMemo(()=>!a||!i?0:tt.filter(v=>v.dbId===a&&v.tableName===i).length,[tt,a,i]),an=!!(P&&J&&i===J&&ft.currentTableIndex>=0),on=L,[Oe,It]=d.useState({}),[qs,gt]=d.useState(null),[Gs,Ys]=d.useState(null);d.useEffect(()=>{It({}),gt(null),Ys(null)},[i]),d.useEffect(()=>{if(!q||!x?.rows)return;let v=null;const W=setTimeout(()=>{const X=document.querySelector(`tr[data-rowid="${q}"]`);X&&(X.scrollIntoView({behavior:"smooth",block:"center"}),v=setTimeout(()=>{Ce()},3e3))},100);return()=>{clearTimeout(W),v&&clearTimeout(v)}},[q,x?.rows,Ce]);const[Ks,ss]=d.useState(300),[vs,yr]=d.useState(!1),Wt=d.useRef(null),ln=d.useCallback(v=>{v.preventDefault(),Wt.current={startY:v.clientY,startHeight:Ks},yr(!0)},[Ks]);d.useEffect(()=>{if(!vs)return;const v=X=>{if(!Wt.current)return;const ne=X.clientY-Wt.current.startY,Ee=Math.max(100,Math.min(window.innerHeight*.8,Wt.current.startHeight+ne));ss(Ee)},W=()=>{yr(!1),Wt.current=null};return window.addEventListener("mousemove",v),window.addEventListener("mouseup",W),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",W)}},[vs]);const[Ht,te]=d.useState({}),[Te,Ke]=d.useState(!1),rs=d.useRef(null),jr=d.useCallback((v,W)=>{v.preventDefault(),v.stopPropagation();const X=Ht[W]||150;rs.current={columnName:W,startX:v.clientX,startWidth:X},Ke(!0)},[Ht]);d.useEffect(()=>{if(!Te)return;const v=X=>{if(!rs.current)return;const{columnName:ne,startX:Ee,startWidth:xe}=rs.current,pe=X.clientX-Ee,ke=Math.max(80,Math.min(600,xe+pe));te(ge=>({...ge,[ne]:ke}))},W=()=>{Ke(!1),rs.current=null};return document.addEventListener("mousemove",v),document.addEventListener("mouseup",W),()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",W)}},[Te]);const[Ut,Vt]=d.useState(null),[cn,Sa]=d.useState(!1),[dn,Cl]=d.useState(!0),[un,Sl]=d.useState(!0),[xn,Tl]=d.useState(!1),Ta=d.useRef(t),Ea=d.useRef(i);d.useEffect(()=>{Ea.current!==i&&(It({}),gt(null),Ea.current=i)},[i]),d.useEffect(()=>{if(!Ut)return;const v=X=>{X.key==="Escape"&&Vt(null)},W=X=>{const ne=X.target;!ne.closest("[data-path-popup]")&&!ne.closest("[data-path-button]")&&Vt(null)};return document.addEventListener("keydown",v),document.addEventListener("mousedown",W),()=>{document.removeEventListener("keydown",v),document.removeEventListener("mousedown",W)}},[Ut]),d.useEffect(()=>{Ta.current!==t&&(ze(),Ta.current=t),M(t)},[t,ze,M]),d.useEffect(()=>{a&&o.length===0&&T(t,a)},[t,a,o.length,T]),d.useEffect(()=>{a&&i&&!x&&!C&&(B(t,a,i),A(t,a,i))},[t,a,i,x,C,B,A]);const mn=d.useCallback(v=>{I(v),T(t,v)},[I,T,t]),El=d.useCallback(v=>{O(v),a&&(B(t,a,v),A(t,a,v))},[O,a,t,B,A]),Qe=d.useCallback((v,W,X)=>{be(v),ye(W),br(v,W),a?me(t,a,v,X):ee(v,X)},[t,br,me,ee,a]),Ia=d.useCallback(v=>{const W=ys(v);if(!W||W.matchRowIds.length===0){ee(v);return}const X=W.matchRowIds[0];Qe(v,0,X)},[ys,Qe,ee]),Ma=d.useCallback((v,W,X)=>{Qe(v,W,X)},[Qe]),Da=d.useCallback((v,W)=>{$e(X=>({...X,[v]:W})),js(v,W)},[js]),Il=d.useCallback(()=>{if(!P||oe.length===0)return;let v=J?oe.findIndex(X=>X.tableName===J):0;v<0&&(v=0);let W=J?Ie:-1;for(;v<oe.length;){const X=oe[v].matchRowIds;if(X.length===0){v+=1,W=-1;continue}if(W+1<X.length){W+=1,Qe(oe[v].tableName,W,X[W]);return}v+=1,W=-1}},[Ie,J,P,Qe,oe]),Ml=d.useCallback(()=>{if(!P||oe.length===0)return;if(!J){for(let W=oe.length-1;W>=0;W-=1){const X=oe[W].matchRowIds;if(X.length>0){const ne=X.length-1;Qe(oe[W].tableName,ne,X[ne]);return}}return}let v=oe.findIndex(W=>W.tableName===J);for(v<0&&(v=oe.length-1);v>=0;){const W=oe[v].matchRowIds;if(W.length===0){v-=1;continue}if(v===oe.findIndex(ne=>ne.tableName===J)){if(Ie-1>=0){const ne=Ie-1;Qe(oe[v].tableName,ne,W[ne]);return}v-=1;continue}const X=W.length-1;Qe(oe[v].tableName,X,W[X]);return}},[Ie,J,P,Qe,oe]),Dl=d.useCallback(()=>{if(!P||oe.length===0)return;let v=J?oe.findIndex(W=>W.tableName===J):-1;for(v+=1;v<oe.length;){const W=oe[v].matchRowIds;if(W.length>0){Qe(oe[v].tableName,0,W[0]);return}v+=1}},[J,P,Qe,oe]),Rl=d.useCallback(()=>{if(!P||oe.length===0)return;let v=J?oe.findIndex(W=>W.tableName===J):oe.length;for(v-=1;v>=0;){const W=oe[v].matchRowIds;if(W.length>0){Qe(oe[v].tableName,0,W[0]);return}v-=1}},[J,P,Qe,oe]),Ra=d.useCallback(v=>{H(t,v)},[H,t]),La=d.useCallback(v=>{le(t,v)},[le,t]),Ll=d.useCallback((v,W)=>{It(X=>{if(W===""){const{[v]:ne,...Ee}=X;return Ee}return{...X,[v]:W}})},[]),Pa=d.useCallback(v=>{It(W=>{const{[v]:X,...ne}=W;return ne}),gt(null)},[]),Pl=d.useCallback(()=>{It({}),gt(null)},[]),Oa=d.useCallback(async v=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(v),!0;const W=document.createElement("textarea");W.value=v,W.style.position="fixed",W.style.left="-9999px",W.style.top="-9999px",document.body.appendChild(W),W.focus(),W.select();const X=document.execCommand("copy");return document.body.removeChild(W),X}catch(W){return console.error("Failed to copy:",W),!1}},[]),Aa=d.useCallback(v=>v.appSupport?`Application Support/${v.appSupport.relative}`:v.documents?`Documents/${v.documents.relative}`:v.caches?`Caches/${v.caches.relative}`:v.group?`AppGroup(${v.group.containerId})/${v.group.relative}`:v.custom?v.custom.description:"Unknown location",[]),Js=d.useCallback(v=>v.absolutePath||Aa(v.descriptor.location),[Aa]),hn=Tt(),pn=d.useCallback(async v=>{const W=Js(v);await Oa(W)?(Sa(!0),hn.show("success","路径已复制到剪贴板"),setTimeout(()=>Sa(!1),2e3)):hn.show("error","复制失败，请手动复制")},[Js,Oa,hn]),Fa=d.useMemo(()=>{if(!x?.rows)return[];const v=Object.entries(Oe);return v.length===0?x.rows:x.rows.filter(W=>v.every(([X,ne])=>{const Ee=W.values[X];return Ee==null?ne.toLowerCase()==="null":String(Ee).toLowerCase().includes(ne.toLowerCase())}))},[x?.rows,Oe]);if(s)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full"})});if(n){const v=n.includes("未连接")||n.includes("404");return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[v?e.jsxs(e.Fragment,{children:[e.jsx(xs,{size:48,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-base font-medium mb-2",children:"设备未连接"}),e.jsx("p",{className:"text-sm text-text-muted mb-4 text-center max-w-md",children:"请确保设备已连接到 DebugHub，且 DebugProbe SDK 已启用数据库功能"})]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm mb-3",children:n})]}),e.jsx("button",{onClick:()=>M(t),className:"px-4 py-2 bg-primary/20 text-primary rounded-lg hover:bg-primary/30 transition-colors",children:"重试"})]})}return r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(xs,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"没有注册的数据库"}),e.jsx("p",{className:"text-xs mt-2 text-text-muted",children:"在 App 中使用 DatabaseRegistry.shared.register() 注册数据库"})]}):e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-64 flex-shrink-0 border-r border-border bg-bg-dark flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-xs font-medium text-text-muted uppercase tracking-wider",children:"数据库"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>M(t),disabled:s,className:"px-2 py-1 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter transition-colors disabled:opacity-50",title:"刷新所有数据库",children:"刷新"}),e.jsxs("select",{value:R,onChange:v=>Ne(v.target.value),className:"text-2xs bg-bg-light border border-border rounded px-1.5 py-0.5 text-text-secondary focus:outline-none focus:border-primary",title:"排序方式",children:[e.jsx("option",{value:"name",children:"名称"}),e.jsx("option",{value:"size",children:"大小"}),e.jsx("option",{value:"tableCount",children:"表数"})]}),e.jsx("button",{onClick:se,className:"p-1 rounded hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",title:D?"升序":"降序",children:D?e.jsx(ms,{size:12}):e.jsx(hs,{size:12})})]})]}),e.jsxs("div",{className:"space-y-1",children:[(()=>{const v=de().filter(W=>(W.descriptor.ownership||"shared")==="shared");return v.length===0?null:e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>Cl(!dn),className:"w-full flex items-center gap-1.5 px-2 py-1.5 text-2xs text-accent-blue font-medium hover:text-accent-blue/80 transition-colors",children:[dn?e.jsx(yt,{size:12}):e.jsx(at,{size:12}),e.jsx("span",{children:"共享"}),e.jsxs("span",{className:"opacity-60",children:["(",v.length,")"]})]}),dn&&e.jsx("div",{className:"mt-1 space-y-1",children:v.map(W=>e.jsx($n,{db:W,isSelected:a===W.descriptor.id,pathPopupDbId:Ut,pathCopied:cn,onSelect:mn,onTogglePathPopup:X=>Vt(Ut===X?null:X),onClosePathPopup:()=>Vt(null),onCopyPath:pn,getDisplayPath:Js},W.descriptor.id))})]})})(),(()=>{const v=de().filter(ne=>(ne.descriptor.ownership||"shared")==="currentUser");if(v.length===0)return null;const W=de().some(ne=>(ne.descriptor.ownership||"shared")==="shared"),X=v[0]?.descriptor.ownerDisplayName||"当前账户";return e.jsxs("div",{className:W?"mt-2 pt-2 border-t border-border":"",children:[e.jsxs("button",{onClick:()=>Sl(!un),className:"w-full flex items-center gap-1.5 px-2 py-1.5 text-2xs text-primary font-medium hover:text-primary/80 transition-colors",children:[un?e.jsx(yt,{size:12}):e.jsx(at,{size:12}),e.jsx("span",{children:X}),e.jsxs("span",{className:"opacity-60",children:["(",v.length,")"]})]}),un&&e.jsx("div",{className:"mt-1 space-y-1",children:v.map(ne=>e.jsx($n,{db:ne,isSelected:a===ne.descriptor.id,pathPopupDbId:Ut,pathCopied:cn,onSelect:mn,onTogglePathPopup:Ee=>Vt(Ut===Ee?null:Ee),onClosePathPopup:()=>Vt(null),onCopyPath:pn,getDisplayPath:Js},ne.descriptor.id))})]})})(),(()=>{const v=de().filter(xe=>(xe.descriptor.ownership||"shared")==="otherUser");if(v.length===0)return null;const W=v.reduce((xe,pe)=>{const ke=pe.descriptor.ownerIdentifier||"未知";return xe[ke]||(xe[ke]=[]),xe[ke].push(pe),xe},{}),X=de().some(xe=>(xe.descriptor.ownership||"shared")==="shared"),ne=de().some(xe=>(xe.descriptor.ownership||"shared")==="currentUser"),Ee=X||ne;return e.jsxs("div",{className:Ee?"mt-2 pt-2 border-t border-border":"",children:[e.jsxs("button",{onClick:()=>Tl(!xn),className:"w-full flex items-center gap-1.5 px-2 py-1.5 text-2xs text-text-muted font-medium hover:text-text-secondary transition-colors",children:[xn?e.jsx(yt,{size:12}):e.jsx(at,{size:12}),e.jsx("span",{children:"其他账户"}),e.jsxs("span",{className:"opacity-60",children:["(",v.length,")"]})]}),xn&&e.jsx("div",{className:"mt-1 space-y-2 opacity-50",children:Object.entries(W).map(([xe,pe])=>{const ke=pe[0]?.descriptor.ownerDisplayName||null,ge=!!ke;return e.jsxs("div",{className:"space-y-1",children:[e.jsx(Qi,{text:xe,title:"账户 ID",trigger:"dblclick",children:e.jsx("div",{className:`px-2 py-0.5 text-2xs text-text-muted/70 truncate hover:text-text-muted transition-colors ${ge?"":"font-mono"}`,title:ge?`账户 ID: ${xe}`:"双击查看完整 ID",children:ge?ke:xe.length>20?`${xe.slice(0,8)}...${xe.slice(-8)}`:xe})}),pe.map(qt=>e.jsx($n,{db:qt,isSelected:a===qt.descriptor.id,pathPopupDbId:Ut,pathCopied:cn,onSelect:mn,onTogglePathPopup:ws=>Vt(Ut===ws?null:ws),onClosePathPopup:()=>Vt(null),onCopyPath:pn,getDisplayPath:Js},qt.descriptor.id))]},xe)})})]})})()]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xs font-medium text-text-muted uppercase tracking-wider",children:["表 ",o.length>0&&`(${o.length})`]}),e.jsx("div",{className:"flex items-center gap-1",children:a&&e.jsx("button",{onClick:()=>a&&T(t,a),disabled:l,className:"px-2 py-1 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter transition-colors disabled:opacity-50",title:"刷新当前数据库的所有表",children:"刷新"})})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("button",{onClick:()=>Q(!0),disabled:!a,className:g("w-full px-3 py-2 rounded text-xs flex items-center justify-center gap-1 transition-colors",a?"bg-primary text-bg-darkest hover:bg-primary/90":"bg-bg-light text-text-muted cursor-not-allowed"),title:a?"打开跨表搜索":"请先选择数据库",children:[e.jsx(St,{size:12}),"跨表搜索",P&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 rounded bg-bg-darkest/20 text-[10px]",children:P.totalMatches})]})}),l?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})}):a?e.jsx("div",{className:"space-y-1",children:o.map(v=>e.jsx("button",{onClick:()=>El(v.name),className:g("w-full px-3 py-2 rounded-lg text-left text-xs transition-all",i===v.name?"bg-accent-blue text-white shadow-sm shadow-accent-blue/30":"text-text-secondary hover:bg-bg-light"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-mono truncate",children:v.name}),e.jsx("span",{className:g("tabular-nums",i===v.name?"text-white/70":"text-text-muted"),children:v.rowCount!==null?v.rowCount.toLocaleString():"?"})]})},v.name))}):e.jsx("p",{className:"text-xs text-text-muted text-center py-4",children:"请先选择数据库"})]})]}),on&&e.jsxs("div",{className:"w-[360px] min-w-[320px] max-w-[420px] flex-shrink-0 border-r border-border bg-bg-dark/70 flex flex-col",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-border bg-bg-dark/80 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wider",children:"跨表搜索"}),e.jsx("button",{onClick:()=>Q(!1),className:"px-2 py-1 rounded text-2xs text-text-muted hover:text-text-secondary hover:bg-bg-light transition-colors",children:"关闭"})]}),e.jsxs("div",{className:"px-3 py-2 border-b border-border bg-bg-dark/60",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:Z,type:"text",value:F,onChange:v=>_(v.target.value),onFocus:()=>Se(!0),onBlur:()=>{setTimeout(()=>Se(!1),200)},onKeyDown:v=>{v.key==="Enter"&&F.trim()&&(ue(t),Se(!1))},placeholder:"搜索所有表...",className:"w-full px-3 py-1.5 pl-8 text-xs bg-bg-light border border-border rounded focus:outline-none focus:border-primary transition-colors"}),e.jsx(St,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-text-muted"}),F&&e.jsx("button",{onClick:ae,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary",title:"清除搜索",children:e.jsx(cs,{size:12})}),re&&G.length>0&&!F&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-bg-dark border border-border rounded-lg shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5 bg-bg-tertiary border-b border-border",children:[e.jsxs("span",{className:"text-2xs text-text-muted flex items-center gap-1",children:[e.jsx(Qt,{size:10}),"搜索历史"]}),e.jsxs("button",{onClick:v=>{v.preventDefault(),v.stopPropagation(),et()},className:"text-2xs text-text-muted hover:text-red-400 flex items-center gap-0.5",title:"清除所有历史",children:[e.jsx(Ae,{size:10}),"清除"]})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto bg-bg-dark",children:G.map((v,W)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5 hover:bg-bg-lighter cursor-pointer group",onMouseDown:X=>{X.preventDefault(),_(v),Se(!1),setTimeout(()=>ue(t),0)},children:[e.jsx("span",{className:"text-xs text-text-secondary truncate flex-1",children:v}),e.jsx("button",{onMouseDown:X=>{X.preventDefault(),X.stopPropagation(),Fe(v)},className:"opacity-0 group-hover:opacity-100 text-text-muted hover:text-red-400 ml-2",title:"删除此记录",children:e.jsx(cs,{size:10})})]},W))})]})]}),F.trim()&&e.jsx("button",{onClick:()=>ue(t),disabled:U,className:"w-full mt-2 px-3 py-1.5 bg-primary text-bg-darkest rounded text-xs hover:bg-primary/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-1",children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-bg-darkest border-t-transparent rounded-full"}),"搜索中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{size:12}),"搜索全部表"]})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden p-3",children:[U&&!P&&e.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-primary border-t-transparent rounded-full"}),"搜索中..."]})}),K&&e.jsx("div",{className:"mb-3 p-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-400",children:K}),P&&e.jsxs("div",{className:"h-full flex flex-col bg-bg-light border border-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-border bg-bg-tertiary flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-primary",children:["找到 ",P.totalMatches," 条匹配"]}),e.jsxs("span",{className:"text-2xs text-text-muted",children:[P.searchDurationMs.toFixed(0),"ms"]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-2 space-y-2",children:[pt&&e.jsxs("div",{className:"px-2 py-1.5 rounded border border-yellow-500/40 bg-yellow-500/10 text-2xs text-yellow-300 flex items-start gap-2",children:[e.jsx(jt,{size:12,className:"mt-0.5"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"text-yellow-200",children:"结果过大，建议缩小关键词/缩小表范围"}),e.jsxs("div",{className:"text-yellow-200/70",children:["阈值：总匹配 ≥ ",pt.thresholds.totalMatches.toLocaleString(),"，单表 ≥ ",pt.thresholds.perTableMatches.toLocaleString()]})]})]}),oe.length===0?e.jsx("p",{className:"text-xs text-text-muted text-center py-4",children:"未找到匹配结果"}):e.jsx("div",{className:"space-y-2",children:oe.map(v=>e.jsx("div",{className:"border border-border rounded overflow-hidden",children:(()=>{const W=J===v.tableName,X=v.matchRowIds||[],ne=X.length,Ee=!!(pt&&pt.tableOver.some(ot=>ot.tableName===v.tableName)),xe=je[v.tableName]||1,pe=Math.max(1,Math.ceil(ne/is)),ke=_e[v.tableName]||[],ge=mt[v.tableName],qt=Xe[v.tableName],ws=v.matchedColumns.length>0?v.matchedColumns.slice(0,2):v.columns.slice(0,2).map(ot=>ot.name);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{Ia(v.tableName)},className:g("w-full px-2 py-1.5 text-left text-xs transition-colors",i===v.tableName?"bg-accent-blue/20 text-accent-blue":"text-text-secondary hover:bg-bg-lighter bg-bg-tertiary"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-mono truncate",children:v.tableName}),e.jsxs("div",{className:"flex items-center gap-1",children:[Ee&&e.jsx("span",{className:"text-2xs text-yellow-300 bg-yellow-500/10 px-1 py-0.5 rounded border border-yellow-500/40",children:"过大"}),e.jsx("span",{className:"text-2xs text-accent-blue bg-accent-blue/10 px-1.5 py-0.5 rounded",children:v.matchCount})]})]}),e.jsxs("div",{className:"text-2xs text-text-muted mt-0.5 truncate",children:["匹配列: ",v.matchedColumns.join(", ")]})]}),W?e.jsxs("div",{className:"bg-bg-secondary/50 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 text-2xs text-text-muted border-b border-border",children:[e.jsx("span",{children:ne>0?`显示 ${Math.min((xe-1)*is+1,ne)}-${Math.min(xe*is,ne)} / ${ne}`:"暂无匹配"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Da(v.tableName,Math.max(1,xe-1)),disabled:xe<=1||ge,className:"px-1.5 py-0.5 rounded border border-border text-text-muted hover:text-text-secondary hover:bg-bg-lighter disabled:opacity-40",children:"上一页"}),e.jsxs("span",{className:"tabular-nums",children:[xe,"/",pe]}),e.jsx("button",{onClick:()=>Da(v.tableName,Math.min(pe,xe+1)),disabled:xe>=pe||ge,className:"px-1.5 py-0.5 rounded border border-border text-text-muted hover:text-text-secondary hover:bg-bg-lighter disabled:opacity-40",children:"下一页"})]})]}),ge?e.jsx("div",{className:"py-3 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-primary border-t-transparent rounded-full"})}):qt?e.jsx("div",{className:"px-2 py-2 text-2xs text-red-400",children:qt}):ke.length===0?e.jsx("div",{className:"px-2 py-2 text-2xs text-text-muted",children:"暂无匹配"}):e.jsx("div",{className:"max-h-56 overflow-auto",children:ke.map((ot,Ns)=>{const qe=ot.values._rowid??null,ks=qe?X.indexOf(String(qe)):-1,ns=ks>=0?ks:(xe-1)*is+Ns,Ol=J===v.tableName&&ns===Ie;return e.jsxs("div",{onClick:()=>{qe&&Ma(v.tableName,ns,qe)},className:g("px-2 py-1 text-2xs border-b border-border last:border-b-0 truncate font-mono cursor-pointer flex items-center gap-2",Ol?"bg-accent-blue/15 text-accent-blue":"text-text-muted hover:bg-bg-lighter"),children:[qe&&e.jsxs("span",{className:"text-accent-blue/70 min-w-[2.5rem] text-right",title:"Row ID",children:["#",qe]}),e.jsx("span",{className:"flex-1 truncate",children:ws.map(fn=>e.jsxs("span",{className:"mr-3",children:[e.jsxs("span",{className:"text-text-secondary",children:[fn,":"]})," ",e.jsx("span",{className:"text-text-primary",children:zn(String(ot.values[fn]??"NULL"),F)})]},fn))})]},`${v.tableName}-${ns}`)})})]}):v.previewRows&&v.previewRows.length>0&&e.jsxs("div",{className:"bg-bg-secondary/50 border-t border-border max-h-32 overflow-auto",children:[v.previewRows.slice(0,3).map((ot,Ns)=>{const qe=ot.values._rowid??null,ks=qe?X.indexOf(String(qe)):Ns;return e.jsxs("div",{onClick:()=>{qe?Ma(v.tableName,ks,qe):Ia(v.tableName)},className:"px-2 py-1 text-2xs text-text-muted border-b border-border last:border-b-0 truncate font-mono hover:bg-bg-lighter cursor-pointer flex items-center gap-2",children:[qe&&e.jsxs("span",{className:"text-accent-blue/70 min-w-[2.5rem] text-right",title:"Row ID",children:["#",qe]}),e.jsx("span",{className:"flex-1 truncate",children:v.matchedColumns.slice(0,2).map(ns=>e.jsxs("span",{className:"mr-3",children:[e.jsxs("span",{className:"text-text-secondary",children:[ns,":"]})," ",e.jsx("span",{className:"text-text-primary",children:zn(String(ot.values[ns]??"NULL"),F)})]},ns))})]},Ns)}),ne>v.previewRows.length&&e.jsx("div",{className:"px-2 py-1 text-2xs text-text-muted bg-bg-secondary/70",children:"点击表名查看全部匹配"})]})]})})()},v.tableName))})]})]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-mono text-sm text-text-primary",children:i}),x&&e.jsxs("span",{className:"text-xs text-text-muted",children:[x.totalRows?.toLocaleString()??"?"," 行"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ht(!kt),className:g("px-3 py-1.5 rounded text-xs transition-colors flex items-center gap-1 whitespace-nowrap",kt?"bg-purple-500/20 text-purple-400 ring-1 ring-purple-500/40":Vs>0?"text-purple-400 hover:bg-purple-500/10":"text-text-secondary hover:bg-bg-light"),title:"Protobuf 配置",children:[e.jsx(Bt,{size:12}),"Protobuf",Vs>0&&e.jsx("span",{className:"ml-0.5 px-1 py-0.5 rounded text-2xs bg-purple-500/20 text-purple-400",children:Vs})]}),e.jsxs("button",{onClick:()=>z(!u),className:g("px-3 py-1.5 rounded text-xs transition-colors flex items-center gap-1",u?"bg-[rgba(0,212,170,0.2)] text-primary ring-1 ring-[rgba(0,212,170,0.4)]":"text-text-secondary hover:bg-bg-light"),children:[e.jsx(dt,{size:12})," Schema"]}),e.jsxs("button",{onClick:()=>{N||V(`SELECT * FROM ${i} LIMIT 100`),Y(!N)},className:g("px-3 py-1.5 rounded text-xs transition-colors flex items-center gap-1",N?"bg-[rgba(74,144,217,0.2)] text-accent-blue ring-1 ring-[rgba(74,144,217,0.4)]":"text-text-secondary hover:bg-bg-light"),title:"SQL 查询",children:[e.jsx(ni,{size:12})," SQL 查询"]}),e.jsx("button",{onClick:()=>a&&i&&A(t,a,i),disabled:m,className:"px-3 py-1.5 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter transition-colors disabled:opacity-50",children:"刷新"})]})]}),an&&e.jsxs("div",{className:"px-4 py-2 border-b border-border bg-bg-dark/40 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-2xs text-text-muted",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded bg-accent-blue/10 text-accent-blue",children:["搜索: ",P?.keyword]}),e.jsxs("span",{className:"tabular-nums",children:["表 ",ft.currentTableIndex+1,"/",ft.totalTables]}),e.jsxs("span",{className:"tabular-nums",children:["匹配 ",ft.totalMatchesInTable>0?Ie+1:0,"/",ft.totalMatchesInTable]}),b&&e.jsxs("span",{className:"flex items-center gap-1 text-accent-blue",children:[e.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-accent-blue border-t-transparent rounded-full"}),"定位中..."]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-2xs",children:[e.jsxs("button",{onClick:Ml,disabled:!ft.hasPrevMatch||b,className:"px-2 py-1 rounded border border-border text-text-secondary hover:bg-bg-lighter disabled:opacity-40 flex items-center gap-1",children:[e.jsx(Jn,{size:10}),"上一条"]}),e.jsxs("button",{onClick:Il,disabled:!ft.hasNextMatch||b,className:"px-2 py-1 rounded border border-border text-text-secondary hover:bg-bg-lighter disabled:opacity-40 flex items-center gap-1",children:["下一条",e.jsx(at,{size:10})]}),e.jsx("div",{className:"w-px h-4 bg-border"}),e.jsxs("button",{onClick:Rl,disabled:!ft.hasPrevTable||b,className:"px-2 py-1 rounded border border-border text-text-secondary hover:bg-bg-lighter disabled:opacity-40 flex items-center gap-1",children:[e.jsx(Jn,{size:10}),"上一表"]}),e.jsxs("button",{onClick:Dl,disabled:!ft.hasNextTable||b,className:"px-2 py-1 rounded border border-border text-text-secondary hover:bg-bg-lighter disabled:opacity-40 flex items-center gap-1",children:["下一表",e.jsx(at,{size:10})]})]})]}),(kt||u||N)&&e.jsxs("div",{className:"relative border-b border-border bg-bg-dark/30 flex flex-col",children:[e.jsxs("div",{className:"overflow-auto",style:{maxHeight:Ks},children:[kt&&e.jsx("div",{className:"px-4 py-3",children:e.jsx(If,{dbId:a,tableName:i,columns:c.map(v=>({name:v.name,type:v.type})),onClose:()=>ht(!1)})}),u&&c.length>0&&e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"bg-bg-dark rounded-lg border border-border shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{size:16,className:"text-primary"}),e.jsx("h3",{className:"font-medium text-primary text-sm",children:"Schema"}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",c.length," 列)"]})]}),e.jsx("button",{onClick:()=>z(!1),className:"px-2 py-1 rounded text-xs hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:"收起"})]}),e.jsx("div",{className:"max-h-[200px] overflow-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-bg-dark",children:e.jsxs("tr",{className:"text-left text-text-muted",children:[e.jsx("th",{className:"px-4 py-2 font-medium border-b border-border",children:"列名"}),e.jsx("th",{className:"px-4 py-2 font-medium border-b border-border",children:"类型"}),e.jsx("th",{className:"px-4 py-2 font-medium border-b border-border",children:"主键"}),e.jsx("th",{className:"px-4 py-2 font-medium border-b border-border",children:"非空"}),e.jsx("th",{className:"px-4 py-2 font-medium border-b border-border",children:"默认值"})]})}),e.jsx("tbody",{className:"font-mono",children:c.map(v=>e.jsxs("tr",{className:"hover:bg-bg-light/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-1.5 text-primary",children:v.name}),e.jsx("td",{className:"px-4 py-1.5 text-text-secondary",children:v.type||"-"}),e.jsx("td",{className:"px-4 py-1.5",children:v.primaryKey?"✓":""}),e.jsx("td",{className:"px-4 py-1.5",children:v.notNull?"✓":""}),e.jsx("td",{className:"px-4 py-1.5 text-text-muted",children:v.defaultValue||"-"})]},v.name))})]})})]})}),N&&e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"bg-bg-dark rounded-lg border border-border shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ni,{size:16,className:"text-accent-blue"}),e.jsx("h3",{className:"text-sm font-medium text-accent-blue",children:"SQL 查询"}),e.jsx("span",{className:"text-xs text-text-muted",children:"（仅支持 SELECT）"})]}),e.jsx("button",{onClick:()=>Y(!1),className:"px-2 py-1 rounded text-xs hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:"收起"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(Vg,{value:E,onChange:V,onExecute:()=>ie(t),placeholder:"SELECT * FROM table_name LIMIT 100",height:100,tables:o.map(v=>v.name),tableColumns:c?{[i||""]:c.map(v=>v.name)}:{},disabled:j}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:S&&S.success&&S.rowCount!=null&&S.executionTimeMs!=null&&e.jsxs(e.Fragment,{children:[S.rowCount," 行 • ",S.executionTimeMs.toFixed(2)," ms"]})}),e.jsx("button",{onClick:()=>ie(t),disabled:j||!E.trim(),className:"px-3 py-1 bg-primary text-white rounded text-xs font-medium hover:bg-primary/90 disabled:opacity-50 transition-colors",children:j?"执行中...":"执行 (⌘↵)"})]}),k&&e.jsx(eb,{error:k,onApplySuggestion:v=>V(v)})]}),(j||S)&&e.jsx("div",{className:"max-h-[200px] overflow-auto border-t border-border",children:j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})}):S&&S.success&&S.rows&&S.rows.length>0?e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-bg-dark",children:e.jsx("tr",{children:S.columns?.map(v=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-text-muted border-b border-border",children:v.name},v.name))})}),e.jsx("tbody",{className:"font-mono",children:S.rows.map((v,W)=>e.jsx("tr",{className:"border-b border-border hover:bg-bg-light/30 transition-colors",children:S.columns?.map(X=>e.jsx("td",{className:"px-3 py-1.5 text-text-secondary max-w-xs truncate",title:v.values[X.name]??"",children:v.values[X.name]===null?e.jsx("span",{className:"text-text-muted italic",children:"NULL"}):v.values[X.name]},X.name))},W))})]}):S&&S.success?e.jsx("div",{className:"flex items-center justify-center py-4 text-text-muted text-xs",children:"查询结果为空"}):null})]})})]}),e.jsx("div",{onMouseDown:ln,className:g("h-1.5 cursor-ns-resize flex items-center justify-center transition-colors",vs?"bg-primary/30":"hover:bg-bg-lighter"),title:"拖动调整面板高度",children:e.jsx("div",{className:g("w-10 h-0.5 rounded-full transition-colors",vs?"bg-primary":"bg-text-muted/50")})})]}),Object.keys(Oe).length>0&&e.jsxs("div",{className:"px-4 py-2 border-b border-border bg-primary/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-primary flex-wrap",children:[e.jsx(St,{size:14,className:"flex-shrink-0"}),e.jsxs("span",{className:"flex-shrink-0",children:["已筛选 ",Object.keys(Oe).length," 列， 显示 ",Fa.length," / ",x?.rows.length??0," 行"]}),e.jsx("span",{className:"text-text-muted mx-1",children:"|"}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:Object.entries(Oe).map(([v,W])=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-primary/20 rounded text-primary",children:[e.jsx("span",{className:"font-medium",children:v}),e.jsx("span",{className:"text-text-muted",children:"="}),e.jsxs("span",{className:"max-w-[120px] truncate",title:W,children:['"',W,'"']}),e.jsx("button",{onClick:()=>It(X=>{const ne={...X};return delete ne[v],ne}),className:"ml-0.5 text-text-muted hover:text-primary",title:`清除 ${v} 筛选`,children:e.jsx(cs,{size:10})})]},v))})]}),e.jsxs("button",{onClick:Pl,className:"text-xs text-primary hover:text-primary/80 flex items-center gap-1 flex-shrink-0",children:[e.jsx(cs,{size:12}),"清除全部"]})]}),e.jsxs("div",{className:g("flex-1 overflow-auto relative",Te&&"select-none"),children:[e.jsx(bs,{isLoading:m,text:"刷新表数据..."}),x?e.jsxs("table",{className:"text-xs table-fixed",style:{minWidth:"100%"},children:[e.jsx("thead",{className:"sticky top-0 bg-bg-dark z-10",children:e.jsx("tr",{children:x.columns.map((v,W)=>{const X=Oe[v.name]!==void 0,ne=qs===v.name,Ee=Ht[v.name]||150,xe=W===x.columns.length-1;return e.jsxs("th",{className:"px-3 py-2 text-left font-medium text-text-muted border-b border-border relative",style:{width:xe?"auto":Ee,minWidth:80},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{onClick:()=>Ra(v.name),className:g("cursor-pointer hover:text-text-secondary transition-colors truncate",v.primaryKey?"text-primary":""),children:v.name}),f===v.name&&e.jsx("span",{onClick:()=>Ra(v.name),className:"text-primary cursor-pointer hover:opacity-70 transition-opacity flex-shrink-0",title:w?"点击降序":"点击升序",children:w?e.jsx(ms,{size:12}):e.jsx(hs,{size:12})}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),gt(ne?null:v.name)},className:g("ml-auto p-0.5 rounded hover:bg-bg-light/50 transition-colors flex-shrink-0",X?"text-primary":"text-text-muted opacity-50 hover:opacity-100"),title:"筛选",children:e.jsx(St,{size:12})})]}),ne&&e.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[e.jsx("input",{type:"text",value:Oe[v.name]??"",onChange:pe=>Ll(v.name,pe.target.value),placeholder:`筛选 ${v.name}...`,className:"flex-1 px-2 py-1 text-xs bg-bg-light border border-border rounded focus:outline-none focus:ring-1 focus:ring-primary text-text-secondary",autoFocus:!0,onClick:pe=>pe.stopPropagation(),onKeyDown:pe=>{pe.key==="Enter"?gt(null):pe.key==="Escape"&&(Pa(v.name),gt(null))}}),X&&e.jsx("button",{onClick:pe=>{pe.stopPropagation(),Pa(v.name)},className:"p-1 text-text-muted hover:text-red-400 transition-colors",title:"清除筛选",children:e.jsx(cs,{size:12})})]}),!xe&&e.jsx("div",{className:g("absolute right-0 top-0 bottom-0 w-px cursor-col-resize bg-border hover:bg-primary/50 transition-colors",Te&&rs.current?.columnName===v.name&&"bg-primary w-0.5"),onMouseDown:pe=>jr(pe,v.name),children:e.jsx("div",{className:"absolute -left-1.5 -right-1.5 top-0 bottom-0"})})]},v.name)})})}),e.jsx("tbody",{className:"font-mono",children:Fa.map((v,W)=>{const X=Gs?.rowIndex===W,ne=v.values._rowid,Ee=q!==null&&ne===q;return e.jsx("tr",{"data-rowid":ne,className:g("border-b border-border transition-colors",Ee?"bg-primary/25 ring-2 ring-primary/80 ring-inset":X?"bg-purple-500/10":"hover:bg-bg-light/30"),children:x.columns.map((xe,pe)=>{const ke=v.values[xe.name],ge=xe.type?.toLowerCase()==="blob",qt=a&&i&&Et(a,i,xe.name),ws=ge||ke&&Of(ke)&&qt,ot=Ht[xe.name]||150,Ns=pe===x.columns.length-1,qe=X&&Gs?.columnName===xe.name;return e.jsx("td",{className:g("px-3 py-2 text-text-secondary border-r border-border last:border-r-0 overflow-hidden",qe&&"bg-purple-500/20 ring-1 ring-purple-500/50 ring-inset"),style:{width:Ns?"auto":ot,minWidth:80,maxWidth:ot},children:ke===null?e.jsx("span",{className:"text-text-muted italic",children:"NULL"}):ws?e.jsx(Pf,{value:ke,columnName:xe.name,dbId:a,tableName:i,rowData:v.values,onExpandChange:ks=>{Ys(ks?{rowIndex:W,columnName:xe.name}:null)},isHighlighted:qe}):e.jsx(Qi,{text:String(ke),title:xe.name,trigger:"dblclick",children:e.jsx("span",{className:"truncate block cursor-pointer",title:"双击查看完整内容",children:F?zn(String(ke),F):ke})})},xe.name)})},W)})})]}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(jt,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm text-red-400 mb-2",children:h}),e.jsx("button",{onClick:()=>a&&i&&A(t,a,i),className:"px-4 py-2 bg-primary/20 text-primary rounded-lg hover:bg-primary/30 transition-colors text-xs",children:"重试"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"无数据"})]}),x&&x.totalRows!==null&&x.totalRows>p&&e.jsxs("div",{className:"px-4 py-2 border-t border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-text-muted",children:["第 ",y," 页 / 共 ",Math.ceil(x.totalRows/p)," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>La(Math.max(1,y-1)),disabled:y<=1||b,className:"px-3 py-1 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter disabled:opacity-50 transition-colors",children:"上一页"}),e.jsx("button",{onClick:()=>La(y+1),disabled:y>=Math.ceil(x.totalRows/p)||b,className:"px-3 py-1 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter disabled:opacity-50 transition-colors",children:"下一页"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsx("span",{className:"text-4xl mb-3 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:a?"选择一个表查看数据":"选择一个数据库"})]})})})]})}function $n({db:t,isSelected:r,pathPopupDbId:s,pathCopied:n,onSelect:a,onTogglePathPopup:i,onClosePathPopup:o,onCopyPath:l,getDisplayPath:c}){return e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>a(t.descriptor.id),className:g("w-full px-3 py-2 rounded-lg text-left text-xs transition-all",r?"bg-primary text-bg-darkest shadow-sm shadow-primary/30":"text-text-secondary hover:bg-bg-light"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g(r?"text-bg-darkest":"text-text-secondary"),children:Xg(t.descriptor.kind)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.descriptor.name}),e.jsxs("div",{className:g("text-2xs",r?"text-bg-darkest/70":"text-text-muted"),children:[t.tableCount," 表 • ",Jg(t.fileSizeBytes)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.encryptionStatus==="unlocked"&&e.jsx("span",{className:g(r?"text-bg-darkest/70":"text-emerald-500"),title:`已解锁 (${t.descriptor.encryptionType||"SQLCipher"})`,children:e.jsx(Dd,{size:12})}),t.encryptionStatus==="locked"&&e.jsx("span",{className:g(r?"text-red-300":"text-red-500"),title:`已锁定 - 需要密钥 (${t.descriptor.encryptionType||"SQLCipher"})`,children:e.jsx(Gn,{size:12})}),t.descriptor.isSensitive&&e.jsx("span",{className:"text-yellow-500",title:"敏感数据",children:e.jsx(Gn,{size:12})}),e.jsx("span",{"data-path-button":!0,onClick:u=>{u.stopPropagation(),i(t.descriptor.id)},className:g("p-1 rounded transition-colors cursor-pointer",r?"hover:bg-white/20 text-bg-darkest/70 hover:text-bg-darkest":"hover:bg-bg-lighter text-text-muted hover:text-text-secondary"),title:"查看路径",children:e.jsx(Yn,{size:12})})]})]})}),s===t.descriptor.id&&e.jsxs("div",{"data-path-popup":!0,className:"absolute left-0 right-0 mt-1 p-2 bg-bg-dark border border-border rounded-lg shadow-lg z-10",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("span",{className:"text-2xs text-text-muted",children:"数据库路径"}),e.jsx("button",{onClick:u=>{u.stopPropagation(),o()},className:"p-0.5 rounded hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:e.jsx(cs,{size:10})})]}),e.jsx("div",{className:"text-xs text-text-primary font-mono break-all bg-bg-light p-2 rounded",children:c(t)}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx("button",{onClick:u=>{u.stopPropagation(),l(t)},className:g("flex-1 flex items-center justify-center gap-1 px-2 py-1 rounded text-xs transition-colors",n?"bg-accent-green/20 text-accent-green":"bg-bg-light text-text-secondary hover:bg-bg-lighter"),children:n?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:12}),"已复制"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:12}),"复制路径"]})})}),e.jsx("p",{className:"mt-2 text-2xs text-text-muted italic",children:"此路径指向目标设备上的数据库文件位置"})]})]})}class sb{metadata={pluginId:we.DATABASE,displayName:"Database",version:"1.0.0",description:"数据库检查与查询",icon:e.jsx(xs,{size:16})};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["db_query"],s=>this.handleEvent(s)),this.state="ready"}render(r){return e.jsx(rb,{...r})}onActivate(){console.log("[DatabasePlugin] Activated")}onDeactivate(){console.log("[DatabasePlugin] Deactivated")}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}handleEvent(r){console.log("[DatabasePlugin] Received event:",r.eventType)}}function rb({context:t,isActive:r}){const s=t.deviceId;return!r||!s?null:e.jsx("div",{className:"h-full flex flex-col",children:e.jsx(tb,{deviceId:s})})}const nb=new sb;function nn(t){const r=new Date(t),s=String(r.getHours()).padStart(2,"0"),n=String(r.getMinutes()).padStart(2,"0"),a=String(r.getSeconds()).padStart(2,"0"),i=String(r.getMilliseconds()).padStart(3,"0");return`${s}:${n}:${a}.${i}`}function ab(t){const r=new Date(t),s=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");return`${s}-${n}-${a} ${nn(t)}`}const ib="performance";class ob{metadata={pluginId:ib,displayName:"Performance",version:"1.0.0",description:"App 性能监控",icon:e.jsx(us,{size:16})};state="uninitialized";isEnabled=!0;pluginContext=null;unsubscribe=null;async initialize(r){this.pluginContext=r,this.state="loading",this.unsubscribe=r.subscribeToEvents(["performance_metrics","jank_event","performance_alert","alert_resolved","page_timing"],this.handleEvent.bind(this)),this.state="ready"}render(r){return e.jsx(lb,{...r})}onActivate(){console.log("[PerformancePlugin] Activated")}onDeactivate(){console.log("[PerformancePlugin] Deactivated")}handleEvent(r){const s=Ws.getState();if(r.eventType==="performance_metrics"){const n=r.payload,a=Array.isArray(n)?n:n.metrics;a&&a.length>0&&s.addRealtimeMetrics(a)}else if(r.eventType==="jank_event"){const n=r.payload;n&&s.addJankEvent(n)}else if(r.eventType==="performance_alert"){const n=r.payload;n&&s.addAlert(n)}else if(r.eventType==="alert_resolved"){const n=r.payload;n&&s.updateAlert(n)}else if(r.eventType==="page_timing"){const n=r.payload;n&&s.addPageTimingEvent(n)}}onEvent(r){this.handleEvent(r)}destroy(){this.unsubscribe?.(),this.pluginContext=null,this.state="uninitialized"}get context(){return this.pluginContext}}function lb({context:t,isActive:r}){const s=t.deviceId??"",n=Ws(),a=Pe(),i=Tt(),o=d.useMemo(()=>s?a.devices.find(D=>D.deviceId===s)?.isOnline??!1:!1,[s,a.devices]),[l,c]=d.useState("overview"),[u,x]=d.useState(!1),[m,h]=d.useState(!1),[y,p]=d.useState(!1),[f,w]=d.useState(5),[N,E]=d.useState(!1);d.useEffect(()=>{!s||!r||(n.fetchRealtimeMetrics(s),n.fetchStatus(s),n.fetchAlerts(s),n.fetchJankEvents(s),n.fetchTrends(s,60),n.fetchPageTimingEvents(s),n.fetchPageTimingSummary(s),n.fetchAppLaunchData(s))},[s,r]),d.useEffect(()=>{if(!s||!r||!N||f<=0)return;const R=f*1e3,D=setInterval(()=>{n.fetchRealtimeMetrics(s),n.fetchStatus(s)},R);return()=>clearInterval(D)},[s,r,N,f]);const S=d.useCallback(()=>{s&&(n.fetchRealtimeMetrics(s),n.fetchStatus(s),n.fetchJankEvents(s),n.fetchTrends(s,60),n.fetchAlerts(s),n.fetchPageTimingEvents(s),n.fetchPageTimingSummary(s))},[s]),j=d.useCallback(async()=>{if(s){p(!0);try{await Promise.all([n.clearMetrics(s),n.clearPageTimingEvents(s)]),i.show("success","已清除性能数据"),h(!1)}finally{p(!1)}}},[s,i]),k=[{label:"最近 1 分钟",value:60},{label:"最近 5 分钟",value:300},{label:"最近 15 分钟",value:900},{label:"最近 30 分钟",value:1800}];return r?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:S,className:"btn btn-secondary text-xs px-2.5 py-1.5",title:"刷新",children:"刷新"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("div",{className:"flex bg-bg-light rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>c("overview"),className:g("px-3 py-1.5 text-xs rounded-md transition-colors",l==="overview"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:"概览"}),e.jsx("button",{onClick:()=>c("trends"),className:g("px-3 py-1.5 text-xs rounded-md transition-colors",l==="trends"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:"趋势"}),e.jsxs("button",{onClick:()=>c("pageTiming"),className:g("px-3 py-1.5 text-xs rounded-md transition-colors",l==="pageTiming"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:["页面耗时 (",n.pageTimingTotal,")"]}),e.jsxs("button",{onClick:()=>c("janks"),className:g("px-3 py-1.5 text-xs rounded-md transition-colors",l==="janks"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:["卡顿 (",n.jankTotal,")"]}),e.jsxs("button",{onClick:()=>c("alerts"),className:g("px-3 py-1.5 text-xs rounded-md transition-colors relative",l==="alerts"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:["告警",n.activeAlertCount>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center",children:n.activeAlertCount>9?"9+":n.activeAlertCount})]})]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("select",{value:n.timeRange,onChange:R=>n.setTimeRange(Number(R.target.value)),className:"bg-bg-light text-xs text-text-primary rounded px-2.5 py-1.5 border border-border focus:outline-none focus:border-primary",children:k.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs",o?"bg-status-success-bg text-status-success":"bg-bg-light text-text-muted"),children:o?"监控中":"未监控"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{checked:N,onChange:E}),e.jsx("span",{className:"text-xs text-text-muted",children:"自动刷新"}),N&&e.jsxs("select",{value:f,onChange:R=>w(Number(R.target.value)),className:"bg-bg-light text-xs text-text-primary rounded px-1.5 py-0.5 border border-border focus:outline-none focus:border-primary",children:[e.jsx("option",{value:1,children:"1秒"}),e.jsx("option",{value:2,children:"2秒"}),e.jsx("option",{value:5,children:"5秒"}),e.jsx("option",{value:10,children:"10秒"})]})]}),(n.realtimeMetrics.length>0||n.jankEvents.length>0||n.pageTimingTotal>0)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("button",{onClick:()=>h(!0),className:"btn btn-ghost text-red-400 hover:bg-red-500/10 text-xs px-2 py-1.5 flex items-center",title:"清除数据",disabled:y,children:[e.jsx(Ae,{size:14,className:"mr-1"}),"清空"]})]}),e.jsxs("button",{onClick:()=>x(!u),className:g("flex items-center gap-1.5 px-2.5 py-1.5 rounded text-xs font-medium border transition-colors",u?"bg-primary/15 text-primary border-primary hover:bg-primary/20":"bg-bg-light text-text-secondary border-border hover:text-text-primary hover:border-text-muted"),title:"设置",children:[e.jsx(da,{size:14}),"设置"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:l==="overview"?e.jsx(db,{metrics:n.realtimeMetrics,lastMetrics:n.lastMetrics,isLoading:n.isLoading,appLaunchMetrics:n.appLaunchMetrics,appLaunchHistory:n.appLaunchHistory,appLaunchStats:n.appLaunchStats,isLoadingAppLaunch:n.isLoadingAppLaunch}):l==="trends"?e.jsx(hb,{metrics:n.realtimeMetrics,trends:n.trends,isLoading:n.isLoadingTrends}):l==="janks"?e.jsx(xb,{events:n.jankEvents,total:n.jankTotal,page:n.jankPage,pageSize:n.jankPageSize,isLoading:n.isLoadingJanks,onPageChange:R=>n.fetchJankEvents(s,R)}):l==="alerts"?e.jsx(pb,{deviceId:s,alerts:n.alerts,alertRules:n.alertRules,alertConfig:n.alertConfig,isLoading:n.isLoadingAlerts,onResolve:R=>n.resolveAlert(s,R)}):e.jsx(bb,{deviceId:s,events:n.pageTimingEvents,summary:n.pageTimingSummary,total:n.pageTimingTotal,page:n.pageTimingPage,pageSize:n.pageTimingPageSize,isLoading:n.isLoadingPageTiming,isLoadingSummary:n.isLoadingPageTimingSummary,selectedEvent:n.selectedPageTimingEvent,onFetch:R=>n.fetchPageTimingEvents(s,R),onFetchSummary:(R,D,F)=>n.fetchPageTimingSummary(s,R,D,F),onSelectEvent:R=>n.setSelectedPageTimingEvent(R)})}),u&&e.jsx(fb,{config:n.config,onUpdate:R=>n.updateConfig(s,R),onClose:()=>x(!1)}),e.jsx(xt,{isOpen:m,onClose:()=>h(!1),onConfirm:j,title:"清除性能数据",message:`确定要清除该设备的全部性能监控数据吗？

此操作将清除所有性能指标、卡顿事件和告警数据，且不可恢复。`,confirmText:"确认清除",cancelText:"取消",type:"danger",loading:y})]}):null}function cb({history:t}){const r=d.useMemo(()=>[...t].sort((n,a)=>new Date(n.timestamp).getTime()-new Date(a.timestamp).getTime()).map((n,a)=>({index:a+1,time:new Date(n.timestamp).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),total:n.totalTime,preMain:n.preMainTime??0,mainToLaunch:n.mainToLaunchTime??0,launchToFirstFrame:n.launchToFirstFrameTime??0})),[t]),s=({active:n,payload:a,label:i})=>n&&a&&a.length?e.jsxs("div",{className:"bg-bg-darkest border border-border rounded-lg p-2 text-xs shadow-lg",children:[e.jsx("p",{className:"text-text-tertiary mb-1",children:i}),a.map((o,l)=>e.jsxs("p",{style:{color:o.color},children:[o.name,": ",o.value.toFixed(0),"ms"]},l))]}):null;return e.jsx("div",{className:"h-[140px]",children:e.jsx(Es,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Bn,{data:r,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"launchTotalGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(Is,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(Ms,{dataKey:"time",tick:{fontSize:10,fill:"#888"},tickLine:!1,axisLine:!1,interval:"preserveStartEnd"}),e.jsx(Ds,{tick:{fontSize:10,fill:"#888"},tickLine:!1,axisLine:!1,tickFormatter:n=>`${n}ms`,width:50}),e.jsx(Rs,{content:e.jsx(s,{})}),e.jsx(_n,{type:"monotone",dataKey:"total",name:"总耗时",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#launchTotalGradient)",dot:{r:3,fill:"#8b5cf6"},activeDot:{r:5,fill:"#8b5cf6"}})]})})})}function db({metrics:t,lastMetrics:r,isLoading:s,appLaunchMetrics:n,appLaunchHistory:a,appLaunchStats:i,isLoadingAppLaunch:o}){const l=r??t[t.length-1],c=d.useMemo(()=>{if(t.length===0)return null;const u=t.map(j=>j.cpu?.usage??0).filter(j=>j>0),x=t.map(j=>j.memory?.usedMemory??0).filter(j=>j>0),m=t.map(j=>j.fps?.fps??0).filter(j=>j>0),h=t.filter(j=>j.network),y=h.reduce((j,k)=>j+(k.network?.bytesReceived??0),0),p=h.reduce((j,k)=>j+(k.network?.bytesSent??0),0),f=h.length>0?h.reduce((j,k)=>j+(k.network?.downloadRate??0),0)/h.length:0,w=h.length>0?h.reduce((j,k)=>j+(k.network?.uploadRate??0),0)/h.length:0,N=t.filter(j=>j.diskIO),E=N.reduce((j,k)=>j+(k.diskIO?.readBytes??0),0),S=N.reduce((j,k)=>j+(k.diskIO?.writeBytes??0),0);return{avgCPU:u.length>0?u.reduce((j,k)=>j+k,0)/u.length:0,maxCPU:Math.max(...u,0),avgMemory:x.length>0?x.reduce((j,k)=>j+k,0)/x.length:0,maxMemory:Math.max(...x,0),avgFPS:m.length>0?m.reduce((j,k)=>j+k,0)/m.length:0,minFPS:m.length>0?Math.min(...m):0,totalDropped:t.reduce((j,k)=>j+(k.fps?.droppedFrames??0),0),totalJanks:t.reduce((j,k)=>j+(k.fps?.jankCount??0),0),totalReceived:y,totalSent:p,avgDownloadRate:f,avgUploadRate:w,totalRead:E,totalWrite:S}},[t]);return s&&t.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):l?e.jsxs("div",{className:"p-4 space-y-4",children:[(n||a.length>0)&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-100/80 to-indigo-100/80 dark:from-purple-900/30 dark:to-indigo-900/30 rounded-lg p-4 border border-purple-200 dark:border-purple-500/20",children:[e.jsx("h3",{className:"text-sm font-medium text-purple-600 dark:text-purple-300 mb-4",children:"🚀 应用启动时间"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0 w-[280px]",children:(()=>{const u=n??(a.length>0?{totalTime:a[0].totalTime,preMainTime:a[0].preMainTime,mainToLaunchTime:a[0].mainToLaunchTime,launchToFirstFrameTime:a[0].launchToFirstFrameTime,timestamp:a[0].timestamp,preMainDetails:a[0].preMainDetails}:null);return u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-text-muted text-xs",children:"总耗时:"}),e.jsx("span",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:u.totalTime>0?`${u.totalTime.toFixed(0)}ms`:"--"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"PreMain"}),e.jsx("div",{className:"text-base font-semibold text-purple-600 dark:text-purple-400",children:u.preMainTime!=null?`${u.preMainTime.toFixed(0)}ms`:"--"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"Main→Launch"}),e.jsx("div",{className:"text-base font-semibold text-indigo-600 dark:text-indigo-400",children:u.mainToLaunchTime!=null?`${u.mainToLaunchTime.toFixed(0)}ms`:"--"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"Launch→首帧"}),e.jsx("div",{className:"text-base font-semibold text-blue-600 dark:text-blue-400",children:u.launchToFirstFrameTime!=null?`${u.launchToFirstFrameTime.toFixed(0)}ms`:"--"})]})]}),u.preMainDetails&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-200/30 dark:border-purple-500/20",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-2 font-medium",children:"PreMain 细分"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-[10px]",children:[u.preMainDetails.dylibLoadingMs!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"dylib 加载"}),e.jsxs("div",{className:"font-medium text-purple-500",children:[u.preMainDetails.dylibLoadingMs.toFixed(1),"ms"]})]}),u.preMainDetails.staticInitializerMs!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"静态初始化"}),e.jsxs("div",{className:"font-medium text-purple-500",children:[u.preMainDetails.staticInitializerMs.toFixed(1),"ms"]})]}),u.preMainDetails.postDyldToMainMs!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"Post-dyld"}),e.jsxs("div",{className:"font-medium text-purple-500",children:[u.preMainDetails.postDyldToMainMs.toFixed(1),"ms"]})]}),u.preMainDetails.estimatedKernelToConstructorMs!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"内核→构造"}),e.jsxs("div",{className:"font-medium text-purple-500",children:[u.preMainDetails.estimatedKernelToConstructorMs.toFixed(1),"ms"]})]})]}),u.preMainDetails.dylibStats&&e.jsxs("div",{className:"mt-2 text-[10px] text-text-muted",children:[e.jsxs("span",{children:["共 ",u.preMainDetails.dylibStats.totalCount," 个 dylib"]}),e.jsx("span",{className:"mx-1",children:"|"}),e.jsxs("span",{children:["用户库 ",u.preMainDetails.dylibStats.userCount]}),e.jsx("span",{className:"mx-1",children:"|"}),e.jsxs("span",{children:["系统库 ",u.preMainDetails.dylibStats.systemCount]})]}),u.preMainDetails.slowestDylibs&&u.preMainDetails.slowestDylibs.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-1",children:"耗时最长的用户库:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.preMainDetails.slowestDylibs.filter(x=>!x.isSystemLibrary).slice(0,5).map((x,m)=>e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded",children:[x.name,": ",x.loadDurationMs.toFixed(1),"ms"]},m))})]})]}),e.jsxs("div",{className:"mt-3 text-[10px] text-text-muted",children:["记录于: ",u.timestamp?new Date(u.timestamp).toLocaleString():"--"]})]}):e.jsx("div",{className:"text-text-muted text-sm",children:"暂无启动数据"})})()}),e.jsx("div",{className:"flex-1 min-w-0",children:a.length>0?e.jsx(cb,{history:a}):e.jsx("div",{className:"h-[140px] flex items-center justify-center text-text-muted text-xs",children:"暂无历史数据"})})]}),i&&e.jsx("div",{className:"mt-4 pt-3 border-t border-purple-200/50 dark:border-purple-500/20",children:e.jsxs("div",{className:"grid grid-cols-7 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"启动次数"}),e.jsx("div",{className:"font-semibold text-text-primary",children:i.count})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"平均"}),e.jsxs("div",{className:"font-semibold text-purple-600 dark:text-purple-400",children:[i.avgTotalTime.toFixed(0),"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"最小"}),e.jsxs("div",{className:"font-semibold text-status-success",children:[i.minTotalTime.toFixed(0),"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"最大"}),e.jsxs("div",{className:"font-semibold text-red-500",children:[i.maxTotalTime.toFixed(0),"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"P50"}),e.jsxs("div",{className:"font-semibold text-indigo-600 dark:text-indigo-400",children:[i.p50TotalTime.toFixed(0),"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"P90"}),e.jsxs("div",{className:"font-semibold text-orange-500",children:[i.p90TotalTime.toFixed(0),"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"P95"}),e.jsxs("div",{className:"font-semibold text-red-500",children:[i.p95TotalTime.toFixed(0),"ms"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(Or,{icon:e.jsx(bd,{size:20}),title:"CPU",value:l.cpu?.usage?.toFixed(1)??"--",unit:"%",colorClass:jn(l.cpu?.usage??0),subtitle:`线程: ${l.cpu?.threadCount??"--"}`,tooltip:`CPU 使用率表示当前进程占用的 CPU 资源百分比。

• 绿色 (<30%): 正常
• 黄色 (30-60%): 偏高
• 橙色 (60-80%): 较高
• 红色 (>80%): 过高，可能导致卡顿`}),e.jsx(Or,{icon:e.jsx(ti,{size:20}),title:"内存",value:l.memory?Ge(l.memory.usedMemory):"--",colorClass:Ja(l.memory?.memoryPressure??"low"),subtitle:`峰值: ${l.memory?Ge(l.memory.peakMemory):"--"}`,tooltip:`当前应用占用的物理内存大小。

• 峰值: 运行期间的最高内存占用
• 建议保持在设备可用内存的 50% 以下
• 内存过高可能导致应用被系统终止`}),e.jsx(Or,{icon:e.jsx(yd,{size:20}),title:"FPS",value:l.fps?.fps?.toFixed(0)??"--",colorClass:vn(l.fps?.fps??60),subtitle:`丢帧: ${l.fps?.droppedFrames??0}`,tooltip:`每秒渲染帧数 (Frames Per Second)。

• 60 FPS: 流畅体验
• 45-59 FPS: 轻微卡顿
• 30-44 FPS: 明显卡顿
• <30 FPS: 严重卡顿

丢帧数表示未能按时渲染的帧`}),e.jsx(Or,{icon:e.jsx(ti,{size:20}),title:"内存压力",value:l.memory?.memoryPressure??"--",colorClass:Ja(l.memory?.memoryPressure??"low"),subtitle:`占用: ${((l.memory?.footprintRatio??0)*100).toFixed(1)}%`,tooltip:`系统内存压力等级，反映整体内存紧张程度。

• low: 内存充足
• medium: 内存偏紧
• high: 内存紧张
• critical: 内存严重不足

高压力时系统可能会终止后台应用`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(to,{title:"网络流量",icon:"📡",tooltip:`应用的网络使用情况统计。

• 下载速率: 每秒接收的数据量
• 上传速率: 每秒发送的数据量
• 总计: 累计传输的数据量

适用于监控网络请求、流媒体等场景`,hasData:!!l?.network,leftLabel:"下载速率",leftValue:l?.network?`${Ge(l.network.downloadRate)}/s`:"--",leftSubtitle:l?.network?`总计: ${Ge(l.network.bytesReceived)}`:"",leftColor:"text-cyan-400",rightLabel:"上传速率",rightValue:l?.network?`${Ge(l.network.uploadRate)}/s`:"--",rightSubtitle:l?.network?`总计: ${Ge(l.network.bytesSent)}`:"",rightColor:"text-status-success"}),e.jsx(to,{title:"磁盘 I/O",icon:"💾",tooltip:`应用的磁盘读写统计。

• 读取速率: 每秒从磁盘读取的数据量
• 写入速率: 每秒写入磁盘的数据量

注意: iOS 设备上为估算值，基于页面错误和目录大小变化`,hasData:!!l?.diskIO,leftLabel:"读取速率",leftValue:l?.diskIO?`${Ge(l.diskIO.readRate)}/s`:"--",leftSubtitle:l?.diskIO?`总计: ${Ge(l.diskIO.readBytes)}`:"",leftColor:"text-amber-400",rightLabel:"写入速率",rightValue:l?.diskIO?`${Ge(l.diskIO.writeRate)}/s`:"--",rightSubtitle:l?.diskIO?`总计: ${Ge(l.diskIO.writeBytes)}`:"",rightColor:"text-orange-400"})]}),c&&e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"统计概览"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"平均 CPU"}),e.jsxs("div",{className:jn(c.avgCPU),children:[c.avgCPU.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"最高 CPU"}),e.jsxs("div",{className:jn(c.maxCPU),children:[c.maxCPU.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"平均内存"}),e.jsx("div",{className:"text-text-secondary",children:Ge(c.avgMemory)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"峰值内存"}),e.jsx("div",{className:"text-text-secondary",children:Ge(c.maxMemory)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"平均 FPS"}),e.jsx("div",{className:vn(c.avgFPS),children:c.avgFPS.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"最低 FPS"}),e.jsx("div",{className:vn(c.minFPS),children:c.minFPS.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"总丢帧"}),e.jsx("div",{className:"text-orange-400",children:c.totalDropped})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"卡顿次数"}),e.jsx("div",{className:"text-red-400",children:c.totalJanks})]})]}),(c.totalReceived>0||c.totalSent>0||c.totalRead>0||c.totalWrite>0)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-border my-3"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"总下载"}),e.jsx("div",{className:"text-cyan-400",children:Ge(c.totalReceived)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"总上传"}),e.jsx("div",{className:"text-status-success",children:Ge(c.totalSent)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"总读取"}),e.jsx("div",{className:"text-amber-400",children:Ge(c.totalRead)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text-muted",children:"总写入"}),e.jsx("div",{className:"text-orange-400",children:Ge(c.totalWrite)})]})]})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted gap-3",children:[e.jsx(us,{size:48,className:"opacity-30"}),e.jsx("span",{children:"暂无性能数据"})]})}function ub({metrics:t}){const r=a=>new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),s=d.useMemo(()=>t.map(a=>({time:r(a.timestamp),timestamp:new Date(a.timestamp).getTime(),cpu:a.cpu?.usage??0,memory:(a.memory?.usedMemory??0)/1048576,fps:a.fps?.fps??0,droppedFrames:a.fps?.droppedFrames??0,downloadRate:(a.network?.downloadRate??0)/1024,uploadRate:(a.network?.uploadRate??0)/1024})),[t]),n=({active:a,payload:i,label:o})=>a&&i&&i.length?e.jsxs("div",{className:"bg-bg-darkest border border-border rounded-lg p-2 text-xs shadow-lg",children:[e.jsx("p",{className:"text-text-tertiary mb-1",children:o}),i.map((l,c)=>e.jsxs("p",{style:{color:l.color},children:[l.name,": ",typeof l.value=="number"?l.value.toFixed(1):l.value,l.name==="CPU"&&"%",l.name==="内存"&&" MB",l.name==="FPS"&&" fps",l.name.includes("速率")&&" KB/s"]},c))]}):null;return s.length<2?e.jsx("div",{className:"flex items-center justify-center h-32 text-text-muted text-sm",children:"数据收集中，至少需要 2 个数据点..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-tertiary",children:"CPU 使用率 (%)"}),e.jsxs("span",{className:"text-xs text-blue-400",children:["当前: ",s[s.length-1]?.cpu.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-32",children:e.jsx(Es,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Bn,{data:s,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"cpuGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),e.jsx(Is,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(Ms,{dataKey:"time",stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},interval:"preserveStartEnd"}),e.jsx(Ds,{stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},domain:[0,100],tickFormatter:a=>`${a}%`}),e.jsx(Rs,{content:e.jsx(n,{})}),e.jsx(vr,{y:80,stroke:"#EF4444",strokeDasharray:"3 3",label:""}),e.jsx(vr,{y:60,stroke:"#F59E0B",strokeDasharray:"3 3",label:""}),e.jsx(_n,{type:"monotone",dataKey:"cpu",name:"CPU",stroke:"#3B82F6",fill:"url(#cpuGradient)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-tertiary",children:"内存使用 (MB)"}),e.jsxs("span",{className:"text-xs text-emerald-400",children:["当前: ",s[s.length-1]?.memory.toFixed(1)," MB"]})]}),e.jsx("div",{className:"h-32",children:e.jsx(Es,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Bn,{data:s,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"memoryGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})}),e.jsx(Is,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(Ms,{dataKey:"time",stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},interval:"preserveStartEnd"}),e.jsx(Ds,{stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},tickFormatter:a=>`${a}`}),e.jsx(Rs,{content:e.jsx(n,{})}),e.jsx(_n,{type:"monotone",dataKey:"memory",name:"内存",stroke:"#10B981",fill:"url(#memoryGradient)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-tertiary",children:"帧率 (FPS)"}),e.jsxs("span",{className:"text-xs text-amber-400",children:["当前: ",s[s.length-1]?.fps.toFixed(0)," fps"]})]}),e.jsx("div",{className:"h-32",children:e.jsx(Es,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(za,{data:s,children:[e.jsx(Is,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(Ms,{dataKey:"time",stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},interval:"preserveStartEnd"}),e.jsx(Ds,{stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},domain:[0,65],tickFormatter:a=>`${a}`}),e.jsx(Rs,{content:e.jsx(n,{})}),e.jsx(vr,{y:60,stroke:"#22C55E",strokeDasharray:"3 3"}),e.jsx(vr,{y:30,stroke:"#EF4444",strokeDasharray:"3 3"}),e.jsx(gn,{type:"monotone",dataKey:"fps",name:"FPS",stroke:"#F59E0B",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]}),s.some(a=>a.downloadRate>0||a.uploadRate>0)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-tertiary",children:"网络流量 (KB/s)"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"text-cyan-400",children:["↓ ",s[s.length-1]?.downloadRate.toFixed(1)," KB/s"]}),e.jsxs("span",{className:"text-status-success",children:["↑ ",s[s.length-1]?.uploadRate.toFixed(1)," KB/s"]})]})]}),e.jsx("div",{className:"h-32",children:e.jsx(Es,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(za,{data:s,children:[e.jsx(Is,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(Ms,{dataKey:"time",stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10},interval:"preserveStartEnd"}),e.jsx(Ds,{stroke:"#6B7280",tick:{fill:"#9CA3AF",fontSize:10}}),e.jsx(Rs,{content:e.jsx(n,{})}),e.jsx(_l,{wrapperStyle:{fontSize:"10px"},formatter:a=>e.jsx("span",{className:"text-text-tertiary",children:a})}),e.jsx(gn,{type:"monotone",dataKey:"downloadRate",name:"下载速率",stroke:"#22D3EE",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(gn,{type:"monotone",dataKey:"uploadRate",name:"上传速率",stroke:"#22C55E",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]})]})}function Or({icon:t,title:r,value:s,unit:n,colorClass:a,subtitle:i,tooltip:o}){const[l,c]=d.useState(!1);return e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3 relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-text-tertiary",children:t}),e.jsx("span",{className:"text-xs text-text-muted",children:r}),o&&e.jsx("button",{onClick:()=>c(!l),className:"text-text-muted hover:text-text-secondary transition-colors",title:"查看说明",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]})})]}),e.jsxs("div",{className:g("text-2xl font-semibold",a),children:[s,n&&e.jsx("span",{className:"text-sm ml-1",children:n})]}),i&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:i}),l&&o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),e.jsxs("div",{className:"absolute top-full left-0 mt-1 z-20 bg-bg-medium border border-border rounded-lg p-3 shadow-xl max-w-xs",children:[e.jsx("div",{className:"text-xs text-text-secondary whitespace-pre-line",children:o}),e.jsx("button",{onClick:()=>c(!1),className:"absolute top-1 right-1 text-text-tertiary hover:text-text-primary",children:"✕"})]})]})]})}function to({title:t,icon:r,tooltip:s,hasData:n,leftLabel:a,leftValue:i,leftSubtitle:o,leftColor:l,rightLabel:c,rightValue:u,rightSubtitle:x,rightColor:m}){const[h,y]=d.useState(!1);return e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3 relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:l,children:r}),e.jsx("span",{className:"text-xs text-text-muted",children:t}),e.jsx("button",{onClick:()=>y(!h),className:"text-text-muted hover:text-text-secondary transition-colors",title:"查看说明",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]})})]}),n?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-text-muted",children:a}),e.jsx("div",{className:g("text-lg font-semibold",l),children:i}),o&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:o})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-text-muted",children:c}),e.jsx("div",{className:g("text-lg font-semibold",m),children:u}),x&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:x})]})]}):e.jsx("div",{className:"text-sm text-text-muted",children:"暂无数据"}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>y(!1)}),e.jsxs("div",{className:"absolute top-full left-0 mt-1 z-20 bg-bg-medium border border-border rounded-lg p-3 shadow-xl max-w-xs",children:[e.jsx("div",{className:"text-xs text-text-secondary whitespace-pre-line",children:s}),e.jsx("button",{onClick:()=>y(!1),className:"absolute top-1 right-1 text-text-tertiary hover:text-text-primary",children:"✕"})]})]})]})}function xb({events:t,total:r,page:s,pageSize:n,isLoading:a,onPageChange:i}){const o=Math.ceil(r/n),[l,c]=d.useState(null),[u,x]=d.useState({index:50,time:120,duration:100,droppedFrames:80}),[m,h]=d.useState(!1),y=d.useRef(null),p=d.useCallback((w,N)=>{w.preventDefault(),w.stopPropagation();const E=u[N]||100;y.current={columnKey:N,startX:w.clientX,startWidth:E},h(!0)},[u]);if(d.useEffect(()=>{if(!m)return;const w=E=>{if(!y.current)return;const{columnKey:S,startX:j,startWidth:k}=y.current,R=E.clientX-j,D=Math.max(60,Math.min(400,k+R));x(F=>({...F,[S]:D}))},N=()=>{h(!1),y.current=null};return document.addEventListener("mousemove",w),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",N)}},[m]),a&&t.length===0)return e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."});if(t.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted gap-3",children:[e.jsx(us,{size:48,className:"opacity-30"}),e.jsx("span",{children:"暂无卡顿事件"})]});const f=({columnKey:w})=>e.jsx("div",{className:g("absolute right-0 top-0 bottom-0 w-px bg-border",w&&"cursor-col-resize hover:bg-primary/50 transition-colors",m&&y.current?.columnKey===w&&"bg-primary w-0.5"),onMouseDown:w?N=>p(N,w):void 0,children:w&&e.jsx("div",{className:"absolute -left-1.5 -right-1.5 top-0 bottom-0"})});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:g("flex-1 overflow-auto",m&&"select-none"),children:e.jsxs("table",{className:"text-sm table-fixed",style:{minWidth:"100%"},children:[e.jsx("thead",{className:"bg-bg-medium sticky top-0",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"px-3 py-2 text-left text-text-tertiary font-medium relative",style:{width:u.index},children:["#",e.jsx(f,{columnKey:"index"})]}),e.jsxs("th",{className:"px-3 py-2 text-left text-text-tertiary font-medium relative",style:{width:u.time},children:["时间",e.jsx(f,{columnKey:"time"})]}),e.jsxs("th",{className:"px-3 py-2 text-left text-text-tertiary font-medium relative",style:{width:u.duration},children:["持续时间",e.jsx(f,{columnKey:"duration"})]}),e.jsxs("th",{className:"px-3 py-2 text-left text-text-tertiary font-medium relative",style:{width:u.droppedFrames},children:["丢帧数",e.jsx(f,{columnKey:"droppedFrames"})]}),e.jsx("th",{className:"px-3 py-2 text-left text-text-tertiary font-medium",children:e.jsxs("span",{className:"flex items-center gap-1",children:["调用栈",e.jsx("span",{className:"text-text-muted text-[10px]",title:"需要 SDK 配置启用 captureStackTrace",children:"(可选)"})]})})]})}),e.jsx("tbody",{children:t.map((w,N)=>e.jsxs("tr",{className:"border-b border-border hover:bg-bg-medium cursor-pointer select-none transition-colors",onDoubleClick:()=>c(w),title:"双击查看完整详情",children:[e.jsx("td",{className:"px-3 py-2 text-text-muted text-center whitespace-nowrap border-r border-border",style:{width:u.index},children:(s-1)*n+N+1}),e.jsx("td",{className:"px-3 py-2 text-text-secondary whitespace-nowrap border-r border-border",style:{width:u.time},children:nn(w.timestamp)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap border-r border-border",style:{width:u.duration},children:e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs font-medium",w.duration>500?"bg-status-error-bg text-status-error":w.duration>200?"bg-status-warning-bg text-status-warning":"bg-yellow-500/15 text-yellow-600 dark:text-yellow-400"),children:ho(w.duration)})}),e.jsx("td",{className:"px-3 py-2 text-text-secondary text-center whitespace-nowrap border-r border-border",style:{width:u.droppedFrames},children:w.droppedFrames}),e.jsx("td",{className:"px-3 py-2 text-text-muted",children:w.stackTrace?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-text-secondary truncate max-w-md",title:"双击查看完整调用栈",children:w.stackTrace.split(`
`)[0]||w.stackTrace.substring(0,60)}),w.stackTrace.includes(`
`)&&e.jsxs("span",{className:"text-[10px] text-text-tertiary whitespace-nowrap",children:["+",w.stackTrace.split(`
`).length-1," 帧"]})]}):e.jsx("span",{className:"text-text-muted italic",children:"未启用"})})]},w.id))})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-text-muted",children:["共 ",r," 条，双击查看详情"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>i(s-1),disabled:s<=1,className:"px-2 py-1 text-xs rounded bg-bg-medium text-text-secondary disabled:opacity-50",children:"上一页"}),e.jsxs("span",{className:"text-xs text-text-tertiary px-2",children:[s," / ",o]}),e.jsx("button",{onClick:()=>i(s+1),disabled:s>=o,className:"px-2 py-1 text-xs rounded bg-bg-medium text-text-secondary disabled:opacity-50",children:"下一页"})]})]}),l&&e.jsx(mb,{jank:l,onClose:()=>c(null)})]})}function mb({jank:t,onClose:r}){const s=d.useMemo(()=>t.stackTrace?t.stackTrace.split(`
`).filter(n=>n.trim()):[],[t.stackTrace]);return d.useEffect(()=>{const n=a=>{a.key==="Escape"&&r()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[r]),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative bg-bg-dark border border-border rounded-xl shadow-2xl max-w-3xl w-full mx-4 max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(us,{size:20}),"卡顿事件详情"]}),e.jsx("button",{onClick:r,className:"p-1 rounded hover:bg-bg-light transition-colors text-text-muted hover:text-text-primary",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4 border-b border-border bg-bg-medium/50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted text-xs block mb-1",children:"发生时间"}),e.jsx("span",{className:"text-text-primary font-medium",children:ab(t.timestamp)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted text-xs block mb-1",children:"持续时间"}),e.jsx("span",{className:g("px-2 py-0.5 rounded text-sm font-medium inline-block",t.duration>500?"bg-status-error-bg text-status-error":t.duration>200?"bg-status-warning-bg text-status-warning":"bg-yellow-500/15 text-yellow-600 dark:text-yellow-400"),children:ho(t.duration)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted text-xs block mb-1",children:"丢帧数"}),e.jsxs("span",{className:"text-text-primary font-medium",children:[t.droppedFrames," 帧"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-text-muted text-xs font-medium",children:["调用栈 (",s.length," 帧)"]}),t.stackTrace&&e.jsx("button",{onClick:()=>{rt(t.stackTrace||"")},className:"text-xs text-accent-primary hover:text-accent-primary/80 transition-colors",children:"复制调用栈"})]}),s.length>0?e.jsx("div",{className:"bg-bg-darkest rounded-lg border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-auto max-h-[40vh]",children:e.jsx("pre",{className:"text-xs text-text-secondary p-4 font-mono whitespace-pre-wrap break-all",children:s.map((n,a)=>e.jsxs("div",{className:g("py-0.5",a===0&&"text-accent-primary font-medium"),children:[e.jsx("span",{className:"text-text-muted mr-2 select-none",children:String(a).padStart(2,"0")}),n]},a))})})}):e.jsxs("div",{className:"bg-bg-darkest rounded-lg border border-border p-8 text-center",children:[e.jsx("span",{className:"text-text-muted text-sm",children:"未捕获调用栈"}),e.jsx("p",{className:"text-text-tertiary text-xs mt-2",children:"需要在 SDK 配置中启用 captureStackTrace 选项"})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-border",children:e.jsx("button",{onClick:r,className:"px-4 py-2 text-sm rounded-lg bg-bg-light hover:bg-bg-medium text-text-secondary transition-colors",children:"关闭"})})]})]})}function hb({metrics:t,trends:r,isLoading:s}){const[n,a]=d.useState(!1),i=c=>{switch(c){case"improving":return"text-status-success";case"stable":return"text-text-tertiary";case"degrading":return"text-red-400"}},o=c=>{switch(c){case"improving":return"bg-status-success-bg";case"stable":return"bg-bg-light";case"degrading":return"bg-red-400/10"}},l=c=>{switch(c){case"improving":return"改善中";case"stable":return"稳定";case"degrading":return"恶化中"}};return s&&!r?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):r?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>a(!n),className:"text-sm font-medium text-text-secondary hover:text-text-primary transition-colors flex items-center gap-1.5",title:"点击查看趋势说明",children:["整体趋势",e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-text-muted",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]})]})}),e.jsx("span",{className:g("text-sm font-medium px-2 py-0.5 rounded",i(r.overall),o(r.overall)),children:l(r.overall)})]}),e.jsxs("div",{className:"text-xs text-text-muted",children:["分析范围: 最近 ",r.analysisMinutes," 分钟 (",r.dataPoints," 个数据点)"]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),e.jsxs("div",{className:"absolute top-full left-0 mt-1 z-20 bg-bg-medium border border-border rounded-lg p-3 shadow-xl max-w-sm",children:[e.jsxs("div",{className:"text-xs text-text-secondary space-y-2",children:[e.jsx("div",{className:"font-medium mb-2",children:"趋势颜色说明"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-status-success bg-status-success-bg px-2 py-0.5 rounded",children:"改善中"}),e.jsx("span",{className:"text-text-tertiary",children:"指标向好的方向变化"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-text-tertiary bg-bg-light px-2 py-0.5 rounded",children:"稳定"}),e.jsx("span",{className:"text-text-tertiary",children:"指标变化幅度在 5% 以内"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-red-400 bg-red-400/10 px-2 py-0.5 rounded",children:"恶化中"}),e.jsx("span",{className:"text-text-tertiary",children:"指标向差的方向变化"})]}),e.jsxs("div",{className:"border-t border-border pt-2 mt-2 text-text-muted",children:[e.jsx("div",{children:"• CPU/内存: 上升为恶化，下降为改善"}),e.jsx("div",{children:"• FPS: 下降为恶化，上升为改善"})]})]}),e.jsx("button",{onClick:()=>a(!1),className:"absolute top-1 right-1 text-text-tertiary hover:text-text-primary",children:"✕"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.cpu&&e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"CPU 趋势"}),e.jsx("span",{className:g("text-xs px-2 py-0.5 rounded",i(r.cpu.trend),o(r.cpu.trend)),children:l(r.cpu.trend)})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"前半段均值"}),e.jsxs("span",{className:"text-text-secondary",children:[r.cpu.firstHalfAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"后半段均值"}),e.jsxs("span",{className:"text-text-secondary",children:[r.cpu.secondHalfAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"变化幅度"}),e.jsxs("span",{className:r.cpu.changePercent>0?"text-red-400":"text-status-success",children:[r.cpu.changePercent>0?"+":"",r.cpu.changePercent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"范围"}),e.jsxs("span",{className:"text-text-secondary",children:[r.cpu.minValue.toFixed(1),"% - ",r.cpu.maxValue.toFixed(1),"%"]})]})]})]}),r.memory&&e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"内存趋势"}),e.jsx("span",{className:g("text-xs px-2 py-0.5 rounded",i(r.memory.trend),o(r.memory.trend)),children:l(r.memory.trend)})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"前半段均值"}),e.jsxs("span",{className:"text-text-secondary",children:[r.memory.firstHalfAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"后半段均值"}),e.jsxs("span",{className:"text-text-secondary",children:[r.memory.secondHalfAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"变化幅度"}),e.jsxs("span",{className:r.memory.changePercent>0?"text-red-400":"text-status-success",children:[r.memory.changePercent>0?"+":"",r.memory.changePercent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"范围"}),e.jsxs("span",{className:"text-text-secondary",children:[r.memory.minValue.toFixed(1),"% - ",r.memory.maxValue.toFixed(1),"%"]})]})]})]}),r.fps&&e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"FPS 趋势"}),e.jsx("span",{className:g("text-xs px-2 py-0.5 rounded",i(r.fps.trend),o(r.fps.trend)),children:l(r.fps.trend)})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"前半段均值"}),e.jsx("span",{className:"text-text-secondary",children:r.fps.firstHalfAverage.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"后半段均值"}),e.jsx("span",{className:"text-text-secondary",children:r.fps.secondHalfAverage.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"变化幅度"}),e.jsxs("span",{className:r.fps.changePercent<0?"text-red-400":"text-status-success",children:[r.fps.changePercent>0?"+":"",r.fps.changePercent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"范围"}),e.jsxs("span",{className:"text-text-secondary",children:[r.fps.minValue.toFixed(0)," - ",r.fps.maxValue.toFixed(0)]})]})]})]})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"📈 趋势图"}),e.jsx(ub,{metrics:t})]}),r.recommendations&&r.recommendations.length>0&&e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"💡 优化建议"}),e.jsx("ul",{className:"space-y-2",children:r.recommendations.map((c,u)=>e.jsxs("li",{className:"text-xs text-text-tertiary flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"•"}),e.jsx("span",{children:c})]},u))})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted gap-3",children:[e.jsx(us,{size:48,className:"opacity-30"}),e.jsx("span",{children:"暂无趋势数据"}),e.jsx("span",{className:"text-xs",children:"需要至少 1 分钟的监控数据"})]})}function pb({deviceId:t,alerts:r,alertRules:s,isLoading:n,onResolve:a}){const[i,o]=d.useState(!1),[l,c]=d.useState(!1),[u,x]=d.useState(!1),m=Ws(),h=d.useMemo(()=>l?r:r.filter(f=>!f.isResolved),[r,l]),y=d.useMemo(()=>{const f={critical:0,warning:1,info:2};return[...h].sort((w,N)=>w.isResolved!==N.isResolved?w.isResolved?1:-1:f[w.severity]-f[N.severity])},[h]),p=f=>new Date(f).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-shrink-0 px-4 pt-4 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-text-secondary",children:["告警列表",m.activeAlertCount>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 text-xs bg-red-500/20 text-red-400 rounded",children:[m.activeAlertCount," 活跃"]})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-muted cursor-pointer",children:[e.jsx(Ue,{checked:l,onChange:f=>c(f)}),"显示已解决"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>o(!i),className:"btn btn-secondary text-xs px-2 py-1",children:i?"隐藏规则":"告警规则"})})]})}),i&&e.jsx("div",{className:"flex-shrink-0 px-4 pb-3",children:e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary",children:"告警规则"}),e.jsx("button",{onClick:()=>x(!0),className:"btn btn-primary text-xs px-2 py-1",children:"+ 添加规则"})]}),e.jsx("div",{className:"space-y-2",children:s.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-xs text-text-muted mb-2",children:"暂无告警规则"}),e.jsx("p",{className:"text-xs text-text-muted",children:'点击上方"添加规则"按钮创建'})]}):s.map(f=>e.jsxs("div",{className:g("flex items-center justify-between px-2 py-1.5 rounded text-xs",f.isEnabled?"bg-bg-medium":"bg-bg-medium opacity-50"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:Xa(f.severity),children:f.severity==="critical"?"🔴":f.severity==="warning"?"🟡":"🔵"}),e.jsx("span",{className:"text-text-secondary",children:Qa(f.metricType)}),e.jsxs("span",{className:"text-text-muted",children:[od(f.condition)," ",f.threshold,f.metricType==="memory"||f.metricType==="cpu"?"%":""]}),f.durationSeconds>0&&e.jsxs("span",{className:"text-text-muted",children:["持续 ",f.durationSeconds,"s"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>m.updateAlertRule(t,f.id,{isEnabled:!f.isEnabled}),className:g("px-1.5 py-0.5 rounded text-xs",f.isEnabled?"bg-status-success-bg text-status-success":"bg-bg-light text-text-tertiary"),children:f.isEnabled?"启用":"禁用"}),e.jsx("button",{onClick:()=>m.deleteAlertRule(t,f.id),className:"px-1.5 py-0.5 rounded text-xs bg-red-900/50 text-red-400 hover:bg-red-900/70",title:"删除规则",children:"✕"})]})]},f.id))})]})}),u&&e.jsx(gb,{onClose:()=>x(!1),onAdd:f=>{m.addAlertRule(t,f),x(!1)}}),e.jsx("div",{className:"flex-1 overflow-auto px-4 pb-4",children:n?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted gap-3",children:[e.jsx(bo,{size:48,className:"opacity-30"}),e.jsx("span",{children:"暂无告警"})]}):e.jsx("div",{className:"space-y-2",children:y.map(f=>e.jsx("div",{className:g("p-3 rounded-lg border transition-colors",f.isResolved?"bg-bg-medium/30 border-border opacity-60":id(f.severity)),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:g("text-xs font-medium",Xa(f.severity)),children:f.severity==="critical"?"严重":f.severity==="warning"?"警告":"提示"}),e.jsx("span",{className:"text-xs text-text-tertiary",children:Qa(f.metricType)}),e.jsx("span",{className:"text-xs text-text-muted",children:p(f.timestamp)}),f.isResolved&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-status-success-bg text-status-success",children:"已解决"})]}),e.jsx("p",{className:"text-sm text-text-primary",children:f.message}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-text-muted",children:[e.jsxs("span",{children:["当前: ",f.currentValue.toFixed(1)]}),e.jsxs("span",{children:["阈值: ",f.threshold]})]})]}),!f.isResolved&&e.jsx("button",{onClick:()=>a(f.id),className:"ml-2 px-2 py-1 text-xs rounded bg-green-600/80 text-white hover:bg-green-600 transition-colors",children:"解决"})]})},f.id))})})]})}function fb({config:t,onUpdate:r,onClose:s}){const[n,a]=d.useState(t),i=()=>{r(n),s()};return d.useEffect(()=>{const o=l=>{l.key==="Escape"&&s()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[s]),e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-md bg-bg-dark border border-border rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"监控设置"}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-bg-light text-text-muted hover:text-text-primary transition-all",children:"✕"})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"采样间隔"}),e.jsxs("select",{value:n.sampleInterval,onChange:o=>a({...n,sampleInterval:Number(o.target.value)}),className:"select",disabled:n.smartSamplingEnabled,children:[e.jsx("option",{value:.5,children:"0.5 秒"}),e.jsx("option",{value:1,children:"1 秒"}),e.jsx("option",{value:2,children:"2 秒"}),e.jsx("option",{value:5,children:"5 秒"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"智能采样"}),e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"根据系统负载自动调整采样频率"})]}),e.jsx(Ue,{checked:n.smartSamplingEnabled,onChange:o=>a({...n,smartSamplingEnabled:o})})]}),e.jsx("div",{className:"border-t border-border pt-4",children:e.jsx("div",{className:"text-xs text-text-muted mb-3",children:"基础监控项"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"监控 CPU"}),e.jsx(Ue,{checked:n.monitorCPU,onChange:o=>a({...n,monitorCPU:o})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"监控内存"}),e.jsx(Ue,{checked:n.monitorMemory,onChange:o=>a({...n,monitorMemory:o})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"监控 FPS"}),e.jsx(Ue,{checked:n.monitorFPS,onChange:o=>a({...n,monitorFPS:o})})]}),e.jsx("div",{className:"border-t border-border pt-4",children:e.jsx("div",{className:"text-xs text-text-muted mb-3",children:"高级监控项"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"监控网络流量"}),e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"追踪上传/下载速率和总流量"})]}),e.jsx(Ue,{checked:n.monitorNetwork,onChange:o=>a({...n,monitorNetwork:o})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary",children:"监控磁盘 I/O"}),e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"追踪读写速率和总量"})]}),e.jsx(Ue,{checked:n.monitorDiskIO,onChange:o=>a({...n,monitorDiskIO:o})})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"btn btn-secondary px-4 py-2 text-sm",children:"取消"}),e.jsx("button",{onClick:i,className:"btn btn-primary px-4 py-2 text-sm",children:"应用配置"})]})]})]})}function gb({onClose:t,onAdd:r}){const[s,n]=d.useState("cpu"),[a,i]=d.useState(80),[o,l]=d.useState("gt"),[c,u]=d.useState(5),[x,m]=d.useState("warning"),h=()=>{r({metricType:s,threshold:a,condition:o,durationSeconds:c,severity:x})};return d.useEffect(()=>{const y=p=>{p.key==="Escape"&&t()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[t]),e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),e.jsxs("div",{className:"relative w-full max-w-md bg-bg-dark border border-border rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"添加告警规则"}),e.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-bg-light text-text-muted hover:text-text-primary transition-all",children:"✕"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary block mb-1.5",children:"监控指标"}),e.jsxs("select",{value:s,onChange:y=>n(y.target.value),className:"select w-full",children:[e.jsx("option",{value:"cpu",children:"CPU 使用率"}),e.jsx("option",{value:"memory",children:"内存使用"}),e.jsx("option",{value:"fps",children:"FPS"}),e.jsx("option",{value:"jank",children:"卡顿次数"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-text-secondary block mb-1.5",children:"条件"}),e.jsxs("select",{value:o,onChange:y=>l(y.target.value),className:"select w-full",children:[e.jsx("option",{value:"gt",children:"大于"}),e.jsx("option",{value:"gte",children:"大于等于"}),e.jsx("option",{value:"lt",children:"小于"}),e.jsx("option",{value:"lte",children:"小于等于"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm text-text-secondary block mb-1.5",children:["阈值 ",s==="cpu"?"(%)":s==="memory"?"(MB)":""]}),e.jsx("input",{type:"number",value:a,onChange:y=>i(Number(y.target.value)),className:"input w-full",min:0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary block mb-1.5",children:"持续时间 (秒)"}),e.jsx("input",{type:"number",value:c,onChange:y=>u(Number(y.target.value)),className:"input w-full",min:0}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"指标持续达到阈值的时间才触发告警，0 表示立即触发"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary block mb-1.5",children:"严重程度"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m("info"),className:g("flex-1 py-2 px-3 rounded text-xs font-medium transition-colors",x==="info"?"bg-blue-500/20 text-blue-400 border border-blue-500":"bg-bg-medium text-text-tertiary border border-transparent hover:bg-bg-light"),children:"🔵 提示"}),e.jsx("button",{onClick:()=>m("warning"),className:g("flex-1 py-2 px-3 rounded text-xs font-medium transition-colors",x==="warning"?"bg-yellow-500/20 text-yellow-400 border border-yellow-500":"bg-bg-medium text-text-tertiary border border-transparent hover:bg-bg-light"),children:"🟡 警告"}),e.jsx("button",{onClick:()=>m("critical"),className:g("flex-1 py-2 px-3 rounded text-xs font-medium transition-colors",x==="critical"?"bg-red-500/20 text-red-400 border border-red-500":"bg-bg-medium text-text-tertiary border border-transparent hover:bg-bg-light"),children:"🔴 严重"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex justify-end gap-3",children:[e.jsx("button",{onClick:t,className:"btn btn-secondary px-4 py-2 text-sm",children:"取消"}),e.jsx("button",{onClick:h,className:"btn btn-primary px-4 py-2 text-sm",children:"添加规则"})]})]})]})}function bb({events:t,summary:r,total:s,page:n,pageSize:a,isLoading:i,isLoadingSummary:o,selectedEvent:l,onFetch:c,onFetchSummary:u,onSelectEvent:x}){const[m,h]=d.useState("summary"),[y,p]=d.useState(!1),[f,w]=d.useState("count"),[N,E]=d.useState(!0),[S,j]=d.useState("time"),[k,R]=d.useState(!0),[D,F]=d.useState(""),[P,U]=d.useState(void 0),[K,G]=d.useState("all"),q=Math.ceil(s/a),C=d.useCallback(()=>{const H=new Date;switch(K){case"1h":return{from:new Date(H.getTime()-3600*1e3),to:H};case"6h":return{from:new Date(H.getTime()-360*60*1e3),to:H};case"24h":return{from:new Date(H.getTime()-1440*60*1e3),to:H};case"7d":return{from:new Date(H.getTime()-10080*60*1e3),to:H};default:return{from:void 0,to:void 0}}},[K]),b=d.useCallback(H=>{const{from:le,to:Y}=C();c({page:H??1,pageName:D||void 0,minDuration:P,from:le,to:Y}),u(le,Y,D||void 0)},[D,P,C,c,u]),M=d.useCallback(H=>{b(H)},[b]),T=d.useCallback(()=>{F(""),U(void 0),G("all"),c({page:1}),u()},[c,u]),B=D||P||K!=="all",A=[{key:"count",label:"访问次数"},{key:"avgDuration",label:"平均耗时"},{key:"p50",label:"P50"},{key:"p90",label:"P90"},{key:"p95",label:"P95"}],I=[{key:"time",label:"时间"},{key:"loadDuration",label:"加载耗时"},{key:"appearDuration",label:"可见耗时"}],O=d.useCallback(H=>{H===f?E(!N):(w(H),E(!0))},[f,N]),z=d.useCallback(H=>{H===S?R(!k):(j(H),R(!0))},[S,k]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-bg-light rounded p-0.5",children:[e.jsxs("button",{onClick:()=>h("summary"),className:g("px-2 py-0.5 text-xs rounded transition-colors flex items-center gap-1",m==="summary"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:[e.jsx(Ad,{size:12}),"汇总"]}),e.jsxs("button",{onClick:()=>h("list"),className:g("px-2 py-0.5 text-xs rounded transition-colors flex items-center gap-1",m==="list"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:[e.jsx(Fd,{size:12}),"列表"]}),e.jsxs("button",{onClick:()=>h("distribution"),className:g("px-2 py-0.5 text-xs rounded transition-colors flex items-center gap-1",m==="distribution"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary"),children:[e.jsx(zd,{size:12}),"分布"]})]}),e.jsx("div",{className:"h-4 w-px bg-border flex-shrink-0"}),e.jsxs("button",{onClick:()=>p(!y),className:g("btn !text-2xs !px-2 !py-1",y||B?"btn-primary":"btn-secondary"),children:["筛选",B&&e.jsx("span",{className:"ml-1 w-1.5 h-1.5 rounded-full bg-white inline-block"})]}),m==="summary"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-px bg-border flex-shrink-0"}),e.jsx("span",{className:"text-xs text-text-muted",children:"排序:"}),e.jsx("div",{className:"flex gap-1",children:A.map(H=>e.jsxs("button",{onClick:()=>O(H.key),className:g("px-1.5 py-0.5 text-xs rounded transition-colors flex items-center gap-0.5",f===H.key?"bg-primary text-bg-darkest":"bg-bg-light text-text-secondary hover:text-text-primary"),children:[H.label,f===H.key&&e.jsx("span",{className:"text-[10px]",children:N?"↓":"↑"})]},H.key))})]}),m==="list"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-px bg-border flex-shrink-0"}),e.jsx("span",{className:"text-xs text-text-muted",children:"排序:"}),e.jsx("div",{className:"flex gap-1",children:I.map(H=>e.jsxs("button",{onClick:()=>z(H.key),className:g("px-1.5 py-0.5 text-xs rounded transition-colors flex items-center gap-0.5",S===H.key?"bg-primary text-bg-darkest":"bg-bg-light text-text-secondary hover:text-text-primary"),children:[H.label,S===H.key&&e.jsx("span",{className:"text-[10px]",children:k?"↓":"↑"})]},H.key))})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xs text-text-muted",children:["共 ",s," 条记录"]})})]}),y&&e.jsx("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-border bg-bg-medium",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("label",{className:"text-xs text-text-muted",children:"页面名称:"}),e.jsx("input",{type:"text",value:D,onChange:H=>F(H.target.value),placeholder:"搜索页面...",className:"bg-bg-medium text-xs text-text-primary rounded px-2 py-0.5 border border-border focus:outline-none focus:border-primary w-36"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("label",{className:"text-xs text-text-muted",children:"最小耗时:"}),e.jsxs("select",{value:P??"",onChange:H=>U(H.target.value?Number(H.target.value):void 0),className:"bg-bg-medium text-xs text-text-primary rounded px-2 py-0.5 border border-border focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"全部"}),e.jsx("option",{value:"100",children:"> 100ms"}),e.jsx("option",{value:"300",children:"> 300ms"}),e.jsx("option",{value:"500",children:"> 500ms"}),e.jsx("option",{value:"1000",children:"> 1s"}),e.jsx("option",{value:"2000",children:"> 2s"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("label",{className:"text-xs text-text-muted",children:"时间范围:"}),e.jsxs("select",{value:K,onChange:H=>G(H.target.value),className:"bg-bg-medium text-xs text-text-primary rounded px-2 py-0.5 border border-border focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"all",children:"全部"}),e.jsx("option",{value:"1h",children:"最近 1 小时"}),e.jsx("option",{value:"6h",children:"最近 6 小时"}),e.jsx("option",{value:"24h",children:"最近 24 小时"}),e.jsx("option",{value:"7d",children:"最近 7 天"})]})]}),e.jsx("button",{onClick:()=>b(1),className:"btn btn-primary !px-2 !py-1 !text-2xs",children:"应用"}),B&&e.jsx("button",{onClick:T,className:"btn btn-secondary !px-2 !py-1 !text-2xs",children:"重置"})]})}),e.jsx("div",{className:"flex-1 overflow-auto px-4 py-4",children:m==="summary"?e.jsx(yb,{summary:r,isLoading:o,sortKey:f,sortDesc:N}):m==="distribution"?e.jsx(jb,{events:t,summary:r,isLoading:i||o}):e.jsx(wb,{events:t,total:s,page:n,pageSize:a,totalPages:q,isLoading:i,onPageChange:M,onSelectEvent:x,sortKey:S,sortDesc:k})}),l&&e.jsx(Nb,{event:l,onClose:()=>x(null)})]})}function yb({summary:t,isLoading:r,sortKey:s,sortDesc:n}){const[a,i]=d.useState(null),o=d.useMemo(()=>{const l=[...t];return l.sort((c,u)=>{let x,m;switch(s){case"count":x=c.count,m=u.count;break;case"avgDuration":x=c.avgAppearDuration??0,m=u.avgAppearDuration??0;break;case"p50":x=c.p50AppearDuration??0,m=u.p50AppearDuration??0;break;case"p90":x=c.p90AppearDuration??0,m=u.p90AppearDuration??0;break;case"p95":x=c.p95AppearDuration??0,m=u.p95AppearDuration??0;break;default:return 0}return n?m-x:x-m}),l},[t,s,n]);return d.useEffect(()=>{const l=c=>{c.key==="Escape"&&a&&i(null)};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[a]),r&&t.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("span",{className:"text-text-muted text-sm",children:"加载中..."})}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(Qt,{size:48,className:"text-text-muted mb-4"}),e.jsx("span",{className:"text-text-muted text-sm",children:"暂无页面耗时数据"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_80px_70px_70px_70px_70px_60px] gap-2 px-3 py-1.5 text-xs text-text-muted border-b border-border",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["页面",r&&e.jsx("span",{className:"inline-block w-3 h-3 border border-text-muted/30 border-t-text-muted rounded-full animate-spin"})]}),e.jsx("span",{className:"text-right",children:"访问次数"}),e.jsx("span",{className:"text-right",children:"平均"}),e.jsx("span",{className:"text-right",children:"P50"}),e.jsx("span",{className:"text-right",children:"P90"}),e.jsx("span",{className:"text-right",children:"P95"}),e.jsx("span",{className:"text-right",children:"异常"})]}),o.map((l,c)=>e.jsxs("div",{onClick:()=>i(l),className:g("grid grid-cols-[1fr_80px_70px_70px_70px_70px_60px] gap-2 px-3 py-2 rounded cursor-pointer transition-all duration-200","hover:bg-bg-light",a?.pageId===l.pageId&&"bg-primary/10"),style:{animation:`fadeIn 0.3s ease-out ${c*.03}s both`},children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-text-primary truncate",title:l.pageName,children:l.pageName}),e.jsx("p",{className:"text-[10px] text-text-muted truncate",title:l.pageId,children:l.pageId})]}),e.jsx("span",{className:"text-sm text-text-primary text-right font-medium tabular-nums",children:l.count}),e.jsx("span",{className:g("text-sm text-right tabular-nums",Je(l.avgAppearDuration)),children:Me(l.avgAppearDuration)}),e.jsx("span",{className:g("text-sm text-right tabular-nums",Je(l.p50AppearDuration)),children:Me(l.p50AppearDuration)}),e.jsx("span",{className:g("text-sm text-right tabular-nums",Je(l.p90AppearDuration)),children:Me(l.p90AppearDuration)}),e.jsx("span",{className:g("text-sm text-right tabular-nums",Je(l.p95AppearDuration)),children:Me(l.p95AppearDuration)}),e.jsx("span",{className:g("text-sm text-right tabular-nums",l.errorRate&&l.errorRate>0?"text-red-400":"text-text-muted"),children:l.errorRate&&l.errorRate>0?`${(l.errorRate*100).toFixed(0)}%`:"-"})]},l.pageId))]}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>i(null),children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-lg shadow-xl max-w-lg w-full mx-4 overflow-hidden",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary truncate",children:a.pageName}),e.jsx("p",{className:"text-xs text-text-muted truncate",children:a.pageId})]}),e.jsx("button",{onClick:()=>i(null),className:"text-text-muted hover:text-text-primary transition-colors ml-2 text-lg leading-none",children:"×"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"访问次数"}),e.jsx("span",{className:"text-lg font-semibold text-text-primary",children:a.count})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"平均耗时"}),e.jsx("span",{className:g("text-lg font-medium",Je(a.avgAppearDuration)),children:Me(a.avgAppearDuration)})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"P50"}),e.jsx("span",{className:g("text-lg font-medium",Je(a.p50AppearDuration)),children:Me(a.p50AppearDuration)})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"P90"}),e.jsx("span",{className:g("text-lg font-medium",Je(a.p90AppearDuration)),children:Me(a.p90AppearDuration)})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"P95"}),e.jsx("span",{className:g("text-lg font-medium",Je(a.p95AppearDuration)),children:Me(a.p95AppearDuration)})]})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"耗时范围"}),e.jsxs("span",{className:"text-sm text-text-primary",children:[Me(a.minAppearDuration)," ~ ",Me(a.maxAppearDuration)]})]}),a.errorRate!==void 0&&a.errorRate>0&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-red-400 block mb-1",children:"异常率"}),e.jsxs("span",{className:"text-lg font-medium text-red-400",children:[(a.errorRate*100).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-border flex justify-end",children:e.jsx("button",{onClick:()=>i(null),className:"btn btn-secondary text-xs px-3 py-1.5",children:"关闭"})})]})}),e.jsx("style",{children:`
                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(-4px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
            `})]})}function jb({events:t,summary:r,isLoading:s}){const n=d.useMemo(()=>{const i=[{range:"0-100ms",min:0,max:100,count:0,color:"#4ade80"},{range:"100-300ms",min:100,max:300,count:0,color:"#a3e635"},{range:"300-500ms",min:300,max:500,count:0,color:"#facc15"},{range:"500-1s",min:500,max:1e3,count:0,color:"#fb923c"},{range:"1-2s",min:1e3,max:2e3,count:0,color:"#f87171"},{range:">2s",min:2e3,max:1/0,count:0,color:"#ef4444"}];return t.forEach(o=>{const l=o.appearDuration??0,c=i.find(u=>l>=u.min&&l<u.max);c&&c.count++}),i},[t]),a=d.useMemo(()=>[...r].sort((i,o)=>(o.avgAppearDuration??0)-(i.avgAppearDuration??0)).slice(0,10),[r]);return s&&t.length===0&&r.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("span",{className:"text-text-muted text-sm",children:"加载中..."})}):t.length===0&&r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(Qt,{size:48,className:"text-text-muted mb-4"}),e.jsx("span",{className:"text-text-muted text-sm",children:"暂无页面耗时数据"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-bg-light rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-text-primary mb-4 flex items-center gap-2",children:["⏱️ 可见耗时分布",s&&e.jsx("span",{className:"inline-block w-3 h-3 border border-text-muted/30 border-t-text-muted rounded-full animate-spin"})]}),e.jsx("div",{className:"h-64",children:e.jsx(Es,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Wl,{data:n,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(Is,{strokeDasharray:"3 3",stroke:"#333"}),e.jsx(Ms,{dataKey:"range",tick:{fontSize:11,fill:"#9ca3af"},axisLine:{stroke:"#4b5563"}}),e.jsx(Ds,{tick:{fontSize:11,fill:"#9ca3af"},axisLine:{stroke:"#4b5563"},allowDecimals:!1}),e.jsx(Rs,{contentStyle:{backgroundColor:"var(--color-bg-darkest)",border:"1px solid var(--color-border)",borderRadius:"8px",fontSize:"12px",color:"var(--color-text-primary)",boxShadow:"var(--shadow-lg)"},labelStyle:{color:"var(--color-text-primary)"},itemStyle:{color:"var(--color-text-primary)"},cursor:{fill:"rgba(0, 212, 170, 0.15)"},formatter:i=>[`${i} 次`,"访问次数"]}),e.jsx(Hl,{dataKey:"count",radius:[4,4,0,0],children:n.map((i,o)=>e.jsx(Ul,{fill:i.color},`cell-${o}`))})]})})}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-4",children:n.map(i=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:i.color}}),e.jsx("span",{className:"text-[10px] text-text-muted",children:i.range})]},i.range))})]}),a.length>0&&e.jsxs("div",{className:"bg-bg-light rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-4",children:"🐢 Top 10 慢页面 (按平均可见耗时)"}),e.jsx("div",{className:"space-y-2",children:a.map((i,o)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-bg-medium transition-colors",children:[e.jsx("span",{className:g("w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold",o<3?"bg-red-500/20 text-red-400":"bg-bg-medium text-text-muted"),children:o+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary truncate",children:i.pageName}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:["访问 ",i.count," 次"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:g("text-xs font-bold",Je(i.avgAppearDuration)),children:Me(i.avgAppearDuration)}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:["最大 ",Me(i.maxAppearDuration)]})]}),e.jsx("div",{className:"w-24 h-2 bg-bg-dark rounded overflow-hidden",children:e.jsx("div",{className:"h-full rounded",style:{width:`${Math.min((i.avgAppearDuration??0)/(a[0]?.avgAppearDuration||1)*100,100)}%`,backgroundColor:vb(i.avgAppearDuration??0)}})})]},i.pageName))})]})]})}function vb(t){return t<100?"#4ade80":t<300?"#a3e635":t<500?"#facc15":t<1e3?"#fb923c":t<2e3?"#f87171":"#ef4444"}function wb({events:t,total:r,page:s,totalPages:n,isLoading:a,onPageChange:i,onSelectEvent:o,sortKey:l,sortDesc:c}){const{isNewItem:u}=tn(t),x=d.useMemo(()=>{const m=[...t];return m.sort((h,y)=>{let p,f;switch(l){case"time":p=new Date(h.startAt).getTime(),f=new Date(y.startAt).getTime();break;case"loadDuration":p=h.loadDuration??0,f=y.loadDuration??0;break;case"appearDuration":p=h.appearDuration??0,f=y.appearDuration??0;break;default:return 0}return c?f-p:p-f}),m},[t,l,c]);return a&&t.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("span",{className:"text-text-muted text-sm",children:"加载中..."})}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(Qt,{size:48,className:"text-text-muted mb-4"}),e.jsx("span",{className:"text-text-muted text-sm",children:"暂无页面耗时数据"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-3 py-2 text-xs text-text-muted font-medium bg-bg-light rounded",children:[e.jsxs("div",{className:"col-span-3 flex items-center gap-1",children:["页面",a&&e.jsx("span",{className:"inline-block w-3 h-3 border border-text-muted/30 border-t-text-muted rounded-full animate-spin"})]}),e.jsx("div",{className:"col-span-2",children:"路由"}),e.jsx("div",{className:"col-span-2 text-center",children:"加载耗时"}),e.jsx("div",{className:"col-span-2 text-center",children:"可见耗时"}),e.jsx("div",{className:"col-span-2",children:"时间"}),e.jsx("div",{className:"col-span-1 text-center",children:"标记"})]}),x.map(m=>e.jsxs("div",{onClick:()=>o(m),className:g("grid grid-cols-12 gap-2 px-3 py-2 rounded cursor-pointer transition-colors","hover:bg-bg-light border border-transparent hover:border-border",ld(m.appearDuration),u(m.id)&&"animate-row-new"),children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary truncate",children:m.pageName}),e.jsx("p",{className:"text-[10px] text-text-muted truncate",children:m.pageId})]}),e.jsx("div",{className:"col-span-2 text-xs text-text-secondary truncate self-center",children:m.route||"--"}),e.jsx("div",{className:"col-span-2 text-center self-center",children:e.jsx("span",{className:g("text-xs font-medium",Je(m.loadDuration)),children:Me(m.loadDuration)})}),e.jsx("div",{className:"col-span-2 text-center self-center",children:e.jsx("span",{className:g("text-xs font-medium",Je(m.appearDuration)),children:Me(m.appearDuration)})}),e.jsx("div",{className:"col-span-2 text-xs text-text-muted self-center",children:nn(m.startAt)}),e.jsx("div",{className:"col-span-1 text-center self-center",children:m.markers&&m.markers.length>0?e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/20 text-primary text-[10px] font-medium",children:m.markers.length}):e.jsx("span",{className:"text-text-muted",children:"--"})})]},m.id)),n>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border mt-4",children:[e.jsxs("span",{className:"text-xs text-text-muted",children:["第 ",s," / ",n," 页，共 ",r," 条"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(s-1),disabled:s<=1,className:"btn btn-secondary text-xs px-2 py-1 disabled:opacity-50",children:"上一页"}),e.jsx("button",{onClick:()=>i(s+1),disabled:s>=n,className:"btn btn-secondary text-xs px-2 py-1 disabled:opacity-50",children:"下一页"})]})]})]})}function Nb({event:t,onClose:r}){d.useEffect(()=>{const n=a=>{a.key==="Escape"&&r()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[r]);const s=d.useCallback(n=>{n.target===n.currentTarget&&r()},[r]);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:s,children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-lg w-[600px] max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"页面耗时详情"}),e.jsx("button",{onClick:r,className:"text-text-muted hover:text-text-primary",children:"✕"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"基本信息"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-text-muted",children:"页面名称"}),e.jsx("p",{className:"text-sm text-text-primary",children:t.pageName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-text-muted",children:"页面标识"}),e.jsx("p",{className:"text-sm text-text-primary font-mono",children:t.pageId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-text-muted",children:"路由"}),e.jsx("p",{className:"text-sm text-text-primary",children:t.route||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-text-muted",children:"访问 ID"}),e.jsx("p",{className:"text-sm text-text-primary font-mono text-[10px]",children:t.visitId})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"耗时指标"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3 text-center",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"加载耗时"}),e.jsx("span",{className:g("text-lg font-semibold",Je(t.loadDuration)),children:Me(t.loadDuration)}),e.jsx("span",{className:"text-[10px] text-text-muted block mt-1",children:"startAt → firstLayoutAt"})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3 text-center",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"可见耗时"}),e.jsx("span",{className:g("text-lg font-semibold",Je(t.appearDuration)),children:Me(t.appearDuration)}),e.jsx("span",{className:"text-[10px] text-text-muted block mt-1",children:"startAt → appearAt"})]}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-3 text-center",children:[e.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"总耗时"}),e.jsx("span",{className:g("text-lg font-semibold",Je(t.totalDuration)),children:Me(t.totalDuration)}),e.jsx("span",{className:"text-[10px] text-text-muted block mt-1",children:"startAt → endAt"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"时间线"}),e.jsx(kb,{event:t}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(Ar,{label:"开始加载",time:t.startAt,elapsed:0}),t.firstLayoutAt&&e.jsx(Ar,{label:"首次布局",time:t.firstLayoutAt,elapsed:t.loadDuration}),t.appearAt&&e.jsx(Ar,{label:"页面可见",time:t.appearAt,elapsed:t.appearDuration}),t.endAt&&e.jsx(Ar,{label:"页面离开",time:t.endAt,elapsed:t.totalDuration})]})]}),t.markers&&t.markers.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:["自定义标记 (",t.markers.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.markers.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-bg-medium rounded px-3 py-2",children:[e.jsx("span",{className:"text-xs text-text-primary",children:n.name}),e.jsxs("span",{className:"text-xs text-text-muted",children:["+",Me(n.elapsed)]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"上下文信息"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"App 版本"}),e.jsxs("p",{className:"text-text-primary",children:[t.appVersion||"--"," (",t.appBuild||"--",")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"系统版本"}),e.jsx("p",{className:"text-text-primary",children:t.osVersion||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"设备型号"}),e.jsx("p",{className:"text-text-primary",children:t.deviceModel||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"来源页面"}),e.jsx("p",{className:"text-text-primary font-mono",children:t.parentPageId||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"冷启动首页"}),e.jsx("p",{className:"text-text-primary",children:t.isColdStart?"是":"否"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Push 导航"}),e.jsx("p",{className:"text-text-primary",children:t.isPush?"是":"否"})]})]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-border flex justify-end",children:e.jsx("button",{onClick:r,className:"btn btn-secondary px-4 py-2 text-sm",children:"关闭"})})]})})}function Ar({label:t,time:r,elapsed:s}){return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 flex items-center justify-between bg-bg-medium rounded px-3 py-2",children:[e.jsx("span",{className:"text-xs text-text-primary",children:t}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-text-muted",children:nn(r)}),s!==void 0&&s>0&&e.jsxs("span",{className:g("text-xs ml-2",Je(s)),children:["+",Me(s)]})]})]})]})}function kb({event:t}){const r=d.useMemo(()=>{const a=[],i=t.loadDuration??0,o=t.appearDuration??0,l=t.totalDuration??0;return t.firstLayoutAt&&i>0&&a.push({name:"加载",start:0,end:i,color:"#3b82f6"}),t.firstLayoutAt&&t.appearAt&&o>i&&a.push({name:"渲染",start:i,end:o,color:"#8b5cf6"}),t.appearAt&&t.endAt&&l>o&&a.push({name:"交互",start:o,end:l,color:"#10b981"}),a},[t]),s=d.useMemo(()=>!t.markers||t.markers.length===0?[]:t.markers.map(a=>({name:a.name,time:a.elapsed})),[t.markers]),n=t.totalDuration||t.appearDuration||t.loadDuration||1;return e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4",children:[e.jsxs("div",{className:"relative h-10 mb-3",children:[e.jsx("div",{className:"absolute inset-0 flex",children:[0,25,50,75,100].map(a=>e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-border",style:{left:`${a}%`}},a))}),e.jsxs("div",{className:"absolute inset-y-2 left-0 right-0",children:[r.map((a,i)=>{const o=a.start/n*100,l=(a.end-a.start)/n*100;return e.jsx("div",{className:"absolute h-full rounded flex items-center justify-center overflow-hidden",style:{left:`${o}%`,width:`${Math.max(l,1)}%`,backgroundColor:a.color},title:`${a.name}: ${Me(a.end-a.start)}`,children:l>15&&e.jsx("span",{className:"text-[10px] text-white font-medium truncate px-1",children:a.name})},i)}),s.map((a,i)=>{const o=a.time/n*100;return e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-400",style:{left:`${o}%`},title:`${a.name}: +${Me(a.time)}`,children:e.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45 bg-yellow-400"})},`marker-${i}`)})]})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-text-muted",children:[e.jsx("span",{children:"0ms"}),e.jsx("span",{children:Me(n*.25)}),e.jsx("span",{children:Me(n*.5)}),e.jsx("span",{children:Me(n*.75)}),e.jsx("span",{children:Me(n)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-3 pt-3 border-t border-border",children:[r.map(a=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:a.color}}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:[a.name,": ",Me(a.end-a.start)]})]},a.name)),s.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rotate-45"}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:["标记 (",s.length,")"]})]})]})]})}const Cb=new ob;function Sb(){he.register(Hp,{routePath:"/device/:deviceId/http",tabOrder:0}),he.register(hf,{routePath:"/device/:deviceId/websocket",tabOrder:1}),he.register(tf,{routePath:"/device/:deviceId/logs",tabOrder:2}),he.register(nb,{routePath:"/device/:deviceId/database",tabOrder:3}),he.register(Cb,{routePath:"/device/:deviceId/performance",tabOrder:4}),he.register(kp,{routePath:"/device/:deviceId/http",tabOrder:100}),he.register(Lp,{routePath:"/device/:deviceId/http",tabOrder:101}),he.register(zp,{routePath:"/device/:deviceId/http",tabOrder:102}),console.log("[BuiltinPlugins] All builtin plugins registered")}const Tb=["/api-docs","/health"];Sb();he.syncInitialStatesToHub();console.log("[App] Plugin system initialized");function Eb(){const t=ra(),r=!Tb.includes(t.pathname),[s,n]=d.useState(!0);return d.useEffect(()=>{n(!0);const a=setTimeout(()=>n(!1),500);return()=>clearTimeout(a)},[t.pathname]),e.jsxs("div",{className:"flex h-screen bg-bg-darkest text-text-primary",children:[e.jsx(Xm,{isRefreshing:s}),r&&e.jsx(ru,{}),e.jsx("main",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-hidden relative",children:e.jsxs(Bl,{children:[e.jsx(Xs,{path:"/",element:e.jsx($m,{})}),e.jsx(Xs,{path:"/device/:deviceId",element:e.jsx(Fm,{})}),e.jsx(Xs,{path:"/rules",element:e.jsx(Ym,{})}),e.jsx(Xs,{path:"/api-docs",element:e.jsx(Um,{})}),e.jsx(Xs,{path:"/health",element:e.jsx(Gm,{})})]})})})]})}function Ib(){const{theme:t,setTheme:r}=Jr();return d.useEffect(()=>{r(t)},[]),d.useEffect(()=>(ud(()=>{Pe.getState().setAllDevicesOffline()}),md(),()=>hd()),[]),e.jsxs($l,{children:[e.jsx(Eb,{}),e.jsx(Qm,{}),e.jsx(Jm,{}),e.jsx(Km,{})]})}Kl.createRoot(document.getElementById("root")).render(e.jsx(Jt.StrictMode,{children:e.jsx(Ib,{})}));
